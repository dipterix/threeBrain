<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Read `FreeSurfer` surface and volume files"><title>Read `FreeSurfer` surface and volume files — freesurfer_brain • threeBrain</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Read `FreeSurfer` surface and volume files — freesurfer_brain"><meta property="og:description" content="Read `FreeSurfer` surface and volume files"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">threeBrain</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9004</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/A-getting-started.html">Getting Started</a>
    <a class="dropdown-item" href="../articles/B-data-visualization.html">Data Visualization (Electrodes)</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dipterix/threeBrain/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Read `FreeSurfer` surface and volume files</h1>
      <small class="dont-index">Source: <a href="https://github.com/dipterix/threeBrain/blob/HEAD/R/fs_brain.R" class="external-link"><code>R/fs_brain.R</code></a>, <a href="https://github.com/dipterix/threeBrain/blob/HEAD/R/fs_brain2.R" class="external-link"><code>R/fs_brain2.R</code></a></small>
      <div class="d-none name"><code>freesurfer_brain.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Read `FreeSurfer` surface and volume files</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">freesurfer_brain</span><span class="op">(</span></span>
<span>  <span class="va">fs_subject_folder</span>,</span>
<span>  <span class="va">subject_name</span>,</span>
<span>  additional_surfaces <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  aligned_ct <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_cache <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  use_141 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"threeBrain.use141"</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">freesurfer_brain2</span><span class="op">(</span></span>
<span>  <span class="va">fs_subject_folder</span>,</span>
<span>  <span class="va">subject_name</span>,</span>
<span>  volume_types <span class="op">=</span> <span class="st">"t1"</span>,</span>
<span>  surface_types <span class="op">=</span> <span class="st">"pial"</span>,</span>
<span>  curvature <span class="op">=</span> <span class="st">"sulc"</span>,</span>
<span>  atlas_types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aparc+aseg"</span>, <span class="st">"aparc.a2009s+aseg"</span>, <span class="st">"aparc.DKTatlas+aseg"</span><span class="op">)</span>,</span>
<span>  ct_path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_cache <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  use_141 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"threeBrain.use141"</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>fs_subject_folder</dt>
<dd><p>character, `FreeSurfer` subject folder, or `RAVE` subject folder</p></dd>


<dt>subject_name</dt>
<dd><p>character, subject code to display with only letters and digits</p></dd>


<dt>additional_surfaces</dt>
<dd><p>character array, additional surface types to load, such as `white`, `smoothwm`</p></dd>


<dt>aligned_ct</dt>
<dd><p>character, path to `ct_aligned_mri.nii.gz`, used for electrode localization</p></dd>


<dt>use_cache</dt>
<dd><p>logical, whether to use cached `json` files or from raw `FreeSurfer` files</p></dd>


<dt>use_141</dt>
<dd><p>logical, whether to use standard 141 brain for surface file, default is <code>getOption('threeBrain.use141', TRUE)</code></p></dd>


<dt>volume_types</dt>
<dd><p>volume types, right now only support T1 image</p></dd>


<dt>surface_types</dt>
<dd><p>surface types to load</p></dd>


<dt>curvature</dt>
<dd><p>curvature data. Only support <code>"sulc"</code> for current version</p></dd>


<dt>atlas_types</dt>
<dd><p>atlas types to be loaded, choices are <code>'aparc+aseg'</code>,
<code>'aparc.a2009s+aseg'</code>, <code>'aparc.DKTatlas+aseg'</code>, <code>'aseg'</code></p></dd>


<dt>ct_path</dt>
<dd><p>an aligned CT file in 'Nifti' format</p></dd>


<dt>...</dt>
<dd><p>ignored</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is under FreeSurfer license.
1. Volumes:
3D viewer uses `mri/T1.mgz` from `FreeSurfer` to show the
volume information. `T1.mgz` results from step 1 to 5 in `FreeSurfer`
command `recon-all -autorecon1`, which aligns the original `DICOM` image to `RAS` coordinate
system, resamples to volume with <code>256x256x256</code> voxels (tri-linear by default,
check <a href="https://surfer.nmr.mgh.harvard.edu/fswiki/recon-all" class="external-link">https://surfer.nmr.mgh.harvard.edu/fswiki/recon-all</a>
for more information).</p>
<p>2. Surface:
There are two options for surface files. The first choice is using
`std.141` brain generated by `AFNI/SUMA`. This surface file re-calculates vertices
from standard 141 space, which averages the "surface" of 141 subjects. If you
want to map surface electrodes across different subjects, you might want to
consider this case as it's especially designed for surface mapping. However,
you'll need `AFNI/SUMA` installed to generate the surface file. The details
can be found via <a href="https://openwetware.org/wiki/Beauchamp:CorticalSurfaceHCP" class="external-link">https://openwetware.org/wiki/Beauchamp:CorticalSurfaceHCP</a>,
and the `AFNI/SUMA` command related is `SurfToSurf`. Please generate the files
to `[FREESURFER SUBJECT DIR]/SUMA/`. The file name follows the convention of
`std.141.[lr]h.[SURFACE TYPE].[POSTFIX]`, where `lh` means left hemisphere and
`rh` means right hemisphere; `SURFACE TYPE` can be `pial`, `white`, `smoothwm`,
and `POSTFIX` can be `asc`, `gii`. If multiple files for the same surface
type exists, the search order will be `asc &gt; gii`.
The other option is to use mesh files directly from `FreeSurfer` output located
at `[FREESURFER SUBJECT DIR]/surf`. If you want to use these surface, make sure
they are converted to `asc` or `gii` format.</p>
<p>3. Electrode registration and transforms
This package provides two ways to map electrodes to standard space. For surface
electrodes, if standard 141 brain is provided, then the first option is to snap
electrodes to the nearest vertices in subject space. The key is the vertex number
matches across different subjects, hence the location of corresponding vertices
at template brain are the mapped electrode coordinates.
If standard 141 brain is missing, or the electrode type is `stereo EEG`, then
the second option is volume mapping. The idea is to map electrodes to `MNI305`
brain. The details can be found at <a href="https://surfer.nmr.mgh.harvard.edu/fswiki/CoordinateSystems" class="external-link">https://surfer.nmr.mgh.harvard.edu/fswiki/CoordinateSystems</a>.
To perform volume mapping, we need `FreeSurfer` folder `mri/transforms`.
Currently, only linear `Talairach` transform matrix is supported (located at
`talairach.xfm`).</p>
<p>4. Coordinates
The 3D viewer in this package uses the center of volume as the origin (0, 0, 0).</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Zhengjia Wang</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Please run `download_N27()` if `N27` is not at `default_template_directory()`</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Import from `FreeSurfer` subject folder</span></span></span>
<span class="r-in"><span><span class="va">brain</span> <span class="op">=</span> <span class="fu">threeBrain</span><span class="fu">::</span><span class="fu">freesurfer_brain</span><span class="op">(</span></span></span>
<span class="r-in"><span>  fs_subject_folder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="default_template_directory.html">default_template_directory</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'N27'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  subject_name <span class="op">=</span> <span class="st">'N27'</span>,</span></span>
<span class="r-in"><span>  additional_surfaces <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'white'</span>, <span class="st">'smoothwm'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Visualize. Alternatively, you can use brain$plot(...)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">brain</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Zhengjia Wang, John Magnotti.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

