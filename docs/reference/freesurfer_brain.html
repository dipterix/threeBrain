<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Read `FreeSurfer` surface and volume files — freesurfer_brain • threeBrain</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Read `FreeSurfer` surface and volume files — freesurfer_brain" />
<meta property="og:description" content="Read `FreeSurfer` surface and volume files" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">threeBrain</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dipterix/threeBrain/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Read `FreeSurfer` surface and volume files</h1>
    <small class="dont-index">Source: <a href='https://github.com/dipterix/threeBrain/blob/master/R/fs_brain.R'><code>R/fs_brain.R</code></a>, <a href='https://github.com/dipterix/threeBrain/blob/master/R/fs_brain2.R'><code>R/fs_brain2.R</code></a></small>
    <div class="hidden name"><code>freesurfer_brain.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Read `FreeSurfer` surface and volume files</p>
    </div>

    <pre class="usage"><span class='fu'>freesurfer_brain</span><span class='op'>(</span>
  <span class='va'>fs_subject_folder</span>,
  <span class='va'>subject_name</span>,
  additional_surfaces <span class='op'>=</span> <span class='cn'>NULL</span>,
  aligned_ct <span class='op'>=</span> <span class='cn'>NULL</span>,
  use_cache <span class='op'>=</span> <span class='cn'>TRUE</span>,
  use_141 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"threeBrain.use141"</span>, <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='fu'>freesurfer_brain2</span><span class='op'>(</span>
  <span class='va'>fs_subject_folder</span>,
  <span class='va'>subject_name</span>,
  volume_types <span class='op'>=</span> <span class='st'>"t1"</span>,
  surface_types <span class='op'>=</span> <span class='st'>"pial"</span>,
  curvature <span class='op'>=</span> <span class='st'>"sulc"</span>,
  atlas_types <span class='op'>=</span> <span class='st'>"aparc+aseg"</span>,
  ct_path <span class='op'>=</span> <span class='cn'>NULL</span>,
  use_cache <span class='op'>=</span> <span class='cn'>TRUE</span>,
  use_141 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"threeBrain.use141"</span>, <span class='cn'>TRUE</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>fs_subject_folder</th>
      <td><p>character, `FreeSurfer` subject folder, or `RAVE` subject folder</p></td>
    </tr>
    <tr>
      <th>subject_name</th>
      <td><p>character, subject code to display with only letters and digits</p></td>
    </tr>
    <tr>
      <th>additional_surfaces</th>
      <td><p>character array, additional surface types to load, such as `white`, `smoothwm`</p></td>
    </tr>
    <tr>
      <th>aligned_ct</th>
      <td><p>character, path to `ct_aligned_mri.nii.gz`, used for electrode localization</p></td>
    </tr>
    <tr>
      <th>use_cache</th>
      <td><p>logical, whether to use cached `json` files or from raw `FreeSurfer` files</p></td>
    </tr>
    <tr>
      <th>use_141</th>
      <td><p>logical, whether to use standard 141 brain for surface file, default is <code><a href='https://rdrr.io/r/base/options.html'>getOption('threeBrain.use141', TRUE)</a></code></p></td>
    </tr>
    <tr>
      <th>volume_types</th>
      <td><p>volume types, right now only support T1 image</p></td>
    </tr>
    <tr>
      <th>surface_types</th>
      <td><p>surface types to load</p></td>
    </tr>
    <tr>
      <th>curvature</th>
      <td><p>curvature data. Only support <code>"sulc"</code> for current version</p></td>
    </tr>
    <tr>
      <th>atlas_types</th>
      <td><p>atlas types to be loaded, choices are <code>'aparc+aseg'</code>,
<code>'aparc.a2009s+aseg'</code>, <code>'aparc.DKTatlas+aseg'</code>, <code>'aseg'</code></p></td>
    </tr>
    <tr>
      <th>ct_path</th>
      <td><p>an aligned CT file in 'Nifti' format</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>ignored</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function is under FreeSurfer license.
1. Volumes:
3D viewer uses `mri/T1.mgz` from `FreeSurfer` to show the
volume information. `T1.mgz` results from step 1 to 5 in `FreeSurfer`
command `recon-all -autorecon1`, which aligns the original `DICOM` image to `RAS` coordinate
system, resamples to volume with <code>256x256x256</code> voxels (tri-linear by default,
check <a href='https://surfer.nmr.mgh.harvard.edu/fswiki/recon-all'>https://surfer.nmr.mgh.harvard.edu/fswiki/recon-all</a>
for more information).</p>
<p>2. Surface:
There are two options for surface files. The first choice is using
`std.141` brain generated by `AFNI/SUMA`. This surface file re-calculates vertices
from standard 141 space, which averages the "surface" of 141 subjects. If you
want to map surface electrodes across different subjects, you might want to
consider this case as it's especially designed for surface mapping. However,
you'll need `AFNI/SUMA` installed to generate the surface file. The details
can be found via <a href='https://openwetware.org/wiki/Beauchamp:CorticalSurfaceHCP'>https://openwetware.org/wiki/Beauchamp:CorticalSurfaceHCP</a>,
and the `AFNI/SUMA` command related is `SurfToSurf`. Please generate the files
to `[FREESURFER SUBJECT DIR]/SUMA/`. The file name follows the convention of
`std.141.[lr]h.[SURFACE TYPE].[POSTFIX]`, where `lh` means left hemisphere and
`rh` means right hemisphere; `SURFACE TYPE` can be `pial`, `white`, `smoothwm`,
and `POSTFIX` can be `asc`, `gii`. If multiple files for the same surface
type exists, the search order will be `asc &gt; gii`.
The other option is to use mesh files directly from `FreeSurfer` output located
at `[FREESURFER SUBJECT DIR]/surf`. If you want to use these surface, make sure
they are converted to `asc` or `gii` format.</p>
<p>3. Electrode registration and transforms
This package provides two ways to map electrodes to standard space. For surface
electrodes, if standard 141 brain is provided, then the first option is to snap
electrodes to the nearest vertices in subject space. The key is the vertex number
matches across different subjects, hence the location of corresponding vertices
at template brain are the mapped electrode coordinates.
If standard 141 brain is missing, or the electrode type is `stereo EEG`, then
the second option is volume mapping. The idea is to map electrodes to `MNI305`
brain. The details can be found at <a href='https://surfer.nmr.mgh.harvard.edu/fswiki/CoordinateSystems'>https://surfer.nmr.mgh.harvard.edu/fswiki/CoordinateSystems</a>.
To perform volume mapping, we need `FreeSurfer` folder `mri/transforms`.
Currently, only linear `Talairach` transform matrix is supported (located at
`talairach.xfm`).</p>
<p>4. Coordinates
The 3D viewer in this package uses the center of volume as the origin (0, 0, 0).</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Zhengjia Wang</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># Please run `download_N27()` if `N27` is not at '~/rave_data/others/three_brain/'</span>

<span class='co'># Import from `FreeSurfer` subject folder</span>
<span class='va'>brain</span> <span class='op'>=</span> <span class='fu'>threeBrain</span><span class='fu'>::</span><span class='fu'>freesurfer_brain</span><span class='op'>(</span>
  fs_subject_folder <span class='op'>=</span> <span class='st'>'~/rave_data/others/three_brain/N27/'</span>, subject_name <span class='op'>=</span> <span class='st'>'N27'</span>,
  additional_surfaces <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'white'</span>, <span class='st'>'smoothwm'</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='co'># Visualize. Alternatively, you can use brain$plot(...)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span> <span class='va'>brain</span> <span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Zhengjia Wang, John Magnotti, Brian Metzger, Michael Beauchamp.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


