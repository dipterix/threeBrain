(()=>{var __webpack_modules__={6453:(t,e,i)=>{"use strict";const n=i(9937);function r(t,e){return e=l(e),n.isObject(t)?function t(e,i,r){let l=Object.keys(i).map(l=>{let c=o(e,a(l,r));return h=i[l],n.isObject(h)&&!n.isNull(h)&&!Array.isArray(h)&&Object.keys(h).length?t(c,i[l],r):r.expandArrayObjects&&function(t){return Array.isArray(t)}(i[l])?function(t,e,i){let r=s(t,i);return t.length?t.length&&0===n.flatten(r).length?[e]:(r=r.map(t=>{return n=t,Array.isArray(n)&&!n.length?[e]:t.map(t=>o(e,a(t,i)));var n}),n.unique(n.flatten(r))):i.ignoreEmptyArraysWhenExpanding?[]:[e]}(i[l],c,r):c;var h});return n.flatten(l)}("",t,e):[]}function s(t,e){return e=l(e),t.map(t=>n.isObject(t)?r(t,e):[])}function a(t,e){return e.escapeNestedDots?t.replace(/\./g,"\\."):t}function o(t,e){return t?t+"."+e:e}function l(t){return{expandArrayObjects:!1,ignoreEmptyArraysWhenExpanding:!1,escapeNestedDots:!1,...t||{}}}t.exports={deepKeys:r,deepKeysFromList:s}},9937:t=>{"use strict";t.exports={isNull:function(t){return null===t},isObject:function(t){return"object"==typeof t},unique:function(t){return[...new Set(t)]},flatten:function(t){return[].concat(...t)}}},1521:t=>{"use strict";
/**
 * @license MIT
 * doc-path <https://github.com/mrodrig/doc-path>
 * Copyright (c) 2015-present, Michael Rodrigues.
 */function e(t){let e=function(t){for(let e=0;e<t.length;e++){const i=e>0?t[e-1]:"";if("."===t[e]&&"\\"!==i)return e}return-1}(t);return{dotIndex:e,key:t.slice(0,e>=0?e:void 0).replace(/\\./g,"."),remaining:t.slice(e+1)}}t.exports={evaluatePath:function t(i,n){if(!i)return null;let{dotIndex:r,key:s,remaining:a}=e(n);return r>=0&&!i[n]?Array.isArray(i[s])?i[s].map(e=>t(e,a)):t(i[s],a):Array.isArray(i)?i.map(e=>t(e,n)):r>=0&&n!==s&&i[s]?t(i[s],a):-1===r&&i[s]&&!i[n]?i[s]:i[n]},setPath:function(t,i,n){if(!t)throw new Error("No object was provided.");if(!i)throw new Error("No keyPath was provided.");return function t(i,n,r){let{dotIndex:s,key:a,remaining:o}=e(n);if(n.startsWith("__proto__")||n.startsWith("constructor")||n.startsWith("prototype"))return i;if(s>=0){if(!i[a]&&Array.isArray(i))return i.forEach(e=>t(e,n,r));i[a]||(i[a]={}),t(i[a],o,r)}else{if(Array.isArray(i))return i.forEach(e=>t(e,o,r));i[a]=r}return i}(t,i,n)}}},3729:function(t,e){var i,n,r;n=[],void 0===(r="function"==typeof(i=function(){return function t(e,i,n){var r,s,a=window,o="application/octet-stream",l=n||o,c=e,h=!i&&!n&&c,u=document.createElement("a"),d=function(t){return String(t)},p=a.Blob||a.MozBlob||a.WebKitBlob||d,f=i||"download";if(p=p.call?p.bind(a):Blob,"true"===String(this)&&(l=(c=[c,l])[0],c=c[1]),h&&h.length<2048&&(f=h.split("/").pop().split("?")[0],u.href=h,-1!==u.href.indexOf(h))){var m=new XMLHttpRequest;return m.open("GET",h,!0),m.responseType="blob",m.onload=function(e){t(e.target.response,f,o)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&p!==d))return navigator.msSaveBlob?navigator.msSaveBlob(y(c),f):b(c);l=(c=y(c)).type||o}else if(/([\x80-\xff])/.test(c)){for(var g=0,_=new Uint8Array(c.length),v=_.length;g<v;++g)_[g]=c.charCodeAt(g);c=new p([_],{type:l})}function y(t){for(var e=t.split(/[:;,]/),i=e[1],n=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),r=n.length,s=0,a=new Uint8Array(r);s<r;++s)a[s]=n.charCodeAt(s);return new p([a],{type:i})}function b(t,e){if("download"in u)return u.href=t,u.setAttribute("download",f),u.className="download-js-link",u.innerHTML="downloading...",u.style.display="none",document.body.appendChild(u),setTimeout((function(){u.click(),document.body.removeChild(u),!0===e&&setTimeout((function(){a.URL.revokeObjectURL(u.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,o)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var i=document.createElement("iframe");document.body.appendChild(i),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,o)),i.src=t,setTimeout((function(){document.body.removeChild(i)}),333)}if(r=c instanceof p?c:new p([c],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(r,f);if(a.URL)b(a.URL.createObjectURL(r),!0);else{if("string"==typeof r||r.constructor===d)try{return b("data:"+l+";base64,"+a.btoa(r))}catch(t){return b("data:"+l+","+encodeURIComponent(r))}(s=new FileReader).onload=function(t){b(this.result)},s.readAsDataURL(r)}return!0}})?i.apply(e,n):i)||(t.exports=r)},6835:t=>{"use strict";t.exports=JSON.parse('{"errors":{"callbackRequired":"A callback is required!","optionsRequired":"Options were not passed and are required.","json2csv":{"cannotCallOn":"Cannot call json2csv on ","dataCheckFailure":"Data provided was not an array of documents.","notSameSchema":"Not all documents have the same schema."},"csv2json":{"cannotCallOn":"Cannot call csv2json on ","dataCheckFailure":"CSV is not a string."}},"defaultOptions":{"delimiter":{"field":",","wrap":"\\"","eol":"\\n"},"excelBOM":false,"prependHeader":true,"trimHeaderFields":false,"trimFieldValues":false,"sortHeader":false,"parseCsvNumbers":false,"keys":null,"checkSchemaDifferences":false,"expandArrayObjects":false,"unwindArrays":false,"useDateIso8601Format":false,"useLocaleFormat":false,"parseValue":null,"wrapBooleans":false},"values":{"excelBOM":"\ufeff"}}')},7542:(t,e,i)=>{"use strict";let{Json2Csv:n}=i(2293),{Csv2Json:r}=i(5533),s=i(6304);function a(t,e,i,n){return s.convert({data:e,callback:i,options:n,converter:t})}function o(t,e,i){return new Promise((n,r)=>a(t,e,(t,e)=>t?r(t):n(e),i))}function l(t,e,i,n,r){return console.warn("WARNING: "+e+" is deprecated and will be removed soon. Please use "+i+" instead."),o(t,n,r)}t.exports={json2csv:(t,e,i)=>a(n,t,e,i),csv2json:(t,e,i)=>a(r,t,e,i),json2csvAsync:(t,e)=>o(n,t,e),csv2jsonAsync:(t,e)=>o(r,t,e),json2csvPromisified:(t,e)=>l(n,"json2csvPromisified()","json2csvAsync()",t,e),csv2jsonPromisified:(t,e)=>l(r,"csv2jsonPromisified()","csv2jsonAsync()",t,e)}},5533:(t,e,i)=>{"use strict";let n=i(1521),r=i(6835),s=i(6304);t.exports={Csv2Json:function(t){const e=new RegExp(t.delimiter.wrap+t.delimiter.wrap,"g"),i=new RegExp("^"+r.values.excelBOM),a=t.parseValue&&"function"==typeof t.parseValue?t.parseValue:JSON.parse;function o(e){return e=p(e),t.trimHeaderFields?e.split(".").map(t=>t.trim()).join("."):e}function l(e){let i={lines:e},n=i.lines[0];return i.headerFields=n.map((t,e)=>({value:o(t),index:e})),t.keys&&(i.headerFields=i.headerFields.filter(e=>t.keys.includes(e.value))),i}function c(e){return Promise.resolve(function(e){let i,n,r,a,o=[],l=[],c=e.length-1,h=t.delimiter.eol.length,u={insideWrapDelimiter:!1,parsingValue:!0,justParsedDoubleQuote:!1,startIndex:0},d=0;for(;d<e.length;){if(i=e[d],n=d?e[d-1]:"",r=d<c?e[d+1]:"",a=s.getNCharacters(e,d,h),(a!==t.delimiter.eol||u.insideWrapDelimiter)&&d!==c||n!==t.delimiter.field)if(d===c&&i===t.delimiter.field){let t=e.substring(u.startIndex,d);l.push(t),l.push(""),o.push(l)}else if(d===c||a===t.delimiter.eol&&(!u.insideWrapDelimiter||u.insideWrapDelimiter&&n===t.delimiter.wrap&&!u.justParsedDoubleQuote)){let i=d!==c||n===t.delimiter.wrap?d:void 0;l.push(e.substring(u.startIndex,i)),o.push(l),l=[],u.startIndex=d+h,u.parsingValue=!0,u.insideWrapDelimiter=r===t.delimiter.wrap}else if((n!==t.delimiter.wrap||u.justParsedDoubleQuote&&n===t.delimiter.wrap)&&i===t.delimiter.wrap&&s.getNCharacters(e,d+1,h)===t.delimiter.eol)u.insideWrapDelimiter=!1,u.parsingValue=!1;else if(i!==t.delimiter.wrap||0!==d&&s.getNCharacters(e,d-h,h)!==t.delimiter.eol)if(i===t.delimiter.wrap&&r===t.delimiter.field)l.push(e.substring(u.startIndex,d+1)),u.startIndex=d+2,u.insideWrapDelimiter=!1,u.parsingValue=!1;else if(i!==t.delimiter.wrap||n!==t.delimiter.field||u.insideWrapDelimiter||u.parsingValue)if(i===t.delimiter.wrap&&n===t.delimiter.field&&!u.insideWrapDelimiter&&u.parsingValue)l.push(e.substring(u.startIndex,d-1)),u.insideWrapDelimiter=!0,u.parsingValue=!0,u.startIndex=d;else{if(i===t.delimiter.wrap&&r===t.delimiter.wrap){d+=2,u.justParsedDoubleQuote=!0;continue}i===t.delimiter.field&&n!==t.delimiter.wrap&&r!==t.delimiter.wrap&&!u.insideWrapDelimiter&&u.parsingValue?(l.push(e.substring(u.startIndex,d)),u.startIndex=d+1):i!==t.delimiter.field||n!==t.delimiter.wrap||r===t.delimiter.wrap||u.parsingValue||(u.insideWrapDelimiter=!1,u.parsingValue=!0,u.startIndex=d+1)}else u.startIndex=d,u.insideWrapDelimiter=!0,u.parsingValue=!0;else u.insideWrapDelimiter=!0,u.parsingValue=!0,u.startIndex=d;else a===t.delimiter.eol&&u.startIndex===d||i===t.delimiter.field?l.push(""):l.push(e.substr(u.startIndex)),l.push(""),o.push(l),l=[],u.startIndex=d+h,u.parsingValue=!0,u.insideWrapDelimiter=r===t.delimiter.wrap;d++,u.justParsedDoubleQuote=!1}return o}(e))}function h(t){return t.recordLines=t.lines.splice(1),t}function u(e,i){return function(e){let i=function(e){try{if(s.isStringRepresentation(e,t)&&!s.isDateRepresentation(e))return e;let i=a(e);return Array.isArray(i)?i.map(d):i}catch(t){return t}}(e);s.isError(i)||s.isInvalid(i)?"undefined"===e&&(e=void 0):e=i;return e}(e[i.index])}function d(e){return t.trimFieldValues&&!s.isNull(e)?e.trim():e}function p(e){let i=e[0],n=e.length-1,r=e[n];return i===t.delimiter.wrap&&r===t.delimiter.wrap?e.substr(1,n-1):e}function f(i){return i.json=i.recordLines.reduce((r,s)=>{s=s.map(i=>i=d(i=function(i){return i.replace(e,t.delimiter.wrap)}(i=p(i))));let a=function(t,e){return t.reduce((t,i)=>{let r=u(e,i);return n.setPath(t,i.value,r)},{})}(i.headerFields,s);return r.concat(a)},[]),i}return{convert:function(e,n){var r;(r=e,t.excelBOM?Promise.resolve(r.replace(i,"")):Promise.resolve(r)).then(c).then(l).then(h).then(f).then(t=>n(null,t.json)).catch(n)},validationFn:s.isString,validationMessages:r.errors.csv2json}}}},2293:(t,e,i)=>{"use strict";let n=i(1521),r=i(6453),s=i(6835),a=i(6304);t.exports={Json2Csv:function(t){const e=new RegExp(t.delimiter.wrap,"g"),i=/\r?\n|\r/,o=t.parseValue&&"function"==typeof t.parseValue?t.parseValue:function(e){const i=a.isDate(e);return a.isNull(e)||Array.isArray(e)||a.isObject(e)&&!i?JSON.stringify(e):a.isUndefined(e)?"undefined":i&&t.useDateIso8601Format?e.toISOString():t.useLocaleFormat?e.toLocaleString():e.toString()},l=t.expandArrayObjects&&!t.unwindArrays,c={expandArrayObjects:l,ignoreEmptyArraysWhenExpanding:l,escapeNestedDots:!0};function h(e){if(t.checkSchemaDifferences)return function(t){let e=t[0],i=t.slice(1);if(function(t,e){return e.reduce((e,i)=>a.computeSchemaDifferences(t,i).length>0?e+1:e,0)}(e,i))return Promise.reject(new Error(s.errors.json2csv.notSameSchema));return Promise.resolve(e)}(e);{let t=a.unique(a.flatten(e));return Promise.resolve(t)}}function u(e){return t.excludeKeys?e.filter(e=>!t.excludeKeys.includes(e)):e}function d(e){return t.sortHeader?e.sort():e}function p(e){return t.trimHeaderFields&&(e.headerFields=e.headerFields.map(t=>t.split(".").map(t=>t.trim()).join("."))),e}function f(e){return t.prependHeader&&(e.headerFields=e.headerFields.map((function(t){return b(t)}))),e}function m(e){let i=Object.keys(t.fieldTitleMap);return e.header=e.headerFields.map((function(e){return b(i.includes(e)?t.fieldTitleMap[e]:e)})).join(t.delimiter.field),e}function g(e){return t.keys&&(t.keys=t.keys.map(e=>a.isObject(e)&&e.field?(t.fieldTitleMap[e.field]=e.title||e.field,e.field):e)),t.keys&&!t.unwindArrays?Promise.resolve(t.keys).then(u).then(d):function(t){return Promise.resolve(r.deepKeysFromList(t,c))}(e).then(h).then(u).then(d)}function _(e,i=!1){if(t.unwindArrays){const n=e.records.length;return e.headerFields.forEach(t=>{e.records=a.unwind(e.records,t)}),g(e.records).then(r=>(e.headerFields=r,n!==e.records.length?_(e):i?(t.keys&&(e.headerFields=u(t.keys)),e):_(e,!0)))}return e}function v(e){return e.records=e.records.map(i=>{let r=function(e,i){let r=[];return i.forEach(i=>{let s=n.evaluatePath(e,i);!a.isUndefined(t.emptyFieldValue)&&a.isEmptyField(s)?s=t.emptyFieldValue:t.expandArrayObjects&&Array.isArray(s)&&(s=function(e){let i=a.removeEmptyFields(e);if(!e.length||!i.length)return t.emptyFieldValue||"";if(1===i.length)return i[0];return e}(s)),r.push(s)}),r}(i,e.headerFields).map(t=>(t=y(t),t=b(t=o(t))));return r.join(t.delimiter.field)}).join(t.delimiter.eol),e}function y(e){return t.trimFieldValues?Array.isArray(e)?e.map(y):a.isString(e)?e.trim():e:e}function b(n){const r=t.delimiter.wrap;return n.includes(t.delimiter.wrap)&&(n=n.replace(e,r+r)),(n.includes(t.delimiter.field)||n.includes(t.delimiter.wrap)||n.match(i)||t.wrapBooleans&&("true"===n||"false"===n))&&(n=r+n+r),n}function x(e){let i=e.header,n=e.records,r=(t.excelBOM?s.values.excelBOM:"")+(t.prependHeader?i+t.delimiter.eol:"")+n;return e.callback(null,r)}return{convert:function(t,e){a.isObject(t)&&!t.length&&(t=[t]),g(t).then(i=>({headerFields:i,callback:e,records:t})).then(_).then(v).then(f).then(p).then(m).then(x).catch(e)},validationFn:a.isObject,validationMessages:s.errors.json2csv}}}},6304:(t,e,i)=>{"use strict";let n=i(1521),r=i(6835);const s=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/;function a(t){return JSON.parse(JSON.stringify(t))}function o(t){return h(t)||c(t)||""===t}function l(t){return"object"==typeof t}function c(t){return null===t}function h(t){return void 0===t}function u(t,e){return t.filter(t=>!e.includes(t))}t.exports={isStringRepresentation:function(t,e){const i=t[0],n=t.length-1,r=t[n];return i===e.delimiter.wrap&&r===e.delimiter.wrap},isDateRepresentation:function(t){return s.test(t)},computeSchemaDifferences:function(t,e){return u(t,e).concat(u(e,t))},deepCopy:a,convert:function(t){let{options:e,callback:i}=function(t,e){if(l(t)&&(i=t,"function"!=typeof i))return{options:t,callback:e};var i;return{options:e,callback:t}}(t.callback,t.options);n=e,(n={...r.defaultOptions,...n||{}}).fieldTitleMap=new Map,n.delimiter.field=n.delimiter.field||r.defaultOptions.delimiter.field,n.delimiter.wrap=n.delimiter.wrap||r.defaultOptions.delimiter.wrap,n.delimiter.eol=n.delimiter.eol||r.defaultOptions.delimiter.eol,e=n;var n;let s=new t.converter(e);(function(t){if(!t.callback)throw new Error(r.errors.callbackRequired);if(!t.data)return t.callback(new Error(t.errorMessages.cannotCallOn+t.data+".")),!1;if(!t.dataCheckFn(t.data))return t.callback(new Error(t.errorMessages.dataCheckFailure)),!1;return!0})({data:t.data,callback:i,errorMessages:s.validationMessages,dataCheckFn:s.validationFn})&&s.convert(t.data,i)},isEmptyField:o,removeEmptyFields:function(t){return t.filter(t=>!o(t))},getNCharacters:function(t,e,i){return t.substring(e,e+i)},unwind:function(t,e){const i=[];return t.forEach(t=>{!function(t,e,i){const r=n.evaluatePath(e,i);let s=a(e);Array.isArray(r)&&r.length?r.forEach(r=>{s=a(e),t.push(n.setPath(s,i,r))}):Array.isArray(r)&&0===r.length?(n.setPath(s,i,""),t.push(s)):t.push(s)}(i,t,e)}),i},isInvalid:function(t){return t===1/0||t===-1/0},isString:function(t){return"string"==typeof t},isNull:c,isError:function(t){return"[object Error]"===Object.prototype.toString.call(t)},isDate:function(t){return t instanceof Date},isUndefined:h,isObject:l,unique:function(t){return[...new Set(t)]},flatten:function(t){if(t.flat)return t.flat();if(t.length>1e5){let e=[];for(let i=0;i<t.length;i+=1e5)e=e.concat(...t.slice(i,i+1e5));return e}return[].concat(...t)}}},7e3:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ACESFilmicToneMapping:()=>it,AddEquation:()=>A,AddOperation:()=>Z,AdditiveAnimationBlendMode:()=>qe,AdditiveBlending:()=>x,AlphaFormat:()=>kt,AlwaysDepth:()=>V,AlwaysStencilFunc:()=>Si,AmbientLight:()=>Du,AmbientLightProbe:()=>ed,AnimationClip:()=>tu,AnimationLoader:()=>lu,AnimationMixer:()=>Nd,AnimationObjectGroup:()=>Cd,AnimationUtils:()=>Uh,ArcCurve:()=>xc,ArrayCamera:()=>qo,ArrowHelper:()=>bp,Audio:()=>dd,AudioAnalyser:()=>vd,AudioContext:()=>$u,AudioListener:()=>ud,AudioLoader:()=>Qu,AxesHelper:()=>xp,AxisHelper:()=>xf,BackSide:()=>m,BasicDepthPacking:()=>ri,BasicShadowMap:()=>h,BinaryTextureLoader:()=>Ef,Bone:()=>Nl,BooleanKeyframeTrack:()=>Yh,BoundingBoxHelper:()=>wf,Box2:()=>Ud,Box3:()=>hn,Box3Helper:()=>mp,BoxBufferGeometry:()=>bs,BoxGeometry:()=>bs,BoxHelper:()=>fp,BufferAttribute:()=>Dr,BufferGeometry:()=>ts,BufferGeometryLoader:()=>Uu,ByteType:()=>At,Cache:()=>iu,Camera:()=>As,CameraHelper:()=>up,CanvasRenderer:()=>Tf,CanvasTexture:()=>oc,CatmullRomCurve3:()=>Lc,CineonToneMapping:()=>et,CircleBufferGeometry:()=>cc,CircleGeometry:()=>cc,ClampToEdgeWrapping:()=>dt,Clock:()=>sd,Color:()=>Cr,ColorKeyframeTrack:()=>Jh,CompressedTexture:()=>ac,CompressedTextureLoader:()=>cu,ConeBufferGeometry:()=>uc,ConeGeometry:()=>uc,CubeCamera:()=>Ls,CubeReflectionMapping:()=>st,CubeRefractionMapping:()=>at,CubeTexture:()=>Ts,CubeTextureLoader:()=>uu,CubeUVReflectionMapping:()=>ct,CubeUVRefractionMapping:()=>ht,CubicBezierCurve:()=>Nc,CubicBezierCurve3:()=>Rc,CubicInterpolant:()=>Hh,CullFaceBack:()=>o,CullFaceFront:()=>l,CullFaceFrontBack:()=>c,CullFaceNone:()=>a,Curve:()=>yc,CurvePath:()=>fu,CustomBlending:()=>M,CustomToneMapping:()=>nt,CylinderBufferGeometry:()=>hc,CylinderGeometry:()=>hc,Cylindrical:()=>zd,DataTexture:()=>Rl,DataTexture2DArray:()=>na,DataTexture3D:()=>ra,DataTextureLoader:()=>du,DataUtils:()=>Mp,DecrementStencilOp:()=>di,DecrementWrapStencilOp:()=>fi,DefaultLoadingManager:()=>ru,DepthFormat:()=>Vt,DepthStencilFormat:()=>Ht,DepthTexture:()=>lc,DirectionalLight:()=>Ru,DirectionalLightHelper:()=>lp,DiscreteInterpolant:()=>Wh,DodecahedronBufferGeometry:()=>pc,DodecahedronGeometry:()=>pc,DoubleSide:()=>g,DstAlphaFactor:()=>k,DstColorFactor:()=>B,DynamicBufferAttribute:()=>uf,DynamicCopyUsage:()=>Ni,DynamicDrawUsage:()=>Ai,DynamicReadUsage:()=>Ti,EdgesGeometry:()=>vc,EdgesHelper:()=>Sf,EllipseCurve:()=>bc,EqualDepth:()=>W,EqualStencilFunc:()=>vi,EquirectangularReflectionMapping:()=>ot,EquirectangularRefractionMapping:()=>lt,Euler:()=>Jn,EventDispatcher:()=>Oi,ExtrudeBufferGeometry:()=>ph,ExtrudeGeometry:()=>ph,FaceColors:()=>Qp,FileLoader:()=>ou,FlatShading:()=>_,Float16BufferAttribute:()=>Ur,Float32Attribute:()=>yf,Float32BufferAttribute:()=>Vr,Float64Attribute:()=>bf,Float64BufferAttribute:()=>Hr,FloatType:()=>Pt,Fog:()=>el,FogExp2:()=>tl,Font:()=>Ju,FontLoader:()=>Ku,FrontSide:()=>f,Frustum:()=>ks,GLBufferAttribute:()=>Id,GLSL1:()=>Di,GLSL3:()=>Ii,GammaEncoding:()=>$e,GreaterDepth:()=>Y,GreaterEqualDepth:()=>q,GreaterEqualStencilFunc:()=>wi,GreaterStencilFunc:()=>bi,GridHelper:()=>np,Group:()=>Yo,HalfFloatType:()=>Nt,HemisphereLight:()=>vu,HemisphereLightHelper:()=>ip,HemisphereLightProbe:()=>td,IcosahedronBufferGeometry:()=>mh,IcosahedronGeometry:()=>mh,ImageBitmapLoader:()=>qu,ImageLoader:()=>hu,ImageUtils:()=>Zi,ImmediateRenderObject:()=>Wd,IncrementStencilOp:()=>ui,IncrementWrapStencilOp:()=>pi,InstancedBufferAttribute:()=>ju,InstancedBufferGeometry:()=>zu,InstancedInterleavedBuffer:()=>Dd,InstancedMesh:()=>jl,Int16Attribute:()=>mf,Int16BufferAttribute:()=>Fr,Int32Attribute:()=>_f,Int32BufferAttribute:()=>zr,Int8Attribute:()=>df,Int8BufferAttribute:()=>Ir,IntType:()=>Tt,InterleavedBuffer:()=>nl,InterleavedBufferAttribute:()=>sl,Interpolant:()=>Vh,InterpolateDiscrete:()=>ze,InterpolateLinear:()=>je,InterpolateSmooth:()=>Ue,InvertStencilOp:()=>mi,JSONLoader:()=>Cf,KeepStencilOp:()=>ci,KeyframeTrack:()=>qh,LOD:()=>Ml,LatheBufferGeometry:()=>gh,LatheGeometry:()=>gh,Layers:()=>Xn,LensFlare:()=>Nf,LessDepth:()=>H,LessEqualDepth:()=>G,LessEqualStencilFunc:()=>yi,LessStencilFunc:()=>_i,Light:()=>_u,LightProbe:()=>ku,Line:()=>Yl,Line3:()=>Gd,LineBasicMaterial:()=>Ul,LineCurve:()=>Dc,LineCurve3:()=>Ic,LineDashedMaterial:()=>zh,LineLoop:()=>Zl,LinePieces:()=>Zp,LineSegments:()=>Kl,LineStrip:()=>Kp,LinearEncoding:()=>Ke,LinearFilter:()=>yt,LinearInterpolant:()=>Gh,LinearMipMapLinearFilter:()=>St,LinearMipMapNearestFilter:()=>xt,LinearMipmapLinearFilter:()=>wt,LinearMipmapNearestFilter:()=>bt,LinearToneMapping:()=>Q,Loader:()=>su,LoaderUtils:()=>Bu,LoadingManager:()=>nu,LogLuvEncoding:()=>ti,LoopOnce:()=>ke,LoopPingPong:()=>Be,LoopRepeat:()=>Fe,LuminanceAlphaFormat:()=>jt,LuminanceFormat:()=>zt,MOUSE:()=>r,Material:()=>wr,MaterialLoader:()=>Fu,Math:()=>Yi,MathUtils:()=>Yi,Matrix3:()=>Xi,Matrix4:()=>Bn,MaxEquation:()=>C,Mesh:()=>vs,MeshBasicMaterial:()=>Pr,MeshDepthMaterial:()=>jo,MeshDistanceMaterial:()=>Uo,MeshFaceMaterial:()=>ef,MeshLambertMaterial:()=>Fh,MeshMatcapMaterial:()=>Bh,MeshNormalMaterial:()=>kh,MeshPhongMaterial:()=>Ih,MeshPhysicalMaterial:()=>Dh,MeshStandardMaterial:()=>Rh,MeshToonMaterial:()=>Oh,MinEquation:()=>T,MirroredRepeatWrapping:()=>pt,MixOperation:()=>K,MultiMaterial:()=>nf,MultiplyBlending:()=>S,MultiplyOperation:()=>X,NearestFilter:()=>ft,NearestMipMapLinearFilter:()=>vt,NearestMipMapNearestFilter:()=>gt,NearestMipmapLinearFilter:()=>_t,NearestMipmapNearestFilter:()=>mt,NeverDepth:()=>U,NeverStencilFunc:()=>gi,NoBlending:()=>y,NoColors:()=>$p,NoToneMapping:()=>$,NormalAnimationBlendMode:()=>We,NormalBlending:()=>b,NotEqualDepth:()=>J,NotEqualStencilFunc:()=>xi,NumberKeyframeTrack:()=>Xh,Object3D:()=>cr,ObjectLoader:()=>Vu,ObjectSpaceNormalMap:()=>oi,OctahedronBufferGeometry:()=>_h,OctahedronGeometry:()=>_h,OneFactor:()=>N,OneMinusDstAlphaFactor:()=>F,OneMinusDstColorFactor:()=>z,OneMinusSrcAlphaFactor:()=>O,OneMinusSrcColorFactor:()=>D,OrthographicCamera:()=>Pu,PCFShadowMap:()=>u,PCFSoftShadowMap:()=>d,PMREMGenerator:()=>Up,ParametricBufferGeometry:()=>vh,ParametricGeometry:()=>vh,Particle:()=>sf,ParticleBasicMaterial:()=>lf,ParticleSystem:()=>af,ParticleSystemMaterial:()=>cf,Path:()=>mu,PerspectiveCamera:()=>Es,Plane:()=>Ds,PlaneBufferGeometry:()=>zs,PlaneGeometry:()=>zs,PlaneHelper:()=>gp,PointCloud:()=>rf,PointCloudMaterial:()=>of,PointLight:()=>Cu,PointLightHelper:()=>$d,Points:()=>nc,PointsMaterial:()=>$l,PolarGridHelper:()=>rp,PolyhedronBufferGeometry:()=>dc,PolyhedronGeometry:()=>dc,PositionalAudio:()=>_d,PropertyBinding:()=>Td,PropertyMixer:()=>yd,QuadraticBezierCurve:()=>Oc,QuadraticBezierCurve3:()=>kc,Quaternion:()=>an,QuaternionKeyframeTrack:()=>Zh,QuaternionLinearInterpolant:()=>Kh,REVISION:()=>n,RGBADepthPacking:()=>si,RGBAFormat:()=>Bt,RGBAIntegerFormat:()=>Xt,RGBA_ASTC_10x10_Format:()=>ve,RGBA_ASTC_10x5_Format:()=>me,RGBA_ASTC_10x6_Format:()=>ge,RGBA_ASTC_10x8_Format:()=>_e,RGBA_ASTC_12x10_Format:()=>ye,RGBA_ASTC_12x12_Format:()=>be,RGBA_ASTC_4x4_Format:()=>oe,RGBA_ASTC_5x4_Format:()=>le,RGBA_ASTC_5x5_Format:()=>ce,RGBA_ASTC_6x5_Format:()=>he,RGBA_ASTC_6x6_Format:()=>ue,RGBA_ASTC_8x5_Format:()=>de,RGBA_ASTC_8x6_Format:()=>pe,RGBA_ASTC_8x8_Format:()=>fe,RGBA_BPTC_Format:()=>xe,RGBA_ETC2_EAC_Format:()=>ae,RGBA_PVRTC_2BPPV1_Format:()=>ne,RGBA_PVRTC_4BPPV1_Format:()=>ie,RGBA_S3TC_DXT1_Format:()=>Zt,RGBA_S3TC_DXT3_Format:()=>$t,RGBA_S3TC_DXT5_Format:()=>Qt,RGBDEncoding:()=>ni,RGBEEncoding:()=>Qe,RGBEFormat:()=>Ut,RGBFormat:()=>Ft,RGBIntegerFormat:()=>Jt,RGBM16Encoding:()=>ii,RGBM7Encoding:()=>ei,RGB_ETC1_Format:()=>re,RGB_ETC2_Format:()=>se,RGB_PVRTC_2BPPV1_Format:()=>ee,RGB_PVRTC_4BPPV1_Format:()=>te,RGB_S3TC_DXT1_Format:()=>Kt,RGFormat:()=>qt,RGIntegerFormat:()=>Yt,RawShaderMaterial:()=>Nh,Ray:()=>Fn,Raycaster:()=>Od,RectAreaLight:()=>Iu,RedFormat:()=>Gt,RedIntegerFormat:()=>Wt,ReinhardToneMapping:()=>tt,RepeatWrapping:()=>ut,ReplaceStencilOp:()=>hi,ReverseSubtractEquation:()=>L,RingBufferGeometry:()=>yh,RingGeometry:()=>yh,SRGB8_ALPHA8_ASTC_10x10_Format:()=>De,SRGB8_ALPHA8_ASTC_10x5_Format:()=>Pe,SRGB8_ALPHA8_ASTC_10x6_Format:()=>Ne,SRGB8_ALPHA8_ASTC_10x8_Format:()=>Re,SRGB8_ALPHA8_ASTC_12x10_Format:()=>Ie,SRGB8_ALPHA8_ASTC_12x12_Format:()=>Oe,SRGB8_ALPHA8_ASTC_4x4_Format:()=>we,SRGB8_ALPHA8_ASTC_5x4_Format:()=>Se,SRGB8_ALPHA8_ASTC_5x5_Format:()=>Me,SRGB8_ALPHA8_ASTC_6x5_Format:()=>Ae,SRGB8_ALPHA8_ASTC_6x6_Format:()=>Ee,SRGB8_ALPHA8_ASTC_8x5_Format:()=>Le,SRGB8_ALPHA8_ASTC_8x6_Format:()=>Te,SRGB8_ALPHA8_ASTC_8x8_Format:()=>Ce,Scene:()=>il,SceneUtils:()=>Pf,ShaderChunk:()=>js,ShaderLib:()=>Vs,ShaderMaterial:()=>Ms,ShadowMaterial:()=>Ph,Shape:()=>gu,ShapeBufferGeometry:()=>bh,ShapeGeometry:()=>bh,ShapePath:()=>Yu,ShapeUtils:()=>hh,ShortType:()=>Et,Skeleton:()=>Ol,SkeletonHelper:()=>Zd,SkinnedMesh:()=>Pl,SmoothShading:()=>v,Sphere:()=>Cn,SphereBufferGeometry:()=>xh,SphereGeometry:()=>xh,Spherical:()=>Bd,SphericalHarmonics3:()=>Ou,SplineCurve:()=>Fc,SpotLight:()=>Mu,SpotLightHelper:()=>Yd,Sprite:()=>bl,SpriteMaterial:()=>al,SrcAlphaFactor:()=>I,SrcAlphaSaturateFactor:()=>j,SrcColorFactor:()=>R,StaticCopyUsage:()=>Pi,StaticDrawUsage:()=>Mi,StaticReadUsage:()=>Li,StereoCamera:()=>rd,StreamCopyUsage:()=>Ri,StreamDrawUsage:()=>Ei,StreamReadUsage:()=>Ci,StringKeyframeTrack:()=>$h,SubtractEquation:()=>E,SubtractiveBlending:()=>w,TOUCH:()=>s,TangentSpaceNormalMap:()=>ai,TetrahedronBufferGeometry:()=>wh,TetrahedronGeometry:()=>wh,TextBufferGeometry:()=>Sh,TextGeometry:()=>Sh,Texture:()=>Qi,TextureLoader:()=>pu,TorusBufferGeometry:()=>Mh,TorusGeometry:()=>Mh,TorusKnotBufferGeometry:()=>Ah,TorusKnotGeometry:()=>Ah,Triangle:()=>br,TriangleFanDrawMode:()=>Xe,TriangleStripDrawMode:()=>Je,TrianglesDrawMode:()=>Ye,TubeBufferGeometry:()=>Eh,TubeGeometry:()=>Eh,UVMapping:()=>rt,Uint16Attribute:()=>gf,Uint16BufferAttribute:()=>Br,Uint32Attribute:()=>vf,Uint32BufferAttribute:()=>jr,Uint8Attribute:()=>pf,Uint8BufferAttribute:()=>Or,Uint8ClampedAttribute:()=>ff,Uint8ClampedBufferAttribute:()=>kr,Uniform:()=>Rd,UniformsLib:()=>Us,UniformsUtils:()=>Ss,UnsignedByteType:()=>Mt,UnsignedInt248Type:()=>Ot,UnsignedIntType:()=>Ct,UnsignedShort4444Type:()=>Rt,UnsignedShort5551Type:()=>Dt,UnsignedShort565Type:()=>It,UnsignedShortType:()=>Lt,VSMShadowMap:()=>p,Vector2:()=>Ji,Vector3:()=>on,Vector4:()=>en,VectorKeyframeTrack:()=>Qh,Vertex:()=>hf,VertexColors:()=>tf,VideoTexture:()=>sc,WebGL1Renderer:()=>Qo,WebGLCubeRenderTarget:()=>Cs,WebGLMultipleRenderTargets:()=>rn,WebGLMultisampleRenderTarget:()=>sn,WebGLRenderTarget:()=>nn,WebGLRenderTargetCube:()=>Lf,WebGLRenderer:()=>$o,WebGLUtils:()=>Wo,WireframeGeometry:()=>Lh,WireframeHelper:()=>Mf,WrapAroundEnding:()=>Ge,XHRLoader:()=>Af,ZeroCurvatureEnding:()=>Ve,ZeroFactor:()=>P,ZeroSlopeEnding:()=>He,ZeroStencilOp:()=>li,sRGBEncoding:()=>Ze});
/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const n="131dev",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},a=0,o=1,l=2,c=3,h=0,u=1,d=2,p=3,f=0,m=1,g=2,_=1,v=2,y=0,b=1,x=2,w=3,S=4,M=5,A=100,E=101,L=102,T=103,C=104,P=200,N=201,R=202,D=203,I=204,O=205,k=206,F=207,B=208,z=209,j=210,U=0,V=1,H=2,G=3,W=4,q=5,Y=6,J=7,X=0,K=1,Z=2,$=0,Q=1,tt=2,et=3,it=4,nt=5,rt=300,st=301,at=302,ot=303,lt=304,ct=306,ht=307,ut=1e3,dt=1001,pt=1002,ft=1003,mt=1004,gt=1004,_t=1005,vt=1005,yt=1006,bt=1007,xt=1007,wt=1008,St=1008,Mt=1009,At=1010,Et=1011,Lt=1012,Tt=1013,Ct=1014,Pt=1015,Nt=1016,Rt=1017,Dt=1018,It=1019,Ot=1020,kt=1021,Ft=1022,Bt=1023,zt=1024,jt=1025,Ut=Bt,Vt=1026,Ht=1027,Gt=1028,Wt=1029,qt=1030,Yt=1031,Jt=1032,Xt=1033,Kt=33776,Zt=33777,$t=33778,Qt=33779,te=35840,ee=35841,ie=35842,ne=35843,re=36196,se=37492,ae=37496,oe=37808,le=37809,ce=37810,he=37811,ue=37812,de=37813,pe=37814,fe=37815,me=37816,ge=37817,_e=37818,ve=37819,ye=37820,be=37821,xe=36492,we=37840,Se=37841,Me=37842,Ae=37843,Ee=37844,Le=37845,Te=37846,Ce=37847,Pe=37848,Ne=37849,Re=37850,De=37851,Ie=37852,Oe=37853,ke=2200,Fe=2201,Be=2202,ze=2300,je=2301,Ue=2302,Ve=2400,He=2401,Ge=2402,We=2500,qe=2501,Ye=0,Je=1,Xe=2,Ke=3e3,Ze=3001,$e=3007,Qe=3002,ti=3003,ei=3004,ii=3005,ni=3006,ri=3200,si=3201,ai=0,oi=1,li=0,ci=7680,hi=7681,ui=7682,di=7683,pi=34055,fi=34056,mi=5386,gi=512,_i=513,vi=514,yi=515,bi=516,xi=517,wi=518,Si=519,Mi=35044,Ai=35048,Ei=35040,Li=35045,Ti=35049,Ci=35041,Pi=35046,Ni=35050,Ri=35042,Di="100",Ii="300 es";class Oi{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}const ki=[];for(let t=0;t<256;t++)ki[t]=(t<16?"0":"")+t.toString(16);let Fi=1234567;const Bi=Math.PI/180,zi=180/Math.PI;function ji(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(ki[255&t]+ki[t>>8&255]+ki[t>>16&255]+ki[t>>24&255]+"-"+ki[255&e]+ki[e>>8&255]+"-"+ki[e>>16&15|64]+ki[e>>24&255]+"-"+ki[63&i|128]+ki[i>>8&255]+"-"+ki[i>>16&255]+ki[i>>24&255]+ki[255&n]+ki[n>>8&255]+ki[n>>16&255]+ki[n>>24&255]).toUpperCase()}function Ui(t,e,i){return Math.max(e,Math.min(i,t))}function Vi(t,e){return(t%e+e)%e}function Hi(t,e,i){return(1-i)*t+i*e}function Gi(t){return 0==(t&t-1)&&0!==t}function Wi(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function qi(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var Yi=Object.freeze({__proto__:null,DEG2RAD:Bi,RAD2DEG:zi,generateUUID:ji,clamp:Ui,euclideanModulo:Vi,mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:Hi,damp:function(t,e,i,n){return Hi(t,e,1-Math.exp(-i*n))},pingpong:function(t,e=1){return e-Math.abs(Vi(t,2*e)-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(Fi=t%2147483647),Fi=16807*Fi%2147483647,(Fi-1)/2147483646},degToRad:function(t){return t*Bi},radToDeg:function(t){return t*zi},isPowerOfTwo:Gi,ceilPowerOfTwo:Wi,floorPowerOfTwo:qi,setQuaternionFromProperEuler:function(t,e,i,n,r){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((e+n)/2),h=a((e+n)/2),u=s((e-n)/2),d=a((e-n)/2),p=s((n-e)/2),f=a((n-e)/2);switch(r){case"XYX":t.set(o*h,l*u,l*d,o*c);break;case"YZY":t.set(l*d,o*h,l*u,o*c);break;case"ZXZ":t.set(l*u,l*d,o*h,o*c);break;case"XZX":t.set(o*h,l*f,l*p,o*c);break;case"YXY":t.set(l*p,o*h,l*f,o*c);break;case"ZYZ":t.set(l*f,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}});class Ji{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Ji.prototype.isVector2=!0;class Xi{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,a,o,l){const c=this.elements;return c[0]=t,c[1]=n,c[2]=a,c[3]=e,c[4]=r,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],_=n[1],v=n[4],y=n[7],b=n[2],x=n[5],w=n[8];return r[0]=s*f+a*_+o*b,r[3]=s*m+a*v+o*x,r[6]=s*g+a*y+o*w,r[1]=l*f+c*_+h*b,r[4]=l*m+c*v+h*x,r[7]=l*g+c*y+h*w,r[2]=u*f+d*_+p*b,r[5]=u*m+d*v+p*x,r[8]=u*g+d*y+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8];return e*s*c-e*a*l-i*r*c+i*a*o+n*r*l-n*s*o}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=c*s-a*l,u=a*o-c*r,d=l*r-s*o,p=e*h+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(n*l-c*i)*f,t[2]=(a*i-n*s)*f,t[3]=u*f,t[4]=(c*e-n*o)*f,t[5]=(n*r-a*e)*f,t[6]=d*f,t[7]=(i*o-l*e)*f,t[8]=(s*e-i*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*s+l*a)+s+t,-n*l,n*o,-n*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],s=n[3],a=n[6],o=n[1],l=n[4],c=n[7];return n[0]=e*r+i*o,n[3]=e*s+i*l,n[6]=e*a+i*c,n[1]=-i*r+e*o,n[4]=-i*s+e*l,n[7]=-i*a+e*c,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}let Ki;Xi.prototype.isMatrix3=!0;class Zi{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Ki&&(Ki=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ki.width=t.width,Ki.height=t.height;const i=Ki.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=Ki}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}}let $i=0;class Qi extends Oi{constructor(t=Qi.DEFAULT_IMAGE,e=Qi.DEFAULT_MAPPING,i=dt,n=dt,r=yt,s=wt,a=Bt,o=Mt,l=1,c=Ke){super(),Object.defineProperty(this,"id",{value:$i++}),this.uuid=ji(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Ji(0,0),this.repeat=new Ji(1,1),this.center=new Ji(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Xi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=ji()),!e&&void 0===t.images[n.uuid]){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)n[t].isDataTexture?e.push(tn(n[t].image)):e.push(tn(n[t]))}else e=tn(n);t.images[n.uuid]={uuid:n.uuid,url:e}}i.image=n.uuid}return e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==rt)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case ut:t.x=t.x-Math.floor(t.x);break;case dt:t.x=t.x<0?0:1;break;case pt:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case ut:t.y=t.y-Math.floor(t.y);break;case dt:t.y=t.y<0?0:1;break;case pt:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}function tn(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Zi.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Qi.DEFAULT_IMAGE=void 0,Qi.DEFAULT_MAPPING=rt,Qi.prototype.isTexture=!0;class en{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const s=t.elements,a=s[0],o=s[4],l=s[8],c=s[1],h=s[5],u=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(a+h+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const t=(a+1)/2,s=(h+1)/2,m=(f+1)/2,g=(o+c)/4,_=(l+d)/4,v=(u+p)/4;return t>s&&t>m?t<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(t),n=g/i,r=_/i):s>m?s<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(s),i=g/n,r=v/n):m<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(m),i=_/r,n=v/r),this.set(i,n,r,e),this}let m=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(m)<.001&&(m=1),this.x=(p-u)/m,this.y=(l-d)/m,this.z=(c-o)/m,this.w=Math.acos((a+h+f-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}en.prototype.isVector4=!0;class nn extends Oi{constructor(t,e,i={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new en(0,0,t,e),this.scissorTest=!1,this.viewport=new en(0,0,t,e),this.texture=new Qi(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:yt,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}nn.prototype.isWebGLRenderTarget=!0;class rn extends nn{constructor(t,e,i){super(t,e);const n=this.texture;this.texture=[];for(let t=0;t<i;t++)this.texture[t]=n.clone()}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone();return this}}rn.prototype.isWebGLMultipleRenderTargets=!0;class sn extends nn{constructor(t,e,i){super(t,e,i),this.samples=4}copy(t){return super.copy.call(this,t),this.samples=t.samples,this}}sn.prototype.isWebGLMultisampleRenderTarget=!0;class an{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,r,s,a){let o=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=c,void(t[e+3]=h);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||o!==u||l!==d||c!==p){let t=1-a;const e=o*u+l*d+c*p+h*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,e*i);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}const r=a*i;if(o=o*t+u*r,l=l*t+d*r,c=c*t+p*r,h=h*t+f*r,t===1-a){const t=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=t,l*=t,c*=t,h*=t}}t[e]=o,t[e+1]=l,t[e+2]=c,t[e+3]=h}static multiplyQuaternionsFlat(t,e,i,n,r,s){const a=i[n],o=i[n+1],l=i[n+2],c=i[n+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+c*h+o*d-l*u,t[e+1]=o*p+c*u+l*h-a*d,t[e+2]=l*p+c*d+a*u-o*h,t[e+3]=c*p-a*h-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(n/2),h=a(r/2),u=o(i/2),d=o(n/2),p=o(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],c=e[6],h=e[10],u=i+a+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(c-o)*t,this._y=(r-l)*t,this._z=(s-n)*t}else if(i>a&&i>h){const t=2*Math.sqrt(1+i-a-h);this._w=(c-o)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(r+l)/t}else if(a>h){const t=2*Math.sqrt(1+a-i-h);this._w=(r-l)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(o+c)/t}else{const t=2*Math.sqrt(1+h-i-a);this._w=(s-n)/t,this._x=(r+l)/t,this._y=(o+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Ui(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,c=e._w;return this._x=i*c+s*a+n*l-r*o,this._y=n*c+s*o+r*a-i*l,this._z=r*c+s*l+i*o-n*a,this._w=s*c-i*a-n*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,s=this._w;let a=s*t._w+i*t._x+n*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-e)*c)/l,u=Math.sin(e*c)/l;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){this.copy(t).slerp(e,i)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}an.prototype.isQuaternion=!0;class on{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(cn.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(cn.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=o*e+s*n-a*i,c=o*i+a*e-r*n,h=o*n+r*i-s*e,u=-r*e-s*i-a*n;return this.x=l*o+u*-r+c*-a-h*-s,this.y=c*o+u*-s+h*-r-l*-a,this.z=h*o+u*-a+l*-s-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return ln.copy(this).projectOnVector(t),this.sub(ln)}reflect(t){return this.sub(ln.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Ui(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}on.prototype.isVector3=!0;const ln=new on,cn=new an;class hn{constructor(t=new on(1/0,1/0,1/0),e=new on(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=3){const l=t[o],c=t[o+1],h=t[o+2];l<e&&(e=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>a&&(a=h)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.count;o<l;o++){const l=t.getX(o),c=t.getY(o),h=t.getZ(o);l<e&&(e=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>a&&(a=h)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=dn.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),pn.copy(e.boundingBox),pn.applyMatrix4(t.matrixWorld),this.union(pn));const i=t.children;for(let t=0,e=i.length;t<e;t++)this.expandByObject(i[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,dn),dn.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(bn),xn.subVectors(this.max,bn),fn.subVectors(t.a,bn),mn.subVectors(t.b,bn),gn.subVectors(t.c,bn),_n.subVectors(mn,fn),vn.subVectors(gn,mn),yn.subVectors(fn,gn);let e=[0,-_n.z,_n.y,0,-vn.z,vn.y,0,-yn.z,yn.y,_n.z,0,-_n.x,vn.z,0,-vn.x,yn.z,0,-yn.x,-_n.y,_n.x,0,-vn.y,vn.x,0,-yn.y,yn.x,0];return!!Mn(e,fn,mn,gn,xn)&&(e=[1,0,0,0,1,0,0,0,1],!!Mn(e,fn,mn,gn,xn)&&(wn.crossVectors(_n,vn),e=[wn.x,wn.y,wn.z],Mn(e,fn,mn,gn,xn)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return dn.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(dn).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(un[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),un[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),un[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),un[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),un[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),un[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),un[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),un[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(un)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}hn.prototype.isBox3=!0;const un=[new on,new on,new on,new on,new on,new on,new on,new on],dn=new on,pn=new hn,fn=new on,mn=new on,gn=new on,_n=new on,vn=new on,yn=new on,bn=new on,xn=new on,wn=new on,Sn=new on;function Mn(t,e,i,n,r){for(let s=0,a=t.length-3;s<=a;s+=3){Sn.fromArray(t,s);const a=r.x*Math.abs(Sn.x)+r.y*Math.abs(Sn.y)+r.z*Math.abs(Sn.z),o=e.dot(Sn),l=i.dot(Sn),c=n.dot(Sn);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const An=new hn,En=new on,Ln=new on,Tn=new on;class Cn{constructor(t=new on,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):An.setFromPoints(t).getCenter(i);let n=0;for(let e=0,r=t.length;e<r;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){Tn.subVectors(t,this.center);const e=Tn.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.add(Tn.multiplyScalar(i/t)),this.radius+=i}return this}union(t){return Ln.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(En.copy(t.center).add(Ln)),this.expandByPoint(En.copy(t.center).sub(Ln)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Pn=new on,Nn=new on,Rn=new on,Dn=new on,In=new on,On=new on,kn=new on;class Fn{constructor(t=new on,e=new on(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Pn)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Pn.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Pn.copy(this.direction).multiplyScalar(e).add(this.origin),Pn.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){Nn.copy(t).add(e).multiplyScalar(.5),Rn.copy(e).sub(t).normalize(),Dn.copy(this.origin).sub(Nn);const r=.5*t.distanceTo(e),s=-this.direction.dot(Rn),a=Dn.dot(this.direction),o=-Dn.dot(Rn),l=Dn.lengthSq(),c=Math.abs(1-s*s);let h,u,d,p;if(c>0)if(h=s*o-a,u=s*a-o,p=r*c,h>=0)if(u>=-p)if(u<=p){const t=1/c;h*=t,u*=t,d=h*(h+s*u+2*a)+u*(s*h+u+2*o)+l}else u=r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u=-r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u<=-p?(h=Math.max(0,-(-s*r+a)),u=h>0?-r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-o),r),d=u*(u+2*o)+l):(h=Math.max(0,-(s*r+a)),u=h>0?r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(Rn).multiplyScalar(u).add(Nn),d}intersectSphere(t,e){Pn.subVectors(t.center,this.origin);const i=Pn.dot(this.direction),n=Pn.dot(Pn)-i*i,r=t.radius*t.radius;if(n>r)return null;const s=Math.sqrt(r-n),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),c>=0?(r=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),h>=0?(a=(t.min.z-u.z)*h,o=(t.max.z-u.z)*h):(a=(t.max.z-u.z)*h,o=(t.min.z-u.z)*h),i>o||a>n?null:((a>i||i!=i)&&(i=a),(o<n||n!=n)&&(n=o),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,Pn)}intersectTriangle(t,e,i,n,r){In.subVectors(e,t),On.subVectors(i,t),kn.crossVectors(In,On);let s,a=this.direction.dot(kn);if(a>0){if(n)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}Dn.subVectors(this.origin,t);const o=s*this.direction.dot(On.crossVectors(Dn,On));if(o<0)return null;const l=s*this.direction.dot(In.cross(Dn));if(l<0)return null;if(o+l>a)return null;const c=-s*Dn.dot(kn);return c<0?null:this.at(c/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Bn{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,a,o,l,c,h,u,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Bn).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/zn.setFromMatrixColumn(t,0).length(),r=1/zn.setFromMatrixColumn(t,1).length(),s=1/zn.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=s*c,i=s*h,n=a*c,r=a*h;e[0]=o*c,e[4]=-o*h,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-a*o,e[2]=r-t*l,e[6]=n+i*l,e[10]=s*o}else if("YXZ"===t.order){const t=o*c,i=o*h,n=l*c,r=l*h;e[0]=t+r*a,e[4]=n*a-i,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-a,e[2]=i*a-n,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*c,i=o*h,n=l*c,r=l*h;e[0]=t-r*a,e[4]=-s*h,e[8]=n+i*a,e[1]=i+n*a,e[5]=s*c,e[9]=r-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*c,i=s*h,n=a*c,r=a*h;e[0]=o*c,e[4]=n*l-i,e[8]=t*l+r,e[1]=o*h,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*c,e[4]=r-t*h,e[8]=n*h+i,e[1]=h,e[5]=s*c,e[9]=-a*c,e[2]=-l*c,e[6]=i*h+n,e[10]=t-r*h}else if("XZY"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*c,e[4]=-h,e[8]=l*c,e[1]=t*h+r,e[5]=s*c,e[9]=i*h-n,e[2]=n*h-i,e[6]=a*c,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Un,t,Vn)}lookAt(t,e,i){const n=this.elements;return Wn.subVectors(t,e),0===Wn.lengthSq()&&(Wn.z=1),Wn.normalize(),Hn.crossVectors(i,Wn),0===Hn.lengthSq()&&(1===Math.abs(i.z)?Wn.x+=1e-4:Wn.z+=1e-4,Wn.normalize(),Hn.crossVectors(i,Wn)),Hn.normalize(),Gn.crossVectors(Wn,Hn),n[0]=Hn.x,n[4]=Gn.x,n[8]=Wn.x,n[1]=Hn.y,n[5]=Gn.y,n[9]=Wn.y,n[2]=Hn.z,n[6]=Gn.z,n[10]=Wn.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],_=i[3],v=i[7],y=i[11],b=i[15],x=n[0],w=n[4],S=n[8],M=n[12],A=n[1],E=n[5],L=n[9],T=n[13],C=n[2],P=n[6],N=n[10],R=n[14],D=n[3],I=n[7],O=n[11],k=n[15];return r[0]=s*x+a*A+o*C+l*D,r[4]=s*w+a*E+o*P+l*I,r[8]=s*S+a*L+o*N+l*O,r[12]=s*M+a*T+o*R+l*k,r[1]=c*x+h*A+u*C+d*D,r[5]=c*w+h*E+u*P+d*I,r[9]=c*S+h*L+u*N+d*O,r[13]=c*M+h*T+u*R+d*k,r[2]=p*x+f*A+m*C+g*D,r[6]=p*w+f*E+m*P+g*I,r[10]=p*S+f*L+m*N+g*O,r[14]=p*M+f*T+m*R+g*k,r[3]=_*x+v*A+y*C+b*D,r[7]=_*w+v*E+y*P+b*I,r[11]=_*S+v*L+y*N+b*O,r[15]=_*M+v*T+y*R+b*k,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14];return t[3]*(+r*o*h-n*l*h-r*a*u+i*l*u+n*a*d-i*o*d)+t[7]*(+e*o*d-e*l*u+r*s*u-n*s*d+n*l*c-r*o*c)+t[11]*(+e*l*h-e*a*d-r*s*h+i*s*d+r*a*c-i*l*c)+t[15]*(-n*a*c-e*o*h+e*a*u+n*s*h-i*s*u+i*o*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],_=h*m*l-f*u*l+f*o*d-a*m*d-h*o*g+a*u*g,v=p*u*l-c*m*l-p*o*d+s*m*d+c*o*g-s*u*g,y=c*f*l-p*h*l+p*a*d-s*f*d-c*a*g+s*h*g,b=p*h*o-c*f*o-p*a*u+s*f*u+c*a*m-s*h*m,x=e*_+i*v+n*y+r*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return t[0]=_*w,t[1]=(f*u*r-h*m*r-f*n*d+i*m*d+h*n*g-i*u*g)*w,t[2]=(a*m*r-f*o*r+f*n*l-i*m*l-a*n*g+i*o*g)*w,t[3]=(h*o*r-a*u*r-h*n*l+i*u*l+a*n*d-i*o*d)*w,t[4]=v*w,t[5]=(c*m*r-p*u*r+p*n*d-e*m*d-c*n*g+e*u*g)*w,t[6]=(p*o*r-s*m*r-p*n*l+e*m*l+s*n*g-e*o*g)*w,t[7]=(s*u*r-c*o*r+c*n*l-e*u*l-s*n*d+e*o*d)*w,t[8]=y*w,t[9]=(p*h*r-c*f*r-p*i*d+e*f*d+c*i*g-e*h*g)*w,t[10]=(s*f*r-p*a*r+p*i*l-e*f*l-s*i*g+e*a*g)*w,t[11]=(c*a*r-s*h*r-c*i*l+e*h*l+s*i*d-e*a*d)*w,t[12]=b*w,t[13]=(c*f*n-p*h*n+p*i*u-e*f*u-c*i*m+e*h*m)*w,t[14]=(p*a*n-s*f*n-p*i*o+e*f*o+s*i*m-e*a*m)*w,t[15]=(s*h*n-c*a*n+c*i*o-e*h*o-s*i*u+e*a*u)*w,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,a=t.y,o=t.z,l=r*s,c=r*a;return this.set(l*s+i,l*a-n*o,l*o+n*a,0,l*a+n*o,c*a+i,c*o-n*s,0,l*o-n*a,c*o+n*s,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,s){return this.set(1,i,r,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,c=s+s,h=a+a,u=r*l,d=r*c,p=r*h,f=s*c,m=s*h,g=a*h,_=o*l,v=o*c,y=o*h,b=i.x,x=i.y,w=i.z;return n[0]=(1-(f+g))*b,n[1]=(d+y)*b,n[2]=(p-v)*b,n[3]=0,n[4]=(d-y)*x,n[5]=(1-(u+g))*x,n[6]=(m+_)*x,n[7]=0,n[8]=(p+v)*w,n[9]=(m-_)*w,n[10]=(1-(u+f))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=zn.set(n[0],n[1],n[2]).length();const s=zn.set(n[4],n[5],n[6]).length(),a=zn.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],jn.copy(this);const o=1/r,l=1/s,c=1/a;return jn.elements[0]*=o,jn.elements[1]*=o,jn.elements[2]*=o,jn.elements[4]*=l,jn.elements[5]*=l,jn.elements[6]*=l,jn.elements[8]*=c,jn.elements[9]*=c,jn.elements[10]*=c,e.setFromRotationMatrix(jn),i.x=r,i.y=s,i.z=a,this}makePerspective(t,e,i,n,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,o=2*r/(e-t),l=2*r/(i-n),c=(e+t)/(e-t),h=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,r,s){const a=this.elements,o=1/(e-t),l=1/(i-n),c=1/(s-r),h=(e+t)*o,u=(i+n)*l,d=(s+r)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}Bn.prototype.isMatrix4=!0;const zn=new on,jn=new Bn,Un=new on(0,0,0),Vn=new on(1,1,1),Hn=new on,Gn=new on,Wn=new on,qn=new Bn,Yn=new an;class Jn{constructor(t=0,e=0,i=0,n=Jn.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,r=n[0],s=n[4],a=n[8],o=n[1],l=n[5],c=n[9],h=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(Ui(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Ui(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(Ui(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-Ui(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Ui(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Ui(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return qn.makeRotationFromQuaternion(t),this.setFromRotationMatrix(qn,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Yn.setFromEuler(this),this.setFromQuaternion(Yn,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new on(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Jn.prototype.isEuler=!0,Jn.DefaultOrder="XYZ",Jn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Xn{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let Kn=0;const Zn=new on,$n=new an,Qn=new Bn,tr=new on,er=new on,ir=new on,nr=new an,rr=new on(1,0,0),sr=new on(0,1,0),ar=new on(0,0,1),or={type:"added"},lr={type:"removed"};class cr extends Oi{constructor(){super(),Object.defineProperty(this,"id",{value:Kn++}),this.uuid=ji(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=cr.DefaultUp.clone();const t=new on,e=new Jn,i=new an,n=new on(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Bn},normalMatrix:{value:new Xi}}),this.matrix=new Bn,this.matrixWorld=new Bn,this.matrixAutoUpdate=cr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Xn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return $n.setFromAxisAngle(t,e),this.quaternion.multiply($n),this}rotateOnWorldAxis(t,e){return $n.setFromAxisAngle(t,e),this.quaternion.premultiply($n),this}rotateX(t){return this.rotateOnAxis(rr,t)}rotateY(t){return this.rotateOnAxis(sr,t)}rotateZ(t){return this.rotateOnAxis(ar,t)}translateOnAxis(t,e){return Zn.copy(t).applyQuaternion(this.quaternion),this.position.add(Zn.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(rr,t)}translateY(t){return this.translateOnAxis(sr,t)}translateZ(t){return this.translateOnAxis(ar,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Qn.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?tr.copy(t):tr.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),er.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Qn.lookAt(er,tr,this.up):Qn.lookAt(tr,er,this.up),this.quaternion.setFromRotationMatrix(Qn),n&&(Qn.extractRotation(n.matrixWorld),$n.setFromRotationMatrix(Qn),this.quaternion.premultiply($n.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(or)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(lr)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(lr)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Qn.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Qn.multiply(t.parent.matrixWorld)),t.applyMatrix4(Qn),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(er,t,ir),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(er,nr,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];r(t.shapes,n)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(r(t.materials,this.material[i]));n.material=e}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(r(t.animations,i))}}if(e){const e=s(t.geometries),n=s(t.materials),r=s(t.textures),a=s(t.images),o=s(t.shapes),l=s(t.skeletons),c=s(t.animations);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),a.length>0&&(i.images=a),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c)}return i.object=n,i;function s(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}cr.DefaultUp=new on(0,1,0),cr.DefaultMatrixAutoUpdate=!0,cr.prototype.isObject3D=!0;const hr=new on,ur=new on,dr=new on,pr=new on,fr=new on,mr=new on,gr=new on,_r=new on,vr=new on,yr=new on;class br{constructor(t=new on,e=new on,i=new on){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),hr.subVectors(t,e),n.cross(hr);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){hr.subVectors(n,e),ur.subVectors(i,e),dr.subVectors(t,e);const s=hr.dot(hr),a=hr.dot(ur),o=hr.dot(dr),l=ur.dot(ur),c=ur.dot(dr),h=s*l-a*a;if(0===h)return r.set(-2,-1,-1);const u=1/h,d=(l*o-a*c)*u,p=(s*c-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,pr),pr.x>=0&&pr.y>=0&&pr.x+pr.y<=1}static getUV(t,e,i,n,r,s,a,o){return this.getBarycoord(t,e,i,n,pr),o.set(0,0),o.addScaledVector(r,pr.x),o.addScaledVector(s,pr.y),o.addScaledVector(a,pr.z),o}static isFrontFacing(t,e,i,n){return hr.subVectors(i,e),ur.subVectors(t,e),hr.cross(ur).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return hr.subVectors(this.c,this.b),ur.subVectors(this.a,this.b),.5*hr.cross(ur).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return br.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return br.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return br.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return br.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return br.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,r=this.c;let s,a;fr.subVectors(n,i),mr.subVectors(r,i),_r.subVectors(t,i);const o=fr.dot(_r),l=mr.dot(_r);if(o<=0&&l<=0)return e.copy(i);vr.subVectors(t,n);const c=fr.dot(vr),h=mr.dot(vr);if(c>=0&&h<=c)return e.copy(n);const u=o*h-c*l;if(u<=0&&o>=0&&c<=0)return s=o/(o-c),e.copy(i).addScaledVector(fr,s);yr.subVectors(t,r);const d=fr.dot(yr),p=mr.dot(yr);if(p>=0&&d<=p)return e.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(i).addScaledVector(mr,a);const m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return gr.subVectors(r,n),a=(h-c)/(h-c+(d-p)),e.copy(n).addScaledVector(gr,a);const g=1/(m+f+u);return s=f*g,a=u*g,e.copy(i).addScaledVector(fr,s).addScaledVector(mr,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let xr=0;class wr extends Oi{constructor(){super(),Object.defineProperty(this,"id",{value:xr++}),this.uuid=ji(),this.name="",this.type="Material",this.fog=!0,this.blending=b,this.side=f,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=I,this.blendDst=O,this.blendEquation=A,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=G,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Si,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ci,this.stencilZFail=ci,this.stencilZPass=ci,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===_;continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==b&&(i.blending=this.blending),this.side!==f&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=n(t.textures),r=n(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}wr.prototype.isMaterial=!0;const Sr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Mr={h:0,s:0,l:0},Ar={h:0,s:0,l:0};function Er(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function Lr(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Tr(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class Cr{constructor(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}setHSL(t,e,i){if(t=Vi(t,1),e=Ui(e,0,1),i=Ui(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=Er(r,n,t+1/3),this.g=Er(r,n,t),this.b=Er(r,n,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const n=i[1],r=i[2];switch(n){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const i=parseFloat(t[1])/360,n=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(i,n,r)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=i[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=Sr[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=Lr(t.r),this.g=Lr(t.g),this.b=Lr(t.b),this}copyLinearToSRGB(t){return this.r=Tr(t.r),this.g=Tr(t.g),this.b=Tr(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,i=this.g,n=this.b,r=Math.max(e,i,n),s=Math.min(e,i,n);let a,o;const l=(s+r)/2;if(s===r)a=0,o=0;else{const t=r-s;switch(o=l<=.5?t/(r+s):t/(2-r-s),r){case e:a=(i-n)/t+(i<n?6:0);break;case i:a=(n-e)/t+2;break;case n:a=(e-i)/t+4}a/=6}return t.h=a,t.s=o,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,i){return this.getHSL(Mr),Mr.h+=t,Mr.s+=e,Mr.l+=i,this.setHSL(Mr.h,Mr.s,Mr.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Mr),t.getHSL(Ar);const i=Hi(Mr.h,Ar.h,e),n=Hi(Mr.s,Ar.s,e),r=Hi(Mr.l,Ar.l,e);return this.setHSL(i,n,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Cr.NAMES=Sr,Cr.prototype.isColor=!0,Cr.prototype.r=1,Cr.prototype.g=1,Cr.prototype.b=1;class Pr extends wr{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new Cr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.morphTargets=t.morphTargets,this}}Pr.prototype.isMeshBasicMaterial=!0;const Nr=new on,Rr=new Ji;class Dr{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=Mi,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new Cr),e[i++]=r.r,e[i++]=r.g,e[i++]=r.b}return this}copyVector2sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new Ji),e[i++]=r.x,e[i++]=r.y}return this}copyVector3sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new on),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z}return this}copyVector4sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new en),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z,e[i++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)Rr.fromBufferAttribute(this,e),Rr.applyMatrix3(t),this.setXY(e,Rr.x,Rr.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)Nr.fromBufferAttribute(this,e),Nr.applyMatrix3(t),this.setXYZ(e,Nr.x,Nr.y,Nr.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Nr.x=this.getX(e),Nr.y=this.getY(e),Nr.z=this.getZ(e),Nr.applyMatrix4(t),this.setXYZ(e,Nr.x,Nr.y,Nr.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Nr.x=this.getX(e),Nr.y=this.getY(e),Nr.z=this.getZ(e),Nr.applyNormalMatrix(t),this.setXYZ(e,Nr.x,Nr.y,Nr.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Nr.x=this.getX(e),Nr.y=this.getY(e),Nr.z=this.getZ(e),Nr.transformDirection(t),this.setXYZ(e,Nr.x,Nr.y,Nr.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Mi&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}Dr.prototype.isBufferAttribute=!0;class Ir extends Dr{constructor(t,e,i){super(new Int8Array(t),e,i)}}class Or extends Dr{constructor(t,e,i){super(new Uint8Array(t),e,i)}}class kr extends Dr{constructor(t,e,i){super(new Uint8ClampedArray(t),e,i)}}class Fr extends Dr{constructor(t,e,i){super(new Int16Array(t),e,i)}}class Br extends Dr{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class zr extends Dr{constructor(t,e,i){super(new Int32Array(t),e,i)}}class jr extends Dr{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Ur extends Dr{constructor(t,e,i){super(new Uint16Array(t),e,i)}}Ur.prototype.isFloat16BufferAttribute=!0;class Vr extends Dr{constructor(t,e,i){super(new Float32Array(t),e,i)}}class Hr extends Dr{constructor(t,e,i){super(new Float64Array(t),e,i)}}function Gr(t){if(0===t.length)return-1/0;let e=t[0];for(let i=1,n=t.length;i<n;++i)t[i]>e&&(e=t[i]);return e}const Wr={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function qr(t,e){return new Wr[t](e)}let Yr=0;const Jr=new Bn,Xr=new cr,Kr=new on,Zr=new hn,$r=new hn,Qr=new on;class ts extends Oi{constructor(){super(),Object.defineProperty(this,"id",{value:Yr++}),this.uuid=ji(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Gr(t)>65535?jr:Br)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new Xi).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Jr.makeRotationFromQuaternion(t),this.applyMatrix4(Jr),this}rotateX(t){return Jr.makeRotationX(t),this.applyMatrix4(Jr),this}rotateY(t){return Jr.makeRotationY(t),this.applyMatrix4(Jr),this}rotateZ(t){return Jr.makeRotationZ(t),this.applyMatrix4(Jr),this}translate(t,e,i){return Jr.makeTranslation(t,e,i),this.applyMatrix4(Jr),this}scale(t,e,i){return Jr.makeScale(t,e,i),this.applyMatrix4(Jr),this}lookAt(t){return Xr.lookAt(t),Xr.updateMatrix(),this.applyMatrix4(Xr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Kr).negate(),this.translate(Kr.x,Kr.y,Kr.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Vr(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new hn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new on(-1/0,-1/0,-1/0),new on(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Zr.setFromBufferAttribute(i),this.morphTargetsRelative?(Qr.addVectors(this.boundingBox.min,Zr.min),this.boundingBox.expandByPoint(Qr),Qr.addVectors(this.boundingBox.max,Zr.max),this.boundingBox.expandByPoint(Qr)):(this.boundingBox.expandByPoint(Zr.min),this.boundingBox.expandByPoint(Zr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Cn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new on,1/0);if(t){const i=this.boundingSphere.center;if(Zr.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];$r.setFromBufferAttribute(i),this.morphTargetsRelative?(Qr.addVectors(Zr.min,$r.min),Zr.expandByPoint(Qr),Qr.addVectors(Zr.max,$r.max),Zr.expandByPoint(Qr)):(Zr.expandByPoint($r.min),Zr.expandByPoint($r.max))}Zr.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)Qr.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(Qr));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],a=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)Qr.fromBufferAttribute(s,e),a&&(Kr.fromBufferAttribute(t,e),Qr.add(Kr)),n=Math.max(n,i.distanceToSquared(Qr))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,n=e.position.array,r=e.normal.array,s=e.uv.array,a=n.length/3;void 0===e.tangent&&this.setAttribute("tangent",new Dr(new Float32Array(4*a),4));const o=e.tangent.array,l=[],c=[];for(let t=0;t<a;t++)l[t]=new on,c[t]=new on;const h=new on,u=new on,d=new on,p=new Ji,f=new Ji,m=new Ji,g=new on,_=new on;function v(t,e,i){h.fromArray(n,3*t),u.fromArray(n,3*e),d.fromArray(n,3*i),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*i),u.sub(h),d.sub(h),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),_.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[i].add(g),c[t].add(_),c[e].add(_),c[i].add(_))}let y=this.groups;0===y.length&&(y=[{start:0,count:i.length}]);for(let t=0,e=y.length;t<e;++t){const e=y[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)v(i[t+0],i[t+1],i[t+2])}const b=new on,x=new on,w=new on,S=new on;function M(t){w.fromArray(r,3*t),S.copy(w);const e=l[t];b.copy(e),b.sub(w.multiplyScalar(w.dot(e))).normalize(),x.crossVectors(S,e);const i=x.dot(c[t])<0?-1:1;o[4*t]=b.x,o[4*t+1]=b.y,o[4*t+2]=b.z,o[4*t+3]=i}for(let t=0,e=y.length;t<e;++t){const e=y[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)M(i[t+0]),M(i[t+1]),M(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new Dr(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new on,r=new on,s=new on,a=new on,o=new on,l=new on,c=new on,h=new on;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);n.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),a.fromBufferAttribute(i,d),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),a.add(c),o.add(c),l.add(c),i.setXYZ(d,a.x,a.y,a.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,a=e.count;t<a;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),i.setXYZ(t+0,c.x,c.y,c.z),i.setXYZ(t+1,c.x,c.y,c.z),i.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===t.attributes[n])continue;const r=i[n].array,s=t.attributes[n],a=s.array,o=s.itemSize*e,l=Math.min(a.length,r.length-o);for(let t=0,e=o;t<l;t++,e++)r[e]=a[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Qr.fromBufferAttribute(t,e),Qr.normalize(),t.setXYZ(e,Qr.x,Qr.y,Qr.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,r=t.normalized,s=new i.constructor(e.length*n);let a=0,o=0;for(let r=0,l=e.length;r<l;r++){a=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*n;for(let t=0;t<n;t++)s[o++]=i[a++]}return new Dr(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new ts,i=this.index.array,n=this.attributes;for(const r in n){const s=t(n[r],i);e.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],a=r[n];for(let e=0,n=a.length;e<n;e++){const n=t(a[e],i);s.push(n)}e.morphAttributes[n]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,i=s.length;t<i;t++){const i=s[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let r=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],s=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];s.push(n.toJSON(t.data))}s.length>0&&(n[e]=s,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new ts).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const r=t.morphAttributes;for(const t in r){const i=[],n=r[t];for(let t=0,r=n.length;t<r;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}ts.prototype.isBufferGeometry=!0;const es=new Bn,is=new Fn,ns=new Cn,rs=new on,ss=new on,as=new on,os=new on,ls=new on,cs=new on,hs=new on,us=new on,ds=new on,ps=new Ji,fs=new Ji,ms=new Ji,gs=new on,_s=new on;class vs extends cr{constructor(t=new ts,e=new Pr){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),ns.copy(i.boundingSphere),ns.applyMatrix4(r),!1===t.ray.intersectsSphere(ns))return;if(es.copy(r).invert(),is.copy(t.ray).applyMatrix4(es),null!==i.boundingBox&&!1===is.intersectsBox(i.boundingBox))return;let s;if(i.isBufferGeometry){const r=i.index,a=i.attributes.position,o=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,h=i.attributes.uv2,u=i.groups,d=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,p=u.length;i<p;i++){const p=u[i],f=n[p.materialIndex];for(let i=Math.max(p.start,d.start),n=Math.min(p.start+p.count,d.start+d.count);i<n;i+=3){const n=r.getX(i),u=r.getX(i+1),d=r.getX(i+2);s=ys(this,f,t,is,a,o,l,c,h,n,u,d),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else{for(let i=Math.max(0,d.start),u=Math.min(r.count,d.start+d.count);i<u;i+=3){const u=r.getX(i),d=r.getX(i+1),p=r.getX(i+2);s=ys(this,n,t,is,a,o,l,c,h,u,d,p),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}else if(void 0!==a)if(Array.isArray(n))for(let i=0,r=u.length;i<r;i++){const r=u[i],p=n[r.materialIndex];for(let i=Math.max(r.start,d.start),n=Math.min(r.start+r.count,d.start+d.count);i<n;i+=3){s=ys(this,p,t,is,a,o,l,c,h,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,e.push(s))}}else{for(let i=Math.max(0,d.start),r=Math.min(a.count,d.start+d.count);i<r;i+=3){s=ys(this,n,t,is,a,o,l,c,h,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function ys(t,e,i,n,r,s,a,o,l,c,h,u){rs.fromBufferAttribute(r,c),ss.fromBufferAttribute(r,h),as.fromBufferAttribute(r,u);const d=t.morphTargetInfluences;if(e.morphTargets&&s&&d){hs.set(0,0,0),us.set(0,0,0),ds.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=d[t],i=s[t];0!==e&&(os.fromBufferAttribute(i,c),ls.fromBufferAttribute(i,h),cs.fromBufferAttribute(i,u),a?(hs.addScaledVector(os,e),us.addScaledVector(ls,e),ds.addScaledVector(cs,e)):(hs.addScaledVector(os.sub(rs),e),us.addScaledVector(ls.sub(ss),e),ds.addScaledVector(cs.sub(as),e)))}rs.add(hs),ss.add(us),as.add(ds)}t.isSkinnedMesh&&(t.boneTransform(c,rs),t.boneTransform(h,ss),t.boneTransform(u,as));const p=function(t,e,i,n,r,s,a,o){let l;if(l=e.side===m?n.intersectTriangle(a,s,r,!0,o):n.intersectTriangle(r,s,a,e.side!==g,o),null===l)return null;_s.copy(o),_s.applyMatrix4(t.matrixWorld);const c=i.ray.origin.distanceTo(_s);return c<i.near||c>i.far?null:{distance:c,point:_s.clone(),object:t}}(t,e,i,n,rs,ss,as,gs);if(p){o&&(ps.fromBufferAttribute(o,c),fs.fromBufferAttribute(o,h),ms.fromBufferAttribute(o,u),p.uv=br.getUV(gs,rs,ss,as,ps,fs,ms,new Ji)),l&&(ps.fromBufferAttribute(l,c),fs.fromBufferAttribute(l,h),ms.fromBufferAttribute(l,u),p.uv2=br.getUV(gs,rs,ss,as,ps,fs,ms,new Ji));const t={a:c,b:h,c:u,normal:new on,materialIndex:0};br.getNormal(rs,ss,as,t.normal),p.face=t}return p}vs.prototype.isMesh=!0;class bs extends ts{constructor(t=1,e=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const a=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],c=[],h=[];let u=0,d=0;function p(t,e,i,n,r,s,p,f,m,g,_){const v=s/m,y=p/g,b=s/2,x=p/2,w=f/2,S=m+1,M=g+1;let A=0,E=0;const L=new on;for(let s=0;s<M;s++){const a=s*y-x;for(let o=0;o<S;o++){const u=o*v-b;L[t]=u*n,L[e]=a*r,L[i]=w,l.push(L.x,L.y,L.z),L[t]=0,L[e]=0,L[i]=f>0?1:-1,c.push(L.x,L.y,L.z),h.push(o/m),h.push(1-s/g),A+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const i=u+e+S*t,n=u+e+S*(t+1),r=u+(e+1)+S*(t+1),s=u+(e+1)+S*t;o.push(i,n,s),o.push(n,r,s),E+=6}a.addGroup(d,E,_),d+=E,u+=A}p("z","y","x",-1,-1,i,e,t,s,r,0),p("z","y","x",1,-1,i,e,-t,s,r,1),p("x","z","y",1,1,t,i,e,n,s,2),p("x","z","y",1,-1,t,i,-e,n,s,3),p("x","y","z",1,-1,t,e,i,n,r,4),p("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new Vr(l,3)),this.setAttribute("normal",new Vr(c,3)),this.setAttribute("uv",new Vr(h,2))}static fromJSON(t){return new bs(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function xs(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function ws(t){const e={};for(let i=0;i<t.length;i++){const n=xs(t[i]);for(const t in n)e[t]=n[t]}return e}const Ss={clone:xs,merge:ws};class Ms extends wr{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=xs(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}Ms.prototype.isShaderMaterial=!0;class As extends cr{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Bn,this.projectionMatrix=new Bn,this.projectionMatrixInverse=new Bn}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}As.prototype.isCamera=!0;class Es extends As{constructor(t=50,e=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*zi*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Bi*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*zi*Math.atan(Math.tan(.5*Bi*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Bi*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,a=s.fullHeight;r+=s.offsetX*n/t,e-=s.offsetY*i/a,n*=s.width/t,i*=s.height/a}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}Es.prototype.isPerspectiveCamera=!0;class Ls extends cr{constructor(t,e,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new Es(90,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new on(1,0,0)),this.add(n);const r=new Es(90,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new on(-1,0,0)),this.add(r);const s=new Es(90,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new on(0,1,0)),this.add(s);const a=new Es(90,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new on(0,-1,0)),this.add(a);const o=new Es(90,1,t,e);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new on(0,0,1)),this.add(o);const l=new Es(90,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new on(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,s,a,o,l]=this.children,c=t.xr.enabled,h=t.getRenderTarget();t.xr.enabled=!1;const u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,a),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=u,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(h),t.xr.enabled=c}}class Ts extends Qi{constructor(t,e,i,n,r,s,a,o,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:st,i,n,r,s,a=void 0!==a?a:Ft,o,l,c),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}Ts.prototype.isCubeTexture=!0;class Cs extends nn{constructor(t,e,i){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=i),super(t,t,e),e=e||{},this.texture=new Ts(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:yt,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=Bt,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new bs(5,5,5),r=new Ms({name:"CubemapFromEquirect",uniforms:xs(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:m,blending:y});r.uniforms.tEquirect.value=e;const s=new vs(n,r),a=e.minFilter;e.minFilter===wt&&(e.minFilter=yt);return new Ls(1,10,this).update(t,s),e.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,i,n){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,i,n);t.setRenderTarget(r)}}Cs.prototype.isWebGLCubeRenderTarget=!0;const Ps=new on,Ns=new on,Rs=new Xi;class Ds{constructor(t=new on(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=Ps.subVectors(i,e).cross(Ns.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(Ps),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||Rs.getNormalMatrix(t),n=this.coplanarPoint(Ps).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Ds.prototype.isPlane=!0;const Is=new Cn,Os=new on;class ks{constructor(t=new Ds,e=new Ds,i=new Ds,n=new Ds,r=new Ds,s=new Ds){this.planes=[t,e,i,n,r,s]}set(t,e,i,n,r,s){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(s),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],_=i[14],v=i[15];return e[0].setComponents(a-n,h-o,f-u,v-m).normalize(),e[1].setComponents(a+n,h+o,f+u,v+m).normalize(),e[2].setComponents(a+r,h+l,f+d,v+g).normalize(),e[3].setComponents(a-r,h-l,f-d,v-g).normalize(),e[4].setComponents(a-s,h-c,f-p,v-_).normalize(),e[5].setComponents(a+s,h+c,f+p,v+_).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Is.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Is)}intersectsSprite(t){return Is.center.set(0,0,0),Is.radius=.7071067811865476,Is.applyMatrix4(t.matrixWorld),this.intersectsSphere(Is)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<n)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Os.x=n.normal.x>0?t.max.x:t.min.x,Os.y=n.normal.y>0?t.max.y:t.min.y,Os.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Os)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Fs(){let t=null,e=!1,i=null,n=null;function r(e,s){i(e,s),n=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function Bs(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=n.get(e);void 0===s?n.set(e,function(e,n){const r=e.array,s=e.usage,a=t.createBuffer();t.bindBuffer(n,a),t.bufferData(n,r,s),e.onUploadCallback();let o=5126;return r instanceof Float32Array?o=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?e.isFloat16BufferAttribute?i?o=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):o=5123:r instanceof Int16Array?o=5122:r instanceof Uint32Array?o=5125:r instanceof Int32Array?o=5124:r instanceof Int8Array?o=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(o=5121),{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(!function(e,n,r){const s=n.array,a=n.updateRange;t.bindBuffer(r,e),-1===a.count?t.bufferSubData(r,0,s):(i?t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1)}(s.buffer,e,r),s.version=e.version)}}}class zs extends ts{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const r=t/2,s=e/2,a=Math.floor(i),o=Math.floor(n),l=a+1,c=o+1,h=t/a,u=e/o,d=[],p=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*u-s;for(let i=0;i<l;i++){const n=i*h-r;p.push(n,-e,0),f.push(0,0,1),m.push(i/a),m.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<a;e++){const i=e+l*t,n=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(i,n,s),d.push(n,r,s)}this.setIndex(d),this.setAttribute("position",new Vr(p,3)),this.setAttribute("normal",new Vr(f,3)),this.setAttribute("uv",new Vr(m,2))}static fromJSON(t){return new zs(t.width,t.height,t.widthSegments,t.heightSegments)}}const js={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotVH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition.xyz / vWorldPosition.w;\n\tvec3 v = normalize( cameraPosition - pos );\n\tfloat ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );\n\tvec3 transmission = transmissionFactor * getIBLVolumeRefraction(\n\t\tnormal, v, roughnessFactor, material.diffuseColor, material.specularColor,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec4 vWorldPosition;\n\tvec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {\n\t\tvec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length(vec3(modelMatrix[0].xyz));\n\t\tmodelScale.y = length(vec3(modelMatrix[1].xyz));\n\t\tmodelScale.z = length(vec3(modelMatrix[2].xyz));\n\t\treturn normalize(refractionVector) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness(float roughness, float ior) {\n\t\treturn roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);\n\t}\n\tvec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {\n\t\tfloat framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);\n\t\treturn texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;\n\t}\n\tvec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {\n\t\tif (attenuationDistance == 0.0) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;\n\t\t\tvec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec3 getIBLVolumeRefraction(vec3 n, vec3 v, float perceptualRoughness, vec3 baseColor, vec3 specularColor,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);\n\t\tvec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);\n\t\treturn (1.0 - specularColor) * attenuatedColor * baseColor;\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform vec3 attenuationColor;\n\tuniform float attenuationDistance;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#ifdef USE_TRANSMISSION\n\tvarying vec4 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition;\n#endif\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Us={common:{diffuse:{value:new Cr(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Xi},uv2Transform:{value:new Xi},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ji(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Cr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Cr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Xi}},sprite:{diffuse:{value:new Cr(16777215)},opacity:{value:1},center:{value:new Ji(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Xi}}},Vs={basic:{uniforms:ws([Us.common,Us.specularmap,Us.envmap,Us.aomap,Us.lightmap,Us.fog]),vertexShader:js.meshbasic_vert,fragmentShader:js.meshbasic_frag},lambert:{uniforms:ws([Us.common,Us.specularmap,Us.envmap,Us.aomap,Us.lightmap,Us.emissivemap,Us.fog,Us.lights,{emissive:{value:new Cr(0)}}]),vertexShader:js.meshlambert_vert,fragmentShader:js.meshlambert_frag},phong:{uniforms:ws([Us.common,Us.specularmap,Us.envmap,Us.aomap,Us.lightmap,Us.emissivemap,Us.bumpmap,Us.normalmap,Us.displacementmap,Us.fog,Us.lights,{emissive:{value:new Cr(0)},specular:{value:new Cr(1118481)},shininess:{value:30}}]),vertexShader:js.meshphong_vert,fragmentShader:js.meshphong_frag},standard:{uniforms:ws([Us.common,Us.envmap,Us.aomap,Us.lightmap,Us.emissivemap,Us.bumpmap,Us.normalmap,Us.displacementmap,Us.roughnessmap,Us.metalnessmap,Us.fog,Us.lights,{emissive:{value:new Cr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:js.meshphysical_vert,fragmentShader:js.meshphysical_frag},toon:{uniforms:ws([Us.common,Us.aomap,Us.lightmap,Us.emissivemap,Us.bumpmap,Us.normalmap,Us.displacementmap,Us.gradientmap,Us.fog,Us.lights,{emissive:{value:new Cr(0)}}]),vertexShader:js.meshtoon_vert,fragmentShader:js.meshtoon_frag},matcap:{uniforms:ws([Us.common,Us.bumpmap,Us.normalmap,Us.displacementmap,Us.fog,{matcap:{value:null}}]),vertexShader:js.meshmatcap_vert,fragmentShader:js.meshmatcap_frag},points:{uniforms:ws([Us.points,Us.fog]),vertexShader:js.points_vert,fragmentShader:js.points_frag},dashed:{uniforms:ws([Us.common,Us.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:js.linedashed_vert,fragmentShader:js.linedashed_frag},depth:{uniforms:ws([Us.common,Us.displacementmap]),vertexShader:js.depth_vert,fragmentShader:js.depth_frag},normal:{uniforms:ws([Us.common,Us.bumpmap,Us.normalmap,Us.displacementmap,{opacity:{value:1}}]),vertexShader:js.normal_vert,fragmentShader:js.normal_frag},sprite:{uniforms:ws([Us.sprite,Us.fog]),vertexShader:js.sprite_vert,fragmentShader:js.sprite_frag},background:{uniforms:{uvTransform:{value:new Xi},t2D:{value:null}},vertexShader:js.background_vert,fragmentShader:js.background_frag},cube:{uniforms:ws([Us.envmap,{opacity:{value:1}}]),vertexShader:js.cube_vert,fragmentShader:js.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:js.equirect_vert,fragmentShader:js.equirect_frag},distanceRGBA:{uniforms:ws([Us.common,Us.displacementmap,{referencePosition:{value:new on},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:js.distanceRGBA_vert,fragmentShader:js.distanceRGBA_frag},shadow:{uniforms:ws([Us.lights,Us.fog,{color:{value:new Cr(0)},opacity:{value:1}}]),vertexShader:js.shadow_vert,fragmentShader:js.shadow_frag}};function Hs(t,e,i,n,r){const s=new Cr(0);let a,o,l=0,c=null,h=0,u=null;function d(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,r)}return{getClearColor:function(){return s},setClearColor:function(t,e=1){s.set(t),l=e,d(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(t){l=t,d(s,l)},render:function(i,r){let p=!1,g=!0===r.isScene?r.background:null;g&&g.isTexture&&(g=e.get(g));const _=t.xr,v=_.getSession&&_.getSession();v&&"additive"===v.environmentBlendMode&&(g=null),null===g?d(s,l):g&&g.isColor&&(d(g,1),p=!0),(t.autoClear||p)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),g&&(g.isCubeTexture||g.mapping===ct)?(void 0===o&&(o=new vs(new bs(1,1,1),new Ms({name:"BackgroundCubeMaterial",uniforms:xs(Vs.cube.uniforms),vertexShader:Vs.cube.vertexShader,fragmentShader:Vs.cube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(o)),o.material.uniforms.envMap.value=g,o.material.uniforms.flipEnvMap.value=g.isCubeTexture&&g._needsFlipEnvMap?-1:1,c===g&&h===g.version&&u===t.toneMapping||(o.material.needsUpdate=!0,c=g,h=g.version,u=t.toneMapping),i.unshift(o,o.geometry,o.material,0,0,null)):g&&g.isTexture&&(void 0===a&&(a=new vs(new zs(2,2),new Ms({name:"BackgroundMaterial",uniforms:xs(Vs.background.uniforms),vertexShader:Vs.background.vertexShader,fragmentShader:Vs.background.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(a)),a.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),a.material.uniforms.uvTransform.value.copy(g.matrix),c===g&&h===g.version&&u===t.toneMapping||(a.material.needsUpdate=!0,c=g,h=g.version,u=t.toneMapping),i.unshift(a,a.geometry,a.material,0,0,null))}}}function Gs(t,e,i,n){const r=t.getParameter(34921),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),a=n.isWebGL2||null!==s,o={},l=d(null);let c=l;function h(e){return n.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function u(e){return n.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function d(t){const e=[],i=[],n=[];for(let t=0;t<r;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function p(){const t=c.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function f(t){m(t,0)}function m(i,r){const s=c.newAttributes,a=c.enabledAttributes,o=c.attributeDivisors;if(s[i]=1,0===a[i]&&(t.enableVertexAttribArray(i),a[i]=1),o[i]!==r){(n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r}}function g(){const e=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function _(e,i,r,s,a,o){!0!==n.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,i,r,s,a,o):t.vertexAttribIPointer(e,i,r,a,o)}function v(){y(),c!==l&&(c=l,h(c.object))}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,u,v,y){let b=!1;if(a){const e=function(e,i,r){const a=!0===r.wireframe;let l=o[e.id];void 0===l&&(l={},o[e.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[a];void 0===h&&(h=d(n.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[a]=h);return h}(v,u,l);c!==e&&(c=e,h(c.object)),b=function(t,e){const i=c.attributes,n=t.attributes;let r=0;for(const t in n){const e=i[t],s=n[t];if(void 0===e)return!0;if(e.attribute!==s)return!0;if(e.data!==s.data)return!0;r++}return c.attributesNum!==r||c.index!==e}(v,y),b&&function(t,e){const i={},n=t.attributes;let r=0;for(const t in n){const e=n[t],s={};s.attribute=e,e.data&&(s.data=e.data),i[t]=s,r++}c.attributes=i,c.attributesNum=r,c.index=e}(v,y)}else{const t=!0===l.wireframe;c.geometry===v.id&&c.program===u.id&&c.wireframe===t||(c.geometry=v.id,c.program=u.id,c.wireframe=t,b=!0)}!0===r.isInstancedMesh&&(b=!0),null!==y&&i.update(y,34963),b&&(!function(r,s,a,o){if(!1===n.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;p();const l=o.attributes,c=a.getAttributes(),h=s.defaultAttributeValues;for(const e in c){const n=c[e];if(n>=0){const s=l[e];if(void 0!==s){const e=s.normalized,r=s.itemSize,a=i.get(s);if(void 0===a)continue;const l=a.buffer,c=a.type,h=a.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,a=i.stride,u=s.offset;i&&i.isInstancedInterleavedBuffer?(m(n,i.meshPerAttribute),void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)):f(n),t.bindBuffer(34962,l),_(n,r,c,e,a*h,u*h)}else s.isInstancedBufferAttribute?(m(n,s.meshPerAttribute),void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)):f(n),t.bindBuffer(34962,l),_(n,r,c,e,0,0)}else if("instanceMatrix"===e){const e=i.get(r.instanceMatrix);if(void 0===e)continue;const s=e.buffer,a=e.type;m(n+0,1),m(n+1,1),m(n+2,1),m(n+3,1),t.bindBuffer(34962,s),t.vertexAttribPointer(n+0,4,a,!1,64,0),t.vertexAttribPointer(n+1,4,a,!1,64,16),t.vertexAttribPointer(n+2,4,a,!1,64,32),t.vertexAttribPointer(n+3,4,a,!1,64,48)}else if("instanceColor"===e){const e=i.get(r.instanceColor);if(void 0===e)continue;const s=e.buffer,a=e.type;m(n,1),t.bindBuffer(34962,s),t.vertexAttribPointer(n,3,a,!1,12,0)}else if(void 0!==h){const i=h[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n,i);break;case 3:t.vertexAttrib3fv(n,i);break;case 4:t.vertexAttrib4fv(n,i);break;default:t.vertexAttrib1fv(n,i)}}}}g()}(r,l,u,v),null!==y&&t.bindBuffer(34963,i.get(y).buffer))},reset:v,resetDefaultState:y,dispose:function(){v();for(const t in o){const e=o[t];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete o[t]}},releaseStatesOfGeometry:function(t){if(void 0===o[t.id])return;const e=o[t.id];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete o[t.id]},releaseStatesOfProgram:function(t){for(const e in o){const i=o[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)u(n[t].object),delete n[t];delete i[t.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function Ws(t,e,i,n){const r=n.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,n){t.drawArrays(s,e,n),i.update(n,s,1)},this.renderInstances=function(n,a,o){if(0===o)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,n,a,o),i.update(a,s,o)}}function qs(t,e,i){let n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==i.precision?i.precision:"highp";const o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=s||e.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=t.getParameter(34930),u=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),_=t.getParameter(36349),v=u>0,y=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:s?t.getParameter(36183):0}}function Ys(t){const e=this;let i=null,n=0,r=!1,s=!1;const a=new Ds,o=new Xi,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function h(t,i,n,r){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const e=n+4*s,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,i=n;e!==s;++e,i+=4)a.copy(t[e]).applyMatrix4(r,o),a.normal.toArray(c,i),c[i+3]=a.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const a=0!==t.length||e||0!==n||r;return r=e,i=h(t,s,0),n=t.length,a},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1,c()},this.setState=function(e,a,o){const u=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!r||null===u||0===u.length||s&&!p)s?h(null):c();else{const t=s?0:n,e=4*t;let r=f.clippingState||null;l.value=r,r=h(u,a,e,o);for(let t=0;t!==e;++t)r[t]=i[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function Js(t){let e=new WeakMap;function i(t,e){return e===ot?t.mapping=st:e===lt&&(t.mapping=at),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping;if(s===ot||s===lt){if(e.has(r)){return i(e.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const a=t.getRenderTarget(),o=new Cs(s.height/2);return o.fromEquirectangularTexture(t,r),e.set(r,o),t.setRenderTarget(a),r.addEventListener("dispose",n),i(o.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}function Xs(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float")},get:function(t){const e=i(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Ks(t,e,i,n){const r={},s=new WeakMap;function a(t){const o=t.target;null!==o.index&&e.remove(o.index);for(const t in o.attributes)e.remove(o.attributes[t]);o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(e.remove(l),s.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(t){const i=[],n=t.index,r=t.attributes.position;let a=0;if(null!==n){const t=n.array;a=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],s=t[e+2];i.push(n,r,r,s,s,n)}}else{const t=r.array;a=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}const o=new(Gr(i)>65535?jr:Br)(i,1);o.version=a;const l=s.get(t);l&&e.remove(l),s.set(t,o)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",a),r[e.id]=!0,i.memory.geometries++),e},update:function(t){const i=t.attributes;for(const t in i)e.update(i[t],34962);const n=t.morphAttributes;for(const t in n){const i=n[t];for(let t=0,n=i.length;t<n;t++)e.update(i[t],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&o(t)}else o(t);return s.get(t)}}}function Zs(t,e,i,n){const r=n.isWebGL2;let s,a,o;this.setMode=function(t){s=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,n){t.drawElements(s,n,a,e*o),i.update(n,s,1)},this.renderInstances=function(n,l,c){if(0===c)return;let h,u;if(r)h=t,u="drawElementsInstanced";else if(h=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,a,n*o,c),i.update(l,s,c)}}function $s(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,i,n){switch(e.calls++,i){case 4:e.triangles+=n*(t/3);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Qs(t,e){return t[0]-e[0]}function ta(t,e){return Math.abs(e[1])-Math.abs(t[1])}function ea(t){const e={},i=new Float32Array(8),n=[];for(let t=0;t<8;t++)n[t]=[t,0];return{update:function(r,s,a,o){const l=r.morphTargetInfluences,c=void 0===l?0:l.length;let h=e[s.id];if(void 0===h||h.length!==c){h=[];for(let t=0;t<c;t++)h[t]=[t,0];e[s.id]=h}for(let t=0;t<c;t++){const e=h[t];e[0]=t,e[1]=l[t]}h.sort(ta);for(let t=0;t<8;t++)t<c&&h[t][1]?(n[t][0]=h[t][0],n[t][1]=h[t][1]):(n[t][0]=Number.MAX_SAFE_INTEGER,n[t][1]=0);n.sort(Qs);const u=a.morphTargets&&s.morphAttributes.position,d=a.morphNormals&&s.morphAttributes.normal;let p=0;for(let t=0;t<8;t++){const e=n[t],r=e[0],a=e[1];r!==Number.MAX_SAFE_INTEGER&&a?(u&&s.getAttribute("morphTarget"+t)!==u[r]&&s.setAttribute("morphTarget"+t,u[r]),d&&s.getAttribute("morphNormal"+t)!==d[r]&&s.setAttribute("morphNormal"+t,d[r]),i[t]=a,p+=a):(u&&!0===s.hasAttribute("morphTarget"+t)&&s.deleteAttribute("morphTarget"+t),d&&!0===s.hasAttribute("morphNormal"+t)&&s.deleteAttribute("morphNormal"+t),i[t]=0)}const f=s.morphTargetsRelative?1:1-p;o.getUniforms().setValue(t,"morphTargetBaseInfluence",f),o.getUniforms().setValue(t,"morphTargetInfluences",i)}}}function ia(t,e,i,n){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(t){const a=n.render.frame,o=t.geometry,l=e.get(t,o);return r.get(l)!==a&&(e.update(l),r.set(l,a)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),i.update(t.instanceMatrix,34962),null!==t.instanceColor&&i.update(t.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}Vs.physical={uniforms:ws([Vs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ji(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Cr(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ji},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Cr(0)}}]),vertexShader:js.meshphysical_vert,fragmentShader:js.meshphysical_frag};class na extends Qi{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=ft,this.minFilter=ft,this.wrapR=dt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}na.prototype.isDataTexture2DArray=!0;class ra extends Qi{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=ft,this.minFilter=ft,this.wrapR=dt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ra.prototype.isDataTexture3D=!0;const sa=new Qi,aa=new na,oa=new ra,la=new Ts,ca=[],ha=[],ua=new Float32Array(16),da=new Float32Array(9),pa=new Float32Array(4);function fa(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let s=ca[r];if(void 0===s&&(s=new Float32Array(r),ca[r]=s),0!==e){n.toArray(s,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(s,r)}return s}function ma(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function ga(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function _a(t,e){let i=ha[e];void 0===i&&(i=new Int32Array(e),ha[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function va(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function ya(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ma(i,e))return;t.uniform2fv(this.addr,e),ga(i,e)}}function ba(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(ma(i,e))return;t.uniform3fv(this.addr,e),ga(i,e)}}function xa(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ma(i,e))return;t.uniform4fv(this.addr,e),ga(i,e)}}function wa(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(ma(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),ga(i,e)}else{if(ma(i,n))return;pa.set(n),t.uniformMatrix2fv(this.addr,!1,pa),ga(i,n)}}function Sa(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(ma(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),ga(i,e)}else{if(ma(i,n))return;da.set(n),t.uniformMatrix3fv(this.addr,!1,da),ga(i,n)}}function Ma(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(ma(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),ga(i,e)}else{if(ma(i,n))return;ua.set(n),t.uniformMatrix4fv(this.addr,!1,ua),ga(i,n)}}function Aa(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Ea(t,e){const i=this.cache;ma(i,e)||(t.uniform2iv(this.addr,e),ga(i,e))}function La(t,e){const i=this.cache;ma(i,e)||(t.uniform3iv(this.addr,e),ga(i,e))}function Ta(t,e){const i=this.cache;ma(i,e)||(t.uniform4iv(this.addr,e),ga(i,e))}function Ca(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function Pa(t,e){const i=this.cache;ma(i,e)||(t.uniform2uiv(this.addr,e),ga(i,e))}function Na(t,e){const i=this.cache;ma(i,e)||(t.uniform3uiv(this.addr,e),ga(i,e))}function Ra(t,e){const i=this.cache;ma(i,e)||(t.uniform4uiv(this.addr,e),ga(i,e))}function Da(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.safeSetTexture2D(e||sa,r)}function Ia(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||oa,r)}function Oa(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.safeSetTextureCube(e||la,r)}function ka(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||aa,r)}function Fa(t,e){t.uniform1fv(this.addr,e)}function Ba(t,e){const i=fa(e,this.size,2);t.uniform2fv(this.addr,i)}function za(t,e){const i=fa(e,this.size,3);t.uniform3fv(this.addr,i)}function ja(t,e){const i=fa(e,this.size,4);t.uniform4fv(this.addr,i)}function Ua(t,e){const i=fa(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function Va(t,e){const i=fa(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function Ha(t,e){const i=fa(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function Ga(t,e){t.uniform1iv(this.addr,e)}function Wa(t,e){t.uniform2iv(this.addr,e)}function qa(t,e){t.uniform3iv(this.addr,e)}function Ya(t,e){t.uniform4iv(this.addr,e)}function Ja(t,e){t.uniform1uiv(this.addr,e)}function Xa(t,e){t.uniform2uiv(this.addr,e)}function Ka(t,e){t.uniform3uiv(this.addr,e)}function Za(t,e){t.uniform4uiv(this.addr,e)}function $a(t,e,i){const n=e.length,r=_a(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.safeSetTexture2D(e[t]||sa,r[t])}function Qa(t,e,i){const n=e.length,r=_a(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.safeSetTextureCube(e[t]||la,r[t])}function to(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return va;case 35664:return ya;case 35665:return ba;case 35666:return xa;case 35674:return wa;case 35675:return Sa;case 35676:return Ma;case 5124:case 35670:return Aa;case 35667:case 35671:return Ea;case 35668:case 35672:return La;case 35669:case 35673:return Ta;case 5125:return Ca;case 36294:return Pa;case 36295:return Na;case 36296:return Ra;case 35678:case 36198:case 36298:case 36306:case 35682:return Da;case 35679:case 36299:case 36307:return Ia;case 35680:case 36300:case 36308:case 36293:return Oa;case 36289:case 36303:case 36311:case 36292:return ka}}(e.type)}function eo(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Fa;case 35664:return Ba;case 35665:return za;case 35666:return ja;case 35674:return Ua;case 35675:return Va;case 35676:return Ha;case 5124:case 35670:return Ga;case 35667:case 35671:return Wa;case 35668:case 35672:return qa;case 35669:case 35673:return Ya;case 5125:return Ja;case 36294:return Xa;case 36295:return Ka;case 36296:return Za;case 35678:case 36198:case 36298:case 36306:case 35682:return $a;case 35680:case 36300:case 36308:case 36293:return Qa}}(e.type)}function io(t){this.id=t,this.seq=[],this.map={}}eo.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),ga(e,t)},io.prototype.setValue=function(t,e,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(t,e[s.id],i)}};const no=/(\w+)(\])?(\[|\.)?/g;function ro(t,e){t.seq.push(e),t.map[e.id]=e}function so(t,e,i){const n=t.name,r=n.length;for(no.lastIndex=0;;){const s=no.exec(n),a=no.lastIndex;let o=s[1];const l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===r){ro(i,void 0===c?new to(o,t,e):new eo(o,t,e));break}{let t=i.map[o];void 0===t&&(t=new io(o),ro(i,t)),i=t}}}function ao(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);so(i,t.getUniformLocation(e,i.name),this)}}function oo(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}ao.prototype.setValue=function(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)},ao.prototype.setOptional=function(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)},ao.upload=function(t,e,i,n){for(let r=0,s=e.length;r!==s;++r){const s=e[r],a=i[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,n)}},ao.seqWithValue=function(t,e){const i=[];for(let n=0,r=t.length;n!==r;++n){const r=t[n];r.id in e&&i.push(r)}return i};let lo=0;function co(t){switch(t){case Ke:return["Linear","( value )"];case Ze:return["sRGB","( value )"];case Qe:return["RGBE","( value )"];case ei:return["RGBM","( value, 7.0 )"];case ii:return["RGBM","( value, 16.0 )"];case ni:return["RGBD","( value, 256.0 )"];case $e:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case ti:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function ho(t,e,i){const n=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();if(n&&""===r)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+r+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function uo(t,e){const i=co(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function po(t,e){const i=co(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function fo(t,e){let i;switch(e){case Q:i="Linear";break;case tt:i="Reinhard";break;case et:i="OptimizedCineon";break;case it:i="ACESFilmic";break;case nt:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function mo(t){return""!==t}function go(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function _o(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const vo=/^[ \t]*#include +<([\w\d./]+)>/gm;function yo(t){return t.replace(vo,bo)}function bo(t,e){const i=js[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return yo(i)}const xo=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,wo=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function So(t){return t.replace(wo,Ao).replace(xo,Mo)}function Mo(t,e,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Ao(t,e,i,n)}function Ao(t,e,i,n){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Eo(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Lo(t,e,i,n){const r=t.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===u?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===d?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===p&&(e="SHADOWMAP_TYPE_VSM"),e}(i),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case st:case at:e="ENVMAP_TYPE_CUBE";break;case ct:case ht:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),h=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case at:case ht:e="ENVMAP_MODE_REFRACTION"}return e}(i),f=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case X:e="ENVMAP_BLENDING_MULTIPLY";break;case K:e="ENVMAP_BLENDING_MIX";break;case Z:e="ENVMAP_BLENDING_ADD"}return e}(i),m=t.gammaFactor>0?t.gammaFactor:1,g=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission>0)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(mo).join("\n")}(i),_=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(s),v=r.createProgram();let y,b,x=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(y=[_].filter(mo).join("\n"),y.length>0&&(y+="\n"),b=[g,_].filter(mo).join("\n"),b.length>0&&(b+="\n")):(y=[Eo(i),"#define SHADER_NAME "+i.shaderName,_,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(mo).join("\n"),b=[g,Eo(i),"#define SHADER_NAME "+i.shaderName,_,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+m,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+f:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==$?"#define TONE_MAPPING":"",i.toneMapping!==$?js.tonemapping_pars_fragment:"",i.toneMapping!==$?fo("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",js.encodings_pars_fragment,i.map?uo("mapTexelToLinear",i.mapEncoding):"",i.matcap?uo("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?uo("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?uo("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?uo("lightMapTexelToLinear",i.lightMapEncoding):"",po("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(mo).join("\n")),a=yo(a),a=go(a,i),a=_o(a,i),o=yo(o),o=go(o,i),o=_o(o,i),a=So(a),o=So(o),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(x="#version 300 es\n",y=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+y,b=["#define varying in",i.glslVersion===Ii?"":"out highp vec4 pc_fragColor;",i.glslVersion===Ii?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const w=x+b+o,S=oo(r,35633,x+y+a),M=oo(r,35632,w);if(r.attachShader(v,S),r.attachShader(v,M),void 0!==i.index0AttributeName?r.bindAttribLocation(v,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(v,0,"position"),r.linkProgram(v),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(v).trim(),e=r.getShaderInfoLog(S).trim(),i=r.getShaderInfoLog(M).trim();let n=!0,s=!0;if(!1===r.getProgramParameter(v,35714)){n=!1;const e=ho(r,S,"vertex"),i=ho(r,M,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(v,35715),"gl.getProgramInfoLog",t,e,i)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==i||(s=!1);s&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:y},fragmentShader:{log:i,prefix:b}})}let A,E;return r.deleteShader(S),r.deleteShader(M),this.getUniforms=function(){return void 0===A&&(A=new ao(r,v)),A},this.getAttributes=function(){return void 0===E&&(E=function(t,e){const i={},n=t.getProgramParameter(e,35721);for(let r=0;r<n;r++){const n=t.getActiveAttrib(e,r).name;i[n]=t.getAttribLocation(e,n)}return i}(r,v)),E},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=lo++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=S,this.fragmentShader=M,this}function To(t,e,i,n,r,s){const a=[],o=n.isWebGL2,l=n.logarithmicDepthBuffer,c=n.floatVertexTextures,h=n.maxVertexUniforms,u=n.vertexTextures;let d=n.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function _(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Ke,e}return{getParameters:function(r,a,f,v,y){const b=v.fog,x=r.isMeshStandardMaterial?v.environment:null,w=e.get(r.envMap||x),S=p[r.type],M=y.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(c)return 1024;{const t=h,i=Math.floor((t-20)/4),n=Math.min(i,e.length);return n<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+n+"."),0):n}}(y):0;let A,E;if(null!==r.precision&&(d=n.getMaxPrecision(r.precision),d!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",d,"instead.")),S){const t=Vs[S];A=t.vertexShader,E=t.fragmentShader}else A=r.vertexShader,E=r.fragmentShader;const L=t.getRenderTarget();return{isWebGL2:o,shaderID:S,shaderName:r.type,vertexShader:A,fragmentShader:E,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:d,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:u,outputEncoding:null!==L?_(L.texture):t.outputEncoding,map:!!r.map,mapEncoding:_(r.map),matcap:!!r.matcap,matcapEncoding:_(r.matcap),envMap:!!w,envMapMode:w&&w.mapping,envMapEncoding:_(w),envMapCubeUV:!!w&&(w.mapping===ct||w.mapping===ht),lightMap:!!r.lightMap,lightMapEncoding:_(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:_(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===oi,tangentSpaceNormalMap:r.normalMapType===ai,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmission:!!r.transmission,transmissionMap:!!r.transmissionMap,thicknessMap:!!r.thicknessMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexAlphas:!0===r.vertexColors&&y.geometry&&y.geometry.attributes.color&&4===y.geometry.attributes.color.itemSize,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmissionMap||r.thicknessMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmission||r.transmissionMap||r.thicknessMap||!r.displacementMap),fog:!!b,useFog:r.fog,fogExp2:b&&b.isFogExp2,flatShading:!!r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:l,skinning:!0===y.isSkinnedMesh&&M>0,maxBones:M,useVertexTexture:c,morphTargets:r.morphTargets,morphNormals:r.morphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:r.dithering,shadowMapEnabled:t.shadowMap.enabled&&f.length>0,shadowMapType:t.shadowMap.type,toneMapping:r.toneMapped?t.toneMapping:$,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===g,flipSided:r.side===m,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:o||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:o||i.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.fragmentShader),i.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<f.length;t++)i.push(e[f[t]]);i.push(t.outputEncoding),i.push(t.gammaFactor)}return i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=p[t.type];let i;if(e){const t=Vs[e];i=Ss.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=a.length;t<e;t++){const e=a[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new Lo(t,i,e,r),a.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=a.indexOf(t);a[e]=a[a.length-1],a.pop(),t.destroy()}},programs:a}}function Co(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function Po(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function No(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Ro(t){const e=[];let i=0;const n=[],r=[],s=[],a={id:-1};function o(n,r,s,o,l,c){let h=e[i];const u=t.get(s);return void 0===h?(h={id:n.id,object:n,geometry:r,material:s,program:u.program||a,groupOrder:o,renderOrder:n.renderOrder,z:l,group:c},e[i]=h):(h.id=n.id,h.object=n,h.geometry=r,h.material=s,h.program=u.program||a,h.groupOrder=o,h.renderOrder=n.renderOrder,h.z=l,h.group=c),i++,h}return{opaque:n,transmissive:r,transparent:s,init:function(){i=0,n.length=0,r.length=0,s.length=0},push:function(t,e,i,a,l,c){const h=o(t,e,i,a,l,c);i.transmission>0?r.push(h):!0===i.transparent?s.push(h):n.push(h)},unshift:function(t,e,i,a,l,c){const h=o(t,e,i,a,l,c);i.transmission>0?r.unshift(h):!0===i.transparent?s.unshift(h):n.unshift(h)},finish:function(){for(let t=i,n=e.length;t<n;t++){const i=e[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(t,e){n.length>1&&n.sort(t||Po),r.length>1&&r.sort(e||No),s.length>1&&s.sort(e||No)}}}function Do(t){let e=new WeakMap;return{get:function(i,n){let r;return!1===e.has(i)?(r=new Ro(t),e.set(i,[r])):n>=e.get(i).length?(r=new Ro(t),e.get(i).push(r)):r=e.get(i)[n],r},dispose:function(){e=new WeakMap}}}function Io(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new on,color:new Cr};break;case"SpotLight":i={position:new on,direction:new on,color:new Cr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new on,color:new Cr,distance:0,decay:0};break;case"HemisphereLight":i={direction:new on,skyColor:new Cr,groundColor:new Cr};break;case"RectAreaLight":i={color:new Cr,position:new on,halfWidth:new on,halfHeight:new on}}return t[e.id]=i,i}}}let Oo=0;function ko(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Fo(t,e){const i=new Io,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ji};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ji,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new on);const s=new on,a=new Bn,o=new Bn;return{setup:function(s){let a=0,o=0,l=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0;s.sort(ko);for(let t=0,e=s.length;t<e;t++){const e=s[t],_=e.color,v=e.intensity,y=e.distance,b=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=_.r*v,o+=_.g*v,l+=_.b*v;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],v);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[c]=i,r.directionalShadowMap[c]=b,r.directionalShadowMatrix[c]=e.shadow.matrix,f++}r.directional[c]=t,c++}else if(e.isSpotLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(_).multiplyScalar(v),t.distance=y,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.spotShadow[u]=i,r.spotShadowMap[u]=b,r.spotShadowMatrix[u]=e.shadow.matrix,g++}r.spot[u]=t,u++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(_).multiplyScalar(v),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[d]=t,d++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[h]=i,r.pointShadowMap[h]=b,r.pointShadowMatrix[h]=e.shadow.matrix,m++}r.point[h]=t,h++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(v),t.groundColor.copy(e.groundColor).multiplyScalar(v),r.hemi[p]=t,p++}}d>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Us.LTC_FLOAT_1,r.rectAreaLTC2=Us.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Us.LTC_HALF_1,r.rectAreaLTC2=Us.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=o,r.ambient[2]=l;const _=r.hash;_.directionalLength===c&&_.pointLength===h&&_.spotLength===u&&_.rectAreaLength===d&&_.hemiLength===p&&_.numDirectionalShadows===f&&_.numPointShadows===m&&_.numSpotShadows===g||(r.directional.length=c,r.spot.length=u,r.rectArea.length=d,r.point.length=h,r.hemi.length=p,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=m,r.pointShadowMap.length=m,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=m,r.spotShadowMatrix.length=g,_.directionalLength=c,_.pointLength=h,_.spotLength=u,_.rectAreaLength=d,_.hemiLength=p,_.numDirectionalShadows=f,_.numPointShadows=m,_.numSpotShadows=g,r.version=Oo++)},setupView:function(t,e){let i=0,n=0,l=0,c=0,h=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),i++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),o.identity(),a.copy(d.matrixWorld),a.premultiply(u),o.extractRotation(a),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),c++}else if(d.isPointLight){const t=r.point[n];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const t=r.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),t.direction.normalize(),h++}}},state:r}}function Bo(t,e){const i=new Fo(t,e),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(){i.setup(n)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function zo(t,e){let i=new WeakMap;return{get:function(n,r=0){let s;return!1===i.has(n)?(s=new Bo(t,e),i.set(n,[s])):r>=i.get(n).length?(s=new Bo(t,e),i.get(n).push(s)):s=i.get(n)[r],s},dispose:function(){i=new WeakMap}}}class jo extends wr{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=ri,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}jo.prototype.isMeshDepthMaterial=!0;class Uo extends wr{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new on,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}Uo.prototype.isMeshDistanceMaterial=!0;function Vo(t,e,i){let n=new ks;const r=new Ji,s=new Ji,a=new en,o=[],l=[],c={},h=i.maxTextureSize,d={0:m,1:f,2:g},_=new Ms({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ji},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),v=_.clone();v.defines.HORIZONTAL_PASS=1;const b=new ts;b.setAttribute("position",new Dr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new vs(b,_),w=this;function S(i,n){const r=e.update(x);_.uniforms.shadow_pass.value=i.map.texture,_.uniforms.resolution.value=i.mapSize,_.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,r,_,x,null),v.uniforms.shadow_pass.value=i.mapPass.texture,v.uniforms.resolution.value=i.mapSize,v.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,r,v,x,null)}function M(t){const e=t<<0;let i=o[e];return void 0===i&&(i=new jo({depthPacking:si,morphTargets:t}),o[e]=i),i}function A(t){const e=t<<0;let i=l[e];return void 0===i&&(i=new Uo({morphTargets:t}),l[e]=i),i}function E(e,i,n,r,s,a,o){let l=null,h=M,u=e.customDepthMaterial;if(!0===r.isPointLight&&(h=A,u=e.customDistanceMaterial),void 0===u){let t=!1;!0===n.morphTargets&&(t=i.morphAttributes&&i.morphAttributes.position&&i.morphAttributes.position.length>0),l=h(t)}else l=u;if(t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){const t=l.uuid,e=n.uuid;let i=c[t];void 0===i&&(i={},c[t]=i);let r=i[e];void 0===r&&(r=l.clone(),i[e]=r),l=r}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=o===p?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=s,l.farDistance=a),l}function L(i,r,s,a,o){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&o===p)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=e.update(i),r=i.material;if(Array.isArray(r)){const e=n.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],h=r[c.materialIndex];if(h&&h.visible){const e=E(i,n,h,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,c)}}}else if(r.visible){const e=E(i,n,r,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)L(l[t],r,s,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=u,this.render=function(e,i,o){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(y),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=e.length;l<c;l++){const c=e[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const f=u.getFrameExtents();if(r.multiply(f),s.copy(u.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/f.x),r.x=s.x*f.x,u.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/f.y),r.y=s.y*f.y,u.mapSize.y=s.y)),null===u.map&&!u.isPointLightShadow&&this.type===p){const t={minFilter:yt,magFilter:yt,format:Bt};u.map=new nn(r.x,r.y,t),u.map.texture.name=c.name+".shadowMap",u.mapPass=new nn(r.x,r.y,t),u.camera.updateProjectionMatrix()}if(null===u.map){const t={minFilter:ft,magFilter:ft,format:Bt};u.map=new nn(r.x,r.y,t),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const m=u.getViewportCount();for(let t=0;t<m;t++){const e=u.getViewport(t);a.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(a),u.updateMatrices(c,t),n=u.getFrustum(),L(i,o,u.camera,c,this.type)}u.isPointLightShadow||this.type!==p||S(u,o),u.needsUpdate=!1}w.needsUpdate=!1,t.setRenderTarget(l,c,u)}}function Ho(t,e,i){const n=i.isWebGL2;const r=new function(){let e=!1;const i=new en;let n=null;const r=new en(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,s,a,o){!0===o&&(e*=a,n*=a,s*=a),i.set(e,n,s,a),!1===r.equals(i)&&(t.clearColor(e,n,s,a),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},s=new function(){let e=!1,i=null,n=null,r=null;return{setTest:function(t){t?vt(2929):yt(2929)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case U:t.depthFunc(512);break;case V:t.depthFunc(519);break;case H:t.depthFunc(513);break;case G:t.depthFunc(515);break;case W:t.depthFunc(514);break;case q:t.depthFunc(518);break;case Y:t.depthFunc(516);break;case J:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},c=new function(){let e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(t){e||(t?vt(2960):yt(2960))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,a){n===e&&r===i&&s===a||(t.stencilFunc(e,i,a),n=e,r=i,s=a)},setOp:function(e,i,n){a===e&&o===i&&l===n||(t.stencilOp(e,i,n),a=e,o=i,l=n)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,c=null}}};let h={},u=null,d={},p=null,f=!1,_=null,v=null,X=null,K=null,Z=null,$=null,Q=null,tt=!1,et=null,it=null,nt=null,rt=null,st=null;const at=t.getParameter(35661);let ot=!1,lt=0;const ct=t.getParameter(7938);-1!==ct.indexOf("WebGL")?(lt=parseFloat(/^WebGL (\d)/.exec(ct)[1]),ot=lt>=1):-1!==ct.indexOf("OpenGL ES")&&(lt=parseFloat(/^OpenGL ES (\d)/.exec(ct)[1]),ot=lt>=2);let ht=null,ut={};const dt=t.getParameter(3088),pt=t.getParameter(2978),ft=(new en).fromArray(dt),mt=(new en).fromArray(pt);function gt(e,i,n){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<n;e++)t.texImage2D(i+e,0,6408,1,1,0,6408,5121,r);return s}const _t={};function vt(e){!0!==h[e]&&(t.enable(e),h[e]=!0)}function yt(e){!1!==h[e]&&(t.disable(e),h[e]=!1)}_t[3553]=gt(3553,3553,1),_t[34067]=gt(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),c.setClear(0),vt(2929),s.setFunc(G),St(!1),Mt(o),vt(2884),wt(y);const bt={[A]:32774,[E]:32778,[L]:32779};if(n)bt[T]=32775,bt[C]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(bt[T]=t.MIN_EXT,bt[C]=t.MAX_EXT)}const xt={[P]:0,[N]:1,[R]:768,[I]:770,[j]:776,[B]:774,[k]:772,[D]:769,[O]:771,[z]:775,[F]:773};function wt(e,i,n,r,s,a,o,l){if(e!==y){if(!1===f&&(vt(3042),f=!0),e===M)s=s||i,a=a||n,o=o||r,i===v&&s===Z||(t.blendEquationSeparate(bt[i],bt[s]),v=i,Z=s),n===X&&r===K&&a===$&&o===Q||(t.blendFuncSeparate(xt[n],xt[r],xt[a],xt[o]),X=n,K=r,$=a,Q=o),_=e,tt=null;else if(e!==_||l!==tt){if(v===A&&Z===A||(t.blendEquation(32774),v=A,Z=A),l)switch(e){case b:t.blendFuncSeparate(1,771,1,771);break;case x:t.blendFunc(1,1);break;case w:t.blendFuncSeparate(0,0,769,771);break;case S:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case b:t.blendFuncSeparate(770,771,1,771);break;case x:t.blendFunc(770,1);break;case w:t.blendFunc(0,769);break;case S:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}X=null,K=null,$=null,Q=null,_=e,tt=l}}else!0===f&&(yt(3042),f=!1)}function St(e){et!==e&&(e?t.frontFace(2304):t.frontFace(2305),et=e)}function Mt(e){e!==a?(vt(2884),e!==it&&(e===o?t.cullFace(1029):e===l?t.cullFace(1028):t.cullFace(1032))):yt(2884),it=e}function At(e,i,n){e?(vt(32823),rt===i&&st===n||(t.polygonOffset(i,n),rt=i,st=n)):yt(32823)}function Et(e){void 0===e&&(e=33984+at-1),ht!==e&&(t.activeTexture(e),ht=e)}return{buffers:{color:r,depth:s,stencil:c},enable:vt,disable:yt,bindFramebuffer:function(e,i){return null===i&&null!==u&&(i=u),d[e]!==i&&(t.bindFramebuffer(e,i),d[e]=i,n&&(36009===e&&(d[36160]=i),36160===e&&(d[36009]=i)),!0)},bindXRFramebuffer:function(e){e!==u&&(t.bindFramebuffer(36160,e),u=e)},useProgram:function(e){return p!==e&&(t.useProgram(e),p=e,!0)},setBlending:wt,setMaterial:function(t,e){t.side===g?yt(2884):vt(2884);let i=t.side===m;e&&(i=!i),St(i),t.blending===b&&!1===t.transparent?wt(y):wt(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),r.setMask(t.colorWrite);const n=t.stencilWrite;c.setTest(n),n&&(c.setMask(t.stencilWriteMask),c.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),c.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),At(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?vt(32926):yt(32926)},setFlipSided:St,setCullFace:Mt,setLineWidth:function(e){e!==nt&&(ot&&t.lineWidth(e),nt=e)},setPolygonOffset:At,setScissorTest:function(t){t?vt(3089):yt(3089)},activeTexture:Et,bindTexture:function(e,i){null===ht&&Et();let n=ut[ht];void 0===n&&(n={type:void 0,texture:void 0},ut[ht]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||_t[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=ut[ht];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===ft.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),ft.copy(e))},viewport:function(e){!1===mt.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),mt.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===n&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),h={},ht=null,ut={},u=null,d={},p=null,f=!1,_=null,v=null,X=null,K=null,Z=null,$=null,Q=null,tt=!1,et=null,it=null,nt=null,rt=null,st=null,ft.set(0,0,t.canvas.width,t.canvas.height),mt.set(0,0,t.canvas.width,t.canvas.height),r.reset(),s.reset(),c.reset()}}}function Go(t,e,i,n,r,s,a){const o=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,h=r.maxTextureSize,u=r.maxSamples,d=new WeakMap;let p,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return f?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,i,n){let r=1;if((t.width>n||t.height>n)&&(r=n/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?qi:Math.floor,s=n(r*t.width),a=n(r*t.height);void 0===p&&(p=m(s,a));const o=i?m(s,a):p;o.width=s,o.height=a;return o.getContext("2d").drawImage(t,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+a+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function _(t){return Gi(t.width)&&Gi(t.height)}function v(t,e){return t.generateMipmaps&&e&&t.minFilter!==ft&&t.minFilter!==yt}function y(e,i,r,s,a=1){t.generateMipmap(e);n.get(i).__maxMipLevel=Math.log2(Math.max(r,s,a))}function b(i,n,r){if(!1===o)return n;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let s=n;return 6403===n&&(5126===r&&(s=33326),5131===r&&(s=33325),5121===r&&(s=33321)),6407===n&&(5126===r&&(s=34837),5131===r&&(s=34843),5121===r&&(s=32849)),6408===n&&(5126===r&&(s=34836),5131===r&&(s=34842),5121===r&&(s=32856)),33325!==s&&33326!==s&&34842!==s&&34836!==s||e.get("EXT_color_buffer_float"),s}function x(t){return t===ft||t===mt||t===_t?9728:9729}function w(e){const i=e.target;i.removeEventListener("dispose",w),function(e){const i=n.get(e);if(void 0===i.__webglInit)return;t.deleteTexture(i.__webglTexture),n.remove(e)}(i),i.isVideoTexture&&d.delete(i),a.memory.textures--}function S(e){const i=e.target;i.removeEventListener("dispose",S),function(e){const i=e.texture,r=n.get(e),s=n.get(i);if(!e)return;void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),a.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),a.memory.textures--),n.remove(i[e])}n.remove(i),n.remove(e)}(i)}let M=0;function A(t,e){const r=n.get(t);if(t.isVideoTexture&&function(t){const e=a.render.frame;d.get(t)!==e&&(d.set(t,e),t.update())}(t),t.version>0&&r.__version!==t.version){const i=t.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void N(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+e),i.bindTexture(3553,r.__webglTexture)}function E(e,r){const a=n.get(e);e.version>0&&a.__version!==e.version?function(e,n,r){if(6!==n.image.length)return;P(e,n),i.activeTexture(33984+r),i.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const a=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),l=n.image[0]&&n.image[0].isDataTexture,h=[];for(let t=0;t<6;t++)h[t]=a||l?l?n.image[t].image:n.image[t]:g(n.image[t],!1,!0,c);const u=h[0],d=_(u)||o,p=s.convert(n.format),f=s.convert(n.type),m=b(n.internalFormat,p,f);let x;if(C(34067,n,d),a){for(let t=0;t<6;t++){x=h[t].mipmaps;for(let e=0;e<x.length;e++){const r=x[e];n.format!==Bt&&n.format!==Ft?null!==p?i.compressedTexImage2D(34069+t,e,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+t,e,m,r.width,r.height,0,p,f,r.data)}}e.__maxMipLevel=x.length-1}else{x=n.mipmaps;for(let t=0;t<6;t++)if(l){i.texImage2D(34069+t,0,m,h[t].width,h[t].height,0,p,f,h[t].data);for(let e=0;e<x.length;e++){const n=x[e].image[t].image;i.texImage2D(34069+t,e+1,m,n.width,n.height,0,p,f,n.data)}}else{i.texImage2D(34069+t,0,m,p,f,h[t]);for(let e=0;e<x.length;e++){const n=x[e];i.texImage2D(34069+t,e+1,m,p,f,n.image[t])}}e.__maxMipLevel=x.length}v(n,d)&&y(34067,n,u.width,u.height);e.__version=n.version,n.onUpdate&&n.onUpdate(n)}(a,e,r):(i.activeTexture(33984+r),i.bindTexture(34067,a.__webglTexture))}const L={[ut]:10497,[dt]:33071,[pt]:33648},T={[ft]:9728,[mt]:9984,[_t]:9986,[yt]:9729,[bt]:9985,[wt]:9987};function C(i,s,a){if(a?(t.texParameteri(i,10242,L[s.wrapS]),t.texParameteri(i,10243,L[s.wrapT]),32879!==i&&35866!==i||t.texParameteri(i,32882,L[s.wrapR]),t.texParameteri(i,10240,T[s.magFilter]),t.texParameteri(i,10241,T[s.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),32879!==i&&35866!==i||t.texParameteri(i,32882,33071),s.wrapS===dt&&s.wrapT===dt||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,10240,x(s.magFilter)),t.texParameteri(i,10241,x(s.minFilter)),s.minFilter!==ft&&s.minFilter!==yt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const a=e.get("EXT_texture_filter_anisotropic");if(s.type===Pt&&!1===e.has("OES_texture_float_linear"))return;if(!1===o&&s.type===Nt&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function P(e,i){void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",w),e.__webglTexture=t.createTexture(),a.memory.textures++)}function N(e,n,r){let a=3553;n.isDataTexture2DArray&&(a=35866),n.isDataTexture3D&&(a=32879),P(e,n),i.activeTexture(33984+r),i.bindTexture(a,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const l=function(t){return!o&&(t.wrapS!==dt||t.wrapT!==dt||t.minFilter!==ft&&t.minFilter!==yt)}(n)&&!1===_(n.image),c=g(n.image,l,!1,h),u=_(c)||o,d=s.convert(n.format);let p,f=s.convert(n.type),m=b(n.internalFormat,d,f);C(a,n,u);const x=n.mipmaps;if(n.isDepthTexture)m=6402,o?m=n.type===Pt?36012:n.type===Ct?33190:n.type===Ot?35056:33189:n.type===Pt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===Vt&&6402===m&&n.type!==Lt&&n.type!==Ct&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Lt,f=s.convert(n.type)),n.format===Ht&&6402===m&&(m=34041,n.type!==Ot&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Ot,f=s.convert(n.type))),i.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(n.isDataTexture)if(x.length>0&&u){for(let t=0,e=x.length;t<e;t++)p=x[t],i.texImage2D(3553,t,m,p.width,p.height,0,d,f,p.data);n.generateMipmaps=!1,e.__maxMipLevel=x.length-1}else i.texImage2D(3553,0,m,c.width,c.height,0,d,f,c.data),e.__maxMipLevel=0;else if(n.isCompressedTexture){for(let t=0,e=x.length;t<e;t++)p=x[t],n.format!==Bt&&n.format!==Ft?null!==d?i.compressedTexImage2D(3553,t,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,t,m,p.width,p.height,0,d,f,p.data);e.__maxMipLevel=x.length-1}else if(n.isDataTexture2DArray)i.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,f,c.data),e.__maxMipLevel=0;else if(n.isDataTexture3D)i.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,f,c.data),e.__maxMipLevel=0;else if(x.length>0&&u){for(let t=0,e=x.length;t<e;t++)p=x[t],i.texImage2D(3553,t,m,d,f,p);n.generateMipmaps=!1,e.__maxMipLevel=x.length-1}else i.texImage2D(3553,0,m,d,f,c),e.__maxMipLevel=0;v(n,u)&&y(a,n,c.width,c.height),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}function R(e,r,a,o,l){const c=s.convert(a.format),h=s.convert(a.type),u=b(a.internalFormat,c,h);32879===l||35866===l?i.texImage3D(l,0,u,r.width,r.height,r.depth,0,c,h,null):i.texImage2D(l,0,u,r.width,r.height,0,c,h,null),i.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,o,l,n.get(a).__webglTexture,0),i.bindFramebuffer(36160,null)}function D(e,i,n){if(t.bindRenderbuffer(36161,e),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===Pt?r=36012:e.type===Ct&&(r=33190));const n=O(i);t.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else t.renderbufferStorage(36161,r,i.width,i.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(i.depthBuffer&&i.stencilBuffer){if(n){const e=O(i);t.renderbufferStorageMultisample(36161,e,35056,i.width,i.height)}else t.renderbufferStorage(36161,34041,i.width,i.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,r=s.convert(e.format),a=s.convert(e.type),o=b(e.internalFormat,r,a);if(n){const e=O(i);t.renderbufferStorageMultisample(36161,e,o,i.width,i.height)}else t.renderbufferStorage(36161,o,i.width,i.height)}t.bindRenderbuffer(36161,null)}function I(e){const r=n.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),A(r.depthTexture,0);const s=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Vt)t.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==Ht)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=t.createRenderbuffer(),D(r.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),D(r.__webglDepthbuffer,e,!1);i.bindFramebuffer(36160,null)}function O(t){return o&&t.isWebGLMultisampleRenderTarget?Math.min(u,t.samples):0}let k=!1,F=!1;this.allocateTextureUnit=function(){const t=M;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),M+=1,t},this.resetTextureUnits=function(){M=0},this.setTexture2D=A,this.setTexture2DArray=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?N(r,t,e):(i.activeTexture(33984+e),i.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?N(r,t,e):(i.activeTexture(33984+e),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(e){const l=e.texture,c=n.get(e),h=n.get(l);e.addEventListener("dispose",S),!0!==e.isWebGLMultipleRenderTargets&&(h.__webglTexture=t.createTexture(),h.__version=l.version,a.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=!0===e.isWebGLMultisampleRenderTarget,f=l.isDataTexture3D||l.isDataTexture2DArray,m=_(e)||o;if(!o||l.format!==Ft||l.type!==Pt&&l.type!==Nt||(l.format=Bt,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else if(c.__webglFramebuffer=t.createFramebuffer(),d)if(r.drawBuffers){const i=e.texture;for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(p)if(o){c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const n=s.convert(l.format),r=s.convert(l.type),a=b(l.internalFormat,n,r),o=O(e);t.renderbufferStorageMultisample(36161,o,a,e.width,e.height),i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),D(c.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){i.bindTexture(34067,h.__webglTexture),C(34067,l,m);for(let t=0;t<6;t++)R(c.__webglFramebuffer[t],e,l,36064,34069+t);v(l,m)&&y(34067,l,e.width,e.height),i.bindTexture(34067,null)}else if(d){const t=e.texture;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=n.get(s);i.bindTexture(3553,a.__webglTexture),C(3553,s,m),R(c.__webglFramebuffer,e,s,36064+r,3553),v(s,m)&&y(3553,s,e.width,e.height)}i.bindTexture(3553,null)}else{let t=3553;if(f)if(o){t=l.isDataTexture3D?32879:35866}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");i.bindTexture(t,h.__webglTexture),C(t,l,m),R(c.__webglFramebuffer,e,l,36064,t),v(l,m)&&y(t,l,e.width,e.height,e.depth),i.bindTexture(t,null)}e.depthBuffer&&I(e)},this.updateRenderTargetMipmap=function(t){const e=_(t)||o,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,a=r.length;s<a;s++){const a=r[s];if(v(a,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,r=n.get(a).__webglTexture;i.bindTexture(e,r),y(e,a,t.width,t.height),i.bindTexture(e,null)}}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(o){const r=e.width,s=e.height;let a=16384;e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024);const o=n.get(e);i.bindFramebuffer(36008,o.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,o.__webglFramebuffer),t.blitFramebuffer(0,0,r,s,0,0,r,s,a,9728),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,o.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),k=!0),t=t.texture),A(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),F=!0),t=t.texture),E(t,e)}}function Wo(t,e,i){const n=i.isWebGL2;return{convert:function(t){let i;if(t===Mt)return 5121;if(t===Rt)return 32819;if(t===Dt)return 32820;if(t===It)return 33635;if(t===At)return 5120;if(t===Et)return 5122;if(t===Lt)return 5123;if(t===Tt)return 5124;if(t===Ct)return 5125;if(t===Pt)return 5126;if(t===Nt)return n?5131:(i=e.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(t===kt)return 6406;if(t===Ft)return 6407;if(t===Bt)return 6408;if(t===zt)return 6409;if(t===jt)return 6410;if(t===Vt)return 6402;if(t===Ht)return 34041;if(t===Gt)return 6403;if(t===Wt)return 36244;if(t===qt)return 33319;if(t===Yt)return 33320;if(t===Jt)return 36248;if(t===Xt)return 36249;if(t===Kt||t===Zt||t===$t||t===Qt){if(i=e.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(t===Kt)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Zt)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===$t)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Qt)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===te||t===ee||t===ie||t===ne){if(i=e.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(t===te)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===ee)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===ie)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===ne)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===re)return i=e.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===se||t===ae)&&(i=e.get("WEBGL_compressed_texture_etc"),null!==i)){if(t===se)return i.COMPRESSED_RGB8_ETC2;if(t===ae)return i.COMPRESSED_RGBA8_ETC2_EAC}return t===oe||t===le||t===ce||t===he||t===ue||t===de||t===pe||t===fe||t===me||t===ge||t===_e||t===ve||t===ye||t===be||t===we||t===Se||t===Me||t===Ae||t===Ee||t===Le||t===Te||t===Ce||t===Pe||t===Ne||t===Re||t===De||t===Ie||t===Oe?(i=e.get("WEBGL_compressed_texture_astc"),null!==i?t:null):t===xe?(i=e.get("EXT_texture_compression_bptc"),null!==i?t:null):t===Ot?n?34042:(i=e.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class qo extends Es{constructor(t=[]){super(),this.cameras=t}}qo.prototype.isArrayCamera=!0;class Yo extends cr{constructor(){super(),this.type="Group"}}Yo.prototype.isGroup=!0;const Jo={type:"move"};class Xo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Yo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Yo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new on,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new on),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Yo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new on,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new on),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==a&&(n=e.getPose(t.targetRaySpace,i),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Jo))),l&&t.hand){s=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const t=new Yo;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[n.jointName]=t,l.add(t)}const r=l.joints[n.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=n.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class Ko extends Oi{constructor(t,e){super();const i=this,n=t.state;let r=null,s=1,a=null,o="local-floor",l=null,c=null,h=null,u=null,d=null;const p=[],f=new Map,m=new Es;m.layers.enable(1),m.viewport=new en;const g=new Es;g.layers.enable(2),g.viewport=new en;const _=[m,g],v=new qo;v.layers.enable(1),v.layers.enable(2);let y=null,b=null;function x(t){const e=f.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function w(){f.forEach((function(t,e){t.disconnect(e)})),f.clear(),y=null,b=null,n.bindXRFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),T.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function S(t){const e=r.inputSources;for(let t=0;t<p.length;t++)f.set(e[t],p[t]);for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=f.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),f.delete(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e],n=f.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=p[t];return void 0===e&&(e=new Xo,p[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=p[t];return void 0===e&&(e=new Xo,p[t]=e),e.getGripSpace()},this.getHand=function(t){let e=p[t];return void 0===e&&(e=new Xo,p[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){s=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getSession=function(){return r},this.setSession=async function(t){if(r=t,null!==r){r.addEventListener("select",x),r.addEventListener("selectstart",x),r.addEventListener("selectend",x),r.addEventListener("squeeze",x),r.addEventListener("squeezestart",x),r.addEventListener("squeezeend",x),r.addEventListener("end",w),r.addEventListener("inputsourceschange",S);const t=e.getContextAttributes();if(!0!==t.xrCompatible&&await e.makeXRCompatible(),void 0===r.renderState.layers){const i={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(r,e,i),r.updateRenderState({baseLayer:d})}else{let i=0;if(t.antialias){const i={antialias:!0,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(r,e,i),r.updateRenderState({layers:[d]})}else{t.depth&&(i=t.stencil?34041:6402);const n={colorFormat:t.alpha?6408:6407,depthFormat:i,scaleFactor:s};c=new XRWebGLBinding(r,e),u=c.createProjectionLayer(n),h=e.createFramebuffer(),r.updateRenderState({layers:[u]})}}a=await r.requestReferenceSpace(o),T.setContext(r),T.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const M=new on,A=new on;function E(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===r)return;v.near=g.near=m.near=t.near,v.far=g.far=m.far=t.far,y===v.near&&b===v.far||(r.updateRenderState({depthNear:v.near,depthFar:v.far}),y=v.near,b=v.far);const e=t.parent,i=v.cameras;E(v,e);for(let t=0;t<i.length;t++)E(i[t],e);v.matrixWorld.decompose(v.position,v.quaternion,v.scale),t.position.copy(v.position),t.quaternion.copy(v.quaternion),t.scale.copy(v.scale),t.matrix.copy(v.matrix),t.matrixWorld.copy(v.matrixWorld);const n=t.children;for(let t=0,e=n.length;t<e;t++)n[t].updateMatrixWorld(!0);2===i.length?function(t,e,i){M.setFromMatrixPosition(e.matrixWorld),A.setFromMatrixPosition(i.matrixWorld);const n=M.distanceTo(A),r=e.projectionMatrix.elements,s=i.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*h,p=a*u,f=n/(-h+u),m=f*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=a+f,_=o+f,v=d-m,y=p+(n-m),b=l*o/_*g,x=c*o/_*g;t.projectionMatrix.makePerspective(v,y,b,x,g,_)}(v,m,g):v.projectionMatrix.copy(m.projectionMatrix)},this.getCamera=function(){return v};let L=null;const T=new Fs;T.setAnimationLoop((function(t,i){if(l=i.getViewerPose(a),null!==l){const t=l.views;null!==d&&n.bindXRFramebuffer(d.framebuffer);let i=!1;t.length!==v.cameras.length&&(v.cameras.length=0,i=!0);for(let r=0;r<t.length;r++){const s=t[r];let a=null;if(null!==d)a=d.getViewport(s);else{const t=c.getViewSubImage(u,s);n.bindXRFramebuffer(h),void 0!==t.depthStencilTexture&&e.framebufferTexture2D(36160,36096,3553,t.depthStencilTexture,0),e.framebufferTexture2D(36160,36064,3553,t.colorTexture,0),a=t.viewport}const o=_[r];o.matrix.fromArray(s.transform.matrix),o.projectionMatrix.fromArray(s.projectionMatrix),o.viewport.set(a.x,a.y,a.width,a.height),0===r&&v.matrix.copy(o.matrix),!0===i&&v.cameras.push(o)}}const s=r.inputSources;for(let t=0;t<p.length;t++){const e=p[t],n=s[t];e.update(n,i,a)}L&&L(t,i)})),this.setAnimationLoop=function(t){L=t},this.dispose=function(){}}}function Zo(t){function e(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map),i.alphaMap&&(e.alphaMap.value=i.alphaMap),i.specularMap&&(e.specularMap.value=i.specularMap);const n=t.get(i).envMap;if(n){e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture&&n._needsFlipEnvMap?-1:1,e.reflectivity.value=i.reflectivity,e.refractionRatio.value=i.refractionRatio;const r=t.get(n).__maxMipLevel;void 0!==r&&(e.maxMipLevel.value=r)}let r,s;i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap&&(r=i.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),i.aoMap?s=i.aoMap:i.lightMap&&(s=i.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function i(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap),i.bumpMap&&(e.bumpMap.value=i.bumpMap,e.bumpScale.value=i.bumpScale,i.side===m&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,e.normalScale.value.copy(i.normalScale),i.side===m&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias);t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,r,s,a){n.isMeshBasicMaterial?e(t,n):n.isMeshLambertMaterial?(e(t,n),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,n)):n.isMeshToonMaterial?(e(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshPhongMaterial?(e(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshStandardMaterial?(e(t,n),n.isMeshPhysicalMaterial?function(t,e,n){i(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen);e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap);e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap);e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===m&&t.clearcoatNormalScale.value.negate());t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap);e.transmission>0&&(t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height));t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap);t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)}(t,n,a):i(t,n)):n.isMeshMatcapMaterial?(e(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDepthMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDistanceMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?(e(t,n),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,i,n){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n,r,s):n.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function $o(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.style.display="block",t}(),i=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,s=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",h=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let u=null,d=null;const p=[],_=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ke,this.physicallyCorrectLights=!1,this.toneMapping=$,this.toneMappingExposure=1;const v=this;let y=!1,b=0,x=0,w=null,S=-1,M=null;const A=new en,E=new en;let L=null,T=e.width,C=e.height,P=1,N=null,R=null;const D=new en(0,0,T,C),I=new en(0,0,T,C);let O=!1;const k=[],F=new ks;let B=!1,z=!1,j=null;const U=new Bn,V=new on,H={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function G(){return null===w?P:1}let W,q,Y,J,X,K,Z,Q,tt,et,it,nt,rt,st,at,ot,lt,ct,ht,ut,pt,mt,gt=i;function _t(t,i){for(let n=0;n<t.length;n++){const r=t[n],s=e.getContext(r,i);if(null!==s)return s}return null}try{const t={alpha:n,depth:r,stencil:s,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if(e.addEventListener("webglcontextlost",bt,!1),e.addEventListener("webglcontextrestored",xt,!1),null===gt){const e=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&e.shift(),gt=_t(e,t),null===gt)throw _t(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===gt.getShaderPrecisionFormat&&(gt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function vt(){W=new Xs(gt),q=new qs(gt,W,t),W.init(q),pt=new Wo(gt,W,q),Y=new Ho(gt,W,q),k[0]=1029,J=new $s(gt),X=new Co,K=new Go(gt,W,Y,X,q,pt,J),Z=new Js(v),Q=new Bs(gt,q),mt=new Gs(gt,W,Q,q),tt=new Ks(gt,Q,J,mt),et=new ia(gt,tt,Q,J),ct=new ea(gt),at=new Ys(X),it=new To(v,Z,W,q,mt,at),nt=new Zo(X),rt=new Do(X),st=new zo(W,q),lt=new Hs(v,Z,Y,et,o),ot=new Vo(v,et,q),ht=new Ws(gt,W,J,q),ut=new Zs(gt,W,J,q),J.programs=it.programs,v.capabilities=q,v.extensions=W,v.properties=X,v.renderLists=rt,v.shadowMap=ot,v.state=Y,v.info=J}vt();const yt=new Ko(v,gt);function bt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function xt(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const t=J.autoReset,e=ot.enabled,i=ot.autoUpdate,n=ot.needsUpdate,r=ot.type;vt(),J.autoReset=t,ot.enabled=e,ot.autoUpdate=i,ot.needsUpdate=n,ot.type=r}function St(t){const e=t.target;e.removeEventListener("dispose",St),function(t){(function(t){const e=X.get(t).programs;void 0!==e&&e.forEach((function(t){it.releaseProgram(t)}))})(t),X.remove(t)}(e)}this.xr=yt,this.getContext=function(){return gt},this.getContextAttributes=function(){return gt.getContextAttributes()},this.forceContextLoss=function(){const t=W.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=W.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(t){void 0!==t&&(P=t,this.setSize(T,C,!1))},this.getSize=function(t){return t.set(T,C)},this.setSize=function(t,i,n){yt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=t,C=i,e.width=Math.floor(t*P),e.height=Math.floor(i*P),!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(T*P,C*P).floor()},this.setDrawingBufferSize=function(t,i,n){T=t,C=i,P=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(A)},this.getViewport=function(t){return t.copy(D)},this.setViewport=function(t,e,i,n){t.isVector4?D.set(t.x,t.y,t.z,t.w):D.set(t,e,i,n),Y.viewport(A.copy(D).multiplyScalar(P).floor())},this.getScissor=function(t){return t.copy(I)},this.setScissor=function(t,e,i,n){t.isVector4?I.set(t.x,t.y,t.z,t.w):I.set(t,e,i,n),Y.scissor(E.copy(I).multiplyScalar(P).floor())},this.getScissorTest=function(){return O},this.setScissorTest=function(t){Y.setScissorTest(O=t)},this.setOpaqueSort=function(t){N=t},this.setTransparentSort=function(t){R=t},this.getClearColor=function(t){return t.copy(lt.getClearColor())},this.setClearColor=function(){lt.setClearColor.apply(lt,arguments)},this.getClearAlpha=function(){return lt.getClearAlpha()},this.setClearAlpha=function(){lt.setClearAlpha.apply(lt,arguments)},this.clear=function(t,e,i){let n=0;(void 0===t||t)&&(n|=16384),(void 0===e||e)&&(n|=256),(void 0===i||i)&&(n|=1024),gt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",bt,!1),e.removeEventListener("webglcontextrestored",xt,!1),rt.dispose(),st.dispose(),X.dispose(),Z.dispose(),et.dispose(),mt.dispose(),yt.dispose(),yt.removeEventListener("sessionstart",Et),yt.removeEventListener("sessionend",Lt),j&&(j.dispose(),j=null),Tt.stop()},this.renderBufferImmediate=function(t,e){mt.initAttributes();const i=X.get(t);t.hasPositions&&!i.position&&(i.position=gt.createBuffer()),t.hasNormals&&!i.normal&&(i.normal=gt.createBuffer()),t.hasUvs&&!i.uv&&(i.uv=gt.createBuffer()),t.hasColors&&!i.color&&(i.color=gt.createBuffer());const n=e.getAttributes();t.hasPositions&&(gt.bindBuffer(34962,i.position),gt.bufferData(34962,t.positionArray,35048),mt.enableAttribute(n.position),gt.vertexAttribPointer(n.position,3,5126,!1,0,0)),t.hasNormals&&(gt.bindBuffer(34962,i.normal),gt.bufferData(34962,t.normalArray,35048),mt.enableAttribute(n.normal),gt.vertexAttribPointer(n.normal,3,5126,!1,0,0)),t.hasUvs&&(gt.bindBuffer(34962,i.uv),gt.bufferData(34962,t.uvArray,35048),mt.enableAttribute(n.uv),gt.vertexAttribPointer(n.uv,2,5126,!1,0,0)),t.hasColors&&(gt.bindBuffer(34962,i.color),gt.bufferData(34962,t.colorArray,35048),mt.enableAttribute(n.color),gt.vertexAttribPointer(n.color,3,5126,!1,0,0)),mt.disableUnusedAttributes(),gt.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,i,n,r,s){null===e&&(e=H);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=Ot(t,e,n,r);Y.setMaterial(n,a);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,u=1;!0===n.wireframe&&(l=tt.getWireframeAttribute(i),u=2),(n.morphTargets||n.morphNormals)&&ct.update(r,i,n,o),mt.setup(r,n,o,i,l);let d=ht;null!==l&&(h=Q.get(l),d=ut,d.setIndex(h));const p=null!==l?l.count:c.count,f=i.drawRange.start*u,m=i.drawRange.count*u,g=null!==s?s.start*u:0,_=null!==s?s.count*u:1/0,v=Math.max(f,g),y=Math.min(p,f+m,g+_)-1,b=Math.max(0,y-v+1);if(0!==b){if(r.isMesh)!0===n.wireframe?(Y.setLineWidth(n.wireframeLinewidth*G()),d.setMode(1)):d.setMode(4);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),Y.setLineWidth(t*G()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(v,b,r.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);d.renderInstances(v,b,t)}else d.render(v,b)}},this.compile=function(t,e){d=st.get(t),d.init(),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights(),t.traverse((function(e){const i=e.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++){Dt(i[n],t,e)}else Dt(i,t,e)}))};let At=null;function Et(){Tt.stop()}function Lt(){Tt.start()}const Tt=new Fs;function Ct(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;if(i.isArrayCamera){const r=i.cameras;for(let i=0,s=r.length;i<s;i++){const s=r[i];Y.viewport(A.copy(s.viewport)),d.setupLightsView(s);for(let i=0,r=t.length;i<r;i++){const r=t[i],a=r.object,o=r.geometry,l=null===n?r.material:n,c=r.group;a.layers.test(s.layers)&&Rt(a,e,s,o,l,c)}}}else for(let r=0,s=t.length;r<s;r++){const s=t[r];Rt(s.object,e,i,s.geometry,null===n?s.material:n,s.group)}}function Rt(t,e,i,n,r,s){if(t.onBeforeRender(v,e,i,n,r,s),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const n=Ot(i,e,r,t);Y.setMaterial(r),mt.reset(),function(t,e){t.render((function(t){v.renderBufferImmediate(t,e)}))}(t,n)}else!0===r.transparent&&r.side===g?(r.side=m,r.needsUpdate=!0,v.renderBufferDirect(i,e,n,r,t,s),r.side=f,r.needsUpdate=!0,v.renderBufferDirect(i,e,n,r,t,s),r.side=g):v.renderBufferDirect(i,e,n,r,t,s);t.onAfterRender(v,e,i,n,r,s)}function Dt(t,e,i){!0!==e.isScene&&(e=H);const n=X.get(t),r=d.state.lights,s=d.state.shadowsArray,a=r.state.version,o=it.getParameters(t,r.state,s,e,i),l=it.getProgramCacheKey(o);let c=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=Z.get(t.envMap||n.environment),void 0===c&&(t.addEventListener("dispose",St),c=new Map,n.programs=c);let h=c.get(l);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===a)return It(t,o),h}else o.uniforms=it.getUniforms(t),t.onBuild(o,v),t.onBeforeCompile(o,v),h=it.acquireProgram(o,l),c.set(l,h),n.uniforms=o.uniforms;const u=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=at.uniform),It(t,o),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=a,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=h.getUniforms(),f=ao.seqWithValue(p.seq,u);return n.currentProgram=h,n.uniformsList=f,h}function It(t,e){const i=X.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.skinning=e.skinning,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas}function Ot(t,e,i,n){!0!==e.isScene&&(e=H),K.resetTextureUnits();const r=e.fog,s=i.isMeshStandardMaterial?e.environment:null,a=null===w?v.outputEncoding:w.texture.encoding,o=Z.get(i.envMap||s),l=!0===i.vertexColors&&n.geometry&&n.geometry.attributes.color&&4===n.geometry.attributes.color.itemSize,c=X.get(i),h=d.state.lights;if(!0===B&&(!0===z||t!==M)){const e=t===M&&i.id===S;at.setState(i,t,e)}let u=!1;i.version===c.__version?c.needsLights&&c.lightsStateVersion!==h.state.version||c.outputEncoding!==a||n.isInstancedMesh&&!1===c.instancing?u=!0:n.isInstancedMesh||!0!==c.instancing?n.isSkinnedMesh&&!1===c.skinning?u=!0:n.isSkinnedMesh||!0!==c.skinning?c.envMap!==o||i.fog&&c.fog!==r?u=!0:void 0===c.numClippingPlanes||c.numClippingPlanes===at.numPlanes&&c.numIntersection===at.numIntersection?c.vertexAlphas!==l&&(u=!0):u=!0:u=!0:u=!0:(u=!0,c.__version=i.version);let p=c.currentProgram;!0===u&&(p=Dt(i,e,n));let f=!1,m=!1,g=!1;const _=p.getUniforms(),y=c.uniforms;if(Y.useProgram(p.program)&&(f=!0,m=!0,g=!0),i.id!==S&&(S=i.id,m=!0),f||M!==t){if(_.setValue(gt,"projectionMatrix",t.projectionMatrix),q.logarithmicDepthBuffer&&_.setValue(gt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),M!==t&&(M=t,m=!0,g=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const e=_.map.cameraPosition;void 0!==e&&e.setValue(gt,V.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&_.setValue(gt,"isOrthographic",!0===t.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||n.isSkinnedMesh)&&_.setValue(gt,"viewMatrix",t.matrixWorldInverse)}if(n.isSkinnedMesh){_.setOptional(gt,n,"bindMatrix"),_.setOptional(gt,n,"bindMatrixInverse");const t=n.skeleton;t&&(q.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),_.setValue(gt,"boneTexture",t.boneTexture,K),_.setValue(gt,"boneTextureSize",t.boneTextureSize)):_.setOptional(gt,t,"boneMatrices"))}var b,x;return(m||c.receiveShadow!==n.receiveShadow)&&(c.receiveShadow=n.receiveShadow,_.setValue(gt,"receiveShadow",n.receiveShadow)),m&&(_.setValue(gt,"toneMappingExposure",v.toneMappingExposure),c.needsLights&&(x=g,(b=y).ambientLightColor.needsUpdate=x,b.lightProbe.needsUpdate=x,b.directionalLights.needsUpdate=x,b.directionalLightShadows.needsUpdate=x,b.pointLights.needsUpdate=x,b.pointLightShadows.needsUpdate=x,b.spotLights.needsUpdate=x,b.spotLightShadows.needsUpdate=x,b.rectAreaLights.needsUpdate=x,b.hemisphereLights.needsUpdate=x),r&&i.fog&&nt.refreshFogUniforms(y,r),nt.refreshMaterialUniforms(y,i,P,C,j),ao.upload(gt,c.uniformsList,y,K)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(ao.upload(gt,c.uniformsList,y,K),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&_.setValue(gt,"center",n.center),_.setValue(gt,"modelViewMatrix",n.modelViewMatrix),_.setValue(gt,"normalMatrix",n.normalMatrix),_.setValue(gt,"modelMatrix",n.matrixWorld),p}Tt.setAnimationLoop((function(t){At&&At(t)})),"undefined"!=typeof window&&Tt.setContext(window),this.setAnimationLoop=function(t){At=t,yt.setAnimationLoop(t),null===t?Tt.stop():Tt.start()},yt.addEventListener("sessionstart",Et),yt.addEventListener("sessionend",Lt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===y)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===yt.enabled&&!0===yt.isPresenting&&(!0===yt.cameraAutoUpdate&&yt.updateCamera(e),e=yt.getCamera()),!0===t.isScene&&t.onBeforeRender(v,t,e,w),d=st.get(t,_.length),d.init(),_.push(d),U.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),F.setFromProjectionMatrix(U),z=this.localClippingEnabled,B=at.init(this.clippingPlanes,z,e),u=rt.get(t,p.length),u.init(),p.push(u),function t(e,i,n,r){if(!1===e.visible)return;if(e.layers.test(i.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(i);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||F.intersectsSprite(e)){r&&V.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);const t=et.update(e),i=e.material;i.visible&&u.push(e,t,i,n,V.z,null)}}else if(e.isImmediateRenderObject)r&&V.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U),u.push(e,null,e.material,n,V.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==J.render.frame&&(e.skeleton.update(),e.skeleton.frame=J.render.frame),!e.frustumCulled||F.intersectsObject(e))){r&&V.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);const t=et.update(e),i=e.material;if(Array.isArray(i)){const r=t.groups;for(let s=0,a=r.length;s<a;s++){const a=r[s],o=i[a.materialIndex];o&&o.visible&&u.push(e,t,o,n,V.z,a)}}else i.visible&&u.push(e,t,i,n,V.z,null)}const s=e.children;for(let e=0,a=s.length;e<a;e++)t(s[e],i,n,r)}(t,e,0,v.sortObjects),u.finish(),!0===v.sortObjects&&u.sort(N,R),!0===B&&at.beginShadows();const i=d.state.shadowsArray;ot.render(i,t,e),d.setupLights(),d.setupLightsView(e),!0===B&&at.endShadows(),!0===this.info.autoReset&&this.info.reset(),lt.render(u,t);const n=u.opaque,r=u.transmissive,s=u.transparent;n.length>0&&Ct(n,t,e),r.length>0&&function(t,e,i,n){if(null===j){const t=!0===a&&!0===q.isWebGL2;j=new(t?sn:nn)(1024,1024,{generateMipmaps:!0,type:null!==pt.convert(Nt)?Nt:Mt,minFilter:wt,magFilter:ft,wrapS:dt,wrapT:dt})}const r=v.getRenderTarget();v.setRenderTarget(j),v.clear();const s=v.toneMapping;v.toneMapping=$,Ct(t,i,n),v.toneMapping=s,K.updateMultisampleRenderTarget(j),K.updateRenderTargetMipmap(j),v.setRenderTarget(r),Ct(e,i,n)}(n,r,t,e),s.length>0&&Ct(s,t,e),null!==w&&(K.updateMultisampleRenderTarget(w),K.updateRenderTargetMipmap(w)),!0===t.isScene&&t.onAfterRender(v,t,e),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1),mt.resetDefaultState(),S=-1,M=null,_.pop(),d=_.length>0?_[_.length-1]:null,p.pop(),u=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return w},this.setRenderTarget=function(t,e=0,i=0){w=t,b=e,x=i,t&&void 0===X.get(t).__webglFramebuffer&&K.setupRenderTarget(t);let n=null,r=!1,s=!1;if(t){const i=t.texture;(i.isDataTexture3D||i.isDataTexture2DArray)&&(s=!0);const a=X.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(n=a[e],r=!0):n=t.isWebGLMultisampleRenderTarget?X.get(t).__webglMultisampledFramebuffer:a,A.copy(t.viewport),E.copy(t.scissor),L=t.scissorTest}else A.copy(D).multiplyScalar(P).floor(),E.copy(I).multiplyScalar(P).floor(),L=O;if(Y.bindFramebuffer(36160,n)&&q.drawBuffers){let e=!1;if(t)if(t.isWebGLMultipleRenderTargets){const i=t.texture;if(k.length!==i.length||36064!==k[0]){for(let t=0,e=i.length;t<e;t++)k[t]=36064+t;k.length=i.length,e=!0}}else 1===k.length&&36064===k[0]||(k[0]=36064,k.length=1,e=!0);else 1===k.length&&1029===k[0]||(k[0]=1029,k.length=1,e=!0);e&&(q.isWebGL2?gt.drawBuffers(k):W.get("WEBGL_draw_buffers").drawBuffersWEBGL(k))}if(Y.viewport(A),Y.scissor(E),Y.setScissorTest(L),r){const n=X.get(t.texture);gt.framebufferTexture2D(36160,36064,34069+e,n.__webglTexture,i)}else if(s){const n=X.get(t.texture),r=e||0;gt.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}},this.readRenderTargetPixels=function(t,e,i,n,r,s,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=X.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){Y.bindFramebuffer(36160,o);try{const a=t.texture,o=a.format,l=a.type;if(o!==Bt&&pt.convert(o)!==gt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Nt&&(W.has("EXT_color_buffer_half_float")||q.isWebGL2&&W.has("EXT_color_buffer_float"));if(!(l===Mt||pt.convert(l)===gt.getParameter(35738)||l===Pt&&(q.isWebGL2||W.has("OES_texture_float")||W.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===gt.checkFramebufferStatus(36160)?e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&gt.readPixels(e,i,n,r,pt.convert(o),pt.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==w?X.get(w).__webglFramebuffer:null;Y.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){const n=Math.pow(2,-i),r=Math.floor(e.image.width*n),s=Math.floor(e.image.height*n);let a=pt.convert(e.format);q.isWebGL2&&(6407===a&&(a=32849),6408===a&&(a=32856)),K.setTexture2D(e,0),gt.copyTexImage2D(3553,i,a,t.x,t.y,r,s,0),Y.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const r=e.image.width,s=e.image.height,a=pt.convert(i.format),o=pt.convert(i.type);K.setTexture2D(i,0),gt.pixelStorei(37440,i.flipY),gt.pixelStorei(37441,i.premultiplyAlpha),gt.pixelStorei(3317,i.unpackAlignment),e.isDataTexture?gt.texSubImage2D(3553,n,t.x,t.y,r,s,a,o,e.image.data):e.isCompressedTexture?gt.compressedTexSubImage2D(3553,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):gt.texSubImage2D(3553,n,t.x,t.y,a,o,e.image),0===n&&i.generateMipmaps&&gt.generateMipmap(3553),Y.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,r=0){if(v.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,a=t.max.y-t.min.y+1,o=t.max.z-t.min.z+1,l=pt.convert(n.format),c=pt.convert(n.type);let h;if(n.isDataTexture3D)K.setTexture3D(n,0),h=32879;else{if(!n.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");K.setTexture2DArray(n,0),h=35866}gt.pixelStorei(37440,n.flipY),gt.pixelStorei(37441,n.premultiplyAlpha),gt.pixelStorei(3317,n.unpackAlignment);const u=gt.getParameter(3314),d=gt.getParameter(32878),p=gt.getParameter(3316),f=gt.getParameter(3315),m=gt.getParameter(32877),g=i.isCompressedTexture?i.mipmaps[0]:i.image;gt.pixelStorei(3314,g.width),gt.pixelStorei(32878,g.height),gt.pixelStorei(3316,t.min.x),gt.pixelStorei(3315,t.min.y),gt.pixelStorei(32877,t.min.z),i.isDataTexture||i.isDataTexture3D?gt.texSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,c,g.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),gt.compressedTexSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,g.data)):gt.texSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,c,g),gt.pixelStorei(3314,u),gt.pixelStorei(32878,d),gt.pixelStorei(3316,p),gt.pixelStorei(3315,f),gt.pixelStorei(32877,m),0===r&&n.generateMipmaps&&gt.generateMipmap(h),Y.unbindTexture()},this.initTexture=function(t){K.setTexture2D(t,0),Y.unbindTexture()},this.resetState=function(){b=0,x=0,w=null,Y.reset(),mt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Qo extends $o{}Qo.prototype.isWebGL1Renderer=!0;class tl{constructor(t,e=25e-5){this.name="",this.color=new Cr(t),this.density=e}clone(){return new tl(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}tl.prototype.isFogExp2=!0;class el{constructor(t,e=1,i=1e3){this.name="",this.color=new Cr(t),this.near=e,this.far=i}clone(){return new el(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}el.prototype.isFog=!0;class il extends cr{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}il.prototype.isScene=!0;class nl{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Mi,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ji()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ji()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ji()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}nl.prototype.isInterleavedBuffer=!0;const rl=new on;class sl{constructor(t,e,i,n=!1){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)rl.x=this.getX(e),rl.y=this.getY(e),rl.z=this.getZ(e),rl.applyMatrix4(t),this.setXYZ(e,rl.x,rl.y,rl.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)rl.x=this.getX(e),rl.y=this.getY(e),rl.z=this.getZ(e),rl.applyNormalMatrix(t),this.setXYZ(e,rl.x,rl.y,rl.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)rl.x=this.getX(e),rl.y=this.getY(e),rl.z=this.getZ(e),rl.transformDirection(t),this.setXYZ(e,rl.x,rl.y,rl.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new Dr(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new sl(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}sl.prototype.isInterleavedBufferAttribute=!0;class al extends wr{constructor(t){super(),this.type="SpriteMaterial",this.color=new Cr(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let ol;al.prototype.isSpriteMaterial=!0;const ll=new on,cl=new on,hl=new on,ul=new Ji,dl=new Ji,pl=new Bn,fl=new on,ml=new on,gl=new on,_l=new Ji,vl=new Ji,yl=new Ji;class bl extends cr{constructor(t){if(super(),this.type="Sprite",void 0===ol){ol=new ts;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new nl(t,5);ol.setIndex([0,1,2,0,2,3]),ol.setAttribute("position",new sl(e,3,0,!1)),ol.setAttribute("uv",new sl(e,2,3,!1))}this.geometry=ol,this.material=void 0!==t?t:new al,this.center=new Ji(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),cl.setFromMatrixScale(this.matrixWorld),pl.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),hl.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&cl.multiplyScalar(-hl.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;xl(fl.set(-.5,-.5,0),hl,s,cl,n,r),xl(ml.set(.5,-.5,0),hl,s,cl,n,r),xl(gl.set(.5,.5,0),hl,s,cl,n,r),_l.set(0,0),vl.set(1,0),yl.set(1,1);let a=t.ray.intersectTriangle(fl,ml,gl,!1,ll);if(null===a&&(xl(ml.set(-.5,.5,0),hl,s,cl,n,r),vl.set(0,1),a=t.ray.intersectTriangle(fl,gl,ml,!1,ll),null===a))return;const o=t.ray.origin.distanceTo(ll);o<t.near||o>t.far||e.push({distance:o,point:ll.clone(),uv:br.getUV(ll,fl,ml,gl,_l,vl,yl,new Ji),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function xl(t,e,i,n,r,s){ul.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?(dl.x=s*ul.x-r*ul.y,dl.y=r*ul.x+s*ul.y):dl.copy(ul),t.copy(e),t.x+=dl.x,t.y+=dl.y,t.applyMatrix4(pl)}bl.prototype.isSprite=!0;const wl=new on,Sl=new on;class Ml extends cr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0){e=Math.abs(e);const i=this.levels;let n;for(n=0;n<i.length&&!(e<i[n].distance);n++);return i.splice(n,0,{distance:e,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let i,n;for(i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object}return null}raycast(t,e){if(this.levels.length>0){wl.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(wl);this.getObjectForDistance(i).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){wl.setFromMatrixPosition(t.matrixWorld),Sl.setFromMatrixPosition(this.matrixWorld);const i=wl.distanceTo(Sl)/t.zoom;let n,r;for(e[0].object.visible=!0,n=1,r=e.length;n<r&&i>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)e[n].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let t=0,n=i.length;t<n;t++){const n=i[t];e.object.levels.push({object:n.object.uuid,distance:n.distance})}return e}}const Al=new on,El=new en,Ll=new en,Tl=new on,Cl=new Bn;class Pl extends vs{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Bn,this.bindMatrixInverse=new Bn}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new en,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const i=this.skeleton,n=this.geometry;El.fromBufferAttribute(n.attributes.skinIndex,t),Ll.fromBufferAttribute(n.attributes.skinWeight,t),Al.fromBufferAttribute(n.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=Ll.getComponent(t);if(0!==n){const r=El.getComponent(t);Cl.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(Tl.copy(Al).applyMatrix4(Cl),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}Pl.prototype.isSkinnedMesh=!0;class Nl extends cr{constructor(){super(),this.type="Bone"}}Nl.prototype.isBone=!0;class Rl extends Qi{constructor(t=null,e=1,i=1,n,r,s,a,o,l=ft,c=ft,h,u){super(null,s,a,o,l,c,n,r,h,u),this.image={data:t,width:e,height:i},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Rl.prototype.isDataTexture=!0;const Dl=new Bn,Il=new Bn;class Ol{constructor(t=[],e=[]){this.uuid=ji(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Bn)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Bn;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=t.length;n<r;n++){const r=t[n]?t[n].matrixWorld:Il;Dl.multiplyMatrices(r,e[n]),Dl.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new Ol(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=Wi(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new Rl(e,t,t,Bt,Pt);return this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,n=t.bones.length;i<n;i++){const n=t.bones[i];let r=e[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new Nl),this.bones.push(r),this.boneInverses.push((new Bn).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let n=0,r=e.length;n<r;n++){const r=e[n];t.bones.push(r.uuid);const s=i[n];t.boneInverses.push(s.toArray())}return t}}const kl=new Bn,Fl=new Bn,Bl=[],zl=new vs;class jl extends vs{constructor(t,e,i){super(t,e),this.instanceMatrix=new Dr(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(zl.geometry=this.geometry,zl.material=this.material,void 0!==zl.material)for(let r=0;r<n;r++){this.getMatrixAt(r,kl),Fl.multiplyMatrices(i,kl),zl.matrixWorld=Fl,zl.raycast(t,Bl);for(let t=0,i=Bl.length;t<i;t++){const i=Bl[t];i.instanceId=r,i.object=this,e.push(i)}Bl.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Dr(new Float32Array(3*this.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}jl.prototype.isInstancedMesh=!0;class Ul extends wr{constructor(t){super(),this.type="LineBasicMaterial",this.color=new Cr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this}}Ul.prototype.isLineBasicMaterial=!0;const Vl=new on,Hl=new on,Gl=new Bn,Wl=new Fn,ql=new Cn;class Yl extends cr{constructor(t=new ts,e=new Ul){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)Vl.fromBufferAttribute(e,t-1),Hl.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=Vl.distanceTo(Hl);t.setAttribute("lineDistance",new Vr(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),ql.copy(i.boundingSphere),ql.applyMatrix4(n),ql.radius+=r,!1===t.ray.intersectsSphere(ql))return;Gl.copy(n).invert(),Wl.copy(t.ray).applyMatrix4(Gl);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new on,c=new on,h=new on,u=new on,d=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n){for(let i=Math.max(0,s.start),a=Math.min(n.count,s.start+s.count)-1;i<a;i+=d){const s=n.getX(i),a=n.getX(i+1);l.fromBufferAttribute(r,s),c.fromBufferAttribute(r,a);if(Wl.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,s.start),n=Math.min(r.count,s.start+s.count)-1;i<n;i+=d){l.fromBufferAttribute(r,i),c.fromBufferAttribute(r,i+1);if(Wl.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(u);n<t.near||n>t.far||e.push({distance:n,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Yl.prototype.isLine=!0;const Jl=new on,Xl=new on;class Kl extends Yl{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)Jl.fromBufferAttribute(e,t),Xl.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Jl.distanceTo(Xl);t.setAttribute("lineDistance",new Vr(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Kl.prototype.isLineSegments=!0;class Zl extends Yl{constructor(t,e){super(t,e),this.type="LineLoop"}}Zl.prototype.isLineLoop=!0;class $l extends wr{constructor(t){super(),this.type="PointsMaterial",this.color=new Cr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this}}$l.prototype.isPointsMaterial=!0;const Ql=new Bn,tc=new Fn,ec=new Cn,ic=new on;class nc extends cr{constructor(t=new ts,e=new $l){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),ec.copy(i.boundingSphere),ec.applyMatrix4(n),ec.radius+=r,!1===t.ray.intersectsSphere(ec))return;Ql.copy(n).invert(),tc.copy(t.ray).applyMatrix4(Ql);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(i.isBufferGeometry){const r=i.index,a=i.attributes.position;if(null!==r){for(let i=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);i<l;i++){const s=r.getX(i);ic.fromBufferAttribute(a,s),rc(ic,s,o,n,t,e,this)}}else{for(let i=Math.max(0,s.start),r=Math.min(a.count,s.start+s.count);i<r;i++)ic.fromBufferAttribute(a,i),rc(ic,i,o,n,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function rc(t,e,i,n,r,s,a){const o=tc.distanceSqToPoint(t);if(o<i){const i=new on;tc.closestPointToPoint(t,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:i,index:e,face:null,object:a})}}nc.prototype.isPoints=!0;class sc extends Qi{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,r,s,a,o,l),this.format=void 0!==a?a:Ft,this.minFilter=void 0!==s?s:yt,this.magFilter=void 0!==r?r:yt,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}sc.prototype.isVideoTexture=!0;class ac extends Qi{constructor(t,e,i,n,r,s,a,o,l,c,h,u){super(null,s,a,o,l,c,n,r,h,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}ac.prototype.isCompressedTexture=!0;class oc extends Qi{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,r,s,a,o,l),this.needsUpdate=!0}}oc.prototype.isCanvasTexture=!0;class lc extends Qi{constructor(t,e,i,n,r,s,a,o,l,c){if((c=void 0!==c?c:Vt)!==Vt&&c!==Ht)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Vt&&(i=Lt),void 0===i&&c===Ht&&(i=Ot),super(null,n,r,s,a,o,c,i,l),this.image={width:t,height:e},this.magFilter=void 0!==a?a:ft,this.minFilter=void 0!==o?o:ft,this.flipY=!1,this.generateMipmaps=!1}}lc.prototype.isDepthTexture=!0;class cc extends ts{constructor(t=1,e=8,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},e=Math.max(3,e);const r=[],s=[],a=[],o=[],l=new on,c=new Ji;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let r=0,h=3;r<=e;r++,h+=3){const u=i+r/e*n;l.x=t*Math.cos(u),l.y=t*Math.sin(u),s.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(s[h]/t+1)/2,c.y=(s[h+1]/t+1)/2,o.push(c.x,c.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new Vr(s,3)),this.setAttribute("normal",new Vr(a,3)),this.setAttribute("uv",new Vr(o,2))}static fromJSON(t){return new cc(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class hc extends ts{constructor(t=1,e=1,i=1,n=8,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;n=Math.floor(n),r=Math.floor(r);const c=[],h=[],u=[],d=[];let p=0;const f=[],m=i/2;let g=0;function _(i){const r=p,s=new Ji,f=new on;let _=0;const v=!0===i?t:e,y=!0===i?1:-1;for(let t=1;t<=n;t++)h.push(0,m*y,0),u.push(0,y,0),d.push(.5,.5),p++;const b=p;for(let t=0;t<=n;t++){const e=t/n*o+a,i=Math.cos(e),r=Math.sin(e);f.x=v*r,f.y=m*y,f.z=v*i,h.push(f.x,f.y,f.z),u.push(0,y,0),s.x=.5*i+.5,s.y=.5*r*y+.5,d.push(s.x,s.y),p++}for(let t=0;t<n;t++){const e=r+t,n=b+t;!0===i?c.push(n,n+1,e):c.push(n+1,n,e),_+=3}l.addGroup(g,_,!0===i?1:2),g+=_}!function(){const s=new on,_=new on;let v=0;const y=(e-t)/i;for(let l=0;l<=r;l++){const c=[],g=l/r,v=g*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,r=e*o+a,l=Math.sin(r),f=Math.cos(r);_.x=v*l,_.y=-g*i+m,_.z=v*f,h.push(_.x,_.y,_.z),s.set(l,y,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),c.push(p++)}f.push(c)}for(let t=0;t<n;t++)for(let e=0;e<r;e++){const i=f[e][t],n=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];c.push(i,n,s),c.push(n,r,s),v+=6}l.addGroup(g,v,0),g+=v}(),!1===s&&(t>0&&_(!0),e>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new Vr(h,3)),this.setAttribute("normal",new Vr(u,3)),this.setAttribute("uv",new Vr(d,2))}static fromJSON(t){return new hc(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class uc extends hc{constructor(t=1,e=1,i=8,n=1,r=!1,s=0,a=2*Math.PI){super(0,t,e,i,n,r,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(t){return new uc(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class dc extends ts{constructor(t,e,i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n};const r=[],s=[];function a(t,e,i,n){const r=n+1,s=[];for(let n=0;n<=r;n++){s[n]=[];const a=t.clone().lerp(i,n/r),o=e.clone().lerp(i,n/r),l=r-n;for(let t=0;t<=l;t++)s[n][t]=0===t&&n===r?a:a.clone().lerp(o,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const i=Math.floor(e/2);e%2==0?(o(s[t][i+1]),o(s[t+1][i]),o(s[t][i])):(o(s[t][i+1]),o(s[t+1][i+1]),o(s[t+1][i]))}}function o(t){r.push(t.x,t.y,t.z)}function l(e,i){const n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function c(t,e,i,n){n<0&&1===t.x&&(s[e]=t.x-1),0===i.x&&0===i.z&&(s[e]=n/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}!function(t){const i=new on,n=new on,r=new on;for(let s=0;s<e.length;s+=3)l(e[s+0],i),l(e[s+1],n),l(e[s+2],r),a(i,n,r,t)}(n),function(t){const e=new on;for(let i=0;i<r.length;i+=3)e.x=r[i+0],e.y=r[i+1],e.z=r[i+2],e.normalize().multiplyScalar(t),r[i+0]=e.x,r[i+1]=e.y,r[i+2]=e.z}(i),function(){const t=new on;for(let i=0;i<r.length;i+=3){t.x=r[i+0],t.y=r[i+1],t.z=r[i+2];const n=h(t)/2/Math.PI+.5,a=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(n,1-a)}var e;(function(){const t=new on,e=new on,i=new on,n=new on,a=new Ji,o=new Ji,l=new Ji;for(let u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),n.copy(t).add(e).add(i).divideScalar(3);const p=h(n);c(a,d+0,t,p),c(o,d+2,e,p),c(l,d+4,i,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],i=s[t+2],n=s[t+4],r=Math.max(e,i,n),a=Math.min(e,i,n);r>.9&&a<.1&&(e<.2&&(s[t+0]+=1),i<.2&&(s[t+2]+=1),n<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Vr(r,3)),this.setAttribute("normal",new Vr(r.slice(),3)),this.setAttribute("uv",new Vr(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new dc(t.vertices,t.indices,t.radius,t.details)}}class pc extends dc{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new pc(t.radius,t.detail)}}const fc=new on,mc=new on,gc=new on,_c=new br;class vc extends ts{constructor(t,e){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1,!0===t.isGeometry)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const i=Math.cos(Bi*e),n=t.getIndex(),r=t.getAttribute("position"),s=n?n.count:r.count,a=[0,0,0],o=["a","b","c"],l=new Array(3),c={},h=[];for(let t=0;t<s;t+=3){n?(a[0]=n.getX(t),a[1]=n.getX(t+1),a[2]=n.getX(t+2)):(a[0]=t,a[1]=t+1,a[2]=t+2);const{a:e,b:s,c:u}=_c;if(e.fromBufferAttribute(r,a[0]),s.fromBufferAttribute(r,a[1]),u.fromBufferAttribute(r,a[2]),_c.getNormal(gc),l[0]=`${e.x},${e.y},${e.z}`,l[1]=`${s.x},${s.y},${s.z}`,l[2]=`${u.x},${u.y},${u.z}`,l[0]!==l[1]&&l[1]!==l[2]&&l[2]!==l[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=l[t],r=l[e],s=_c[o[t]],u=_c[o[e]],d=`${n}_${r}`,p=`${r}_${n}`;p in c&&c[p]?(gc.dot(c[p].normal)<=i&&(h.push(s.x,s.y,s.z),h.push(u.x,u.y,u.z)),c[p]=null):d in c||(c[d]={index0:a[t],index1:a[e],normal:gc.clone()})}}for(const t in c)if(c[t]){const{index0:e,index1:i}=c[t];fc.fromBufferAttribute(r,e),mc.fromBufferAttribute(r,i),h.push(fc.x,fc.y,fc.z),h.push(mc.x,mc.y,mc.z)}this.setAttribute("position",new Vr(h,3))}}class yc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),r+=i.distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const r=i.length;let s;s=e||t*i[r-1];let a,o=0,l=r-1;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),a=i[n]-s,a<0)o=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const c=i[n];return(n+(s-c)/(i[n+1]-c))/(r-1)}getTangent(t,e){let i=t-1e-4,n=t+1e-4;i<0&&(i=0),n>1&&(n=1);const r=this.getPoint(i),s=this.getPoint(n),a=e||(r.isVector2?new Ji:new on);return a.copy(s).sub(r).normalize(),a}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new on,n=[],r=[],s=[],a=new on,o=new Bn;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new on),n[e].normalize()}r[0]=new on,s[0]=new on;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),s[0].crossVectors(n[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),a.crossVectors(n[e-1],n[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(Ui(n[e-1].dot(n[e]),-1,1));r[e].applyMatrix4(o.makeRotationAxis(a,t))}s[e].crossVectors(n[e],r[e])}if(!0===e){let e=Math.acos(Ui(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(o.makeRotationAxis(n[i],e*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class bc extends yc{constructor(t=0,e=0,i=1,n=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e){const i=e||new Ji,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const a=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}bc.prototype.isEllipseCurve=!0;class xc extends bc{constructor(t,e,i,n,r,s){super(t,e,i,i,n,r,s),this.type="ArcCurve"}}function wc(){let t=0,e=0,i=0,n=0;function r(r,s,a,o){t=r,e=a,i=-3*r+3*s-2*a-o,n=2*r-2*s+a+o}return{initCatmullRom:function(t,e,i,n,s){r(e,i,s*(i-t),s*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,s,a,o){let l=(e-t)/s-(i-t)/(s+a)+(i-e)/a,c=(i-e)/a-(n-e)/(a+o)+(n-i)/o;l*=a,c*=a,r(e,i,l,c)},calc:function(r){const s=r*r;return t+e*r+i*s+n*(s*r)}}}xc.prototype.isArcCurve=!0;const Sc=new on,Mc=new wc,Ac=new wc,Ec=new wc;class Lc extends yc{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new on){const i=e,n=this.points,r=n.length,s=(r-(this.closed?0:1))*t;let a,o,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?a=n[(l-1)%r]:(Sc.subVectors(n[0],n[1]).add(n[0]),a=Sc);const h=n[l%r],u=n[(l+1)%r];if(this.closed||l+2<r?o=n[(l+2)%r]:(Sc.subVectors(n[r-1],n[r-2]).add(n[r-1]),o=Sc),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(h),t),i=Math.pow(h.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(o),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),Mc.initNonuniformCatmullRom(a.x,h.x,u.x,o.x,e,i,n),Ac.initNonuniformCatmullRom(a.y,h.y,u.y,o.y,e,i,n),Ec.initNonuniformCatmullRom(a.z,h.z,u.z,o.z,e,i,n)}else"catmullrom"===this.curveType&&(Mc.initCatmullRom(a.x,h.x,u.x,o.x,this.tension),Ac.initCatmullRom(a.y,h.y,u.y,o.y,this.tension),Ec.initCatmullRom(a.z,h.z,u.z,o.z,this.tension));return i.set(Mc.calc(c),Ac.calc(c),Ec.calc(c)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new on).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Tc(t,e,i,n,r){const s=.5*(n-e),a=.5*(r-i),o=t*t;return(2*i-2*n+s+a)*(t*o)+(-3*i+3*n-2*s-a)*o+s*t+i}function Cc(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function Pc(t,e,i,n,r){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}Lc.prototype.isCatmullRomCurve3=!0;class Nc extends yc{constructor(t=new Ji,e=new Ji,i=new Ji,n=new Ji){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Ji){const i=e,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(Pc(t,n.x,r.x,s.x,a.x),Pc(t,n.y,r.y,s.y,a.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Nc.prototype.isCubicBezierCurve=!0;class Rc extends yc{constructor(t=new on,e=new on,i=new on,n=new on){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new on){const i=e,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(Pc(t,n.x,r.x,s.x,a.x),Pc(t,n.y,r.y,s.y,a.y),Pc(t,n.z,r.z,s.z,a.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Rc.prototype.isCubicBezierCurve3=!0;class Dc extends yc{constructor(t=new Ji,e=new Ji){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Ji){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new Ji;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Dc.prototype.isLineCurve=!0;class Ic extends yc{constructor(t=new on,e=new on){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new on){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Oc extends yc{constructor(t=new Ji,e=new Ji,i=new Ji){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Ji){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(Cc(t,n.x,r.x,s.x),Cc(t,n.y,r.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Oc.prototype.isQuadraticBezierCurve=!0;class kc extends yc{constructor(t=new on,e=new on,i=new on){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new on){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(Cc(t,n.x,r.x,s.x),Cc(t,n.y,r.y,s.y),Cc(t,n.z,r.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}kc.prototype.isQuadraticBezierCurve3=!0;class Fc extends yc{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Ji){const i=e,n=this.points,r=(n.length-1)*t,s=Math.floor(r),a=r-s,o=n[0===s?s:s-1],l=n[s],c=n[s>n.length-2?n.length-1:s+1],h=n[s>n.length-3?n.length-1:s+2];return i.set(Tc(a,o.x,l.x,c.x,h.x),Tc(a,o.y,l.y,c.y,h.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Ji).fromArray(i))}return this}}Fc.prototype.isSplineCurve=!0;var Bc=Object.freeze({__proto__:null,ArcCurve:xc,CatmullRomCurve3:Lc,CubicBezierCurve:Nc,CubicBezierCurve3:Rc,EllipseCurve:bc,LineCurve:Dc,LineCurve3:Ic,QuadraticBezierCurve:Oc,QuadraticBezierCurve3:kc,SplineCurve:Fc});const zc=function(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let s=jc(t,0,r,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,h,u,d,p;if(n&&(s=function(t,e,i,n){const r=[];let s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*n,l=s<a-1?e[s+1]*n:t.length,c=jc(t,o,l,n,!1),c===c.next&&(c.steiner=!0),r.push(Zc(c));for(r.sort(Yc),s=0;s<r.length;s++)Jc(r[s],i),i=Uc(i,i.next);return i}(t,e,s,i)),t.length>80*i){o=c=t[0],l=h=t[1];for(let e=i;e<r;e+=i)u=t[e],d=t[e+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-o,h-l),p=0!==p?1/p:0}return Vc(s,a,i,o,l,p),a};function jc(t,e,i,n,r){let s,a;if(r===function(t,e,i,n){let r=0;for(let s=e,a=i-n;s<i;s+=n)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(t,e,i,n)>0)for(s=e;s<i;s+=n)a=oh(s,t[s],t[s+1],a);else for(s=i-n;s>=e;s-=n)a=oh(s,t[s],t[s+1],a);return a&&eh(a,a.next)&&(lh(a),a=a.next),a}function Uc(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!eh(n,n.next)&&0!==th(n.prev,n,n.next))n=n.next;else{if(lh(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function Vc(t,e,i,n,r,s,a){if(!t)return;!a&&s&&function(t,e,i,n){let r=t;do{null===r.z&&(r.z=Kc(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i,n,r,s,a,o,l,c=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,n=i,o=0,e=0;e<c&&(o++,n=n.nextZ,n);e++);for(l=c;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(a>1)}(r)}(t,n,r,s);let o,l,c=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,s?Gc(t,n,r,s):Hc(t))e.push(o.i/i),e.push(t.i/i),e.push(l.i/i),lh(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?Vc(t=Wc(Uc(t),e,i),e,i,n,r,s,2):2===a&&qc(t,e,i,n,r,s):Vc(Uc(t),e,i,n,r,s,1);break}}function Hc(t){const e=t.prev,i=t,n=t.next;if(th(e,i,n)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if($c(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&th(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Gc(t,e,i,n){const r=t.prev,s=t,a=t.next;if(th(r,s,a)>=0)return!1;const o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,l=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,c=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,h=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,u=Kc(o,l,e,i,n),d=Kc(c,h,e,i,n);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=u&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&$c(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&th(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&$c(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&th(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&$c(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&th(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&$c(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&th(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Wc(t,e,i){let n=t;do{const r=n.prev,s=n.next.next;!eh(r,s)&&ih(r,n,n.next,s)&&sh(r,s)&&sh(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),lh(n),lh(n.next),n=t=s),n=n.next}while(n!==t);return Uc(n)}function qc(t,e,i,n,r,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&Qc(a,t)){let o=ah(a,t);return a=Uc(a,a.next),o=Uc(o,o.next),Vc(a,e,i,n,r,s),void Vc(o,e,i,n,r,s)}t=t.next}a=a.next}while(a!==t)}function Yc(t,e){return t.x-e.x}function Jc(t,e){if(e=function(t,e){let i=e;const n=t.x,r=t.y;let s,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>a){if(a=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===a)return s;const o=s,l=s.x,c=s.y;let h,u=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&$c(r<c?n:a,r,l,c,r<c?a:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),sh(i,t)&&(h<u||h===u&&(i.x>s.x||i.x===s.x&&Xc(s,i)))&&(s=i,u=h)),i=i.next}while(i!==o);return s}(t,e)){const i=ah(e,t);Uc(e,e.next),Uc(i,i.next)}}function Xc(t,e){return th(t.prev,t,e.prev)<0&&th(e.next,t,t.next)<0}function Kc(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Zc(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function $c(t,e,i,n,r,s,a,o){return(r-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(n-o)-(i-a)*(e-o)>=0&&(i-a)*(s-o)-(r-a)*(n-o)>=0}function Qc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&ih(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(sh(t,e)&&sh(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(th(t.prev,t,e.prev)||th(t,e.prev,e))||eh(t,e)&&th(t.prev,t,t.next)>0&&th(e.prev,e,e.next)>0)}function th(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function eh(t,e){return t.x===e.x&&t.y===e.y}function ih(t,e,i,n){const r=rh(th(t,e,i)),s=rh(th(t,e,n)),a=rh(th(i,n,t)),o=rh(th(i,n,e));return r!==s&&a!==o||(!(0!==r||!nh(t,i,e))||(!(0!==s||!nh(t,n,e))||(!(0!==a||!nh(i,t,n))||!(0!==o||!nh(i,e,n)))))}function nh(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function rh(t){return t>0?1:t<0?-1:0}function sh(t,e){return th(t.prev,t,t.next)<0?th(t,e,t.next)>=0&&th(t,t.prev,e)>=0:th(t,e,t.prev)<0||th(t,t.next,e)<0}function ah(t,e){const i=new ch(t.i,t.x,t.y),n=new ch(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function oh(t,e,i,n){const r=new ch(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function lh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ch(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class hh{static area(t){const e=t.length;let i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i}static isClockWise(t){return hh.area(t)<0}static triangulateShape(t,e){const i=[],n=[],r=[];uh(t),dh(i,t);let s=t.length;e.forEach(uh);for(let t=0;t<e.length;t++)n.push(s),s+=e[t].length,dh(i,e[t]);const a=zc(i,n);for(let t=0;t<a.length;t+=3)r.push(a.slice(t,t+3));return r}}function uh(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function dh(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class ph extends ts{constructor(t,e){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],r=[];for(let e=0,i=t.length;e<i;e++){s(t[e])}function s(t){const s=[],a=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:100,c=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:6,u=void 0!==e.bevelSize?e.bevelSize:h-2,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:fh;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let g,_,v,y,b,x=!1;f&&(g=f.getSpacedPoints(o),x=!0,c=!1,_=f.computeFrenetFrames(o,!1),v=new on,y=new on,b=new on),c||(p=0,h=0,u=0,d=0);const w=t.extractPoints(a);let S=w.shape;const M=w.holes;if(!hh.isClockWise(S)){S=S.reverse();for(let t=0,e=M.length;t<e;t++){const e=M[t];hh.isClockWise(e)&&(M[t]=e.reverse())}}const A=hh.triangulateShape(S,M),E=S;for(let t=0,e=M.length;t<e;t++){const e=M[t];S=S.concat(e)}function L(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const T=S.length,C=A.length;function P(t,e,i){let n,r,s;const a=t.x-e.x,o=t.y-e.y,l=i.x-t.x,c=i.y-t.y,h=a*a+o*o,u=a*c-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=e.x-o/u,f=e.y+a/u,m=((i.x-c/d-p)*c-(i.y+l/d-f)*l)/(a*c-o*l);n=p+a*m-t.x,r=f+o*m-t.y;const g=n*n+r*r;if(g<=2)return new Ji(n,r);s=Math.sqrt(g/2)}else{let t=!1;a>Number.EPSILON?l>Number.EPSILON&&(t=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(c)&&(t=!0),t?(n=-o,r=a,s=Math.sqrt(h)):(n=a,r=o,s=Math.sqrt(h/2))}return new Ji(n/s,r/s)}const N=[];for(let t=0,e=E.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),N[t]=P(E[t],E[i],E[n]);const R=[];let D,I=N.concat();for(let t=0,e=M.length;t<e;t++){const e=M[t];D=[];for(let t=0,i=e.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),D[t]=P(e[t],e[n],e[r]);R.push(D),I=I.concat(D)}for(let t=0;t<p;t++){const e=t/p,i=h*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=L(E[t],N[t],n);F(e.x,e.y,-i)}for(let t=0,e=M.length;t<e;t++){const e=M[t];D=R[t];for(let t=0,r=e.length;t<r;t++){const r=L(e[t],D[t],n);F(r.x,r.y,-i)}}}const O=u+d;for(let t=0;t<T;t++){const e=c?L(S[t],I[t],O):S[t];x?(y.copy(_.normals[0]).multiplyScalar(e.x),v.copy(_.binormals[0]).multiplyScalar(e.y),b.copy(g[0]).add(y).add(v),F(b.x,b.y,b.z)):F(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<T;e++){const i=c?L(S[e],I[e],O):S[e];x?(y.copy(_.normals[t]).multiplyScalar(i.x),v.copy(_.binormals[t]).multiplyScalar(i.y),b.copy(g[t]).add(y).add(v),F(b.x,b.y,b.z)):F(i.x,i.y,l/o*t)}for(let t=p-1;t>=0;t--){const e=t/p,i=h*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=L(E[t],N[t],n);F(e.x,e.y,l+i)}for(let t=0,e=M.length;t<e;t++){const e=M[t];D=R[t];for(let t=0,r=e.length;t<r;t++){const r=L(e[t],D[t],n);x?F(r.x,r.y+g[o-1].y,g[o-1].x+i):F(r.x,r.y,l+i)}}}function k(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=o+2*p;t<i;t++){const i=T*t,s=T*(t+1);z(e+n+i,e+r+i,e+r+s,e+n+s)}}}function F(t,e,i){s.push(t),s.push(e),s.push(i)}function B(t,e,r){j(t),j(e),j(r);const s=n.length/3,a=m.generateTopUV(i,n,s-3,s-2,s-1);U(a[0]),U(a[1]),U(a[2])}function z(t,e,r,s){j(t),j(e),j(s),j(e),j(r),j(s);const a=n.length/3,o=m.generateSideWallUV(i,n,a-6,a-3,a-2,a-1);U(o[0]),U(o[1]),U(o[3]),U(o[1]),U(o[2]),U(o[3])}function j(t){n.push(s[3*t+0]),n.push(s[3*t+1]),n.push(s[3*t+2])}function U(t){r.push(t.x),r.push(t.y)}!function(){const t=n.length/3;if(c){let t=0,e=T*t;for(let t=0;t<C;t++){const i=A[t];B(i[2]+e,i[1]+e,i[0]+e)}t=o+2*p,e=T*t;for(let t=0;t<C;t++){const i=A[t];B(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<C;t++){const e=A[t];B(e[2],e[1],e[0])}for(let t=0;t<C;t++){const e=A[t];B(e[0]+T*o,e[1]+T*o,e[2]+T*o)}}i.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;k(E,e),e+=E.length;for(let t=0,i=M.length;t<i;t++){const i=M[t];k(i,e),e+=i.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Vr(n,3)),this.setAttribute("uv",new Vr(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new Bc[n.type]).fromJSON(n)),new ph(i,t.options)}}const fh={generateTopUV:function(t,e,i,n,r){const s=e[3*i],a=e[3*i+1],o=e[3*n],l=e[3*n+1],c=e[3*r],h=e[3*r+1];return[new Ji(s,a),new Ji(o,l),new Ji(c,h)]},generateSideWallUV:function(t,e,i,n,r,s){const a=e[3*i],o=e[3*i+1],l=e[3*i+2],c=e[3*n],h=e[3*n+1],u=e[3*n+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*s],g=e[3*s+1],_=e[3*s+2];return Math.abs(o-h)<Math.abs(a-c)?[new Ji(a,1-l),new Ji(c,1-u),new Ji(d,1-f),new Ji(m,1-_)]:[new Ji(o,1-l),new Ji(h,1-u),new Ji(p,1-f),new Ji(g,1-_)]}};class mh extends dc{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new mh(t.radius,t.detail)}}class gh extends ts{constructor(t,e=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e),n=Ui(n,0,2*Math.PI);const r=[],s=[],a=[],o=1/e,l=new on,c=new Ji;for(let r=0;r<=e;r++){const h=i+r*o*n,u=Math.sin(h),d=Math.cos(h);for(let i=0;i<=t.length-1;i++)l.x=t[i].x*u,l.y=t[i].y,l.z=t[i].x*d,s.push(l.x,l.y,l.z),c.x=r/e,c.y=i/(t.length-1),a.push(c.x,c.y)}for(let i=0;i<e;i++)for(let e=0;e<t.length-1;e++){const n=e+i*t.length,s=n,a=n+t.length,o=n+t.length+1,l=n+1;r.push(s,a,l),r.push(a,o,l)}if(this.setIndex(r),this.setAttribute("position",new Vr(s,3)),this.setAttribute("uv",new Vr(a,2)),this.computeVertexNormals(),n===2*Math.PI){const i=this.attributes.normal.array,n=new on,r=new on,s=new on,a=e*t.length*3;for(let e=0,o=0;e<t.length;e++,o+=3)n.x=i[o+0],n.y=i[o+1],n.z=i[o+2],r.x=i[a+o+0],r.y=i[a+o+1],r.z=i[a+o+2],s.addVectors(n,r).normalize(),i[o+0]=i[a+o+0]=s.x,i[o+1]=i[a+o+1]=s.y,i[o+2]=i[a+o+2]=s.z}}static fromJSON(t){return new gh(t.points,t.segments,t.phiStart,t.phiLength)}}class _h extends dc{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new _h(t.radius,t.detail)}}class vh extends ts{constructor(t,e,i){super(),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:i};const n=[],r=[],s=[],a=[],o=1e-5,l=new on,c=new on,h=new on,u=new on,d=new on;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=e+1;for(let n=0;n<=i;n++){const p=n/i;for(let i=0;i<=e;i++){const n=i/e;t(n,p,c),r.push(c.x,c.y,c.z),n-o>=0?(t(n-o,p,h),u.subVectors(c,h)):(t(n+o,p,h),u.subVectors(h,c)),p-o>=0?(t(n,p-o,h),d.subVectors(c,h)):(t(n,p+o,h),d.subVectors(h,c)),l.crossVectors(u,d).normalize(),s.push(l.x,l.y,l.z),a.push(n,p)}}for(let t=0;t<i;t++)for(let i=0;i<e;i++){const e=t*p+i,r=t*p+i+1,s=(t+1)*p+i+1,a=(t+1)*p+i;n.push(e,r,a),n.push(r,s,a)}this.setIndex(n),this.setAttribute("position",new Vr(r,3)),this.setAttribute("normal",new Vr(s,3)),this.setAttribute("uv",new Vr(a,2))}}class yh extends ts{constructor(t=.5,e=1,i=8,n=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:s},i=Math.max(3,i);const a=[],o=[],l=[],c=[];let h=t;const u=(e-t)/(n=Math.max(1,n)),d=new on,p=new Ji;for(let t=0;t<=n;t++){for(let t=0;t<=i;t++){const n=r+t/i*s;d.x=h*Math.cos(n),d.y=h*Math.sin(n),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y)}h+=u}for(let t=0;t<n;t++){const e=t*(i+1);for(let t=0;t<i;t++){const n=t+e,r=n,s=n+i+1,o=n+i+2,l=n+1;a.push(r,s,l),a.push(s,o,l)}}this.setIndex(a),this.setAttribute("position",new Vr(o,3)),this.setAttribute("normal",new Vr(l,3)),this.setAttribute("uv",new Vr(c,2))}static fromJSON(t){return new yh(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class bh extends ts{constructor(t,e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(a,o,e),a+=o,o=0;function l(t){const a=n.length/3,l=t.extractPoints(e);let c=l.shape;const h=l.holes;!1===hh.isClockWise(c)&&(c=c.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===hh.isClockWise(e)&&(h[t]=e.reverse())}const u=hh.triangulateShape(c,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];n.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],n=e[0]+a,r=e[1]+a,s=e[2]+a;i.push(n,r,s),o+=3}}this.setIndex(i),this.setAttribute("position",new Vr(n,3)),this.setAttribute("normal",new Vr(r,3)),this.setAttribute("uv",new Vr(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}return new bh(i,t.curveSegments)}}class xh extends ts{constructor(t=1,e=32,i=16,n=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const o=Math.min(s+a,Math.PI);let l=0;const c=[],h=new on,u=new on,d=[],p=[],f=[],m=[];for(let d=0;d<=i;d++){const g=[],_=d/i;let v=0;0==d&&0==s?v=.5/e:d==i&&o==Math.PI&&(v=-.5/e);for(let i=0;i<=e;i++){const o=i/e;h.x=-t*Math.cos(n+o*r)*Math.sin(s+_*a),h.y=t*Math.cos(s+_*a),h.z=t*Math.sin(n+o*r)*Math.sin(s+_*a),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(o+v,1-_),g.push(l++)}c.push(g)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){const e=c[t][n+1],r=c[t][n],a=c[t+1][n],l=c[t+1][n+1];(0!==t||s>0)&&d.push(e,r,l),(t!==i-1||o<Math.PI)&&d.push(r,a,l)}this.setIndex(d),this.setAttribute("position",new Vr(p,3)),this.setAttribute("normal",new Vr(f,3)),this.setAttribute("uv",new Vr(m,2))}static fromJSON(t){return new xh(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class wh extends dc{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new wh(t.radius,t.detail)}}class Sh extends ph{constructor(t,e={}){const i=e.font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new ts;const n=i.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),super(n,e),this.type="TextGeometry"}}class Mh extends ts{constructor(t=1,e=.4,i=8,n=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const s=[],a=[],o=[],l=[],c=new on,h=new on,u=new on;for(let s=0;s<=i;s++)for(let d=0;d<=n;d++){const p=d/n*r,f=s/i*Math.PI*2;h.x=(t+e*Math.cos(f))*Math.cos(p),h.y=(t+e*Math.cos(f))*Math.sin(p),h.z=e*Math.sin(f),a.push(h.x,h.y,h.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(d/n),l.push(s/i)}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*t+e-1,r=(n+1)*(t-1)+e-1,a=(n+1)*(t-1)+e,o=(n+1)*t+e;s.push(i,r,o),s.push(r,a,o)}this.setIndex(s),this.setAttribute("position",new Vr(a,3)),this.setAttribute("normal",new Vr(o,3)),this.setAttribute("uv",new Vr(l,2))}static fromJSON(t){return new Mh(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Ah extends ts{constructor(t=1,e=.4,i=64,n=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);const a=[],o=[],l=[],c=[],h=new on,u=new on,d=new on,p=new on,f=new on,m=new on,g=new on;for(let a=0;a<=i;++a){const v=a/i*r*Math.PI*2;_(v,r,s,t,d),_(v+.01,r,s,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=n;++t){const r=t/n*Math.PI*2,s=-e*Math.cos(r),p=e*Math.sin(r);h.x=d.x+(s*g.x+p*f.x),h.y=d.y+(s*g.y+p*f.y),h.z=d.z+(s*g.z+p*f.z),o.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(a/i),c.push(t/n)}}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,o=(n+1)*(t-1)+e;a.push(i,r,o),a.push(r,s,o)}function _(t,e,i,n,r){const s=Math.cos(t),a=Math.sin(t),o=i/e*t,l=Math.cos(o);r.x=n*(2+l)*.5*s,r.y=n*(2+l)*a*.5,r.z=n*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new Vr(o,3)),this.setAttribute("normal",new Vr(l,3)),this.setAttribute("uv",new Vr(c,2))}static fromJSON(t){return new Ah(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Eh extends ts{constructor(t,e=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r};const s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new on,o=new on,l=new Ji;let c=new on;const h=[],u=[],d=[],p=[];function f(r){c=t.getPointAt(r/e,c);const l=s.normals[r],d=s.binormals[r];for(let t=0;t<=n;t++){const e=t/n*Math.PI*2,r=Math.sin(e),s=-Math.cos(e);o.x=s*l.x+r*d.x,o.y=s*l.y+r*d.y,o.z=s*l.z+r*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=c.x+i*o.x,a.y=c.y+i*o.y,a.z=c.z+i*o.z,h.push(a.x,a.y,a.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let i=0;i<=n;i++)l.x=t/e,l.y=i/n,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,a=(n+1)*(t-1)+e;p.push(i,r,a),p.push(r,s,a)}}()}(),this.setIndex(p),this.setAttribute("position",new Vr(h,3)),this.setAttribute("normal",new Vr(u,3)),this.setAttribute("uv",new Vr(d,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Eh((new Bc[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Lh extends ts{constructor(t){if(super(),this.type="WireframeGeometry",!0===t.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const e=[],i=new Set,n=new on,r=new on;if(null!==t.index){const s=t.attributes.position,a=t.index;let o=t.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let t=0,l=o.length;t<l;++t){const l=o[t],c=l.start;for(let t=c,o=c+l.count;t<o;t+=3)for(let o=0;o<3;o++){const l=a.getX(t+o),c=a.getX(t+(o+1)%3);n.fromBufferAttribute(s,l),r.fromBufferAttribute(s,c),!0===Th(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let t=0,a=s.count/3;t<a;t++)for(let a=0;a<3;a++){const o=3*t+a,l=3*t+(a+1)%3;n.fromBufferAttribute(s,o),r.fromBufferAttribute(s,l),!0===Th(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new Vr(e,3))}}function Th(t,e,i){const n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==i.has(n)&&!0!==i.has(r)&&(i.add(n,r),!0)}var Ch=Object.freeze({__proto__:null,BoxGeometry:bs,BoxBufferGeometry:bs,CircleGeometry:cc,CircleBufferGeometry:cc,ConeGeometry:uc,ConeBufferGeometry:uc,CylinderGeometry:hc,CylinderBufferGeometry:hc,DodecahedronGeometry:pc,DodecahedronBufferGeometry:pc,EdgesGeometry:vc,ExtrudeGeometry:ph,ExtrudeBufferGeometry:ph,IcosahedronGeometry:mh,IcosahedronBufferGeometry:mh,LatheGeometry:gh,LatheBufferGeometry:gh,OctahedronGeometry:_h,OctahedronBufferGeometry:_h,ParametricGeometry:vh,ParametricBufferGeometry:vh,PlaneGeometry:zs,PlaneBufferGeometry:zs,PolyhedronGeometry:dc,PolyhedronBufferGeometry:dc,RingGeometry:yh,RingBufferGeometry:yh,ShapeGeometry:bh,ShapeBufferGeometry:bh,SphereGeometry:xh,SphereBufferGeometry:xh,TetrahedronGeometry:wh,TetrahedronBufferGeometry:wh,TextGeometry:Sh,TextBufferGeometry:Sh,TorusGeometry:Mh,TorusBufferGeometry:Mh,TorusKnotGeometry:Ah,TorusKnotBufferGeometry:Ah,TubeGeometry:Eh,TubeBufferGeometry:Eh,WireframeGeometry:Lh});class Ph extends wr{constructor(t){super(),this.type="ShadowMaterial",this.color=new Cr(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}Ph.prototype.isShadowMaterial=!0;class Nh extends Ms{constructor(t){super(t),this.type="RawShaderMaterial"}}Nh.prototype.isRawShaderMaterial=!0;class Rh extends wr{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Cr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Cr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ai,this.normalScale=new Ji(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this.vertexTangents=t.vertexTangents,this}}Rh.prototype.isMeshStandardMaterial=!0;class Dh extends Rh{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ji(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=Ui(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Cr(1,1,1),this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new Cr).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this}}Dh.prototype.isMeshPhysicalMaterial=!0;class Ih extends wr{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new Cr(16777215),this.specular=new Cr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Cr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ai,this.normalScale=new Ji(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this}}Ih.prototype.isMeshPhongMaterial=!0;class Oh extends wr{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Cr(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Cr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ai,this.normalScale=new Ji(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this}}Oh.prototype.isMeshToonMaterial=!0;class kh extends wr{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ai,this.normalScale=new Ji(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this}}kh.prototype.isMeshNormalMaterial=!0;class Fh extends wr{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new Cr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Cr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this}}Fh.prototype.isMeshLambertMaterial=!0;class Bh extends wr{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Cr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ai,this.normalScale=new Ji(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this}}Bh.prototype.isMeshMatcapMaterial=!0;class zh extends Ul{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}zh.prototype.isLineDashedMaterial=!0;var jh=Object.freeze({__proto__:null,ShadowMaterial:Ph,SpriteMaterial:al,RawShaderMaterial:Nh,ShaderMaterial:Ms,PointsMaterial:$l,MeshPhysicalMaterial:Dh,MeshStandardMaterial:Rh,MeshPhongMaterial:Ih,MeshToonMaterial:Oh,MeshNormalMaterial:kh,MeshLambertMaterial:Fh,MeshDepthMaterial:jo,MeshDistanceMaterial:Uo,MeshBasicMaterial:Pr,MeshMatcapMaterial:Bh,LineDashedMaterial:zh,LineBasicMaterial:Ul,Material:wr});const Uh={arraySlice:function(t,e,i){return Uh.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i},sortedArray:function(t,e,i){const n=t.length,r=new t.constructor(n);for(let s=0,a=0;a!==n;++s){const n=i[s]*e;for(let i=0;i!==e;++i)r[a++]=t[n+i]}return r},flattenJSON:function(t,e,i,n){let r=1,s=t[0];for(;void 0!==s&&void 0===s[n];)s=t[r++];if(void 0===s)return;let a=s[n];if(void 0!==a)if(Array.isArray(a))do{a=s[n],void 0!==a&&(e.push(s.time),i.push.apply(i,a)),s=t[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[n],void 0!==a&&(e.push(s.time),a.toArray(i,i.length)),s=t[r++]}while(void 0!==s);else do{a=s[n],void 0!==a&&(e.push(s.time),i.push(a)),s=t[r++]}while(void 0!==s)},subclip:function(t,e,i,n,r=30){const s=t.clone();s.name=e;const a=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],o=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<i||s>=n)){l.push(e.times[t]);for(let i=0;i<o;++i)c.push(e.values[t*o+i])}}0!==l.length&&(e.times=Uh.convertArray(l,e.times.constructor),e.values=Uh.convertArray(c,e.values.constructor),a.push(e))}s.tracks=a;let o=1/0;for(let t=0;t<s.tracks.length;++t)o>s.tracks[t].times[0]&&(o=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,i=t,n=30){n<=0&&(n=30);const r=i.tracks.length,s=e/n;for(let e=0;e<r;++e){const n=i.tracks[e],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const a=t.tracks.find((function(t){return t.name===n.name&&t.ValueTypeName===r}));if(void 0===a)continue;let o=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let c=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=n.times.length-1;let d;if(s<=n.times[0]){const t=o,e=l-o;d=Uh.arraySlice(n.values,t,e)}else if(s>=n.times[u]){const t=u*l+o,e=t+l-o;d=Uh.arraySlice(n.values,t,e)}else{const t=n.createInterpolant(),e=o,i=l-o;t.evaluate(s),d=Uh.arraySlice(t.resultBuffer,e,i)}if("quaternion"===r){(new an).fromArray(d).normalize().conjugate().toArray(d)}const p=a.times.length;for(let t=0;t<p;++t){const e=t*h+c;if("quaternion"===r)an.multiplyQuaternionsFlat(a.values,e,d,0,a.values,e);else{const t=h-2*c;for(let i=0;i<t;++i)a.values[e+i]-=d[i]}}}return t.blendMode=qe,t}};class Vh{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{let s;i:{n:if(!(t<n)){for(let s=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===s)break;if(r=n,n=e[++i],t<n)break e}s=e.length;break i}if(t>=r)break t;{const a=e[1];t<a&&(i=2,r=a);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===s)break;if(n=r,r=e[--i-1],t>=r)break e}s=i,i=0}}for(;i<s;){const n=i+s>>>1;t<e[n]?s=n:i=n+1}if(n=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let t=0;t!==n;++t)e[t]=i[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Vh.prototype.beforeStart_=Vh.prototype.copySampleValue_,Vh.prototype.afterEnd_=Vh.prototype.copySampleValue_;class Hh extends Vh{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ve,endingEnd:Ve}}intervalChanged_(t,e,i){const n=this.parameterPositions;let r=t-2,s=t+1,a=n[r],o=n[s];if(void 0===a)switch(this.getSettings_().endingStart){case He:r=t,a=2*e-i;break;case Ge:r=n.length-2,a=e+n[r]-n[r+1];break;default:r=t,a=i}if(void 0===o)switch(this.getSettings_().endingEnd){case He:s=t,o=2*i-e;break;case Ge:s=1,o=i+n[1]-n[0];break;default:s=t-1,o=e}const l=.5*(i-e),c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,_=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f;for(let t=0;t!==a;++t)r[t]=g*s[c+t]+_*s[l+t]+v*s[o+t]+y*s[h+t];return r}}class Gh extends Vh{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=(i-e)/(n-e),h=1-c;for(let t=0;t!==a;++t)r[t]=s[l+t]*h+s[o+t]*c;return r}}class Wh extends Vh{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class qh{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Uh.convertArray(e,this.TimeBufferType),this.values=Uh.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Uh.convertArray(t.times,Array),values:Uh.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new Wh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Gh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Hh(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case ze:e=this.InterpolantFactoryMethodDiscrete;break;case je:e=this.InterpolantFactoryMethodLinear;break;case Ue:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ze;case this.InterpolantFactoryMethodLinear:return je;case this.InterpolantFactoryMethodSmooth:return Ue}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==s&&i[s]>e;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=Uh.arraySlice(i,r,s),this.values=Uh.arraySlice(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,s),t=!1;break}s=n}if(void 0!==n&&Uh.isTypedArray(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=Uh.arraySlice(this.times),e=Uh.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===Ue,r=t.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(n)r=!0;else{const t=a*i,n=t-i,s=t+i;for(let a=0;a!==i;++a){const i=e[t+a];if(i!==e[n+a]||i!==e[s+a]){r=!0;break}}}if(r){if(a!==s){t[s]=t[a];const n=a*i,r=s*i;for(let t=0;t!==i;++t)e[r+t]=e[n+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*i,n=s*i,a=0;a!==i;++a)e[n+a]=e[t+a];++s}return s!==t.length?(this.times=Uh.arraySlice(t,0,s),this.values=Uh.arraySlice(e,0,s*i)):(this.times=t,this.values=e),this}clone(){const t=Uh.arraySlice(this.times,0),e=Uh.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}qh.prototype.TimeBufferType=Float32Array,qh.prototype.ValueBufferType=Float32Array,qh.prototype.DefaultInterpolation=je;class Yh extends qh{}Yh.prototype.ValueTypeName="bool",Yh.prototype.ValueBufferType=Array,Yh.prototype.DefaultInterpolation=ze,Yh.prototype.InterpolantFactoryMethodLinear=void 0,Yh.prototype.InterpolantFactoryMethodSmooth=void 0;class Jh extends qh{}Jh.prototype.ValueTypeName="color";class Xh extends qh{}Xh.prototype.ValueTypeName="number";class Kh extends Vh{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-e)/(n-e);let l=t*a;for(let t=l+a;l!==t;l+=4)an.slerpFlat(r,0,s,l-a,s,l,o);return r}}class Zh extends qh{InterpolantFactoryMethodLinear(t){return new Kh(this.times,this.values,this.getValueSize(),t)}}Zh.prototype.ValueTypeName="quaternion",Zh.prototype.DefaultInterpolation=je,Zh.prototype.InterpolantFactoryMethodSmooth=void 0;class $h extends qh{}$h.prototype.ValueTypeName="string",$h.prototype.ValueBufferType=Array,$h.prototype.DefaultInterpolation=ze,$h.prototype.InterpolantFactoryMethodLinear=void 0,$h.prototype.InterpolantFactoryMethodSmooth=void 0;class Qh extends qh{}Qh.prototype.ValueTypeName="vector";class tu{constructor(t,e=-1,i,n=We){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=ji(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,r=i.length;t!==r;++t)e.push(eu(i[t]).scale(n));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(qh.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const r=e.length,s=[];for(let t=0;t<r;t++){let a=[],o=[];a.push((t+r-1)%r,t,(t+1)%r),o.push(0,1,0);const l=Uh.getKeyframeOrder(a);a=Uh.sortedArray(a,1,l),o=Uh.sortedArray(o,1,l),n||0!==a[0]||(a.push(r),o.push(o[0])),s.push(new Xh(".morphTargetInfluences["+e[t].name+"]",a,o).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.name.match(r);if(s&&s.length>1){const t=s[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const s=[];for(const t in n)s.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,r){if(0!==i.length){const s=[],a=[];Uh.flattenJSON(i,s,a,n),0!==s.length&&r.push(new t(e,s,a))}},n=[],r=t.name||"default",s=t.fps||30,a=t.blendMode;let o=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(const i in t){const t=[],s=[];for(let n=0;n!==r[e].morphTargets.length;++n){const n=r[e];t.push(n.time),s.push(n.morphTarget===i?1:0)}n.push(new Xh(".morphTargetInfluence["+i+"]",t,s))}o=t.length*(s||1)}else{const s=".bones["+e[t].name+"]";i(Qh,s+".position",r,"pos",n),i(Zh,s+".quaternion",r,"rot",n),i(Qh,s+".scale",r,"scl",n)}}if(0===n.length)return null;return new this(r,o,n,a)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function eu(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Xh;case"vector":case"vector2":case"vector3":case"vector4":return Qh;case"color":return Jh;case"quaternion":return Zh;case"bool":case"boolean":return Yh;case"string":return $h}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];Uh.flattenJSON(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const iu={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class nu{constructor(t,e,i){const n=this;let r=!1,s=0,a=0,o=void 0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){a++,!1===r&&void 0!==n.onStart&&n.onStart(t,s,a),r=!0},this.itemEnd=function(t){s++,void 0!==n.onProgress&&n.onProgress(t,s,a),s===a&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return o?o(t):t},this.setURLModifier=function(t){return o=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}}const ru=new nu;class su{constructor(t){this.manager=void 0!==t?t:ru,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,r){i.load(t,n,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const au={};class ou extends su{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=iu.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;if(void 0!==au[t])return void au[t].push({onLoad:e,onProgress:i,onError:n});const a=t.match(/^data:(.*?)(;base64)?,(.*)$/);let o;if(a){const i=a[1],s=!!a[2];let o=a[3];o=decodeURIComponent(o),s&&(o=atob(o));try{let n;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const t=new Uint8Array(o.length);for(let e=0;e<o.length;e++)t[e]=o.charCodeAt(e);n="blob"===s?new Blob([t.buffer],{type:i}):t.buffer;break;case"document":const e=new DOMParser;n=e.parseFromString(o,i);break;case"json":n=JSON.parse(o);break;default:n=o}setTimeout((function(){e&&e(n),r.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}),0)}}else{au[t]=[],au[t].push({onLoad:e,onProgress:i,onError:n}),o=new XMLHttpRequest,o.open("GET",t,!0),o.addEventListener("load",(function(e){const i=this.response,n=au[t];if(delete au[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),iu.add(t,i);for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onLoad&&e.onLoad(i)}r.manager.itemEnd(t)}else{for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}}),!1),o.addEventListener("progress",(function(e){const i=au[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onProgress&&n.onProgress(e)}}),!1),o.addEventListener("error",(function(e){const i=au[t];delete au[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}),!1),o.addEventListener("abort",(function(e){const i=au[t];delete au[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(o.responseType=this.responseType),void 0!==this.withCredentials&&(o.withCredentials=this.withCredentials),o.overrideMimeType&&o.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)o.setRequestHeader(t,this.requestHeader[t]);o.send(null)}return r.manager.itemStart(t),o}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class lu extends su{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new ou(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e=[];for(let i=0;i<t.length;i++){const n=tu.parse(t[i]);e.push(n)}return e}}class cu extends su{constructor(t){super(t)}load(t,e,i,n){const r=this,s=[],a=new ac,o=new ou(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;function c(c){o.load(t[c],(function(t){const i=r.parse(t,!0);s[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(a.minFilter=yt),a.image=s,a.format=i.format,a.needsUpdate=!0,e&&e(a))}),i,n)}if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)c(e);else o.load(t,(function(t){const i=r.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)s[e].mipmaps.push(i.mipmaps[e*i.mipmapCount+t]),s[e].format=i.format,s[e].width=i.width,s[e].height=i.height}a.image=s}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=yt),a.format=i.format,a.needsUpdate=!0,e&&e(a)}),i,n);return a}}class hu extends su{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=iu.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function o(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),iu.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class uu extends su{constructor(t){super(t)}load(t,e,i,n){const r=new Ts,s=new hu(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(i){s.load(t[i],(function(t){r.images[i]=t,a++,6===a&&(r.needsUpdate=!0,e&&e(r))}),void 0,n)}for(let e=0;e<t.length;++e)o(e);return r}}class du extends su{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new Rl,a=new ou(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(t,(function(t){const i=r.parse(t);i&&(void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:dt,s.wrapT=void 0!==i.wrapT?i.wrapT:dt,s.magFilter=void 0!==i.magFilter?i.magFilter:yt,s.minFilter=void 0!==i.minFilter?i.minFilter:yt,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(s.encoding=i.encoding),void 0!==i.flipY&&(s.flipY=i.flipY),void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=wt),1===i.mipmapCount&&(s.minFilter=yt),void 0!==i.generateMipmaps&&(s.generateMipmaps=i.generateMipmaps),s.needsUpdate=!0,e&&e(s,i))}),i,n),s}}class pu extends su{constructor(t){super(t)}load(t,e,i,n){const r=new Qi,s=new hu(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(i){r.image=i;const n=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);r.format=n?Ft:Bt,r.needsUpdate=!0,void 0!==e&&e(r)}),i,n),r}}class fu extends yc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Dc(e,t))}getPoint(t){const e=t*this.getLength(),i=this.getCurveLengths();let n=0;for(;n<i.length;){if(i[n]>=e){const t=i[n]-e,r=this.curves[n],s=r.getLength(),a=0===s?0:1-t/s;return r.getPointAt(a)}n++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],a=s&&s.isEllipseCurve?2*t:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let t=0;t<o.length;t++){const n=o[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new Bc[i.type]).fromJSON(i))}return this}}class mu extends fu{constructor(t){super(),this.type="Path",this.currentPoint=new Ji,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new Dc(this.currentPoint.clone(),new Ji(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const r=new Oc(this.currentPoint.clone(),new Ji(t,e),new Ji(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,s){const a=new Nc(this.currentPoint.clone(),new Ji(t,e),new Ji(i,n),new Ji(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new Fc(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,i,n,r,s),this}absarc(t,e,i,n,r,s){return this.absellipse(t,e,i,i,n,r,s),this}ellipse(t,e,i,n,r,s,a,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,i,n,r,s,a,o),this}absellipse(t,e,i,n,r,s,a,o){const l=new bc(t,e,i,n,r,s,a,o);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class gu extends mu{constructor(t){super(t),this.uuid=ji(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new mu).fromJSON(i))}return this}}class _u extends cr{constructor(t,e=1){super(),this.type="Light",this.color=new Cr(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}_u.prototype.isLight=!0;class vu extends _u{constructor(t,e,i){super(t,i),this.type="HemisphereLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.groundColor=new Cr(e)}copy(t){return _u.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}vu.prototype.isHemisphereLight=!0;const yu=new Bn,bu=new on,xu=new on;class wu{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Ji(512,512),this.map=null,this.mapPass=null,this.matrix=new Bn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ks,this._frameExtents=new Ji(1,1),this._viewportCount=1,this._viewports=[new en(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;bu.setFromMatrixPosition(t.matrixWorld),e.position.copy(bu),xu.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(xu),e.updateMatrixWorld(),yu.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yu),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Su extends wu{constructor(){super(new Es(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,i=2*zi*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}Su.prototype.isSpotLightShadow=!0;class Mu extends _u{constructor(t,e,i=0,n=Math.PI/3,r=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.target=new cr,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.shadow=new Su}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Mu.prototype.isSpotLight=!0;const Au=new Bn,Eu=new on,Lu=new on;class Tu extends wu{constructor(){super(new Es(90,1,.5,500)),this._frameExtents=new Ji(4,2),this._viewportCount=6,this._viewports=[new en(2,1,1,1),new en(0,1,1,1),new en(3,1,1,1),new en(1,1,1,1),new en(3,0,1,1),new en(1,0,1,1)],this._cubeDirections=[new on(1,0,0),new on(-1,0,0),new on(0,0,1),new on(0,0,-1),new on(0,1,0),new on(0,-1,0)],this._cubeUps=[new on(0,1,0),new on(0,1,0),new on(0,1,0),new on(0,1,0),new on(0,0,1),new on(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Eu.setFromMatrixPosition(t.matrixWorld),i.position.copy(Eu),Lu.copy(i.position),Lu.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(Lu),i.updateMatrixWorld(),n.makeTranslation(-Eu.x,-Eu.y,-Eu.z),Au.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Au)}}Tu.prototype.isPointLightShadow=!0;class Cu extends _u{constructor(t,e,i=0,n=1){super(t,e),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Tu}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}Cu.prototype.isPointLight=!0;class Pu extends As{constructor(t=-1,e=1,i=1,n=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-t,s=i+t,a=n+e,o=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,a-=e*this.view.offsetY,o=a-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}Pu.prototype.isOrthographicCamera=!0;class Nu extends wu{constructor(){super(new Pu(-5,5,5,-5,.5,500))}}Nu.prototype.isDirectionalLightShadow=!0;class Ru extends _u{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.target=new cr,this.shadow=new Nu}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Ru.prototype.isDirectionalLight=!0;class Du extends _u{constructor(t,e){super(t,e),this.type="AmbientLight"}}Du.prototype.isAmbientLight=!0;class Iu extends _u{constructor(t,e,i=10,n=10){super(t,e),this.type="RectAreaLight",this.width=i,this.height=n}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}Iu.prototype.isRectAreaLight=!0;class Ou{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new on)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*n),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*i),e.addScaledVector(s[4],i*n*1.092548),e.addScaledVector(s[5],n*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],i*r*1.092548),e.addScaledVector(s[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*n),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*i),e.addScaledVector(s[4],.858086*i*n),e.addScaledVector(s[5],.858086*n*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*i*r),e.addScaledVector(s[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}Ou.prototype.isSphericalHarmonics3=!0;class ku extends _u{constructor(t=new Ou,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}ku.prototype.isLightProbe=!0;class Fu extends su{constructor(t){super(t),this.textures={}}load(t,e,i,n){const r=this,s=new ou(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e=this.textures;function i(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const n=new jh[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&void 0!==n.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=(new Cr).setHex(t.sheen)),void 0!==t.emissive&&void 0!==n.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==n.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.transmission&&(n.transmission=t.transmission),void 0!==t.thickness&&(n.thickness=t.thickness),void 0!==t.attenuationDistance&&(n.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(t.attenuationColor),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.shadowSide&&(n.shadowSide=t.shadowSide),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(n.morphNormals=t.morphNormals),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.alphaToCoverage&&(n.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(n.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.vertexTangents&&(n.vertexTangents=t.vertexTangents),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const r=t.uniforms[e];switch(n.uniforms[e]={},r.type){case"t":n.uniforms[e].value=i(r.value);break;case"c":n.uniforms[e].value=(new Cr).setHex(r.value);break;case"v2":n.uniforms[e].value=(new Ji).fromArray(r.value);break;case"v3":n.uniforms[e].value=(new on).fromArray(r.value);break;case"v4":n.uniforms[e].value=(new en).fromArray(r.value);break;case"m3":n.uniforms[e].value=(new Xi).fromArray(r.value);break;case"m4":n.uniforms[e].value=(new Bn).fromArray(r.value);break;default:n.uniforms[e].value=r.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)n.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=i(t.map)),void 0!==t.matcap&&(n.matcap=i(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=i(t.alphaMap)),void 0!==t.bumpMap&&(n.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=i(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),n.normalScale=(new Ji).fromArray(e)}return void 0!==t.displacementMap&&(n.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=i(t.specularMap)),void 0!==t.envMap&&(n.envMap=i(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=i(t.gradientMap)),void 0!==t.clearcoatMap&&(n.clearcoatMap=i(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=i(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Ji).fromArray(t.clearcoatNormalScale)),void 0!==t.transmissionMap&&(n.transmissionMap=i(t.transmissionMap)),void 0!==t.thicknessMap&&(n.thicknessMap=i(t.thicknessMap)),n}setTextures(t){return this.textures=t,this}}class Bu{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}}class zu extends ts{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}zu.prototype.isInstancedBufferGeometry=!0;class ju extends Dr{constructor(t,e,i,n=1){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}ju.prototype.isInstancedBufferAttribute=!0;class Uu extends su{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new ou(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e={},i={};function n(t,n){if(void 0!==e[n])return e[n];const r=t.interleavedBuffers[n],s=function(t,e){if(void 0!==i[e])return i[e];const n=t.arrayBuffers[e],r=new Uint32Array(n).buffer;return i[e]=r,r}(t,r.buffer),a=qr(r.type,s),o=new nl(a,r.stride);return o.uuid=r.uuid,e[n]=o,o}const r=t.isInstancedBufferGeometry?new zu:new ts,s=t.data.index;if(void 0!==s){const t=qr(s.type,s.array);r.setIndex(new Dr(t,1))}const a=t.data.attributes;for(const e in a){const i=a[e];let s;if(i.isInterleavedBufferAttribute){const e=n(t.data,i.data);s=new sl(e,i.itemSize,i.offset,i.normalized)}else{const t=qr(i.type,i.array);s=new(i.isInstancedBufferAttribute?ju:Dr)(t,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),void 0!==i.usage&&s.setUsage(i.usage),void 0!==i.updateRange&&(s.updateRange.offset=i.updateRange.offset,s.updateRange.count=i.updateRange.count),r.setAttribute(e,s)}const o=t.data.morphAttributes;if(o)for(const e in o){const i=o[e],s=[];for(let e=0,r=i.length;e<r;e++){const r=i[e];let a;if(r.isInterleavedBufferAttribute){const e=n(t.data,r.data);a=new sl(e,r.itemSize,r.offset,r.normalized)}else{const t=qr(r.type,r.array);a=new Dr(t,r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),s.push(a)}r.morphAttributes[e]=s}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];r.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new on;void 0!==c.center&&t.fromArray(c.center),r.boundingSphere=new Cn(t,c.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}class Vu extends su{constructor(t){super(t)}load(t,e,i,n){const r=this,s=""===this.path?Bu.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const a=new ou(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(i){let s=null;try{s=JSON.parse(i)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const a=s.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(s,e):console.error("THREE.ObjectLoader: Can't load "+t)}),i,n)}async loadAsync(t,e){const i=""===this.path?Bu.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;const n=new ou(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const r=await n.loadAsync(t,e),s=JSON.parse(r),a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(s)}parse(t,e){const i=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,n),s=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,r,o,a,i),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),void 0!==e){let t=!1;for(const e in s)if(s[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,i),r=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,r),a=this.parseMaterials(t.materials,s),o=this.parseObject(t.object,n,a,s,e),l=this.parseSkeletons(t.skeletons,o);return this.bindSkeletons(o,l),o}parseShapes(t){const e={};if(void 0!==t)for(let i=0,n=t.length;i<n;i++){const n=(new gu).fromJSON(t[i]);e[n.uuid]=n}return e}parseSkeletons(t,e){const i={},n={};if(e.traverse((function(t){t.isBone&&(n[t.uuid]=t)})),void 0!==t)for(let e=0,r=t.length;e<r;e++){const r=(new Ol).fromJSON(t[e],n);i[r.uuid]=r}return i}parseGeometries(t,e){const i={};if(void 0!==t){const n=new Uu;for(let r=0,s=t.length;r<s;r++){let s;const a=t[r];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":s=n.parse(a);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:a.type in Ch?s=Ch[a.type].fromJSON(a,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),i[a.uuid]=s}}return i}parseMaterials(t,e){const i={},n={};if(void 0!==t){const r=new Fu;r.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];if("MultiMaterial"===s.type){const t=[];for(let e=0;e<s.materials.length;e++){const n=s.materials[e];void 0===i[n.uuid]&&(i[n.uuid]=r.parse(n)),t.push(i[n.uuid])}n[s.uuid]=t}else void 0===i[s.uuid]&&(i[s.uuid]=r.parse(s)),n[s.uuid]=i[s.uuid]}}return n}parseAnimations(t){const e={};if(void 0!==t)for(let i=0;i<t.length;i++){const n=t[i],r=tu.parse(n);e[r.uuid]=r}return e}parseImages(t,e){const i=this,n={};let r;function s(t){if("string"==typeof t){const e=t;return function(t){return i.manager.itemStart(t),r.load(t,(function(){i.manager.itemEnd(t)}),void 0,(function(){i.manager.itemError(t),i.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e)}return t.data?{data:qr(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const i=new nu(e);r=new hu(i),r.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.url;if(Array.isArray(r)){n[i.uuid]=[];for(let t=0,e=r.length;t<e;t++){const e=s(r[t]);null!==e&&(e instanceof HTMLImageElement?n[i.uuid].push(e):n[i.uuid].push(new Rl(e.data,e.width,e.height)))}}else{const t=s(i.url);null!==t&&(n[i.uuid]=t)}}}return n}async parseImagesAsync(t){const e=this,i={};let n;async function r(t){if("string"==typeof t){const i=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:e.resourcePath+i;return await n.loadAsync(r)}return t.data?{data:qr(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){n=new hu(this.manager),n.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.url;if(Array.isArray(s)){i[n.uuid]=[];for(let t=0,e=s.length;t<e;t++){const e=s[t],a=await r(e);null!==a&&(a instanceof HTMLImageElement?i[n.uuid].push(a):i[n.uuid].push(new Rl(a.data,a.width,a.height)))}}else{const t=await r(n.url);null!==t&&(i[n.uuid]=t)}}}return i}parseTextures(t,e){function i(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const n={};if(void 0!==t)for(let r=0,s=t.length;r<s;r++){const s=t[r];let a;void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const o=e[s.image];Array.isArray(o)?(a=new Ts(o),6===o.length&&(a.needsUpdate=!0)):(a=o&&o.data?new Rl(o.data,o.width,o.height):new Qi(o),o&&(a.needsUpdate=!0)),a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=i(s.mapping,Hu)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=i(s.wrap[0],Gu),a.wrapT=i(s.wrap[1],Gu)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=i(s.minFilter,Wu)),void 0!==s.magFilter&&(a.magFilter=i(s.magFilter,Wu)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),n[s.uuid]=a}return n}parseObject(t,e,i,n,r){let s,a,o;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];void 0===i[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(i[r])}return e}return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}}function h(t){return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),n[t]}switch(t.type){case"Scene":s=new il,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new Cr(t.background):s.background=h(t.background)),void 0!==t.environment&&(s.environment=h(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new el(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new tl(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":s=new Es(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new Pu(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new Du(t.color,t.intensity);break;case"DirectionalLight":s=new Ru(t.color,t.intensity);break;case"PointLight":s=new Cu(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new Iu(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new Mu(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new vu(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new ku).fromJSON(t);break;case"SkinnedMesh":a=l(t.geometry),o=c(t.material),s=new Pl(a,o),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":a=l(t.geometry),o=c(t.material),s=new vs(a,o);break;case"InstancedMesh":a=l(t.geometry),o=c(t.material);const e=t.count,i=t.instanceMatrix,n=t.instanceColor;s=new jl(a,o,e),s.instanceMatrix=new Dr(new Float32Array(i.array),16),void 0!==n&&(s.instanceColor=new Dr(new Float32Array(n.array),n.itemSize));break;case"LOD":s=new Ml;break;case"Line":s=new Yl(l(t.geometry),c(t.material));break;case"LineLoop":s=new Zl(l(t.geometry),c(t.material));break;case"LineSegments":s=new Kl(l(t.geometry),c(t.material));break;case"PointCloud":case"Points":s=new nc(l(t.geometry),c(t.material));break;case"Sprite":s=new bl(c(t.material));break;case"Group":s=new Yo;break;case"Bone":s=new Nl;break;default:s=new cr}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const a=t.children;for(let t=0;t<a.length;t++)s.add(this.parseObject(a[t],e,i,n,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const i=e[t];s.animations.push(r[i])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const i=e[t],n=s.getObjectByProperty("uuid",i.object);void 0!==n&&s.addLevel(n,i.distance)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const i=e[t.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(i,t.bindMatrix)}}))}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}const Hu={UVMapping:rt,CubeReflectionMapping:st,CubeRefractionMapping:at,EquirectangularReflectionMapping:ot,EquirectangularRefractionMapping:lt,CubeUVReflectionMapping:ct,CubeUVRefractionMapping:ht},Gu={RepeatWrapping:ut,ClampToEdgeWrapping:dt,MirroredRepeatWrapping:pt},Wu={NearestFilter:ft,NearestMipmapNearestFilter:mt,NearestMipmapLinearFilter:_t,LinearFilter:yt,LinearMipmapNearestFilter:bt,LinearMipmapLinearFilter:wt};class qu extends su{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=iu.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){iu.add(t,i),e&&e(i),r.manager.itemEnd(t)})).catch((function(e){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}qu.prototype.isImageBitmapLoader=!0;class Yu{constructor(){this.type="ShapePath",this.color=new Cr,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new mu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.currentPath.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,r,s){return this.currentPath.bezierCurveTo(t,e,i,n,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function i(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i],r=new gu;r.curves=n.curves,e.push(r)}return e}function n(t,e){const i=e.length;let n=!1;for(let r=i-1,s=0;s<i;r=s++){let i=e[r],a=e[s],o=a.x-i.x,l=a.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=e[s],o=-o,a=e[r],l=-l),t.y<i.y||t.y>a.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=l*(t.x-i.x)-o*(t.y-i.y);if(0===e)return!0;if(e<0)continue;n=!n}}else{if(t.y!==i.y)continue;if(a.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=a.x)return!0}}return n}const r=hh.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===e)return i(s);let a,o,l;const c=[];if(1===s.length)return o=s[0],l=new gu,l.curves=o.curves,c.push(l),c;let h=!r(s[0].getPoints());h=t?!h:h;const u=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let e=0,i=s.length;e<i;e++)o=s[e],p=o.getPoints(),a=r(p),a=t?!a:a,a?(!h&&d[g]&&g++,d[g]={s:new gu,p:p},d[g].s.curves=o.curves,h&&g++,m[g]=[]):m[g].push({h:o,p:p[0]});if(!d[0])return i(s);if(d.length>1){let t=!1;const e=[];for(let t=0,e=d.length;t<e;t++)u[t]=[];for(let i=0,r=d.length;i<r;i++){const r=m[i];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<d.length;r++)n(a.p,d[r].p)&&(i!==r&&e.push({froms:i,tos:r,hole:s}),o?(o=!1,u[r].push(a)):t=!0);o&&u[i].push(a)}}e.length>0&&(t||(m=u))}for(let t=0,e=d.length;t<e;t++){l=d[t].s,c.push(l),f=m[t];for(let t=0,e=f.length;t<e;t++)l.holes.push(f[t].h)}return c}}class Ju{constructor(t){this.type="Font",this.data=t}generateShapes(t,e=100){const i=[],n=function(t,e,i){const n=Array.from(t),r=e/i.resolution,s=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*r,a=[];let o=0,l=0;for(let t=0;t<n.length;t++){const e=n[t];if("\n"===e)o=0,l-=s;else{const t=Xu(e,r,o,l,i);o+=t.offsetX,a.push(t.path)}}return a}(t,e,this.data);for(let t=0,e=n.length;t<e;t++)Array.prototype.push.apply(i,n[t].toShapes());return i}}function Xu(t,e,i,n,r){const s=r.glyphs[t]||r.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+r.familyName+".");const a=new Yu;let o,l,c,h,u,d,p,f;if(s.o){const t=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let r=0,s=t.length;r<s;){switch(t[r++]){case"m":o=t[r++]*e+i,l=t[r++]*e+n,a.moveTo(o,l);break;case"l":o=t[r++]*e+i,l=t[r++]*e+n,a.lineTo(o,l);break;case"q":c=t[r++]*e+i,h=t[r++]*e+n,u=t[r++]*e+i,d=t[r++]*e+n,a.quadraticCurveTo(u,d,c,h);break;case"b":c=t[r++]*e+i,h=t[r++]*e+n,u=t[r++]*e+i,d=t[r++]*e+n,p=t[r++]*e+i,f=t[r++]*e+n,a.bezierCurveTo(u,d,p,f,c,h)}}}return{offsetX:s.ha*e,path:a}}Ju.prototype.isFont=!0;class Ku extends su{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new ou(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(t){let i;try{i=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(t.substring(65,t.length-2))}const n=r.parse(i);e&&e(n)}),i,n)}parse(t){return new Ju(t)}}let Zu;const $u={getContext:function(){return void 0===Zu&&(Zu=new(window.AudioContext||window.webkitAudioContext)),Zu},setContext:function(t){Zu=t}};class Qu extends su{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new ou(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{const t=i.slice(0);$u.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}}class td extends ku{constructor(t,e,i=1){super(void 0,i);const n=(new Cr).set(t),r=(new Cr).set(e),s=new on(n.r,n.g,n.b),a=new on(r.r,r.g,r.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(l)}}td.prototype.isHemisphereLightProbe=!0;class ed extends ku{constructor(t,e=1){super(void 0,e);const i=(new Cr).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}ed.prototype.isAmbientLightProbe=!0;const id=new Bn,nd=new Bn;class rd{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Es,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Es,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const i=t.projectionMatrix.clone(),n=e.eyeSep/2,r=n*e.near/e.focus,s=e.near*Math.tan(Bi*e.fov*.5)/e.zoom;let a,o;nd.elements[12]=-n,id.elements[12]=n,a=-s*e.aspect+r,o=s*e.aspect+r,i.elements[0]=2*e.near/(o-a),i.elements[8]=(o+a)/(o-a),this.cameraL.projectionMatrix.copy(i),a=-s*e.aspect-r,o=s*e.aspect-r,i.elements[0]=2*e.near/(o-a),i.elements[8]=(o+a)/(o-a),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(nd),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(id)}}class sd{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=ad(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=ad();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function ad(){return("undefined"==typeof performance?Date:performance).now()}const od=new on,ld=new an,cd=new on,hd=new on;class ud extends cr{constructor(){super(),this.type="AudioListener",this.context=$u.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new sd}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(od,ld,cd),hd.set(0,0,-1).applyQuaternion(ld),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(od.x,t),e.positionY.linearRampToValueAtTime(od.y,t),e.positionZ.linearRampToValueAtTime(od.z,t),e.forwardX.linearRampToValueAtTime(hd.x,t),e.forwardY.linearRampToValueAtTime(hd.y,t),e.forwardZ.linearRampToValueAtTime(hd.z,t),e.upX.linearRampToValueAtTime(i.x,t),e.upY.linearRampToValueAtTime(i.y,t),e.upZ.linearRampToValueAtTime(i.z,t)}else e.setPosition(od.x,od.y,od.z),e.setOrientation(hd.x,hd.y,hd.z,i.x,i.y,i.z)}}class dd extends cr{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const pd=new on,fd=new an,md=new on,gd=new on;class _d extends dd{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(pd,fd,md),gd.set(0,0,1).applyQuaternion(fd);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(pd.x,t),e.positionY.linearRampToValueAtTime(pd.y,t),e.positionZ.linearRampToValueAtTime(pd.z,t),e.orientationX.linearRampToValueAtTime(gd.x,t),e.orientationY.linearRampToValueAtTime(gd.y,t),e.orientationZ.linearRampToValueAtTime(gd.z,t)}else e.setPosition(pd.x,pd.y,pd.z),e.setOrientation(gd.x,gd.y,gd.z)}}class vd{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}}class yd{constructor(t,e,i){let n,r,s;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,r=t*n+n;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==n;++t)i[r+t]=i[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(i,r,0,t,n)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(i[t]!==i[t+e]){a.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,r=n;t!==r;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){an.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,r){const s=this._workIndex*r;an.multiplyQuaternionsFlat(t,s,t,e,t,i),an.slerpFlat(t,e,t,e,t,s,n)}_lerp(t,e,i,n,r){const s=1-n;for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]*s+t[i+a]*n}}_lerpAdditive(t,e,i,n,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[i+s]*n}}}const bd=new RegExp("[\\[\\]\\.:\\/]","g"),xd="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",wd=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Sd=/(WCOD+)?/.source.replace("WCOD",xd),Md=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Ad=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Ed=new RegExp("^"+wd+Sd+Md+Ad+"$"),Ld=["material","materials","bones"];class Td{constructor(t,e,i){this.path=e,this.parsedPath=i||Td.parseTrackName(e),this.node=Td.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new Td.Composite(t,e,i):new Td(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(bd,"")}static parseTrackName(t){const e=Ed.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==Ld.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e||r.uuid===e)return r;const s=i(r.children);if(s)return s}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.node[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let r=e.propertyIndex;if(t||(t=Td.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const s=t[n];if(void 0===s){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Td.Composite=class{constructor(t,e,i){const n=i||Td.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},Td.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Td.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Td.prototype.GetterByBindingType=[Td.prototype._getValue_direct,Td.prototype._getValue_array,Td.prototype._getValue_arrayElement,Td.prototype._getValue_toArray],Td.prototype.SetterByBindingTypeAndVersioning=[[Td.prototype._setValue_direct,Td.prototype._setValue_direct_setNeedsUpdate,Td.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Td.prototype._setValue_array,Td.prototype._setValue_array_setNeedsUpdate,Td.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Td.prototype._setValue_arrayElement,Td.prototype._setValue_arrayElement_setNeedsUpdate,Td.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Td.prototype._setValue_fromArray,Td.prototype._setValue_fromArray_setNeedsUpdate,Td.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Cd{constructor(){this.uuid=ji(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,s=r.length;let a=void 0,o=t.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],u=h.uuid;let d=e[u];if(void 0===d){d=o++,e[u]=d,t.push(h);for(let t=0,e=s;t!==e;++t)r[t].push(new Td(h,i[t],n[t]))}else if(d<l){a=t[d];const o=--l,c=t[o];e[c.uuid]=d,t[d]=c,e[u]=o,t[o]=h;for(let t=0,e=s;t!==e;++t){const e=r[t],s=e[o];let a=e[d];e[d]=s,void 0===a&&(a=new Td(h,i[t],n[t])),e[o]=a}}else t[d]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=e[o];if(void 0!==l&&l>=r){const s=r++,c=t[s];e[c.uuid]=l,t[l]=c,e[o]=s,t[s]=a;for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[s],r=e[l];e[l]=n,e[s]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,s=t.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=e[o];if(void 0!==l)if(delete e[o],l<r){const a=--r,o=t[a],c=--s,h=t[c];e[o.uuid]=l,t[l]=o,e[h.uuid]=a,t[a]=h,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[a],r=e[c];e[l]=n,e[a]=r,e.pop()}}else{const r=--s,a=t[r];r>0&&(e[a.uuid]=l),t[l]=a,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const i=this._bindingsIndicesByPath;let n=i[t];const r=this._bindings;if(void 0!==n)return r[n];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=new Array(l);n=r.length,i[t]=n,s.push(t),a.push(e),r.push(h);for(let i=c,n=o.length;i!==n;++i){const n=o[i];h[i]=new Td(n,t,e)}return h}unsubscribe_(t){const e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){const n=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];e[t[a]]=i,s[i]=o,s.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}}Cd.prototype.isAnimationObjectGroup=!0;class Pd{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const r=e.tracks,s=r.length,a=new Array(s),o={endingStart:Ve,endingEnd:Ve};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);a[t]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Fe,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,r=n/i,s=i/n;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,r=n.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+i,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const n=(t-r)*i;if(n<0||0===i)return;this._startTime=null,e=i*n}e*=this._updateTimeScale(t);const s=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case qe:for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(s),e[i].accumulateAdditive(a);break;case We:default:for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(s),e[i].accumulate(n,a)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,r=this._loopCount;const s=i===Be;if(0===t)return-1===r?n:s&&1==(1&r)?e-n:n;if(i===ke){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,r+=Math.abs(i);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&1==(1&r))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=He,n.endingEnd=He):(n.endingStart=t?this.zeroSlopeAtStart?He:Ve:Ge,n.endingEnd=e?this.zeroSlopeAtEnd?He:Ve:Ge)}_scheduleFading(t,e,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=e,a[1]=r+t,o[1]=i,this}}class Nd extends Oi{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,s=t._propertyBindings,a=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let t=0;t!==r;++t){const r=n[t],l=r.name;let h=c[l];if(void 0!==h)s[t]=h;else{if(h=s[t],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,o,l));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;h=new yd(Td.create(i,l,n),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,o,l),s[t]=h}a[t].resultBuffer=h.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),t._byClipCacheIndex=null;delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[e];void 0===s&&(s={},n[e]=s),s[i]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,a=s[n],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[r],0===Object.keys(a).length&&delete s[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new Gh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r}clipAction(t,e,i){const n=e||this._root,r=n.uuid;let s="string"==typeof t?tu.findByName(n,t):t;const a=null!==s?s.uuid:t,o=this._actionsByClip[a];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:We),void 0!==o){const t=o.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new Pd(this,s,e,i);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c}existingAction(t,e){const i=e||this._root,n=i.uuid,r="string"==typeof t?tu.findByName(i,t):t,s=r?r.uuid:t,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let a=0;a!==i;++a){e[a]._update(n,t,r,s)}const a=this._bindings,o=this._nActiveBindings;for(let t=0;t!==o;++t)a[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const t=r.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const r=n._cacheIndex,s=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}Nd.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Rd{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new Rd(void 0===this.value.clone?this.value:this.value.clone())}}class Dd extends nl{constructor(t,e,i=1){super(t,e),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}Dd.prototype.isInstancedInterleavedBuffer=!0;class Id{constructor(t,e,i,n,r){this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}Id.prototype.isGLBufferAttribute=!0;class Od{constructor(t,e,i=0,n=1/0){this.ray=new Fn(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new Xn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!1,i=[]){return Fd(t,this,i,e),i.sort(kd),i}intersectObjects(t,e=!1,i=[]){for(let n=0,r=t.length;n<r;n++)Fd(t[n],this,i,e);return i.sort(kd),i}}function kd(t,e){return t.distance-e.distance}function Fd(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,r=n.length;t<r;t++)Fd(n[t],e,i,!0)}}class Bd{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(Ui(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class zd{constructor(t=1,e=0,i=0){return this.radius=t,this.theta=e,this.y=i,this}set(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}clone(){return(new this.constructor).copy(this)}}const jd=new Ji;class Ud{constructor(t=new Ji(1/0,1/0),e=new Ji(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=jd.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return jd.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Ud.prototype.isBox2=!0;const Vd=new on,Hd=new on;class Gd{constructor(t=new on,e=new on){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Vd.subVectors(t,this.start),Hd.subVectors(this.end,this.start);const i=Hd.dot(Hd);let n=Hd.dot(Vd)/i;return e&&(n=Ui(n,0,1)),n}closestPointToPoint(t,e,i){const n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class Wd extends cr{constructor(t){super(),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}Wd.prototype.isImmediateRenderObject=!0;const qd=new on;class Yd extends cr{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const i=new ts,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<i;t++,e++){const r=t/i*Math.PI*2,s=e/i*Math.PI*2;n.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new Vr(n,3));const r=new Ul({fog:!1,toneMapped:!1});this.cone=new Kl(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),qd.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(qd),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Jd=new on,Xd=new Bn,Kd=new Bn;class Zd extends Kl{constructor(t){const e=function t(e){const i=[];e&&e.isBone&&i.push(e);for(let n=0;n<e.children.length;n++)i.push.apply(i,t(e.children[n]));return i}(t),i=new ts,n=[],r=[],s=new Cr(0,0,1),a=new Cr(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new Vr(n,3)),i.setAttribute("color",new Vr(r,3));super(i,new Ul({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");Kd.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(Xd.multiplyMatrices(Kd,r.matrixWorld),Jd.setFromMatrixPosition(Xd),n.setXYZ(i,Jd.x,Jd.y,Jd.z),Xd.multiplyMatrices(Kd,r.parent.matrixWorld),Jd.setFromMatrixPosition(Xd),n.setXYZ(i+1,Jd.x,Jd.y,Jd.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}class $d extends vs{constructor(t,e,i){super(new xh(e,4,2),new Pr({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Qd=new on,tp=new Cr,ep=new Cr;class ip extends cr{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const n=new _h(e);n.rotateY(.5*Math.PI),this.material=new Pr({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=n.getAttribute("position"),s=new Float32Array(3*r.count);n.setAttribute("color",new Dr(s,3)),this.add(new vs(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");tp.copy(this.light.color),ep.copy(this.light.groundColor);for(let t=0,i=e.count;t<i;t++){const n=t<i/2?tp:ep;e.setXYZ(t,n.r,n.g,n.b)}e.needsUpdate=!0}t.lookAt(Qd.setFromMatrixPosition(this.light.matrixWorld).negate())}}class np extends Kl{constructor(t=10,e=10,i=4473924,n=8947848){i=new Cr(i),n=new Cr(n);const r=e/2,s=t/e,a=t/2,o=[],l=[];for(let t=0,c=0,h=-a;t<=e;t++,h+=s){o.push(-a,0,h,a,0,h),o.push(h,0,-a,h,0,a);const e=t===r?i:n;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new ts;c.setAttribute("position",new Vr(o,3)),c.setAttribute("color",new Vr(l,3));super(c,new Ul({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class rp extends Kl{constructor(t=10,e=16,i=8,n=64,r=4473924,s=8947848){r=new Cr(r),s=new Cr(s);const a=[],o=[];for(let i=0;i<=e;i++){const n=i/e*(2*Math.PI),l=Math.sin(n)*t,c=Math.cos(n)*t;a.push(0,0,0),a.push(l,0,c);const h=1&i?r:s;o.push(h.r,h.g,h.b),o.push(h.r,h.g,h.b)}for(let e=0;e<=i;e++){const l=1&e?r:s,c=t-t/i*e;for(let t=0;t<n;t++){let e=t/n*(2*Math.PI),i=Math.sin(e)*c,r=Math.cos(e)*c;a.push(i,0,r),o.push(l.r,l.g,l.b),e=(t+1)/n*(2*Math.PI),i=Math.sin(e)*c,r=Math.cos(e)*c,a.push(i,0,r),o.push(l.r,l.g,l.b)}}const l=new ts;l.setAttribute("position",new Vr(a,3)),l.setAttribute("color",new Vr(o,3));super(l,new Ul({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const sp=new on,ap=new on,op=new on;class lp extends cr{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===e&&(e=1);let n=new ts;n.setAttribute("position",new Vr([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Ul({fog:!1,toneMapped:!1});this.lightPlane=new Yl(n,r),this.add(this.lightPlane),n=new ts,n.setAttribute("position",new Vr([0,0,0,0,0,1],3)),this.targetLine=new Yl(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){sp.setFromMatrixPosition(this.light.matrixWorld),ap.setFromMatrixPosition(this.light.target.matrixWorld),op.subVectors(ap,sp),this.lightPlane.lookAt(ap),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ap),this.targetLine.scale.z=op.length()}}const cp=new on,hp=new As;class up extends Kl{constructor(t){const e=new ts,i=new Ul({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={},a=new Cr(16755200),o=new Cr(16711680),l=new Cr(43775),c=new Cr(16777215),h=new Cr(3355443);function u(t,e,i){d(t,i),d(e,i)}function d(t,e){n.push(0,0,0),r.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(n.length/3-1)}u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",c),u("p","c",h),u("cn1","cn2",h),u("cn3","cn4",h),u("cf1","cf2",h),u("cf3","cf4",h),e.setAttribute("position",new Vr(n,3)),e.setAttribute("color",new Vr(r,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){const t=this.geometry,e=this.pointMap;hp.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),dp("c",e,t,hp,0,0,-1),dp("t",e,t,hp,0,0,1),dp("n1",e,t,hp,-1,-1,-1),dp("n2",e,t,hp,1,-1,-1),dp("n3",e,t,hp,-1,1,-1),dp("n4",e,t,hp,1,1,-1),dp("f1",e,t,hp,-1,-1,1),dp("f2",e,t,hp,1,-1,1),dp("f3",e,t,hp,-1,1,1),dp("f4",e,t,hp,1,1,1),dp("u1",e,t,hp,.7,1.1,-1),dp("u2",e,t,hp,-.7,1.1,-1),dp("u3",e,t,hp,0,2,-1),dp("cf1",e,t,hp,-1,0,1),dp("cf2",e,t,hp,1,0,1),dp("cf3",e,t,hp,0,-1,1),dp("cf4",e,t,hp,0,1,1),dp("cn1",e,t,hp,-1,0,-1),dp("cn2",e,t,hp,1,0,-1),dp("cn3",e,t,hp,0,-1,-1),dp("cn4",e,t,hp,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function dp(t,e,i,n,r,s,a){cp.set(r,s,a).unproject(n);const o=e[t];if(void 0!==o){const t=i.getAttribute("position");for(let e=0,i=o.length;e<i;e++)t.setXYZ(o[e],cp.x,cp.y,cp.z)}}const pp=new hn;class fp extends Kl{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new ts;r.setIndex(new Dr(i,1)),r.setAttribute("position",new Dr(n,3)),super(r,new Ul({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&pp.setFromObject(this.object),pp.isEmpty())return;const e=pp.min,i=pp.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return Kl.prototype.copy.call(this,t),this.object=t.object,this}}class mp extends Kl{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new ts;n.setIndex(new Dr(i,1)),n.setAttribute("position",new Vr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new Ul({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}}class gp extends Yl{constructor(t,e=1,i=16776960){const n=i,r=new ts;r.setAttribute("position",new Vr([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new Ul({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new ts;s.setAttribute("position",new Vr([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new vs(s,new Pr({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?m:f,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}}const _p=new on;let vp,yp;class bp extends cr{constructor(t=new on(0,0,1),e=new on(0,0,0),i=1,n=16776960,r=.2*i,s=.2*r){super(),this.type="ArrowHelper",void 0===vp&&(vp=new ts,vp.setAttribute("position",new Vr([0,0,0,0,1,0],3)),yp=new hc(0,.5,1,5,1),yp.translate(0,-.5,0)),this.position.copy(e),this.line=new Yl(vp,new Ul({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new vs(yp,new Pr({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{_p.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(_p,e)}}setLength(t,e=.2*t,i=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}}class xp extends Kl{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new ts;i.setAttribute("position",new Vr(e,3)),i.setAttribute("color",new Vr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new Ul({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){const n=new Cr,r=this.geometry.attributes.color.array;return n.set(t),n.toArray(r,0),n.toArray(r,3),n.set(e),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const wp=new Float32Array(1),Sp=new Int32Array(wp.buffer);class Mp{static toHalfFloat(t){wp[0]=t;const e=Sp[0];let i=e>>16&32768,n=e>>12&2047;const r=e>>23&255;return r<103?i:r>142?(i|=31744,i|=(255==r?0:1)&&8388607&e,i):r<113?(n|=2048,i|=(n>>114-r)+(n>>113-r&1),i):(i|=r-112<<10|n>>1,i+=1&n,i)}}const Ap=Math.pow(2,8),Ep=[.125,.215,.35,.446,.526,.582],Lp=5+Ep.length,Tp={[Ke]:0,[Ze]:1,[Qe]:2,[ei]:3,[ii]:4,[ni]:5,[$e]:6},Cp=new Pr({side:m,depthWrite:!1,depthTest:!1}),Pp=new vs(new bs,Cp),Np=new Pu,{_lodPlanes:Rp,_sizeLods:Dp,_sigmas:Ip}=Hp(),Op=new Cr;let kp=null;const Fp=(1+Math.sqrt(5))/2,Bp=1/Fp,zp=[new on(1,1,1),new on(-1,1,1),new on(1,1,-1),new on(-1,1,-1),new on(0,Fp,Bp),new on(0,Fp,-Bp),new on(Bp,0,Fp),new on(-Bp,0,Fp),new on(Fp,Bp,0),new on(-Fp,Bp,0)];function jp(t){const e=Math.max(t.r,t.g,t.b),i=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);t.multiplyScalar(Math.pow(2,-i));return(i+128)/255}class Up{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(t),i=new on(0,1,0);return new Nh({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:Tp[Ke]},outputEncoding:{value:Tp[Ke]}},vertexShader:Jp(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${Xp()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:y,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){kp=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(t,i,n,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Yp(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=qp(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<Rp.length;t++)Rp[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(kp),t.scissorTest=!1,Wp(t,0,0,t.width,t.height)}_fromTexture(t){kp=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:ft,minFilter:ft,generateMipmaps:!1,type:Mt,format:Ut,encoding:Vp(t)?t.encoding:Qe,depthBuffer:!1},i=Gp(e);return i.depthBuffer=!t,this._pingPongRenderTarget=Gp(e),i}_compileMaterial(t){const e=new vs(Rp[0],t);this._renderer.compile(e,Np)}_sceneToCubeUV(t,e,i,n){const r=new Es(90,1,e,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.outputEncoding,h=o.toneMapping;o.getClearColor(Op),o.toneMapping=$,o.outputEncoding=Ke,o.autoClear=!1;let u=!1;const d=t.background;if(d){if(d.isColor){Cp.color.copy(d).convertSRGBToLinear(),t.background=null;const e=jp(Cp.color);Cp.opacity=e,u=!0}}else{Cp.color.copy(Op).convertSRGBToLinear();const t=jp(Cp.color);Cp.opacity=t,u=!0}for(let e=0;e<6;e++){const i=e%3;0==i?(r.up.set(0,s[e],0),r.lookAt(a[e],0,0)):1==i?(r.up.set(0,0,s[e]),r.lookAt(0,a[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,a[e])),Wp(n,i*Ap,e>2?Ap:0,Ap,Ap),o.setRenderTarget(n),u&&o.render(Pp,r),o.render(t,r)}o.toneMapping=h,o.outputEncoding=c,o.autoClear=l}_textureToCubeUV(t,e){const i=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Yp()):null==this._equirectShader&&(this._equirectShader=qp());const n=t.isCubeTexture?this._cubemapShader:this._equirectShader,r=new vs(Rp[0],n),s=n.uniforms;s.envMap.value=t,t.isCubeTexture||s.texelSize.value.set(1/t.image.width,1/t.image.height),s.inputEncoding.value=Tp[t.encoding],s.outputEncoding.value=Tp[e.texture.encoding],Wp(e,0,0,3*Ap,2*Ap),i.setRenderTarget(e),i.render(r,Np)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<Lp;e++){const i=Math.sqrt(Ip[e]*Ip[e]-Ip[e-1]*Ip[e-1]),n=zp[(e-1)%zp.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,n,"latitudinal",r),this._halfBlur(s,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new vs(Rp[n],l),h=l.uniforms,u=Dp[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<20;++t){const e=t/p,i=Math.exp(-e*e/2);m.push(i),0==t?g+=i:t<f&&(g+=2*i)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;h.envMap.value=t.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,a&&(h.poleAxis.value=a),h.dTheta.value=d,h.mipInt.value=8-i,h.inputEncoding.value=Tp[t.texture.encoding],h.outputEncoding.value=Tp[t.texture.encoding];const _=Dp[n];Wp(e,3*Math.max(0,Ap-2*_),(0===n?0:2*Ap)+2*_*(n>4?n-8+4:0),3*_,2*_),o.setRenderTarget(e),o.render(c,Np)}}function Vp(t){return void 0!==t&&t.type===Mt&&(t.encoding===Ke||t.encoding===Ze||t.encoding===$e)}function Hp(){const t=[],e=[],i=[];let n=8;for(let r=0;r<Lp;r++){const s=Math.pow(2,n);e.push(s);let a=1/s;r>4?a=Ep[r-8+4-1]:0==r&&(a=0),i.push(a);const o=1/(s-1),l=-o/2,c=1+o/2,h=[l,l,c,l,c,c,l,l,c,c,l,c],u=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*u),_=new Float32Array(f*d*u),v=new Float32Array(m*d*u);for(let t=0;t<u;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];g.set(n,p*d*t),_.set(h,f*d*t);const r=[t,t,t,t,t,t];v.set(r,m*d*t)}const y=new ts;y.setAttribute("position",new Dr(g,p)),y.setAttribute("uv",new Dr(_,f)),y.setAttribute("faceIndex",new Dr(v,m)),t.push(y),n>4&&n--}return{_lodPlanes:t,_sizeLods:e,_sigmas:i}}function Gp(t){const e=new nn(3*Ap,3*Ap,t);return e.texture.mapping=ct,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Wp(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function qp(){const t=new Ji(1,1);return new Nh({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:Tp[Ke]},outputEncoding:{value:Tp[Ke]}},vertexShader:Jp(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${Xp()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:y,depthTest:!1,depthWrite:!1})}function Yp(){return new Nh({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Tp[Ke]},outputEncoding:{value:Tp[Ke]}},vertexShader:Jp(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${Xp()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:y,depthTest:!1,depthWrite:!1})}function Jp(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Xp(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}const Kp=0,Zp=1,$p=0,Qp=1,tf=2;function ef(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function nf(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function rf(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new nc(t,e)}function sf(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new bl(t)}function af(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new nc(t,e)}function of(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new $l(t)}function lf(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new $l(t)}function cf(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new $l(t)}function hf(t,e,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new on(t,e,i)}function uf(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Dr(t,e).setUsage(Ai)}function df(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Ir(t,e)}function pf(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Or(t,e)}function ff(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new kr(t,e)}function mf(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Fr(t,e)}function gf(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Br(t,e)}function _f(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new zr(t,e)}function vf(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new jr(t,e)}function yf(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Vr(t,e)}function bf(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Hr(t,e)}function xf(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new xp(t)}function wf(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new fp(t,e)}function Sf(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Kl(new vc(t.geometry),new Ul({color:void 0!==e?e:16777215}))}function Mf(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Kl(new Lh(t.geometry),new Ul({color:void 0!==e?e:16777215}))}function Af(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new ou(t)}function Ef(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new du(t)}function Lf(t,e,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Cs(t,i)}function Tf(){console.error("THREE.CanvasRenderer has been removed")}function Cf(){console.error("THREE.JSONLoader has been removed.")}yc.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(yc.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},mu.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},np.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Zd.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},su.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Bu.extractUrlBase(t)},su.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Ud.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},Ud.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ud.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Ud.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},hn.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},hn.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},hn.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},hn.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},hn.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},Cn.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},ks.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Gd.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Xi.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Xi.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Xi.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Xi.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Xi.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Xi.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Bn.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},Bn.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Bn.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new on).setFromMatrixColumn(this,3)},Bn.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},Bn.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Bn.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Bn.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Bn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Bn.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},Bn.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Bn.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Bn.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Bn.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Bn.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Bn.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Bn.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Bn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Bn.prototype.makeFrustum=function(t,e,i,n,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,i,r,s)},Bn.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Ds.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},an.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},an.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Fn.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Fn.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},Fn.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},br.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},br.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},br.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},br.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},br.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},br.barycoordFromPoint=function(t,e,i,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),br.getBarycoord(t,e,i,n,r)},br.normal=function(t,e,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),br.getNormal(t,e,i,n)},gu.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},gu.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ph(this,t)},gu.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new bh(this,t)},Ji.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},Ji.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Ji.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},on.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},on.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},on.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},on.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},on.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},on.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},on.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},on.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},on.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},en.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},en.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},cr.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},cr.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},cr.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},cr.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},cr.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(cr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),vs.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(vs.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Ye},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Pl.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Es.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(_u.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Dr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Ai},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Ai)}}}),Dr.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Ai:Mi),this},Dr.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Dr.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ts.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},ts.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Dr(arguments[1],arguments[2])))},ts.prototype.addDrawCall=function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},ts.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},ts.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},ts.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},ts.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(ts.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),nl.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Ai:Mi),this},nl.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ph.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},ph.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},ph.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},il.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Rd.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(wr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Cr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===_}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(Ms.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),$o.prototype.clearTarget=function(t,e,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,i,n)},$o.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},$o.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},$o.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},$o.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},$o.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},$o.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},$o.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},$o.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},$o.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},$o.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},$o.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},$o.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},$o.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},$o.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},$o.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},$o.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},$o.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},$o.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},$o.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},$o.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},$o.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},$o.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},$o.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},$o.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties($o.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?Ze:Ke}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Vo.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(nn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),dd.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new Qu).load(t,(function(t){e.setBuffer(t)})),this},vd.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Ls.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},Ls.prototype.clear=function(t,e,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,i,n)},Zi.crossOrigin=void 0,Zi.loadTexture=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new pu;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s},Zi.loadTextureCube=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new uu;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s},Zi.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Zi.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Pf={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function Nf(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:n}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=n)},5278:(t,e,i)=>{"use strict";i.d(e,{$:()=>n});const n={isWebGLAvailable:function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}},isWebGL2Available:function(){try{var t=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!t.getContext("webgl2"))}catch(t){return!1}},getWebGLErrorMessage:function(){return this.getErrorMessage(1)},getWebGL2ErrorMessage:function(){return this.getErrorMessage(2)},getErrorMessage:function(t){var e={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},i='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>',n=document.createElement("div");return n.id="webglmessage",n.style.fontFamily="monospace",n.style.fontSize="13px",n.style.fontWeight="normal",n.style.textAlign="center",n.style.background="#fff",n.style.color="#000",n.style.padding="1.5em",n.style.width="400px",n.style.margin="5em auto 0",i=(i=e[t]?i.replace("$0","graphics card"):i.replace("$0","browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[t]),n.innerHTML=i,n}}},975:(t,e,i)=>{"use strict";i.d(e,{t:()=>r});var n=i(178);const r={LAYER_USER_MAIN_CAMERA_0:0,LAYER_USER_ALL_CAMERA_1:1,LAYER_USER_ALL_SIDE_CAMERAS_4:4,LAYER_SYS_ALL_CAMERAS_7:7,LAYER_SYS_MAIN_CAMERA_8:8,LAYER_SYS_CORONAL_9:9,LAYER_SYS_AXIAL_10:10,LAYER_SYS_SAGITTAL_11:11,LAYER_SYS_ALL_SIDE_CAMERAS_13:13,LAYER_SYS_RAYCASTER_14:14,LAYER_INVISIBLE_31:31,MAX_RENDER_ORDER:9999999};r.VEC_ORIGIN=new n.J.Vector3(0,0,0),r.VEC_ANAT_R=new n.J.Vector3(1,0,0),r.VEC_ANAT_A=new n.J.Vector3(0,1,0),r.VEC_ANAT_S=new n.J.Vector3(0,0,1),r.VEC_ANAT_L=new n.J.Vector3(-1,0,0),r.VEC_ANAT_P=new n.J.Vector3(0,-1,0),r.VEC_ANAT_I=new n.J.Vector3(0,0,-1),r.KEY_ZOOM="KeyZ",r.KEY_CYCLE_LEFT="BracketLeft",r.KEY_CYCLE_RIGHT="BracketRight",r.KEY_CYCLE_SURFACE_COLOR="KeyK",r.KEY_CYCLE_ELECTRODES_NEXT="Period",r.KEY_CYCLE_ELECTRODES_PREV="Comma",r.KEY_CYCLE_ELEC_VISIBILITY="KeyV",r.KEY_CYCLE_SURFACE="KeyP",r.KEY_CYCLE_MATERIAL="KeyM",r.KEY_CYCLE_ATLAS="KeyL",r.KEY_OVERLAY_CORONAL="KeyC",r.KEY_OVERLAY_AXIAL="KeyA",r.KEY_OVERLAY_SAGITTAL="KeyS",r.KEY_MOVE_CORONAL="KeyE",r.KEY_MOVE_AXIAL="KeyQ",r.KEY_MOVE_SAGITTAL="KeyW",r.KEY_CYCLE_ANIMATION="KeyC",r.KEY_TOGGLE_ANIMATION="KeyS",r.KEY_CYCLE_ELEC_EDITOR="Backquote",r.KEY_CYCLE_SURFTYPE_EDITOR="Digit4",r.KEY_NEW_ELECTRODE_EDITOR="Digit1",r.KEY_LABEL_FOCUS_EDITOR="Digit2",r.KEY_CYCLE_REMOVE_EDITOR="KeyR",r.TOOLTIPS={},r.TOOLTIPS.KEY_ZOOM="z/Z",r.TOOLTIPS.KEY_CYCLE_LEFT="[",r.TOOLTIPS.KEY_CYCLE_RIGHT="]",r.TOOLTIPS.KEY_CYCLE_ELECTRODES_NEXT=".",r.TOOLTIPS.KEY_CYCLE_ELECTRODES_PREV=",",r.TOOLTIPS.KEY_CYCLE_ELEC_VISIBILITY="v",r.TOOLTIPS.KEY_CYCLE_SURFACE="p",r.TOOLTIPS.KEY_CYCLE_SURFACE_COLOR="k",r.TOOLTIPS.KEY_CYCLE_MATERIAL="M",r.TOOLTIPS.KEY_OVERLAY_CORONAL="C",r.TOOLTIPS.KEY_OVERLAY_AXIAL="A",r.TOOLTIPS.KEY_OVERLAY_SAGITTAL="S",r.TOOLTIPS.KEY_MOVE_CORONAL="e/E",r.TOOLTIPS.KEY_MOVE_AXIAL="q/Q",r.TOOLTIPS.KEY_MOVE_SAGITTAL="w/W",r.TOOLTIPS.KEY_CYCLE_ANIMATION="c",r.TOOLTIPS.KEY_TOGGLE_ANIMATION="s",r.TOOLTIPS.KEY_CYCLE_ELEC_EDITOR="`",r.TOOLTIPS.KEY_CYCLE_SURFTYPE_EDITOR="4",r.TOOLTIPS.KEY_NEW_ELECTRODE_EDITOR="1",r.TOOLTIPS.KEY_LABEL_FOCUS_EDITOR="2",r.TOOLTIPS.KEY_CYCLE_REMOVE_EDITOR="r",r.TOOLTIPS.KEY_CYCLE_ATLAS="l",r.REGEXP_SURFACE_GROUP=/^Surface - (.+) \((.+)\)$/,r.REGEXP_VOLUME_GROUP=/^Volume - (.+) \((.+)\)$/,r.REGEXP_ELECTRODE_GROUP=/^Electrodes \((.+)\)$/,r.REGEXP_SURFACE=/^([\w ]+) (Left|right) Hemisphere - (.+) \((.+)\)$/,r.REGEXP_ATLAS=/^Atlas - ([^\(\)]+)\s\(/,r.REGEXP_VOLUME=/^(.+) \((.+)\)$/,r.REGEXP_ELECTRODE=/^(.+), ([0-9]+) - (.*)$/,r.COLOR_MAIN_LIGHT=15724527,r.COLOR_AMBIENT_LIGHT=8421504,r.DEFAULT_COLOR=0,r.VERTEX_COLOR=1,r.VOXEL_COLOR=2,r.ELECTRODE_COLOR=3,r.FOLDERS={"background-color":"Default","sync-viewers":"Default","video-recorder":"Default","reset-main-camera":"Default","main-camera-position":"Default","toggle-helpper":"Default","toggle-side-panels":"Volume Settings","reset-side-panels":"Volume Settings","side-three-planes":"Volume Settings","side-electrode-dist":"Volume Settings",atlas:"Volume Settings","subject-selector":"Surface Settings","surface-selector":"Surface Settings","hemisphere-material":"Surface Settings","electrode-style":"Electrodes","electrode-mapping":"Electrodes",animation:"Data Visualization","highlight-selection":"Data Visualization"},r.THRESHOLD_OPERATORS=["v = T1","|v| < T1","|v| >= T1","v < T1","v >= T1","v in [T1, T2]","v not in [T1,T2]"],r.RENDER_ORDER={DataCube2:-1,DataCube:r.MAX_RENDER_ORDER-1}},1658:(t,e,i)=>{"use strict";i.d(e,{E:()=>yt,B:()=>vt});var n=i(178);function r(t,e){var i=t.__state.conversionName.toString(),n=Math.round(t.r),r=Math.round(t.g),s=Math.round(t.b),a=t.a,o=Math.round(t.h),l=t.s.toFixed(1),c=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===i||"SIX_CHAR_HEX"===i){for(var h=t.hex.toString(16);h.length<6;)h="0"+h;return"#"+h}return"CSS_RGB"===i?"rgb("+n+","+r+","+s+")":"CSS_RGBA"===i?"rgba("+n+","+r+","+s+","+a+")":"HEX"===i?"0x"+t.hex.toString(16):"RGB_ARRAY"===i?"["+n+","+r+","+s+"]":"RGBA_ARRAY"===i?"["+n+","+r+","+s+","+a+"]":"RGB_OBJ"===i?"{r:"+n+",g:"+r+",b:"+s+"}":"RGBA_OBJ"===i?"{r:"+n+",g:"+r+",b:"+s+",a:"+a+"}":"HSV_OBJ"===i?"{h:"+o+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===i?"{h:"+o+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var s=Array.prototype.forEach,a=Array.prototype.slice,o={BREAK:{},extend:function(t){return this.each(a.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(e[i])||(t[i]=e[i])}.bind(this))}),this),t},defaults:function(t){return this.each(a.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(t[i])&&(t[i]=e[i])}.bind(this))}),this),t},compose:function(){var t=a.call(arguments);return function(){for(var e=a.call(arguments),i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},each:function(t,e,i){if(t)if(s&&t.forEach&&t.forEach===s)t.forEach(e,i);else if(t.length===t.length+0){var n,r=void 0;for(r=0,n=t.length;r<n;r++)if(r in t&&e.call(i,t[r],r)===this.BREAK)return}else for(var a in t)if(e.call(i,t[a],a)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var n=void 0;return function(){var r=this,s=arguments;function a(){n=null,i||t.apply(r,s)}var o=i||!n;clearTimeout(n),n=setTimeout(a,e),o&&t.apply(r,s)}},toArray:function(t){return t.toArray?t.toArray():a.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)}},l=[{litmus:o.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:r},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:r},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:r},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:r}}},{litmus:o.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:o.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:o.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(o.isNumber(t.r)&&o.isNumber(t.g)&&o.isNumber(t.b)&&o.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(o.isNumber(t.r)&&o.isNumber(t.g)&&o.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(o.isNumber(t.h)&&o.isNumber(t.s)&&o.isNumber(t.v)&&o.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(o.isNumber(t.h)&&o.isNumber(t.s)&&o.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],c=void 0,h=void 0,u=function(){h=!1;var t=arguments.length>1?o.toArray(arguments):arguments[0];return o.each(l,(function(e){if(e.litmus(t))return o.each(e.conversions,(function(e,i){if(c=e.read(t),!1===h&&!1!==c)return h=c,c.conversionName=i,c.conversion=e,o.BREAK})),o.BREAK})),h},d=void 0,p={hsv_to_rgb:function(t,e,i){var n=Math.floor(t/60)%6,r=t/60-Math.floor(t/60),s=i*(1-e),a=i*(1-r*e),o=i*(1-(1-r)*e),l=[[i,o,s],[a,i,s],[s,i,o],[s,a,i],[o,s,i],[i,s,a]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,i){var n=Math.min(t,e,i),r=Math.max(t,e,i),s=r-n,a=void 0;return 0===r?{h:NaN,s:0,v:0}:(a=t===r?(e-i)/s:e===r?2+(i-t)/s:4+(t-e)/s,(a/=6)<0&&(a+=1),{h:360*a,s:s/r,v:r/255})},rgb_to_hex:function(t,e,i){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,i)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,i){return i<<(d=8*e)|t&~(255<<d)}},f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},g=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0},v=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},y=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},b=function(){function t(){if(m(this,t),this.__state=u.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return g(t,[{key:"toString",value:function(){return r(this)}},{key:"toHexString",value:function(){return r(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function x(t,e,i){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||b.recalculateRGB(this,e,i),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(b.recalculateRGB(this,e,i),this.__state.space="RGB"),this.__state[e]=t}})}function w(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||b.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(b.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}b.recalculateRGB=function(t,e,i){if("HEX"===t.__state.space)t.__state[e]=p.component_from_hex(t.__state.hex,i);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");o.extend(t.__state,p.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},b.recalculateHSV=function(t){var e=p.rgb_to_hsv(t.r,t.g,t.b);o.extend(t.__state,{s:e.s,v:e.v}),o.isNaN(e.h)?o.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},b.COMPONENTS=["r","g","b","h","s","v","hex","a"],x(b.prototype,"r",2),x(b.prototype,"g",1),x(b.prototype,"b",0),w(b.prototype,"h"),w(b.prototype,"s"),w(b.prototype,"v"),Object.defineProperty(b.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(b.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=p.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var S=function(){function t(e,i){m(this,t),this.initialValue=e[i],this.domElement=document.createElement("div"),this.object=e,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return g(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),M={};o.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){o.each(t,(function(t){M[t]=e}))}));var A=/(\d+(\.\d+)?)px/;function E(t){if("0"===t||o.isUndefined(t))return 0;var e=t.match(A);return o.isNull(e)?0:parseFloat(e[1])}var L={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,i){var n=i,r=e;o.isUndefined(r)&&(r=!0),o.isUndefined(n)&&(n=!0),t.style.position="absolute",r&&(t.style.left=0,t.style.right=0),n&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,i,n){var r=i||{},s=M[e];if(!s)throw new Error("Event type "+e+" not supported.");var a=document.createEvent(s);switch(s){case"MouseEvents":var l=r.x||r.clientX||0,c=r.y||r.clientY||0;a.initMouseEvent(e,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,l,c,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var h=a.initKeyboardEvent||a.initKeyEvent;o.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(e,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:a.initEvent(e,r.bubbles||!1,r.cancelable||!0)}o.defaults(a,n),t.dispatchEvent(a)},bind:function(t,e,i,n){var r=n||!1;return t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent("on"+e,i),L},unbind:function(t,e,i,n){var r=n||!1;return t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent("on"+e,i),L},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var i=t.className.split(/ +/);-1===i.indexOf(e)&&(i.push(e),t.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return L},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var i=t.className.split(/ +/),n=i.indexOf(e);-1!==n&&(i.splice(n,1),t.className=i.join(" "))}else t.className=void 0;return L},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return E(e["border-left-width"])+E(e["border-right-width"])+E(e["padding-left"])+E(e["padding-right"])+E(e.width)},getHeight:function(t){var e=getComputedStyle(t);return E(e["border-top-width"])+E(e["border-bottom-width"])+E(e["padding-top"])+E(e["padding-bottom"])+E(e.height)},getOffset:function(t){var e=t,i={left:0,top:0};if(e.offsetParent)do{i.left+=e.offsetLeft,i.top+=e.offsetTop,e=e.offsetParent}while(e);return i},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},T=function(t){function e(t,i){m(this,e);var n=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),L.bind(n.__checkbox,"change",(function(){r.setValue(!r.__prev)}),!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return v(e,t),g(e,[{key:"setValue",value:function(t){var i=_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(S),C=function(t){function e(t,i,n){m(this,e);var r=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),s=n,a=r;if(r.__select=document.createElement("select"),o.isArray(s)){var l={};o.each(s,(function(t){l[t]=t})),s=l}return o.each(s,(function(t,e){var i=document.createElement("option");i.innerHTML=e,i.setAttribute("value",t),a.__select.appendChild(i)})),r.updateDisplay(),L.bind(r.__select,"change",(function(){var t=this.options[this.selectedIndex].value;a.setValue(t)})),r.domElement.appendChild(r.__select),r}return v(e,t),g(e,[{key:"setValue",value:function(t){var i=_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return L.isActive(this.__select)?this:(this.__select.value=this.getValue(),_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(S),P=function(t){function e(t,i){m(this,e);var n=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=n;function s(){r.setValue(r.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),L.bind(n.__input,"keyup",s),L.bind(n.__input,"change",s),L.bind(n.__input,"blur",(function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())})),L.bind(n.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return v(e,t),g(e,[{key:"updateDisplay",value:function(){return L.isActive(this.__input)||(this.__input.value=this.getValue()),_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(S);function N(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var R=function(t){function e(t,i,n){m(this,e);var r=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),s=n||{};return r.__min=s.min,r.__max=s.max,r.__step=s.step,o.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=N(r.__impliedStep),r}return v(e,t),g(e,[{key:"setValue",value:function(t){var i=t;return void 0!==this.__min&&i<this.__min?i=this.__min:void 0!==this.__max&&i>this.__max&&(i=this.__max),void 0!==this.__step&&i%this.__step!=0&&(i=Math.round(i/this.__step)*this.__step),_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=N(t),this}}]),e}(S);var D=function(t){function e(t,i,n){m(this,e);var r=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));r.__truncationSuspended=!1;var s=r,a=void 0;function l(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function c(t){var e=a-t.clientY;s.setValue(s.getValue()+e*s.__impliedStep),a=t.clientY}function h(){L.unbind(window,"mousemove",c),L.unbind(window,"mouseup",h),l()}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),L.bind(r.__input,"change",(function(){var t=parseFloat(s.__input.value);o.isNaN(t)||s.setValue(t)})),L.bind(r.__input,"blur",(function(){l()})),L.bind(r.__input,"mousedown",(function(t){L.bind(window,"mousemove",c),L.bind(window,"mouseup",h),a=t.clientY})),L.bind(r.__input,"keydown",(function(t){13===t.keyCode&&(s.__truncationSuspended=!0,this.blur(),s.__truncationSuspended=!1,l())})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return v(e,t),g(e,[{key:"updateDisplay",value:function(){var t,i,n;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),i=this.__precision,n=Math.pow(10,i),Math.round(t*n)/n),_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(R);function I(t,e,i,n,r){return n+(t-e)/(i-e)*(r-n)}var O=function(t){function e(t,i,n,r,s){m(this,e);var a=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,{min:n,max:r,step:s})),o=a;function l(t){t.preventDefault();var e=o.__background.getBoundingClientRect();return o.setValue(I(t.clientX,e.left,e.right,o.__min,o.__max)),!1}function c(){L.unbind(window,"mousemove",l),L.unbind(window,"mouseup",c),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function h(t){var e=t.touches[0].clientX,i=o.__background.getBoundingClientRect();o.setValue(I(e,i.left,i.right,o.__min,o.__max))}function u(){L.unbind(window,"touchmove",h),L.unbind(window,"touchend",u),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),L.bind(a.__background,"mousedown",(function(t){document.activeElement.blur(),L.bind(window,"mousemove",l),L.bind(window,"mouseup",c),l(t)})),L.bind(a.__background,"touchstart",(function(t){if(1!==t.touches.length)return;L.bind(window,"touchmove",h),L.bind(window,"touchend",u),h(t)})),L.addClass(a.__background,"slider"),L.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return v(e,t),g(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(R),k=function(t){function e(t,i,n){m(this,e);var r=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),s=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===n?"Fire":n,L.bind(r.__button,"click",(function(t){return t.preventDefault(),s.fire(),!1})),L.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return v(e,t),g(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(S),F=function(t){function e(t,i){m(this,e);var n=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));n.__color=new b(n.getValue()),n.__temp=new b(0);var r=n;n.domElement=document.createElement("div"),L.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",L.bind(n.__input,"keydown",(function(t){13===t.keyCode&&p.call(this)})),L.bind(n.__input,"blur",p),L.bind(n.__selector,"mousedown",(function(){L.addClass(this,"drag").bind(window,"mouseup",(function(){L.removeClass(r.__selector,"drag")}))})),L.bind(n.__selector,"touchstart",(function(){L.addClass(this,"drag").bind(window,"touchend",(function(){L.removeClass(r.__selector,"drag")}))}));var s,a=document.createElement("div");function l(t){g(t),L.bind(window,"mousemove",g),L.bind(window,"touchmove",g),L.bind(window,"mouseup",h),L.bind(window,"touchend",h)}function c(t){_(t),L.bind(window,"mousemove",_),L.bind(window,"touchmove",_),L.bind(window,"mouseup",d),L.bind(window,"touchend",d)}function h(){L.unbind(window,"mousemove",g),L.unbind(window,"touchmove",g),L.unbind(window,"mouseup",h),L.unbind(window,"touchend",h),f()}function d(){L.unbind(window,"mousemove",_),L.unbind(window,"touchmove",_),L.unbind(window,"mouseup",d),L.unbind(window,"touchend",d),f()}function p(){var t=u(this.value);!1!==t?(r.__color.__state=t,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function f(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}function g(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__saturation_field.getBoundingClientRect(),i=t.touches&&t.touches[0]||t,n=i.clientX,s=i.clientY,a=(n-e.left)/(e.right-e.left),o=1-(s-e.top)/(e.bottom-e.top);return o>1?o=1:o<0&&(o=0),a>1?a=1:a<0&&(a=0),r.__color.v=o,r.__color.s=a,r.setValue(r.__color.toOriginal()),!1}function _(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__hue_field.getBoundingClientRect(),i=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return i>1?i=1:i<0&&(i=0),r.__color.h=360*i,r.setValue(r.__color.toOriginal()),!1}return o.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),o.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),o.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),o.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),o.extend(a.style,{width:"100%",height:"100%",background:"none"}),z(a,"top","rgba(0,0,0,0)","#000"),o.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(s=n.__hue_field).style.background="",s.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",s.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),L.bind(n.__saturation_field,"mousedown",l),L.bind(n.__saturation_field,"touchstart",l),L.bind(n.__field_knob,"mousedown",l),L.bind(n.__field_knob,"touchstart",l),L.bind(n.__hue_field,"mousedown",c),L.bind(n.__hue_field,"touchstart",c),n.__saturation_field.appendChild(a),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}return v(e,t),g(e,[{key:"updateDisplay",value:function(){var t=u(this.getValue());if(!1!==t){var e=!1;o.each(b.COMPONENTS,(function(i){if(!o.isUndefined(t[i])&&!o.isUndefined(this.__color.__state[i])&&t[i]!==this.__color.__state[i])return e=!0,{}}),this),e&&o.extend(this.__color.__state,t)}o.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,n=255-i;o.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,z(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),o.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),e}(S),B=["-moz-","-o-","-webkit-","-ms-",""];function z(t,e,i,n){t.style.background="",o.each(B,(function(r){t.style.cssText+="background: "+r+"linear-gradient("+e+", "+i+" 0%, "+n+" 100%); "}))}var j=function(t,e){var i=e||document,n=document.createElement("style");n.type="text/css",n.innerHTML=t;var r=i.getElementsByTagName("head")[0];try{r.appendChild(n)}catch(t){}},U='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',V=function(t,e){var i=t[e];return o.isArray(arguments[2])||o.isObject(arguments[2])?new C(t,e,arguments[2]):o.isNumber(i)?o.isNumber(arguments[2])&&o.isNumber(arguments[3])?o.isNumber(arguments[4])?new O(t,e,arguments[2],arguments[3],arguments[4]):new O(t,e,arguments[2],arguments[3]):o.isNumber(arguments[4])?new D(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new D(t,e,{min:arguments[2],max:arguments[3]}):o.isString(i)?new P(t,e):o.isFunction(i)?new k(t,e,""):o.isBoolean(i)?new T(t,e):null};var H=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},G=function(){function t(){m(this,t),this.backgroundElement=document.createElement("div"),o.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),L.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),o.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;L.bind(this.backgroundElement,"click",(function(){e.hide()}))}return g(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),o.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",L.unbind(t.domElement,"webkitTransitionEnd",e),L.unbind(t.domElement,"transitionend",e),L.unbind(t.domElement,"oTransitionEnd",e)};L.bind(this.domElement,"webkitTransitionEnd",e),L.bind(this.domElement,"transitionend",e),L.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-L.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-L.getHeight(this.domElement)/2+"px"}}]),t}();j(function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var W=function(){try{return!!window.localStorage}catch(t){return!1}}(),q=void 0,Y=!0,J=void 0,X=!1,K=[],Z=function t(e){var i=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),L.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=o.defaults(n,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),n=o.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),o.isUndefined(n.load)?n.load={preset:"Default"}:n.preset&&(n.load.preset=n.preset),o.isUndefined(n.parent)&&n.hideable&&K.push(this),n.resizable=o.isUndefined(n.parent)&&n.resizable,n.autoPlace&&o.isUndefined(n.scrollable)&&(n.scrollable=!0);var r,s=W&&"true"===localStorage.getItem(nt(this,"isLocal")),a=void 0,l=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return i.parent?i.getRoot().preset:n.load.preset},set:function(t){i.parent?i.getRoot().preset=t:n.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),i.revert()}},width:{get:function(){return n.width},set:function(t){n.width=t,lt(i,t)}},name:{get:function(){return n.name},set:function(t){n.name=t,l&&(l.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(e){n.closed=e,n.closed?L.addClass(i.__ul,t.CLASS_CLOSED):L.removeClass(i.__ul,t.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return s},set:function(t){W&&(s=t,t?L.bind(window,"unload",a):L.unbind(window,"unload",a),localStorage.setItem(nt(i,"isLocal"),t))}}}),o.isUndefined(n.parent)){if(this.closed=n.closed||!1,L.addClass(this.domElement,t.CLASS_MAIN),L.makeSelectable(this.domElement,!1),W&&s){i.useLocalStorage=!0;var c=localStorage.getItem(nt(this,"gui"));c&&(n.load=JSON.parse(c))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,L.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),n.closeOnTop?(L.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(L.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),L.bind(this.__closeButton,"click",(function(){i.closed=!i.closed}))}else{void 0===n.closed&&(n.closed=!0);var h=document.createTextNode(n.name);L.addClass(h,"controller-name"),l=$(i,h);L.addClass(this.__ul,t.CLASS_CLOSED),L.addClass(l,"title"),L.bind(l,"click",(function(t){return t.preventDefault(),i.closed=!i.closed,!1})),n.closed||(this.closed=!1)}n.autoPlace&&(o.isUndefined(n.parent)&&(Y&&(J=document.createElement("div"),L.addClass(J,"dg"),L.addClass(J,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(J),Y=!1),J.appendChild(this.domElement),L.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||lt(i,n.width)),this.__resizeHandler=function(){i.onResizeDebounced()},L.bind(window,"resize",this.__resizeHandler),L.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),L.bind(this.__ul,"transitionend",this.__resizeHandler),L.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&ot(this),a=function(){W&&"true"===localStorage.getItem(nt(i,"isLocal"))&&localStorage.setItem(nt(i,"gui"),JSON.stringify(i.getSaveObject()))},this.saveToLocalStorageIfPossible=a,n.parent||((r=i.getRoot()).width+=1,o.defer((function(){r.width-=1})))};function $(t,e,i){var n=document.createElement("li");return e&&n.appendChild(e),i?t.__ul.insertBefore(n,i):t.__ul.appendChild(n),t.onResize(),n}function Q(t){L.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&L.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function tt(t,e){var i=t.__preset_select[t.__preset_select.selectedIndex];i.innerHTML=e?i.value+"*":i.value}function et(t,e){var i=t.getRoot(),n=i.__rememberedObjects.indexOf(e.object);if(-1!==n){var r=i.__rememberedObjectIndecesToControllers[n];if(void 0===r&&(r={},i.__rememberedObjectIndecesToControllers[n]=r),r[e.property]=e,i.load&&i.load.remembered){var s=i.load.remembered,a=void 0;if(s[t.preset])a=s[t.preset];else{if(!s.Default)return;a=s.Default}if(a[n]&&void 0!==a[n][e.property]){var o=a[n][e.property];e.initialValue=o,e.setValue(o)}}}}function it(t,e,i,n){if(void 0===e[i])throw new Error('Object "'+e+'" has no property "'+i+'"');var r=void 0;if(n.color)r=new F(e,i);else{var s=[e,i].concat(n.factoryArgs);r=V.apply(t,s)}n.before instanceof S&&(n.before=n.before.__li),et(t,r),L.addClass(r.domElement,"c");var a=document.createElement("span");L.addClass(a,"property-name"),a.innerHTML=r.property;var l=document.createElement("div");l.appendChild(a),l.appendChild(r.domElement);var c=$(t,l,n.before);return L.addClass(c,Z.CLASS_CONTROLLER_ROW),r instanceof F?L.addClass(c,"color"):L.addClass(c,f(r.getValue())),function(t,e,i){if(i.__li=e,i.__gui=t,o.extend(i,{options:function(e){if(arguments.length>1){var n=i.__li.nextElementSibling;return i.remove(),it(t,i.object,i.property,{before:n,factoryArgs:[o.toArray(arguments)]})}if(o.isArray(e)||o.isObject(e)){var r=i.__li.nextElementSibling;return i.remove(),it(t,i.object,i.property,{before:r,factoryArgs:[e]})}},name:function(t){return i.__li.firstElementChild.firstElementChild.innerHTML=t,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof O){var n=new D(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});o.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=i[t],r=n[t];i[t]=n[t]=function(){var t=Array.prototype.slice.call(arguments);return r.apply(n,t),e.apply(i,t)}})),L.addClass(e,"has-slider"),i.domElement.insertBefore(n.domElement,i.domElement.firstElementChild)}else if(i instanceof D){var r=function(e){if(o.isNumber(i.__min)&&o.isNumber(i.__max)){var n=i.__li.firstElementChild.firstElementChild.innerHTML,r=i.__gui.__listening.indexOf(i)>-1;i.remove();var s=it(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return s.name(n),r&&s.listen(),s}return e};i.min=o.compose(r,i.min),i.max=o.compose(r,i.max)}else i instanceof T?(L.bind(e,"click",(function(){L.fakeEvent(i.__checkbox,"click")})),L.bind(i.__checkbox,"click",(function(t){t.stopPropagation()}))):i instanceof k?(L.bind(e,"click",(function(){L.fakeEvent(i.__button,"click")})),L.bind(e,"mouseover",(function(){L.addClass(i.__button,"hover")})),L.bind(e,"mouseout",(function(){L.removeClass(i.__button,"hover")}))):i instanceof F&&(L.addClass(e,"color"),i.updateDisplay=o.compose((function(t){return e.style.borderLeftColor=i.__color.toString(),t}),i.updateDisplay),i.updateDisplay());i.setValue=o.compose((function(e){return t.getRoot().__preset_select&&i.isModified()&&tt(t.getRoot(),!0),e}),i.setValue)}(t,c,r),t.__controllers.push(r),r}function nt(t,e){return document.location.href+"."+e}function rt(t,e,i){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.__preset_select.appendChild(n),i&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function st(t,e){e.style.display=t.useLocalStorage?"block":"none"}function at(t){var e=t.__save_row=document.createElement("li");L.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),L.addClass(e,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",L.addClass(i,"button gears");var n=document.createElement("span");n.innerHTML="Save",L.addClass(n,"button"),L.addClass(n,"save");var r=document.createElement("span");r.innerHTML="New",L.addClass(r,"button"),L.addClass(r,"save-as");var s=document.createElement("span");s.innerHTML="Revert",L.addClass(s,"button"),L.addClass(s,"revert");var a=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?o.each(t.load.remembered,(function(e,i){rt(t,i,i===t.preset)})):rt(t,"Default",!1),L.bind(a,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(a),e.appendChild(i),e.appendChild(n),e.appendChild(r),e.appendChild(s),W){var l=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(nt(0,"isLocal"))&&c.setAttribute("checked","checked"),st(t,l),L.bind(c,"change",(function(){t.useLocalStorage=!t.useLocalStorage,st(t,l)}))}var h=document.getElementById("dg-new-constructor");L.bind(h,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||q.hide()})),L.bind(i,"click",(function(){h.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),q.show(),h.focus(),h.select()})),L.bind(n,"click",(function(){t.save()})),L.bind(r,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),L.bind(s,"click",(function(){t.revert()}))}function ot(t){var e=void 0;function i(i){return i.preventDefault(),t.width+=e-i.clientX,t.onResize(),e=i.clientX,!1}function n(){L.removeClass(t.__closeButton,Z.CLASS_DRAG),L.unbind(window,"mousemove",i),L.unbind(window,"mouseup",n)}function r(r){return r.preventDefault(),e=r.clientX,L.addClass(t.__closeButton,Z.CLASS_DRAG),L.bind(window,"mousemove",i),L.bind(window,"mouseup",n),!1}t.__resize_handle=document.createElement("div"),o.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),L.bind(t.__resize_handle,"mousedown",r),L.bind(t.__closeButton,"mousedown",r),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function lt(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function ct(t,e){var i={};return o.each(t.__rememberedObjects,(function(n,r){var s={},a=t.__rememberedObjectIndecesToControllers[r];o.each(a,(function(t,i){s[i]=e?t.initialValue:t.getValue()})),i[r]=s})),i}Z.toggleHide=function(){X=!X,o.each(K,(function(t){t.domElement.style.display=X?"none":""}))},Z.CLASS_AUTO_PLACE="a",Z.CLASS_AUTO_PLACE_CONTAINER="ac",Z.CLASS_MAIN="main",Z.CLASS_CONTROLLER_ROW="cr",Z.CLASS_TOO_TALL="taller-than-window",Z.CLASS_CLOSED="closed",Z.CLASS_CLOSE_BUTTON="close-button",Z.CLASS_CLOSE_TOP="close-top",Z.CLASS_CLOSE_BOTTOM="close-bottom",Z.CLASS_DRAG="drag",Z.DEFAULT_WIDTH=245,Z.TEXT_CLOSED="Close Controls",Z.TEXT_OPEN="Open Controls",Z._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||Z.toggleHide()},L.bind(window,"keydown",Z._keydownHandler,!1),o.extend(Z.prototype,{add:function(t,e){return it(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return it(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;o.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&J.removeChild(this.domElement);var t=this;o.each(this.__folders,(function(e){t.removeFolder(e)})),L.unbind(window,"keydown",Z._keydownHandler,!1),Q(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var i=new Z(e);this.__folders[t]=i;var n=$(this,i.domElement);return L.addClass(n,"folder"),i},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Q(t);var e=this;o.each(t.__folders,(function(e){t.removeFolder(e)})),o.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=L.getOffset(t.__ul).top,i=0;o.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(i+=L.getHeight(e))})),window.innerHeight-e-20<i?(L.addClass(t.domElement,Z.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(L.removeClass(t.domElement,Z.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&o.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:o.debounce((function(){this.onResize()}),50),remember:function(){if(o.isUndefined(q)&&((q=new G).domElement.innerHTML=U),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;o.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&at(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&lt(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=ct(this)),t.folders={},o.each(this.__folders,(function(e,i){t.folders[i]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ct(this),tt(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=ct(this,!0)),this.load.remembered[t]=ct(this),this.preset=t,rt(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){o.each(this.__controllers,(function(e){this.getRoot().load.remembered?et(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),o.each(this.__folders,(function(t){t.revert(t)})),t||tt(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&function t(e){0!==e.length&&H.call(window,(function(){t(e)}));o.each(e,(function(t){t.updateDisplay()}))}(this.__listening)},updateDisplay:function(){o.each(this.__controllers,(function(t){t.updateDisplay()})),o.each(this.__folders,(function(t){t.updateDisplay()}))}});var ht=Z;var ut=i(960),dt=i(3658),pt=i(975);function ft(t){var e={};this.settings=t,this.on=function(t,i){e[t]=i},this.emit=function(t){var i=e[t];i&&i.apply(null,Array.prototype.slice.call(arguments,1))},this.filename=t.name||(new Date).toGMTString(),this.extension="",this.mimeType=""}ft.prototype.start=function(){},ft.prototype.stop=function(){},ft.prototype.add=function(){},ft.prototype.save=function(){},ft.prototype.dispose=function(){},ft.prototype.safeToProceed=function(){return!0},ft.prototype.step=function(){};var mt=i(3121);class gt extends ft{constructor(t){super(t),this.extension=".webm",this.mimeType="video/webm;codecs=vp8,opus",this.baseFilename=this.filename,this.framerate=t.framerate,this.chunks=[],this.canvas=t.canvas,this.stream=this.canvas.captureStream(this.framerate),this.recorder=new MediaRecorder(this.stream,{mimeType:"video/webm;codecs=vp8,opus"}),this.recorder.ondataavailable=t=>{this.chunks.push(t.data)},this.recorder.onstop=t=>{this.save(t=>{console.log("Start to download..."),(0,mt.L)(t,this.filename+this.extension)}),this.chunks.length=0}}stop(){this.recorder&&"recording"===this.recorder.state&&this.recorder.stop()}start(){this.dispose(),this.recorder.start()}save(t=null){if(!t)return null;if(this.chunks.length>0){t(new Blob(this.chunks))}}dispose(){this.recorder&&this.stop(),this.chunks.length=0}add(){}}i(3729);function _t(t,e=!0,i=!0,n=!0){return 0+t.shiftKey+2*t.ctrlKey+4*t.altKey===0+e+2*i+4*n}class vt{constructor(t,e,i,n){this.canvas=t,this.gui=e,this.settings=i,this.shiny=n,this.electrode_regexp=RegExp("^electrodes-(.+)$"),this.animation_time=[0,1],this.cache={},this.canvas.bind("update_data_gui_controllers","switch_subject",t=>{this.update_self()},this.canvas.el)}update_self(){this.update_voxel_type(),this.set_surface_ctype(!0),"function"==typeof this._calculate_intersection_coord&&this._calculate_intersection_coord(),this._update_canvas()}_update_canvas(t=0){t>=0?this.canvas.start_animation(t):this.canvas.pause_animation(-t)}fire_change(t,e="deferred"){if(this.shiny.to_shiny2("controllers",this.gui.params,"deferred"),"object"==typeof t)for(let i in t)this.shiny.to_shiny2(i,t[i],e)}c_background(){const t=this.settings.background||"#ffffff",e=pt.t.FOLDERS["background-color"];this.gui.add_item("Background Color","#FFFFFF",{is_color:!0,folder_name:e}).onChange(t=>{const e=(0,dt.qd)(t);this.canvas.background_color=t,this.canvas.foreground_color=e,this.canvas.main_renderer.setClearColor(t),this.canvas.side_renderer.setClearColor(t),this.canvas.el.style.backgroundColor=t,this.fire_change({background:t}),this._update_canvas(0)}).setValue(t)}c_syncviewer(){if(this.shiny.shiny_mode){const t=pt.t.FOLDERS["sync-viewers"];this.gui.add_item("Send to Other Viewers",()=>{this.fire_change({sync:this.shiny.uuid},"event")},{folder_name:t})}}c_recorder(){const t=pt.t.FOLDERS["video-recorder"];this.gui.add_item("Record Video",!1,{folder_name:t}).onChange(t=>{t?(this.canvas.capturer||(this.canvas.capturer=new gt({canvas:this.canvas.domElement,framerate:24,format:"webm",verbose:!0,autoSaveTime:0,main_width:this.canvas.main_renderer.domElement.width,main_height:this.canvas.main_renderer.domElement.height,sidebar_width:300,pixel_ratio:this.canvas.main_renderer.domElement.width/this.canvas.main_renderer.domElement.clientWidth})),this.canvas.capturer.baseFilename=this.canvas.capturer.filename=(new Date).toGMTString(),this.canvas.capturer.start(),this.canvas.capturer_recording=!0):(this.canvas.capturer_recording=!1,this.canvas.capturer&&(this.canvas.capturer.stop(),this.canvas.capturer.save()))}),this.gui.add_item("Screenshot",()=>{const t=(new Date).toJSON();this.canvas.mapToPDF().save(`[rave-brain] ${t}.pdf`)},{folder_name:t})}c_reset_camera(){const t=pt.t.FOLDERS["reset-main-camera"];this.gui.add_item("Reset",()=>{this.canvas.handle_resize(void 0,void 0,!1,!0),this.canvas.reset_controls(),this.canvas.controls.enabled=!0},{folder_name:t})}c_main_camera_position(){const t=pt.t.FOLDERS["main-camera-position"],e=this.gui.add_item("Camera Position","[free rotate]",{args:["[free rotate]","[lock]","right","left","anterior","posterior","superior","inferior"],folder_name:t}).onChange(t=>{if("[lock]"===t)return this.canvas.controls.enabled=!1,null;switch(this.canvas.controls.enabled=!0,t){case"right":this.canvas.main_camera.position.set(500,0,0),this.canvas.main_camera.up.set(0,0,1);break;case"left":this.canvas.main_camera.position.set(-500,0,0),this.canvas.main_camera.up.set(0,0,1);break;case"anterior":this.canvas.main_camera.position.set(0,500,0),this.canvas.main_camera.up.set(0,0,1);break;case"posterior":this.canvas.main_camera.position.set(0,-500,0),this.canvas.main_camera.up.set(0,0,1);break;case"superior":this.canvas.main_camera.position.set(0,0,500),this.canvas.main_camera.up.set(0,1,0);break;case"inferior":this.canvas.main_camera.position.set(0,0,-500),this.canvas.main_camera.up.set(0,1,0)}e.__select.value="[free rotate]",this._update_canvas()});if(this.canvas.__reset_flag){const t=(new n.J.Vector3).fromArray(this.settings.camera_pos);t.length()>0&&(this.canvas.main_camera.position.set(t.x,t.y,t.z).normalize().multiplyScalar(500),0!==t.x||0!==t.y?this.canvas.main_camera.up.set(0,0,1):this.canvas.main_camera.up.set(0,1,0))}this._update_canvas()}c_toggle_anchor(){const t=pt.t.FOLDERS["toggle-helpper"];this.gui.add_item("Display Coordinates",!1,{folder_name:t}).onChange(t=>{this.canvas.set_cube_anchor_visibility(t),this.fire_change()})}c_toggle_side_panel(){const t=pt.t.FOLDERS["toggle-side-panels"],e=this.settings.side_display||!1;this.gui.add_item("Show Panels",e,{folder_name:t}).onChange(t=>{t?this.canvas.enable_side_cameras():this.canvas.disable_side_cameras(),this.fire_change({side_display:t})});e?this.canvas.enable_side_cameras():this.canvas.disable_side_cameras(),this.fire_change({side_display:e})}c_reset_side_panel(){const t=pt.t.FOLDERS["reset-side-panels"],e=this.settings.side_canvas_zoom,i=this.settings.side_canvas_width,n=this.settings.side_canvas_shift;this.gui.add_item("Reset Position",()=>{this.canvas.reset_side_canvas(e,i,n)},{folder_name:t}),this.canvas._side_width=i,this.canvas.reset_side_canvas(e,i,n)}c_side_depth(){const t=pt.t.FOLDERS["side-three-planes"],e=()=>{console.debug("Recalculate MNI305 for plane intersections");const t=this.canvas.state_data.get("axial_posz")||0,e=this.canvas.state_data.get("coronal_posy")||0,i=this.canvas.state_data.get("sagittal_posx")||0,r=(new n.J.Vector3).set(i,e,t);this.canvas.calculate_mni305(r),a.setValue(`${r.x.toFixed(1)}, ${r.y.toFixed(1)}, ${r.z.toFixed(1)}`)};this._calculate_intersection_coord=e;const i=this.gui.add_item("Coronal (P - A)",0,{folder_name:t}).min(-128).max(128).step(1).onChange(t=>{this.canvas.set_coronal_depth(t),this.fire_change({coronal_depth:t}),e()});this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_MOVE_CORONAL,"Coronal (P - A)",t);const r=this.gui.add_item("Axial (I - S)",0,{folder_name:t}).min(-128).max(128).step(1).onChange(t=>{this.canvas.set_axial_depth(t),this.fire_change({axial_depth:t}),e()});this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_MOVE_AXIAL,"Axial (I - S)",t);const s=this.gui.add_item("Sagittal (L - R)",0,{folder_name:t}).min(-128).max(128).step(1).onChange(t=>{this.canvas.set_sagittal_depth(t),this.fire_change({sagittal_depth:t}),e()});this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_MOVE_SAGITTAL,"Sagittal (L - R)",t);const a=this.gui.add_item("Intersect MNI305","NaN, NaN, NaN",{folder_name:t});this.fire_change({coronal_depth:0}),this.fire_change({axial_depth:0}),this.fire_change({sagittal_depth:0}),[i,r,s].forEach((t,e)=>{this.canvas.bind(`dat_gui_side_controller_${e}_mousewheel`,"mousewheel",e=>{if(e.altKey){e.preventDefault();const i=t.getValue();t.setValue(i+e.deltaY)}},t.domElement)}),this.canvas.set_side_depth=(t,e,n)=>{"number"==typeof t&&i.setValue(t),"number"==typeof e&&r.setValue(e||0),"number"==typeof n&&s.setValue(n||0)};const o=this.gui.add_item("Overlay Coronal",!1,{folder_name:t}).onChange(t=>{this.canvas.set_side_visibility("coronal",t),this.fire_change({coronal_visibility:t})});this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_OVERLAY_CORONAL,"Overlay Coronal",t);const l=this.gui.add_item("Overlay Axial",!1,{folder_name:t}).onChange(t=>{this.canvas.set_side_visibility("axial",t),this.fire_change({axial_visibility:t})});this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_OVERLAY_AXIAL,"Overlay Axial",t);const c=this.gui.add_item("Overlay Sagittal",!1,{folder_name:t}).onChange(t=>{this.canvas.set_side_visibility("sagittal",t),this.fire_change({sagittal_visibility:t})});this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_OVERLAY_SAGITTAL,"Overlay Sagittal",t),this.fire_change({coronal_visibility:!1}),this.fire_change({axial_visibility:!1}),this.fire_change({sagittal_visibility:!1}),this.canvas.add_keyboard_callabck(pt.t.KEY_OVERLAY_CORONAL,t=>{if(_t(t.event,!0,!1,!1)){const t=o.getValue();o.setValue(!t)}},"overlay_coronal"),this.canvas.add_keyboard_callabck(pt.t.KEY_MOVE_CORONAL,t=>{const e=i.getValue();_t(t.event,!0,!1,!1)?i.setValue(e-1):_t(t.event,!1,!1,!1)&&i.setValue(e+1)},"move_coronal"),this.canvas.add_keyboard_callabck(pt.t.KEY_OVERLAY_AXIAL,t=>{if(_t(t.event,!0,!1,!1)){const t=l.getValue();l.setValue(!t)}},"overlay_axial"),this.canvas.add_keyboard_callabck(pt.t.KEY_MOVE_AXIAL,t=>{const e=r.getValue();_t(t.event,!0,!1,!1)?r.setValue(e-1):_t(t.event,!1,!1,!1)&&r.setValue(e+1)},"move_axial"),this.canvas.add_keyboard_callabck(pt.t.KEY_OVERLAY_SAGITTAL,t=>{if(_t(t.event,!0,!1,!1)){const t=c.getValue();c.setValue(!t)}},"overlay_sagittal"),this.canvas.add_keyboard_callabck(pt.t.KEY_MOVE_SAGITTAL,t=>{const e=s.getValue();_t(t.event,!0,!1,!1)?s.setValue(e-1):_t(t.event,!1,!1,!1)&&s.setValue(e+1)},"move_sagittal")}c_side_electrode_dist(){const t=pt.t.FOLDERS["side-electrode-dist"];this.gui.add_item("Dist. Threshold",2,{folder_name:t}).min(0).max(64).step(.1).onChange(t=>{this.canvas.trim_electrodes(t),this._update_canvas(),this.fire_change()}),this.canvas.trim_electrodes(2)}c_subject2(){const t=pt.t.FOLDERS["subject-selector"],e=this.canvas.subject_codes;if(e.length>0){let i=this.canvas.state_data.get("target_subject")||e[0];this.gui.add_item("Subject",i,{folder_name:t,args:e}).onChange(t=>{this.canvas.switch_subject(t),this.fire_change()}),this.canvas.switch_subject()}else this.canvas.update_control_center(this.settings.control_center)}c_surface_type2(){const t=pt.t.FOLDERS["surface-selector"],e=this.canvas.state_data.get("surface_type")||"pial",i=this.canvas.get_surface_types(),n=this.canvas.state_data.get("surface_material_type")||"MeshPhongMaterial",r=["MeshPhongMaterial","MeshLambertMaterial"];if(0===i.length)return null;const s=this.gui.add_item("Surface Type",e,{args:i,folder_name:t}).onChange(t=>{this.canvas.switch_subject("/",{surface_type:t}),this.fire_change({surface_type:t})});this.fire_change({surface_type:e}),this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_CYCLE_SURFACE,"Surface Type",t),this.canvas.add_keyboard_callabck(pt.t.KEY_CYCLE_SURFACE,t=>{if(_t(t.event,!1,!1,!1)){let t=(i.indexOf(s.getValue())+1)%i.length;t>=0&&s.setValue(i[t])}},"gui_surf_type2");const a=this.gui.add_item("Surface Material",n,{args:r,folder_name:t}).onChange(t=>{this.canvas.state_data.set("surface_material_type",t),this.fire_change({surface_material:t}),this._update_canvas()});this.fire_change({surface_material:n}),this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_CYCLE_MATERIAL,"Surface Material",t),this.canvas.add_keyboard_callabck(pt.t.KEY_CYCLE_MATERIAL,t=>{if(_t(t.event,!0,!1,!1)){let t=(r.indexOf(a.getValue())+1)%r.length;t>=0&&a.setValue(r[t])}},"gui_surf_material")}c_hemisphere_material(){const t=pt.t.FOLDERS["hemisphere-material"],e=["normal","wireframe","hidden"],i=this.gui.add_item("Left Hemisphere","normal",{args:e,folder_name:t}).onChange(t=>{this.canvas.switch_subject("/",{material_type_left:t}),this.fire_change()});this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_CYCLE_LEFT,"Left Hemisphere",t);const n=this.gui.add_item("Right Hemisphere","normal",{args:e,folder_name:t}).onChange(t=>{this.canvas.switch_subject("/",{material_type_right:t}),this.fire_change()});this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_CYCLE_RIGHT,"Right Hemisphere",t);const r=this.gui.add_item("Left Opacity",1,{folder_name:t}).min(.1).max(1).step(.1).onChange(t=>{this.canvas.switch_subject("/",{surface_opacity_left:t}),this.fire_change()});this.gui.add_tooltip(""+pt.t.TOOLTIPS.KEY_CYCLE_LEFT,"Left Opacity",t);const s=this.gui.add_item("Right Opacity",1,{folder_name:t}).min(.1).max(1).step(.1).onChange(t=>{this.canvas.switch_subject("/",{surface_opacity_right:t}),this.fire_change()});this.gui.add_tooltip(""+pt.t.TOOLTIPS.KEY_CYCLE_RIGHT,"Right Opacity",t),this.canvas.add_keyboard_callabck(pt.t.KEY_CYCLE_LEFT,t=>{if(_t(t.event,!0,!1,!1)){let t=r.getValue()-.3;t<0&&(t=1),r.setValue(t)}else if(_t(t.event,!1,!1,!1)){let t=(e.indexOf(i.getValue())+1)%e.length;t>=0&&i.setValue(e[t])}},"gui_left_cycle"),this.canvas.add_keyboard_callabck(pt.t.KEY_CYCLE_RIGHT,t=>{if(_t(t.event,!0,!1,!1)){let t=s.getValue()-.3;t<0&&(t=1),s.setValue(t)}else if(_t(t.event,!1,!1,!1)){let t=(e.indexOf(n.getValue())+1)%e.length;t>=0&&n.setValue(e[t])}},"gui_right_cycle")}get_surface_ctype(){const t=this.gui.get_controller("Surface Color");return t.isfake?"none":t.getValue()}set_surface_ctype(t,e,i){if(!this._surface_ctype_map)return;if(void 0===t)return;let n,r=t;!0===t&&(r=this._current_surface_ctype),r||(r="vertices"),this._current_surface_ctype=r,void 0===e&&(n=this.gui.get_controller("Sigma"),e=n.isfake?3:n.getValue()),void 0===i&&(n=this.gui.get_controller("Blend Factor"),i=n.isfake?.4:n.getValue());let s=this._surface_ctype_map[r];void 0===s&&(s=pt.t.VERTEX_COLOR,this._current_surface_ctype="vertices");this.canvas.threebrain_instances.forEach(t=>{if(t.isFreeMesh&&t._material_options&&(t._material_options.which_map.value=s,t._material_options.blend_factor.value=i,t.object.visible&&s===pt.t.VOXEL_COLOR)){const i=this.current_voxel_type();i?t._set_color_from_datacube2(i,e):t._material_options.which_map.value=pt.t.DEFAULT_COLOR}}),this._update_canvas(),this.fire_change({surface_color_type:this._current_surface_ctype})}c_surface_color(){const t=pt.t.FOLDERS["surface-selector"],e={vertices:pt.t.VERTEX_COLOR,"sync from voxels":pt.t.VOXEL_COLOR,"sync from electrodes":pt.t.ELECTRODE_COLOR,none:pt.t.DEFAULT_COLOR},i=Object.keys(e);this._surface_ctype_map=e;this.gui.add_item("Surface Color","vertices",{args:i,folder_name:t}).onChange(e=>{this.gui.hide_item(["Blend Factor","Sigma"],t),this.canvas.__hide_voxels=!1,this.set_surface_ctype(e),"none"!==this._current_surface_ctype&&this.gui.show_item(["Blend Factor"],t),"sync from voxels"===this._current_surface_ctype&&(this.gui.show_item(["Sigma"],t),this.canvas.__hide_voxels=!0),this._update_canvas()}),this.canvas.add_keyboard_callabck(pt.t.KEY_CYCLE_SURFACE_COLOR,t=>{if(_t(t.event,!1,!1,!1)){const t=this.gui.get_controller("Surface Color");let e=(i.indexOf(t.getValue())+1)%i.length;e>=0&&t.setValue(i[e])}},"gui_surf_color_type"),this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_CYCLE_SURFACE_COLOR,"Surface Color",t);this.gui.add_item("Blend Factor",.4,{folder_name:t}).min(0).max(1).onChange(t=>{"number"!=typeof t?t=.4:t<0?t=0:t>1&&(t=1),this.set_surface_ctype(!0,void 0,t),this._update_canvas()}),this.gui.add_item("Sigma",3,{folder_name:t}).min(0).max(10).onChange(t=>{void 0!==t&&(t<0&&(t=0),this.set_surface_ctype(!0,t),this._update_canvas())});this.gui.hide_item(["Sigma"],t)}set_electrodes_visibility(t){return!!this._controller_electrodes&&(this._ani_status&&this._ani_status.setValue(!1),this.canvas.subject_codes.forEach((e,i)=>{(0,dt.AA)(this.canvas.electrodes.get(e)).forEach(e=>{this._electrode_visibility(e,i,t)})}),this.canvas.state_data.set("electrode_visibility",t),this._update_canvas(),this.fire_change({electrode_visibility:t}),!0)}c_electrodes(){const t=pt.t.FOLDERS["electrode-style"],e=this.settings.show_inactive_electrodes,i=["all visible","hide inactives","hidden"],n=e?"all visible":"hide inactives";this.canvas.state_data.set("electrode_visibility",n),this._electrode_visibility=(t,e,i)=>{if(!(0,ut.OK)(t))return null;switch(i){case"hidden":t.visible=!1;break;case"hide inactives":t.material.isMeshLambertMaterial?t.visible=!1:t.visible=!0;break;default:t.visible=!0}},this._controller_electrodes=this.gui.add_item("Visibility",n,{args:i,folder_name:t}).onChange(t=>{this.set_electrodes_visibility(t),this.fire_change()}),this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_CYCLE_ELEC_VISIBILITY,"Visibility",t),this.canvas.add_keyboard_callabck(pt.t.KEY_CYCLE_ELEC_VISIBILITY,t=>{if(_t(t.event,!1,!1,!1)){let t=(i.indexOf(this._controller_electrodes.getValue())+1)%i.length;t>=0&&this._controller_electrodes.setValue(i[t])}},"gui_c_electrodes")}c_map_template(){const t=pt.t.FOLDERS["electrode-mapping"],e=(this.canvas.subject_codes,this.gui.add_item("Map Electrodes",!1,{folder_name:t}).onChange(e=>{this.canvas.switch_subject("/",{map_template:e}),e?this.gui.show_item(["Surface Mapping","Volume Mapping"],t):this.gui.hide_item(["Surface Mapping","Volume Mapping"],t),this.fire_change()}));this.gui.add_item("Surface Mapping","std.141",{args:["std.141","mni305","no mapping"],folder_name:t}).onChange(t=>{this.canvas.switch_subject("/",{map_type_surface:t}),this.fire_change()}),this.gui.add_item("Volume Mapping","mni305",{args:["mni305","no mapping"],folder_name:t}).onChange(t=>{this.canvas.switch_subject("/",{map_type_volume:t}),this.fire_change()}),this.gui.hide_item(["Surface Mapping","Volume Mapping"],t),this.canvas.shared_data.get(".multiple_subjects")&&(e.setValue(!0),this.gui.open_folder(t))}set_animation_time(t){this._ani_time&&("number"!=typeof t&&(t=this.animation_time[0]),this.__current_time=t,this._ani_time.setValue(t))}get_animation_params(){return this._ani_time&&this._ani_speed&&this._ani_status?{play:this._ani_status.getValue(),time:this.__current_time||0,speed:this._ani_speed.getValue(),min:this.animation_time[0],max:this.animation_time[1],display:this._ani_name.getValue(),threshold:this._thres_name.getValue()}:{play:!1,time:0,speed:0,min:0,max:0,display:"[None]",threshold:"[None]"}}add_clip(t,e=!1){if("string"!=typeof t||this._animation_names.includes(t))return;if(!this._ani_name||!this._thres_name)return;let i=document.createElement("option");i.setAttribute("value",t),i.innerHTML=t,this._ani_name.__select.appendChild(i),i=document.createElement("option"),i.setAttribute("value",t),i.innerHTML=t,this._thres_name.__select.appendChild(i),this._animation_names.push(t),e&&setTimeout(()=>{this._ani_name.setValue(t)},100)}c_animation(){if(0===(0,dt.AA)(this.settings.color_maps).length)return!1;const t=pt.t.FOLDERS.animation;let e=Object.keys(this.settings.color_maps),i=["[None]"],n=this.settings.default_colormap;e.forEach(t=>{"Subject"===t&&e.includes("[Subject]")||i.push(t)}),this._animation_names=i,n&&i.includes(n)&&!n.startsWith("[")||(n=void 0,i.forEach(t=>{n||t.startsWith("[")||(n=t)})),n||(n="[None]"),this.canvas.animation_controls.set_time=t=>{this.set_animation_time(t)},this.canvas.animation_controls.get_params=()=>this.get_animation_params();const r=e=>{this.canvas.generate_animation_clips(e,!0,i=>{void 0===this.canvas.__min_t&&this.canvas.update_time_range(),this._ani_time.min(this.canvas.__min_t).max(this.canvas.__max_t),this.animation_time[0]=this.canvas.__min_t,this.animation_time[1]=this.canvas.__max_t,i?(this.set_animation_time(this.animation_time[0]),u.setValue(!0),this._controller_electrodes&&this.set_electrodes_visibility(this._controller_electrodes.getValue()),"continuous"===i.value_type?(o.setValue(this.__display_range_continuous||""),this.gui.show_item(["Display Range"],t)):(o.setValue(","),this.gui.hide_item(["Display Range"],t))):(u.setValue(!1),"[None]"===e&&this.canvas.electrodes.forEach(t=>{for(let e in t)t[e].visible=!0})),this._update_canvas()}),this.canvas.state_data.set("display_variable",e),this.fire_change({clip_name:e,display_data:e})},s=t=>{const e=this.canvas.color_maps.get(t);if(!e)return c.setValue(""),void this.canvas.state_data.set("threshold_active",!1);const i=this.canvas.state_data.get("threshold_type");this.canvas.state_data.get("threshold_type");this.canvas.state_data.set("threshold_active",!0),this.canvas.state_data.set("threshold_variable",t),"continuous"===e.value_type?(this.canvas.state_data.set("threshold_type","continuous"),this.gui.show_item("Threshold Method"),"continuous"!==i&&c.setValue(this.__threshold_values_continuous||"")):(this.canvas.state_data.set("threshold_type","discrete"),c.setValue(e.value_names.join("|")),this.gui.hide_item("Threshold Method"))},a=this.gui.add_item("Display Data",n,{folder_name:t,args:i}).onChange(t=>{r(t),this.fire_change(),this._update_canvas()});this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_CYCLE_ANIMATION,"Display Data",t),this._ani_name=a;const o=this.gui.add_item("Display Range","",{folder_name:t}).onChange(t=>{let e=t;if((t=t.split(",").map(t=>parseFloat(t)).filter(t=>!isNaN(t))).length>0&&(1!==t.length||0!==t[0])){let i=t[0],n=Math.abs(t[0]);1==t.length?i=-n:n=t[1],this.__display_range_continuous=e,this.canvas.switch_colormap(void 0,[i,n])}else{const t=this.canvas.switch_colormap();t&&"continuous"===t.value_type&&(this.__display_range_continuous="",this.canvas.switch_colormap(void 0,[t.value_range[0],t.value_range[1]]))}this.canvas.generate_animation_clips(a.getValue(),!0),this.fire_change(),this._update_canvas()}),l=this.gui.add_item("Threshold Data","[None]",{folder_name:t,args:i}).onChange(t=>{s(t),this.fire_change(),this._update_canvas()});this._thres_name=l;const c=this.gui.add_item("Threshold Range","",{folder_name:t}).onChange(t=>{const e="continuous"==(0,dt.jM)(this.canvas.state_data,"threshold_type","discrete");let i=t.split(/[\|,]/).map(t=>t.trim());e&&(i=i.map(t=>parseFloat(t)).filter(t=>!isNaN(t)),this.__threshold_values_continuous=t),this.canvas.state_data.set("threshold_values",i),this.fire_change(),this._update_canvas()});this.gui.add_item("Threshold Method","|v| >= T1",{folder_name:t,args:pt.t.THRESHOLD_OPERATORS}).onChange(t=>{if("continuous"==(0,dt.jM)(this.canvas.state_data,"threshold_type","discrete")){const e=pt.t.THRESHOLD_OPERATORS.indexOf(t);e>-1&&(this.canvas.state_data.set("threshold_method",e),this.fire_change(),this._update_canvas())}});this.canvas.state_data.set("threshold_method",2),this._ani_status=this.gui.add_item("Play/Pause",!1,{folder_name:t},pt.t.TOOLTIPS.KEY_TOGGLE_ANIMATION),this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_TOGGLE_ANIMATION,"Play/Pause",t),this._ani_status.onChange(t=>{t?this._update_canvas(2):this._update_canvas(-2)}),this._ani_speed=this.gui.add_item("Speed",1,{args:{"x 0.01":.01,"x 0.05":.05,"x 0.1":.1,"x 0.2":.2,"x 0.5":.5,"x 1":1,"x 2":2,"x 5":5},folder_name:t}),this.gui.add_item("Time",this.animation_time[0],{folder_name:t}).min(this.animation_time[0]).max(this.animation_time[1]).step(.001).onChange(t=>{("number"!=typeof this.__current_time||Math.abs(this.__current_time-t)>=.001)&&(this.__current_time=t),this._update_canvas()}),this._ani_time=this.gui.get_controller("Time",t),this.canvas.bind("dat_gui_ani_time_mousewheel","mousewheel",t=>{if(t.altKey){t.preventDefault();const e=this._ani_time.getValue();this._ani_time.setValue(e+.001*Math.sign(t.deltaY))}},this._ani_time.domElement),this.canvas.add_keyboard_callabck(pt.t.KEY_TOGGLE_ANIMATION,t=>{if(_t(t.event,!1,!1,!1)){const t=this._ani_status.getValue();this._ani_status.setValue(!t)}},"gui_toggle_animation"),this.canvas.add_keyboard_callabck(pt.t.KEY_CYCLE_ANIMATION,t=>{if(_t(t.event,!1,!1,!1)){let t=(i.indexOf(a.getValue())+1)%i.length;t>=0&&a.setValue(i[t])}},"gui_cycle_animation");let h=this.settings.show_legend;const u=this.gui.add_item("Show Legend",!0,{folder_name:t}).onChange(t=>{this.canvas.render_legend=t,this._update_canvas(0),this.fire_change()});let d=this.settings.render_timestamp||!1;this.gui.add_item("Show Time",d,{folder_name:t}).onChange(t=>{this.canvas.render_timestamp=t,this.fire_change({render_timestamp:t}),this._update_canvas(0)});this.canvas.render_legend=h,this.canvas.render_timestamp=d,this.fire_change({render_timestamp:d}),r(n),this.gui.open_folder(t)}c_display_highlights(){const t=pt.t.FOLDERS["highlight-selection"]||"Data Visualization";this.gui.add_item("Highlight Box",!0,{folder_name:t}).onChange(t=>{this.canvas.state_data.set("highlight_disabled",!t),this.canvas.focus_object(this.canvas.object_chosen),this.fire_change(),this._update_canvas(0)}),this.gui.add_item("Info Text",!0,{folder_name:t}).onChange(t=>{this.canvas.state_data.set("info_text_disabled",!t),this.fire_change(),this._update_canvas(0)})}update_voxel_type(){let t,e;if(this._ctl_voxel_type_options&&(t=this.gui.get_controller("Voxel Type"),!t.isfake)){let t=this.canvas.get_atlas_types();t.push("none"),this._ctl_voxel_type_options.length!==t.length?e=!0:(e=!1,this._ctl_voxel_type_options.forEach((i,n)=>{t[n]!==i&&(e=!0)})),e&&(e=this.gui.alter_item("Voxel Type",t,()=>{this._ctl_voxel_type_options=t}))}}current_voxel_type(){const t=this.canvas.state_data.get("atlas_type")||"none",e=this.canvas.state_data.get("target_subject")||"none",i=this.canvas.threebrain_instances.get(`Atlas - ${t} (${e})`);if(i&&i.isDataCube2)return i}c_voxel(){const t=pt.t.FOLDERS.atlas||"Volume Settings",e=this.canvas.global_data("__global_data__.VolumeColorLUT"),i=e.map,n=(e.mapAlpha,e.mapDataType);this._ctl_voxel_type_options=["none"],this._ctl_voxel_type_callback=t=>{t&&(this.canvas.switch_subject("/",{atlas_type:t}),this.fire_change({atlas_type:t}))},this.gui.add_item("Voxel Type","none",{args:["none"],folder_name:t}).onChange(this._ctl_voxel_type_callback),this.fire_change({atlas_type:"none",atlas_enabled:!1}),this.gui.add_tooltip(pt.t.TOOLTIPS.KEY_CYCLE_ATLAS,"Voxel Type",t),this.canvas.add_keyboard_callabck(pt.t.KEY_CYCLE_ATLAS,t=>{if(_t(t.event,!1,!1,!1)){const t=this.gui.get_controller("Voxel Type"),e=this._ctl_voxel_type_options;let i=(e.indexOf(t.getValue())+1)%e.length;i>=0&&t.setValue(e[i])}},"gui_atlas_type");this.gui.add_item("Voxel Opacity",0,{folder_name:t}).min(0).max(1).step(.01).onChange(t=>{const e=this.current_voxel_type(),i=t<.001?-1:t;e&&e.isDataCube2&&(e.object.material.uniforms.alpha.value=i,i<0&&(e._set_palette(),e.object.material.uniforms.cmap.value.needsUpdate=!0)),this._update_canvas(),this.fire_change({atlas_alpha:i})});if("continuous"===n){const n=Object.values(i),r=(0,dt.AA)(e.mapValueRange),s=(t,e)=>{const i=this.current_voxel_type();i&&i.isDataCube2&&new Promise(()=>{let r;const s=n.filter(i=>(r=parseFloat(i.Label),!isNaN(r)&&(r>=t&&r<=e))).map(t=>t.ColorID);i._set_palette(s),i.object.material.uniforms.cmap.value.needsUpdate=!0,this._update_canvas()})};if(n.length>0){let e=r[0],i=r[1];this.gui.add_item("Voxel Min",e,{folder_name:t}).min(e).max(i).step((i-e)/n.length).onChange(t=>{e=t,s(e,i)}),this.gui.add_item("Voxel Max",i,{folder_name:t}).min(e).max(i).step((i-e)/n.length).onChange(t=>{i=t,s(e,i)})}}else{this.gui.add_item("Voxel Label","0",{folder_name:t}).onChange(t=>{const e=this.current_voxel_type();e&&e.isDataCube2&&new Promise(()=>{const i=t.split(",").map(t=>parseInt(t)).filter(t=>!isNaN(t));e._set_palette(i),e.object.material.uniforms.cmap.value.needsUpdate=!0,this._update_canvas()})})}}c_electrode_localization(t="Electrode Localization (Beta)"){this.canvas.electrodes.set("__localization__",[]);const e=t=>{let e=i(t);if(e){a.setValue(e.position.x),o.setValue(e.position.y),l.setValue(e.position.z);let t=!0===e.userData.construct_params.is_surface_electrode;s.setValue(t?"Surface":"Depth"),this.canvas.focus_object(e)}else a.setValue(0),o.setValue(0),l.setValue(0)},i=t=>{const e=this.canvas.electrodes.get("__localization__");if(e)return e[`__localization__, ${void 0===t?Math.max(1,Math.round(r.getValue())):t} - `]},n=this.gui.add_item("Editing Mode","disabled",{folder_name:t,args:["disabled","new electrodes","modification"]}).onChange(e=>{this.canvas.edit_mode="disabled"!==e,this.edit_mode=e,this.gui.hide_item(["Remove Electrode","Number","Sub Label","Position-[R]","Position-[A]","Position-[S]","Group Label","Electrode type"],t),"new electrodes"===e?(this.gui.show_item(["Number","Electrode type"],t),u()):"modification"===e&&this.gui.show_item(["Remove Electrode","Sub Label","Position-[R]","Position-[A]","Position-[S]","Group Label"],t)}),r=this.gui.add_item("Number",1,{folder_name:t}).min(1).step(1).onChange(t=>{this.canvas.edit_mode&&(t=Math.max(Math.round(t),1),e(t),this._update_canvas(),this.shiny.loc_electrode_info(!0))}),s=this.gui.add_item("Electrode type","Surface",{folder_name:t,args:["Surface","Depth"]}).onChange(t=>{if(this.canvas.edit_mode){let e=i();e&&(e.userData.construct_params.is_surface_electrode="Surface"===t),"Depth"===t?(this.gui.get_controller("Overlay Coronal","Volume Settings").setValue(!0),this.gui.get_controller("Overlay Axial","Volume Settings").setValue(!0),this.gui.get_controller("Overlay Sagittal","Volume Settings").setValue(!0),this.gui.get_controller("Left Hemisphere","Geometry").setValue("hidden"),this.gui.get_controller("Right Hemisphere","Geometry").setValue("hidden")):"Surface"===t&&(this.gui.get_controller("Left Hemisphere","Geometry").setValue("normal"),this.gui.get_controller("Right Hemisphere","Geometry").setValue("normal"))}}),a=this.gui.add_item("Position-[R]",0,{folder_name:t}).min(-128).max(128).step(.01).onChange(t=>{if(!0!==this.canvas.edit_mode)return null;const e=i();e&&(e.position.x=t,e.userData.construct_params.position[0]=t,e.userData.construct_params.vertex_number=-1,e.userData.construct_params._distance_to_surf=-1,e.userData.construct_params.hemisphere="NA",this.shiny.loc_electrode_info(!0)),this._update_canvas()}),o=this.gui.add_item("Position-[A]",0,{folder_name:t}).min(-128).max(128).step(.01).onChange(t=>{if(!0!==this.canvas.edit_mode)return null;const e=i();e&&(e.position.y=t,e.userData.construct_params.position[1]=t,e.userData.construct_params.vertex_number=-1,e.userData.construct_params._distance_to_surf=-1,e.userData.construct_params.hemisphere="NA",this.shiny.loc_electrode_info(!0)),this._update_canvas()}),l=this.gui.add_item("Position-[S]",0,{folder_name:t}).min(-128).max(128).step(.01).onChange(t=>{if(!0!==this.canvas.edit_mode)return null;const e=i();e&&(e.position.z=t,e.userData.construct_params.position[2]=t,e.userData.construct_params.vertex_number=-1,e.userData.construct_params._distance_to_surf=-1,e.userData.construct_params.hemisphere="NA",this.shiny.loc_electrode_info(!0)),this._update_canvas()}),c=this.gui.add_item("Group Label","",{folder_name:t}).onChange(t=>{h.setValue(0)}),h=this.gui.add_item("Sub Label",0,{folder_name:t}).min(0).step(1),u=()=>{let t=1;(0,dt.AA)(this.canvas.electrodes.get("__localization__")).forEach(e=>{let i=e.userData.electrode_number||1;t<=i&&(t=i+1)}),r.setValue(t),this._update_canvas()};this.gui.hide_item(["Remove Electrode","Number","Position","Sub Label","Position-[R]","Position-[A]","Position-[S]","Group Label","Electrode type"],t),this.canvas.add_mouse_callback(t=>"click"===t.action&&this.canvas.group.has("__electrode_editor__")?{pass:!0,type:this.canvas.group.get("__electrode_editor__").children}:{pass:!1},(t,e)=>{if(!t.target_object)return null;if(this.canvas.focus_object(t.target_object),this._update_canvas(),"modification"===this.edit_mode){const e=t.target_object.userData.electrode_number||0;e>0&&r.setValue(e)}},"electrode_editor_focus"),this.canvas.add_mouse_callback(t=>{if("dblclick"===t.action&&"new electrodes"===this.edit_mode){const t="Surface"===s.getValue(),e=this.canvas.state_data.get("target_subject");if(!e)return{pass:!1};let i,n,r,a=[];if(t){let t=this.canvas.surfaces.get(e);if(n=`FreeSurfer Left Hemisphere - pial-outer-smoothed (${e})`,r=`FreeSurfer Right Hemisphere - pial-outer-smoothed (${e})`,t.hasOwnProperty(n)||(n=`Standard 141 Left Hemisphere - pial-outer-smoothed (${e})`,r=`Standard 141 Right Hemisphere - pial-outer-smoothed (${e})`),t.hasOwnProperty(n)&&t.hasOwnProperty(r)&&!t[n].visible){const s=this.gui.get_controller("Left Hemisphere");s&&s.getValue&&"hidden"===s.getValue()||(t[n].visible=!0);const a=this.gui.get_controller("Right Hemisphere");a&&a.getValue&&"hidden"===a.getValue()||(t[r].visible=!0),i={lh_name:n,rh_name:r,current_subject:e}}else n=void 0,r=void 0;a=(0,dt.AA)(this.canvas.surfaces.get(e))}else a=(0,dt.AA)((0,dt.jM)(this.canvas.volumes,e,{})[`T1 (${e})`]);return{pass:!0,type:a,meta:i}}return{pass:!1}},(t,e)=>{if(t.meta&&t.meta.current_subject){let e=this.canvas.surfaces.get(t.meta.current_subject);t.meta.lh_name&&(e[t.meta.lh_name].visible=!1,e[t.meta.rh_name].visible=!1)}if(t.first_item){let e=Math.max(1,Math.round(r.getValue())),i="",n=t.first_item.point.toArray(),a="Surface"===s.getValue();const o=(0,dt.jM)(this.canvas.state_data,"surface_type","pial");(0,ut.C6)(this.canvas,e,`__localization__, ${e} - `,n,o,i,a,1),u()}this.shiny.loc_electrode_info(),this._update_canvas()},"electrode_editor_add_electrodes"),this.canvas.add_mouse_callback(t=>"dblclick"===t.action&&"modification"===this.edit_mode&&this.canvas.group.has("__electrode_editor__")?{pass:!0,type:this.canvas.group.get("__electrode_editor__").children}:{pass:!1},(t,e)=>{if(!t.target_object)return null;const i=c.getValue(),n=h.getValue()+1;t.target_object.userData.construct_params.custom_info=i+n,h.setValue(n),this.shiny.loc_electrode_info(),this._update_canvas()},"electrode_editor_labels"),this.canvas.add_keyboard_callabck(pt.t.KEY_CYCLE_REMOVE_EDITOR,t=>{if(this.canvas.edit_mode&&_t(t.event,!0,!1,!1)){const t=i();if(t&&t.userData.construct_params.is_electrode){t.parent.remove(t);delete this.canvas.electrodes.get("__localization__")[t.userData.construct_params.name],this.shiny.loc_electrode_info(),this._update_canvas()}}}),this.canvas.add_keyboard_callabck(pt.t.KEY_CYCLE_ELEC_EDITOR,t=>{if(this.canvas.edit_mode){let e=-1;_t(t.event,!0,!1,!1)&&(e=1);let i=Math.round(r.getValue()+e);i=Math.max(1,i),r.setValue(i),this._update_canvas()}},"edit-gui_cycle_electrodes"),this.canvas.add_keyboard_callabck(pt.t.KEY_CYCLE_SURFTYPE_EDITOR,t=>{if(this.canvas.edit_mode){const t="Surface"===s.getValue();s.setValue(t?"Depth":"Surface"),this._update_canvas()}},"edit-gui_cycle_surftype"),this.canvas.add_keyboard_callabck(pt.t.KEY_NEW_ELECTRODE_EDITOR,t=>{this.canvas.edit_mode&&u()},"edit-gui_new_electrodes"),this.gui.folders.Default.close(),this.gui.folders["Volume Settings"].close(),this.gui.folders[t].open(),n.setValue("new electrodes"),this._has_localization=!0}c_export_electrodes(t="Default"){this.gui.add_item("Download Electrodes",()=>{this.canvas.download_electrodes("csv")})}c_ct_visibility(){this.gui.add_item("Align CT to T1",!1,{folder_name:"CT Overlay"}).onChange(t=>{this.canvas._show_ct=t,this.canvas.switch_subject()});const t=this.gui.add_item("CT threshold",.8,{folder_name:"CT Overlay"}).min(.3).max(1).step(.01).onChange(t=>{this.canvas.switch_subject("/",{ct_threshold:t})}),e=this.gui.add_item("Number of Elecs",100,{folder_name:"CT Overlay"}).min(1).step(1);this.gui.add_item("Guess Electrodes",()=>{const i=255*t.getValue(),n=Math.ceil(e.getValue()),r=this.canvas.state_data.get("target_subject")||"",s=this.canvas.mesh.get(`ct.aligned.t1 (${r})`);if(!s||"datacube2"!==s.userData.construct_params.type)return alert(`Cannot find aligned CT (${r})`),null;this.shiny.to_shiny({threshold:i,current_subject:r,n_electrodes:n},"ct_threshold",!0)},{folder_name:"CT Overlay"}),this.gui.folders["CT Overlay"].open()}}class yt{constructor(t={},e=!1){this.params={},this.folders={},this.ctrls={},this._gui=new ht(t);const i=t=>{"function"==typeof this.__on_closed&&this.__on_closed(t)};this._gui.__closeButton.addEventListener("click",i),this.dispose=()=>{this._gui.__closeButton.removeEventListener("click",i)},this.domElement=this._gui.domElement,this.DEBUG=e,this.add_folder("Default"),this.open_folder("Default")}set closed(t){this._gui.closed=t}get closed(){return this._gui.closed}close(){this._gui.close(),"function"==typeof this.__on_closed&&this.__on_closed(!0)}open(){this._gui.open(),"function"==typeof this.__on_closed&&this.__on_closed(!1)}set_closeHandler(t){"function"==typeof t&&(this.__on_closed=t)}remember(t){const e=(0,dt.nr)(t);["Background Color","Camera Position","Display Coordinates","Show Panels","Coronal (P - A)","Axial (I - S)","Sagittal (L - R)","Overlay Coronal","Overlay Axial","Overlay Sagittal","Dist. Threshold","Surface Type","Surface Material","Left Hemisphere","Right Hemisphere","Left Opacity","Right Opacity","Map Electrodes","Surface Mapping","Volume Mapping","Visibility","Display Data","Display Range","Threshold Data","Threshold Range","Threshold Method","Show Legend","Show Time","Highlight Box","Info Text","Voxel Type","Voxel Label","Voxel Opacity","Voxel Min","Voxel Max","Surface Color","Blend Factor","Sigma"].forEach(t=>{void 0!==e[t]&&(console.debug("Setting "+t),this.get_controller(t).setValue(e[t]))})}add_folder(t){return void 0===this.folders[t]&&(this.folders[t]=this._gui.addFolder(t)),this.folders[t]}open_folder(t){void 0!==this.folders[t]&&this.folders[t].open()}close_folder(t){void 0!==this.folders[t]&&this.folders[t].close()}get_controller(t,e="Default"){let i=e,n=this.folders[i];if(n&&n.__controllers)for(let e in n.__controllers)if(n.__controllers[e].property===t)return n.__controllers[e];if("Default"===e&&"string"==typeof this.ctrls[t]&&(i=this.ctrls[t],n=this.folders[i],n&&n.__controllers))for(let e in n.__controllers)if(n.__controllers[e].property===t)return n.__controllers[e];const r={onChange:t=>{},setValue:t=>{},isfake:!0};return r}hide_item(t,e="Default"){(0,dt.AA)(t).forEach(t=>{let i=this.get_controller(t,e);i.__li&&(i.__li.style.display="none")})}show_item(t,e="Default"){(0,dt.AA)(t).forEach(t=>{let i=this.get_controller(t,e);i.__li&&(i.__li.style.display="block")})}add_item(t,e,i={},n=null){let r=i.folder_name||"Default",s=i.args,a=i.is_color||!1;if(void 0!==this.params[t])return;this.params[t]=e;let o,l=this.add_folder(r);return this.ctrls[t]=r,o=a?l.addColor(this.params,t):s?l.add(this.params,t,s):l.add(this.params,t),o}alter_item(t,e,i=null,n="Default"){let r=this.get_controller(t,n);if(r.getValue&&r.options){console.debug("Altering controller: "+t);const s=r.getValue(),a=(0,dt.AA)(e),o=r.__onChange;return!a.includes(s)&&a.length>0&&(s=a[0]),r.options(e),r=this.get_controller(t,n),r.__onChange=void 0,r.setValue(s),r.__onChange=o,"function"==typeof i&&i(),!0}return!1}add_tooltip(t,e,i){const n=this.get_controller(e,i);n.__li&&n.__li.setAttribute("viewer-tooltip",t)}}},3121:(t,e,i)=>{"use strict";function n(t,e,i){var n,r,s,a=window,o="application/octet-stream",l=i||o,c=t,h=document,u=h.createElement("a"),d=function(t){return String(t)},p=a.Blob||a.MozBlob||a.WebKitBlob||d,f=a.MSBlobBuilder||a.WebKitBlobBuilder||a.BlobBuilder,m=e||"download";if("true"===String(this)&&(l=(c=[c,l])[0],c=c[1]),String(c).match(/^data\:[\w+\-]+\/[\w+\-]+[,;]/))return navigator.msSaveBlob?navigator.msSaveBlob(function(t){var e=t.split(/[:;,]/),i=e[1],n=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),r=n.length,s=0,a=new Uint8Array(r);for(;s<r;++s)a[s]=n.charCodeAt(s);return new p([a],{type:i})}(c),m):g(c);try{n=c instanceof p?c:new p([c],{type:l})}catch(t){f&&((r=new f).append([c]),n=r.getBlob(l))}function g(t,e){if("download"in u)return u.href=t,u.setAttribute("download",m),u.innerHTML="downloading...",h.body.appendChild(u),setTimeout((function(){u.click(),h.body.removeChild(u),!0===e&&setTimeout((function(){a.URL.revokeObjectURL(u.href)}),250)}),66),!0;var i=h.createElement("iframe");h.body.appendChild(i),e||(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,o)),i.src=t,setTimeout((function(){h.body.removeChild(i)}),333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(n,m);if(a.URL)g(a.URL.createObjectURL(n),!0);else{if("string"==typeof n||n.constructor===d)try{return g("data:"+l+";base64,"+a.btoa(n))}catch(t){return g("data:"+l+","+encodeURIComponent(n))}(s=new FileReader).onload=function(t){g(this.result)},s.readAsDataURL(n)}return!0}i.d(e,{L:()=>n})},470:(t,e,i)=>{"use strict";i.d(e,{j:()=>s});var n=i(3658),r=i(975);class s{constructor(t,e){this._params=t,this._canvas=e,this.type="AbstractThreeBrainObject",this.isThreeBrainObject=!0,this.name=t.name,t.group&&"object"==typeof t.group&&(this.group_name=t.group.group_name),this.subject_code=t.subject_code||"",e.threebrain_instances.set(this.name,this),this.clickable=!0===t.clickable,this.world_position=new THREE.Vector3}set_layer(t=[],e=null){let i=e||this.object;if(i){let e=(0,n.AA)(this._params.layer),s=(0,n.AA)(t);!0===this._params.clickable&&e.push(r.t.LAYER_SYS_RAYCASTER_14),e.concat(s),i.layers.set(31),e.length>1?e.forEach(t=>{i.layers.enable(t),console.debug(this.name+" is enabled layer "+t)}):0===e.length||e[0]>20?(this.DEBUG&&console.debug(this.name+" is set invisible."),i.layers.set(r.t.LAYER_USER_ALL_CAMERA_1),i.visible=!1):i.layers.set(e[0])}}warn(t){console.warn(this._name+" "+t)}get_world_position(t){return t&&this._last_rendered===t.elapsed_time||(this.object&&this.object.getWorldPosition(this.world_position),t&&(this._last_rendered=t.elapsed_time)),this.world_position}dispose(){this.warn("method dispose() not implemented...")}get_track_data(t,e){this.warn("method get_track_data(track_name, reset_material) not implemented...")}pre_render(t){this.get_world_position(t),this._last_rendered=t.elapsed_time}add_track_data(t,e,i,n=0){}get_group_object(){return this._canvas.group.get(this.group_name)}register_object(t){(0,n.AA)(t).forEach(t=>{(0,n.jM)(this._canvas[t],this.subject_code,{})[this.name]=this.object})}finish_init(){this.object&&(console.debug("Finalizing "+this.name),this.set_layer(),this.object.userData.construct_params=this._params,this._canvas.mesh.set(this.name,this.object),this.clickable&&this._canvas.add_clickable(this.name,this.object),this.group_name?this.get_group_object().add(this.object):this._canvas.add_to_scene(this.object),this.object.isMesh&&this.object.updateMatrixWorld(),this.object.isObject3D&&(this.object.userData.instance=this,this.object.userData.pre_render=t=>this.pre_render(t),this.object.userData.dispose=()=>{this.dispose()},this.object.renderOrder=r.t.RENDER_ORDER[this.type]||0))}}},960:(t,e,i)=>{"use strict";i.d(e,{Lk:()=>c,C6:()=>h,OK:()=>u});var n=i(470),r=i(178),s=i(3658),a=i(975);const o={transparent:!1};class l extends n.j{constructor(t,e){super(t,e),this.type="Sphere",this.isSphere=!0,this._materials={MeshBasicMaterial:new r.J.MeshBasicMaterial(o),MeshLambertMaterial:new r.J.MeshLambertMaterial(o)};const i=new r.J.SphereBufferGeometry(t.radius,t.width_segments,t.height_segments),n=t.keyframes,a=(0,s.AA)(t.keyframes).length;this._geometry=i,i.name="geom_sphere_"+t.name,this._material_type=a>0?"MeshBasicMaterial":"MeshLambertMaterial";const l=new r.J.Mesh(i,this._materials[this._material_type]);l.name="mesh_sphere_"+t.name;let c=!1;if(t.use_link){let i=Math.floor(t.vertex_number-1),n=t.linked_geom,r=e.mesh.get(n);if(r&&r.isMesh){let t=r.geometry.attributes.position.array;l.position.set(t[3*i],t[3*i+1],t[3*i+2]),c=!0}}c||l.position.fromArray(t.position),a>0&&(l.userData.ani_exists=!0),l.userData.ani_active=!1,l.userData.ani_params={...n},l.userData.ani_name="default",l.userData.ani_all_names=Object.keys(l.userData.ani_params),l.userData.display_info={},this._mesh=l,this.object=l,this._link_userData()}_link_userData(){this._mesh.userData.add_track_data=(t,e,i,n=0)=>this.add_track_data(t,e,i,n),this._mesh.userData.get_track_data=(t,e)=>this.get_track_data(t,e),this._mesh.userData.pre_render=t=>this.pre_render(t),this._mesh.userData.dispose=()=>{this.dispose()}}_get_animation_params(){return this._canvas.animation_controls.get_params()}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}pre_render(t){super.pre_render(t);const e=this._canvas,i=this._mesh,n=i.userData.construct_params.position;if(u(i)&&0===n[0]&&0===n[1]&&0===n[2])return void(i.visible=!1);let r,o=!0;const l=e.state_data.get("threshold_variable");if((0,s.jM)(e.state_data,"threshold_active",!1)){o=!1;const t=this.get_track_data(l,!1);if(t){if(Array.isArray(t.time)&&t.time.length>1&&Array.isArray(t.value)){const e=this._get_animation_params();for(let i in t.time)if(t.time[i]>=e.time){r=t.value[i];break}}else r=Array.isArray(t.value)?t.value[0]:t.value;if(void 0!==r){const t=(0,s.AA)(e.state_data.get("threshold_values")),i=e.state_data.get("threshold_method");if("continuous"===(0,s.jM)(e.state_data,"threshold_type","continuous"))if(o=!1,t.length>0&&i>=0&&i<a.t.THRESHOLD_OPERATORS.length){const e=a.t.THRESHOLD_OPERATORS[i];let n=t[0];if("v = T1"===e&&r==n)o=!0;else if("|v| < T1"===e&&Math.abs(r)<n)o=!0;else if("|v| >= T1"===e&&Math.abs(r)>=n)o=!0;else if("v < T1"===e&&r<n)o=!0;else if("v >= T1"===e&&r>=n)o=!0;else{let i=Math.abs(n);1===t.length?n=-i:(i=t[1],n>i&&(i=n,n=t[1])),("v in [T1, T2]"===e&&r<=i&&r>=n||"v not in [T1,T2]"===e&&(r>i||r<n))&&(o=!0)}}else o=!0;else o=t.includes(r)}}}let c=o&i.userData.ani_active;c&&i.material.isMeshLambertMaterial?i.material=this._materials.MeshBasicMaterial:!c&&i.material.isMeshBasicMaterial&&(i.material=this._materials.MeshLambertMaterial);switch((0,s.jM)(e.state_data,"electrode_visibility","all visible")){case"all visible":i.visible=!0;break;case"hidden":i.visible=!1;break;case"hide inactives":i.visible=!!c}i.userData.ani_mixer&&i.userData.ani_mixer.update(t.current_time_delta-i.userData.ani_mixer.time),i===e.object_chosen&&(i.userData.display_info.threshold_name=l,i.userData.display_info.threshold_value=r,i.userData.display_info.display_name=e.state_data.get("display_variable")||"[None]")}switch_material(t,e=!1){if(t in this._materials){const i=this._materials[t];this._material_type=t,this._mesh.material=i,this._mesh.material.needsUpdate=!0,e&&this._canvas.start_animation(0)}}add_track_data(t,e,i,n=0){let r=i,s=i;if(Array.isArray(n)){if(!Array.isArray(i)||n.length!==i.length)return;r=i[0]}else Array.isArray(i)&&(r=i[0],s=r);e||(e="number"==typeof r?"continuous":"discrete"),this._mesh.userData.ani_exists=!0,this._mesh.userData.ani_params[t]={name:t,time:n,value:i,data_type:e,target:".material.color",cached:!1},Array.isArray(this._mesh.userData.ani_all_names)||(this._mesh.userData.ani_all_names=[]),this._mesh.userData.ani_all_names.includes(t)||this._mesh.userData.ani_all_names.push(t)}get_track_data(t,e){let i;return this._mesh.userData.ani_exists&&(void 0===t&&(t=this._mesh.userData.ani_name),i=this._mesh.userData.ani_params[t]),e&&(i&&null!==i.value?(this._mesh.material=this._materials.MeshBasicMaterial,this._mesh.userData.ani_active=!0):(this._mesh.material=this._materials.MeshLambertMaterial,this._mesh.userData.ani_active=!1)),i}finish_init(){if(super.finish_init(),u(this.object)){const t=this._params,e=this.subject_code;this.register_object(["electrodes"]),this._canvas.add_clickable(this.name,this.object);let i=this.get_group_object().position.clone();if((!t.vertex_number||t.vertex_number<0||!t.hemisphere||!["left","right"].includes(t.hemisphere))&&t.is_surface_electrode){const n=t.surface_type,s=this.group.get(`Surface - ${n} (${e})`);if(s&&s.userData){const a=s.userData.group_data[`free_vertices_Standard 141 Left Hemisphere - ${n} (${e})`],o=s.userData.group_data[`free_vertices_Standard 141 Right Hemisphere - ${n} (${e})`],l=s.getWorldPosition(i);if(a&&o){let e=new r.J.Vector3,i=-1,n=1/0,s="",c=0;a.forEach((t,r)=>{c=e.fromArray(t).add(l).distanceToSquared(this.object.position),c<n&&(n=c,i=r,s="left")}),o.forEach((t,r)=>{c=e.fromArray(t).add(l).distanceToSquared(this.object.position),c<n&&(n=c,i=r,s="right")}),i>=0&&(t.vertex_number=i,t.hemisphere=s),console.log(`Electrode ${this.object.name}: ${i}, ${s}`)}}}}}}function c(t,e){return new l(t,e)}function h(t,e,i,n,a="NA",o="",l=!1,c=2,h=[1,1,0],u="__electrode_editor__",d="__localization__"){let p;"__localization__"===d&&(i=`__localization__, ${e} - `),t.group.has(u)||t.add_group({name:u,layer:0,position:[0,0,0],disable_trans_mat:!1,group_data:null,parent_group:null,subject_code:d,trans_mat:null});try{p=t.electrodes.get(d)[i],p.parent.remove(p)}catch(t){}const f={name:i,type:"sphere",time_stamp:[],position:n,value:null,clickable:!0,layer:0,group:{group_name:u,group_layer:0,group_position:[0,0,0]},use_cache:!1,custom_info:o,subject_code:d,radius:c,width_segments:10,height_segments:6,is_electrode:!0,is_surface_electrode:l,use_template:!1,surface_type:a,hemisphere:null,vertex_number:-1,sub_cortical:!0,search_geoms:null};if("__localization__"===d){const e=t.state_data.get("target_subject"),i=t.group.get(`Surface - ${a} (${e})`),o=new r.J.Vector3,l=new r.J.Vector3;if(l.fromArray(n),i&&i.userData){let t=i.userData.group_data[`free_vertices_Standard 141 Left Hemisphere - ${a} (${e})`],n=i.userData.group_data[`free_vertices_Standard 141 Right Hemisphere - ${a} (${e})`],s=!0;t&&n||(s=!1,t=i.userData.group_data[`free_vertices_FreeSurfer Left Hemisphere - ${a} (${e})`],n=i.userData.group_data[`free_vertices_FreeSurfer Right Hemisphere - ${a} (${e})`]);const c=i.getWorldPosition(o);if(t&&n){let e=new r.J.Vector3,i=-1,a=1/0,o="",h=0;t.forEach((t,n)=>{h=e.fromArray(t).add(c).distanceToSquared(l),h<a&&(a=h,i=n,o="left")}),n.forEach((t,n)=>{h=e.fromArray(t).add(c).distanceToSquared(l),h<a&&(a=h,i=n,o="right")}),i>=0&&(s?(f.vertex_number=i,f.hemisphere=o,f._distance_to_surf=Math.sqrt(a)):(f.vertex_number=-1,f.hemisphere=o,f._distance_to_surf=Math.sqrt(a)))}}const c=new r.J.Matrix4,h=new r.J.Vector3,u=(0,s.jM)(t.shared_data,e,{}).vox2vox_MNI305;u&&(c.set(u[0][0],u[0][1],u[0][2],u[0][3],u[1][0],u[1][1],u[1][2],u[1][3],u[2][0],u[2][1],u[2][2],u[2][3],u[3][0],u[3][1],u[3][2],u[3][3]),h.fromArray(n).applyMatrix4(c),f.MNI305_position=h.toArray())}return t.add_object(f),p=t.electrodes.get(d)[i],p.userData.electrode_number=e,"__localization__"===d&&p.material.color.setRGB(h[0],h[1],h[2]),p}function u(t){return!!(t&&t.isMesh&&t.userData.construct_params&&t.userData.construct_params.is_electrode)}},8173:(t,e,i)=>{"use strict";i.d(e,{P:()=>o});var n=i(3658),r=i(178),s=i(960),a=i(975);class o{constructor(t,e,i=!0){this.outputId=t,this.shiny_mode=i,this.shinyId=t+"__shiny",this.canvas=e,this.uuid=r.J.Math.generateUUID(),this.stack=[],this._do_send=(0,n.Ds)(()=>{if(this.shiny_mode&&this.stack.length>0){const t=this.stack.pop();Shiny.onInputChange(t[".__callback_id__."],t)}this.stack.length=0},200,!1),this.shiny_mode&&this.register_shiny(),this.canvas.bind("camera_parameters","end",t=>{this.to_shiny2("main_camera",{position:e.main_camera.position,zoom:e.main_camera.zoom,up:e.main_camera.up})},this.canvas.controls);const s=new r.J.Vector3;this.canvas.add_mouse_callback(t=>({pass:"click"===t.action||"dblclick"===t.action,type:"clickable"}),(t,e)=>{const i=t.target_object;if(i&&i.userData){const t=i.userData.construct_params;i.getWorldPosition(s);const n=t.group?t.group.group_name:null,r={object:t,name:t.name,geom_type:t.type,group:n,position:s.toArray(),action:e.action,meta:e,edit_mode:this.canvas.edit_mode,is_electrode:!1,current_time:0,time_range:[0,0]};if(this.canvas.state_data.has("color_map")){const t=this.canvas.state_data.get("color_map");r.color_map=this.canvas.color_maps.get(t)}if(this.gui){let t=this.gui.get_controller("Display Data",a.t.FOLDERS.animation);t&&t.getValue&&(r.current_clip=t.getValue()),t=this.gui.get_controller("Time",a.t.FOLDERS.animation),t&&t.getValue&&(r.current_time=t.getValue(),r.time_range=[t.__min,t.__max])}if(t.is_electrode){const e=a.t.REGEXP_ELECTRODE.exec(t.name);4===e.length&&(r.subject=e[1],r.electrode_number=parseInt(e[2]),r.is_electrode=!0)}"click"===e.action?this.to_shiny2("mouse_clicked",r,"event"):this.to_shiny2("mouse_dblclicked",r,"event")}},"click-electrodes-callbacks")}register_gui(t,e){this.gui=t,this.presets=e,this.shiny_mode&&Shiny.addCustomMessageHandler("threeBrain-RtoJS-"+this.outputId,t=>{const e=t.name,i=t.value,n="handle_"+e;"function"==typeof this[n]&&this[n](i)})}set_token(t){(function(t){try{var e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}})("localStorage")&&"string"==typeof t&&(this.token=t)}handle_background(t){this.gui.get_controller("Background Color",a.t.FOLDERS["background-color"]).setValue(t)}handle_zoom_level(t){this.canvas.main_camera.zoom=t,this.canvas.main_camera.updateProjectionMatrix(),this.canvas.start_animation(0)}handle_camera(t={position:[500,0,0],up:[0,0,1]}){const e=(0,n.AA)(t.position),i=(0,n.AA)(t.up);3===e.length&&this.canvas.main_camera.position.set(e[0],e[1],e[2]),3===i.length&&this.canvas.main_camera.up.set(i[0],i[1],i[2]),this.canvas.main_camera.updateProjectionMatrix(),this.canvas.start_animation(0)}handle_display_data(t={variable:"",range:[]}){const e=t.variable,i=(0,n.AA)(t.range);"string"==typeof e&&""!==e&&this.gui.get_controller("Display Data",a.t.FOLDERS.animation).setValue(e),2===i.length&&this.gui.get_controller("Display Range",a.t.FOLDERS.animation).setValue(`${i[0].toPrecision(5)},${i[1].toPrecision(5)}`),this.canvas.start_animation(0)}handle_font_magnification(t=1){this.canvas.set_font_size(t),this.canvas.start_animation(0)}handle_controllers(t){for(let e in t)this.gui.get_controller(e).setValue(t[e])}handle_focused_electrode(t){let e=t.subject_code||"";e=e.trim();const i=`${e}, ${parseInt(t.electrode||0)} `;let n=Object.keys(this.canvas.electrodes.get(e)||{}).filter(t=>t.startsWith(i));if(n.length>0){n=n[0];let t=this.canvas.electrodes.get(e)[n];(0,s.OK)(t)&&(this.canvas.focus_object(t),this.canvas.start_animation(0))}}handle_add_clip(t){const e=t.clip_name,i=t.target,r=t.data_type,s=t.value,a=t.time||0,o=t.value_names||[""],l=t.value_range||[0,1],c=t.time_range||[0,0],h=(0,n.AA)(t.color_keys),u=(0,n.AA)(t.color_vals),d=t.n_levels,p=t.focus||!1,f=t.alias;if("string"!=typeof i)return;const m=this.canvas.mesh.get(i);m&&"function"==typeof m.userData.add_track_data&&(m.userData.add_track_data(e,r,s,a),2==c.length&&(c[1]+=1),this.canvas.add_colormap(e,f,r,o,l,c,h,u,d),this.presets.add_clip(e,p))}collect_electrode_info(t="__localization__"){const e=this.canvas.electrodes.get(t),i=[];let r=t;if(void 0===e)return null;if("__localization__"===t&&(r=this.canvas.state_data.get("target_subject"),!r)){if(0===this.canvas.subject_codes.length)return null;r=this.canvas.subject_codes[0]}return(0,n.AA)(e).forEach((t,e)=>{if(!t.isMesh||!t.visible)return null;const n=t.userData.construct_params;let s=n.MNI305_position;Array.isArray(s)&&3===s.length||(s=[0,0,0]),i.push({Electrode:e+1,Label:n.custom_info||"NA",Valid:!0,Coord_x:n.position[0],Coord_y:n.position[1],Coord_z:n.position[2],TemplateSubject:r,SurfaceElectrode:!0===n.is_surface_electrode,SurfaceType:n.surface_type||"NA",Radius:n.radius,VertexNumber:n.vertex_number||-1,Hemisphere:n.hemisphere||"NA",DistanceToSurface:n._distance_to_surf,MNI305_x:s[0],MNI305_y:s[1],MNI305_z:s[2]})}),i}loc_electrode_info(t=!1){const e=this.collect_electrode_info("__localization__");return this.to_shiny({table:e},"localization",!t),e}loc_set_electrode(t,e="",i=!0,r){const s=this.canvas.electrodes.get("__localization__")[`__localization__, ${t} - `];if(!s||!s.userData.construct_params.is_electrode)return null;e&&"string"==typeof e&&""!==e&&"NA"!==e&&(s.userData.construct_params.custom_info=e),s.visible=!!i,r&&3===(r=(0,n.AA)(r)).length&&(s.position.fromArray(r),s.userData.construct_params.position=r),this.canvas.start_animation(0)}loc_add_electrode(t,e,i,n=!1,r="pial",a=[1,0,0]){(0,s.C6)(this.canvas,t,`__localization__, ${t} - `,i,r,e,n,1,a)}clear_electrode_group(t="__localization__"){const e=this.canvas.electrodes.get(t);if(void 0===e)return!1;for(let t in e)e[t].parent.remove(e[t]);return this.canvas.electrodes.set(t,{}),!0}register_shiny(){Shiny.addCustomMessageHandler(this.shinyId,t=>{if(!t||"string"!=typeof t.command||!this.canvas)return null;switch(console.log(t),t.command){case"loc_electrode_info":this.loc_electrode_info();break;case"loc_set_electrode":this.loc_set_electrode(t.electrode,t.label,t.is_valid),this.loc_electrode_info();break;case"loc_set_electrodes":(0,n.AA)(t.data).forEach(t=>{this.loc_set_electrode(t.electrode,t.label,t.is_valid,t.position)}),this.loc_electrode_info();break;case"loc_add_electrodes":!0===t.reset&&this.clear_electrode_group("__localization__");const e=(0,n.AA)(t.data),i=new r.J.Color;e.forEach(t=>{i.setStyle(t.color||"#FF0000"),this.loc_add_electrode(t.electrode,t.label,t.position,t.is_surface||!1,t.surface_type||"pial",i.toArray())}),this.gui&&this.gui.get_controller("Number").setValue(e.length+1),this.loc_electrode_info()}})}to_shiny(t,e="callback",i=!1){const n={...t,".__timestamp__.":new Date,".__callback_id__.":this.outputId+"_"+e};i&&this.shiny_mode?(Shiny.onInputChange(n[".__callback_id__."],n),this.stack.length=0):(this.stack.push(n),this._do_send())}to_shiny2(t,e,i="deferred"){if(this.shiny_mode&&Shiny.shinyapp.$socket){const n=this.outputId+"_"+t;console.debug(n+" is set to ",JSON.stringify(e)),Shiny.setInputValue(n,e,{priority:i})}}}},5664:(t,e,i)=>{"use strict";i.d(e,{E:()=>n});class n{constructor(){this._d=new Map}check_item(t){return this._d.has(t)||void 0!==this._d.get(t)}get_item(t,e=""){const i=this._d.get(t);return void 0!==i?i:e}set_item(t,e){this._d.set(t,e)}get_hash(t){var e,i=0,n=this.get_item(t);if(0===n.length)return i;for(e=0;e<n.length;e++)i=(i<<5)-i+n.charCodeAt(e),i|=0;return i}clear_items(t){void 0===t?this._d.clear():t.forEach(t=>{this._d.delete(t)})}}},1619:(t,e,i)=>{"use strict";i.d(e,{S:()=>ji});var n=i(3658),r=Uint8Array,s=Uint16Array,a=Uint32Array,o=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),l=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=function(t,e){for(var i=new s(31),n=0;n<31;++n)i[n]=e+=1<<t[n-1];var r=new a(i[30]);for(n=1;n<30;++n)for(var o=i[n];o<i[n+1];++o)r[o]=o-i[n]<<5|n;return[i,r]},u=h(o,2),d=u[0],p=u[1];d[28]=258,p[258]=28;for(var f=h(l,0),m=f[0],_=f[1],v=new s(32768),y=0;y<32768;++y){var b;b=(61680&(b=(52428&(b=(43690&y)>>>1|(21845&y)<<1))>>>2|(13107&b)<<2))>>>4|(3855&b)<<4,v[y]=((65280&b)>>>8|(255&b)<<8)>>>1}var x=function(t,e,i){for(var n=t.length,r=0,a=new s(e);r<n;++r)++a[t[r]-1];var o,l=new s(e);for(r=0;r<e;++r)l[r]=l[r-1]+a[r-1]<<1;if(i){o=new s(1<<e);var c=15-e;for(r=0;r<n;++r)if(t[r])for(var h=r<<4|t[r],u=e-t[r],d=l[t[r]-1]++<<u,p=d|(1<<u)-1;d<=p;++d)o[v[d]>>>c]=h}else for(o=new s(n),r=0;r<n;++r)o[r]=v[l[t[r]-1]++]>>>15-t[r];return o},w=new r(288);for(y=0;y<144;++y)w[y]=8;for(y=144;y<256;++y)w[y]=9;for(y=256;y<280;++y)w[y]=7;for(y=280;y<288;++y)w[y]=8;var S=new r(32);for(y=0;y<32;++y)S[y]=5;var M=x(w,9,0),A=x(w,9,1),E=x(S,5,0),L=x(S,5,1),T=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},C=function(t,e,i){var n=e/8>>0;return(t[n]|t[n+1]<<8)>>>(7&e)&i},P=function(t,e){var i=e/8>>0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>>(7&e)},N=function(t){return(t/8>>0)+(7&t&&1)},R=function(t,e,i){(null==e||e<0)&&(e=0),(null==i||i>t.length)&&(i=t.length);var n=new(t instanceof s?s:t instanceof a?a:r)(i-e);return n.set(t.subarray(e,i)),n},D=function(t,e,i){var n=t.length,s=!e||i,a=!i||i.i;i||(i={}),e||(e=new r(3*n));var h=function(t){var i=e.length;if(t>i){var n=new r(Math.max(2*i,t));n.set(e),e=n}},u=i.f||0,p=i.p||0,f=i.b||0,g=i.l,_=i.d,v=i.m,y=i.n,b=8*n;do{if(!g){i.f=u=C(t,p,1);var w=C(t,p+1,3);if(p+=3,!w){var S=t[(U=N(p)+4)-4]|t[U-3]<<8,M=U+S;if(M>n){if(a)throw"unexpected EOF";break}s&&h(f+S),e.set(t.subarray(U,M),f),i.b=f+=S,i.p=p=8*M;continue}if(1==w)g=A,_=L,v=9,y=5;else{if(2!=w)throw"invalid block type";var E=C(t,p,31)+257,D=C(t,p+10,15)+4,I=E+C(t,p+5,31)+1;p+=14;for(var O=new r(I),k=new r(19),F=0;F<D;++F)k[c[F]]=C(t,p+3*F,7);p+=3*D;var B=T(k),z=(1<<B)-1;if(!a&&p+I*(B+7)>b)break;var j=x(k,B,1);for(F=0;F<I;){var U,V=j[C(t,p,z)];if(p+=15&V,(U=V>>>4)<16)O[F++]=U;else{var H=0,G=0;for(16==U?(G=3+C(t,p,3),p+=2,H=O[F-1]):17==U?(G=3+C(t,p,7),p+=3):18==U&&(G=11+C(t,p,127),p+=7);G--;)O[F++]=H}}var W=O.subarray(0,E),q=O.subarray(E);v=T(W),y=T(q),g=x(W,v,1),_=x(q,y,1)}if(p>b)throw"unexpected EOF"}s&&h(f+131072);for(var Y=(1<<v)-1,J=(1<<y)-1,X=v+y+18;a||p+X<b;){var K=(H=g[P(t,p)&Y])>>>4;if((p+=15&H)>b)throw"unexpected EOF";if(!H)throw"invalid length/literal";if(K<256)e[f++]=K;else{if(256==K){g=null;break}var Z=K-254;if(K>264){var $=o[F=K-257];Z=C(t,p,(1<<$)-1)+d[F],p+=$}var Q=_[P(t,p)&J],tt=Q>>>4;if(!Q)throw"invalid distance";p+=15&Q;q=m[tt];if(tt>3){$=l[tt];q+=P(t,p)&(1<<$)-1,p+=$}if(p>b)throw"unexpected EOF";s&&h(f+131072);for(var et=f+Z;f<et;f+=4)e[f]=e[f-q],e[f+1]=e[f+1-q],e[f+2]=e[f+2-q],e[f+3]=e[f+3-q];f=et}}i.l=g,i.p=p,i.b=f,g&&(u=1,i.m=v,i.d=_,i.n=y)}while(!u);return f==e.length?e:R(e,0,f)},I=function(t,e,i){i<<=7&e;var n=e/8>>0;t[n]|=i,t[n+1]|=i>>>8},O=function(t,e,i){i<<=7&e;var n=e/8>>0;t[n]|=i,t[n+1]|=i>>>8,t[n+2]|=i>>>16},k=function(t,e){for(var i=[],n=0;n<t.length;++n)t[n]&&i.push({s:n,f:t[n]});var a=i.length,o=i.slice();if(!a)return[new r(0),0];if(1==a){var l=new r(i[0].s+1);return l[i[0].s]=1,[l,1]}i.sort((function(t,e){return t.f-e.f})),i.push({s:-1,f:25001});var c=i[0],h=i[1],u=0,d=1,p=2;for(i[0]={s:-1,f:c.f+h.f,l:c,r:h};d!=a-1;)c=i[i[u].f<i[p].f?u++:p++],h=i[u!=d&&i[u].f<i[p].f?u++:p++],i[d++]={s:-1,f:c.f+h.f,l:c,r:h};var f=o[0].s;for(n=1;n<a;++n)o[n].s>f&&(f=o[n].s);var m=new s(f+1),g=F(i[d-1],m,0);if(g>e){n=0;var _=0,v=g-e,y=1<<v;for(o.sort((function(t,e){return m[e.s]-m[t.s]||t.f-e.f}));n<a;++n){var b=o[n].s;if(!(m[b]>e))break;_+=y-(1<<g-m[b]),m[b]=e}for(_>>>=v;_>0;){var x=o[n].s;m[x]<e?_-=1<<e-m[x]++-1:++n}for(;n>=0&&_;--n){var w=o[n].s;m[w]==e&&(--m[w],++_)}g=e}return[new r(m),g]},F=function(t,e,i){return-1==t.s?Math.max(F(t.l,e,i+1),F(t.r,e,i+1)):e[t.s]=i},B=function(t){for(var e=t.length;e&&!t[--e];);for(var i=new s(++e),n=0,r=t[0],a=1,o=function(t){i[n++]=t},l=1;l<=e;++l)if(t[l]==r&&l!=e)++a;else{if(!r&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(r),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(r);a=1,r=t[l]}return[i.subarray(0,n),e]},z=function(t,e){for(var i=0,n=0;n<e.length;++n)i+=t[n]*e[n];return i},j=function(t,e,i){var n=i.length,r=N(e+2);t[r]=255&n,t[r+1]=n>>>8,t[r+2]=255^t[r],t[r+3]=255^t[r+1];for(var s=0;s<n;++s)t[r+s+4]=i[s];return 8*(r+4+n)},U=function(t,e,i,n,r,a,h,u,d,p,f){I(e,f++,i),++r[256];for(var m=k(r,15),g=m[0],_=m[1],v=k(a,15),y=v[0],b=v[1],A=B(g),L=A[0],T=A[1],C=B(y),P=C[0],N=C[1],R=new s(19),D=0;D<L.length;++D)R[31&L[D]]++;for(D=0;D<P.length;++D)R[31&P[D]]++;for(var F=k(R,7),U=F[0],V=F[1],H=19;H>4&&!U[c[H-1]];--H);var G,W,q,Y,J=p+5<<3,X=z(r,w)+z(a,S)+h,K=z(r,g)+z(a,y)+h+14+3*H+z(R,U)+(2*R[16]+3*R[17]+7*R[18]);if(J<=X&&J<=K)return j(e,f,t.subarray(d,d+p));if(I(e,f,1+(K<X)),f+=2,K<X){G=x(g,_,0),W=g,q=x(y,b,0),Y=y;var Z=x(U,V,0);I(e,f,T-257),I(e,f+5,N-1),I(e,f+10,H-4),f+=14;for(D=0;D<H;++D)I(e,f+3*D,U[c[D]]);f+=3*H;for(var $=[L,P],Q=0;Q<2;++Q){var tt=$[Q];for(D=0;D<tt.length;++D){var et=31&tt[D];I(e,f,Z[et]),f+=U[et],et>15&&(I(e,f,tt[D]>>>5&127),f+=tt[D]>>>12)}}}else G=M,W=w,q=E,Y=S;for(D=0;D<u;++D)if(n[D]>255){et=n[D]>>>18&31;O(e,f,G[et+257]),f+=W[et+257],et>7&&(I(e,f,n[D]>>>23&31),f+=o[et]);var it=31&n[D];O(e,f,q[it]),f+=Y[it],it>3&&(O(e,f,n[D]>>>5&8191),f+=l[it])}else O(e,f,G[n[D]]),f+=W[n[D]];return O(e,f,G[256]),f+W[256]},V=new a([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),H=new r(0),G=function(t,e,i,n,c,h){var u=t.length,d=new r(n+u+5*(1+Math.floor(u/7e3))+c),f=d.subarray(n,d.length-c),m=0;if(!e||u<8)for(var g=0;g<=u;g+=65535){var v=g+65535;v<u?m=j(f,m,t.subarray(g,v)):(f[g]=h,m=j(f,m,t.subarray(g,u)))}else{for(var y=V[e-1],b=y>>>13,x=8191&y,w=(1<<i)-1,S=new s(32768),M=new s(w+1),A=Math.ceil(i/3),E=2*A,L=function(e){return(t[e]^t[e+1]<<A^t[e+2]<<E)&w},T=new a(25e3),C=new s(288),P=new s(32),D=0,I=0,O=(g=0,0),k=0,F=0;g<u;++g){var B=L(g),z=32767&g,G=M[B];if(S[z]=G,M[B]=z,k<=g){var W=u-g;if((D>7e3||O>24576)&&W>423){m=U(t,f,0,T,C,P,I,O,F,g-F,m),O=D=I=0,F=g;for(var q=0;q<286;++q)C[q]=0;for(q=0;q<30;++q)P[q]=0}var Y=2,J=0,X=x,K=z-G&32767;if(W>2&&B==L(g-K))for(var Z=Math.min(b,W)-1,$=Math.min(32767,g),Q=Math.min(258,W);K<=$&&--X&&z!=G;){if(t[g+Y]==t[g+Y-K]){for(var tt=0;tt<Q&&t[g+tt]==t[g+tt-K];++tt);if(tt>Y){if(Y=tt,J=K,tt>Z)break;var et=Math.min(K,tt-2),it=0;for(q=0;q<et;++q){var nt=g-K+q+32768&32767,rt=nt-S[nt]+32768&32767;rt>it&&(it=rt,G=nt)}}}K+=(z=G)-(G=S[z])+32768&32767}if(J){T[O++]=268435456|p[Y]<<18|_[J];var st=31&p[Y],at=31&_[J];I+=o[st]+l[at],++C[257+st],++P[at],k=g+Y,++D}else T[O++]=t[g],++C[t[g]]}}m=U(t,f,h,T,C,P,I,O,F,g-F,m),h||(m=j(f,m,H))}return R(d,0,n+N(m)+c)},W=function(){var t=1,e=0;return{p:function(i){for(var n=t,r=e,s=i.length,a=0;a!=s;){for(var o=Math.min(a+5552,s);a<o;++a)r+=n+=i[a];n%=65521,r%=65521}t=n,e=r},d:function(){return(t>>>8<<16|(255&e)<<8|e>>>8)+2*((255&t)<<23)}}},q=function(t,e,i,n,r){return G(t,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,i,n,!r)},Y=function(t,e,i){for(;i;++e)t[e]=i,i>>>=8},J=function(t,e){var i=e.level,n=0==i?0:i<6?1:9==i?3:2;t[0]=120,t[1]=n<<6|(n?32-2*n:1)},X=function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"};function K(t,e){void 0===e&&(e={});var i=W();i.p(t);var n=q(t,e,2,4);return J(n,e),Y(n,n.length-4,i.d()),n}function Z(t,e){return D((X(t),t.subarray(2,-4)),e)}
/** @license
 *
 * jsPDF - PDF Document creation from JavaScript
 * Version 2.3.1 Built on 2021-03-08T15:44:11.674Z
 *                      CommitID 00000000
 *
 * Copyright (c) 2010-2020 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
 *               2015-2020 yWorks GmbH, http://www.yworks.com
 *               2015-2020 Lukas Hollnder <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
 *               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
 *               2010 Aaron Spike, https://github.com/acspike
 *               2012 Willow Systems Corporation, willow-systems.com
 *               2012 Pablo Hess, https://github.com/pablohess
 *               2012 Florian Jenett, https://github.com/fjenett
 *               2013 Warren Weckesser, https://github.com/warrenweckesser
 *               2013 Youssef Beddad, https://github.com/lifof
 *               2013 Lee Driscoll, https://github.com/lsdriscoll
 *               2013 Stefan Slonevskiy, https://github.com/stefslon
 *               2013 Jeremy Morel, https://github.com/jmorel
 *               2013 Christoph Hartmann, https://github.com/chris-rock
 *               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
 *               2014 James Makes, https://github.com/dollaruw
 *               2014 Diego Casorran, https://github.com/diegocr
 *               2014 Steven Spungin, https://github.com/Flamenco
 *               2014 Kenneth Glassey, https://github.com/Gavvers
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * Contributor(s):
 *    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
 *    kim3er, mfo, alnorth, Flamenco
 */
var $=function(){return"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:this}();function Q(){$.console&&"function"==typeof $.console.log&&$.console.log.apply($.console,arguments)}var tt={log:Q,warn:function(t){$.console&&("function"==typeof $.console.warn?$.console.warn.apply($.console,arguments):Q.call(null,arguments))},error:function(t){$.console&&("function"==typeof $.console.error?$.console.error.apply($.console,arguments):Q(t))}};
/**
 * @license
 * FileSaver.js
 * A saveAs() FileSaver implementation.
 *
 * By Eli Grey, http://eligrey.com
 *
 * License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)
 * source  : http://purl.eligrey.com/github/FileSaver.js
 */function et(t,e,i){var n=new XMLHttpRequest;n.open("GET",t),n.responseType="blob",n.onload=function(){at(n.response,e,i)},n.onerror=function(){tt.error("could not download file")},n.send()}function it(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return e.status>=200&&e.status<=299}function nt(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(i){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var rt,st,at=$.saveAs||("object"!=typeof window||window!==$?function(){}:"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype?function(t,e,i){var n=$.URL||$.webkitURL,r=document.createElement("a");e=e||t.name||"download",r.download=e,r.rel="noopener","string"==typeof t?(r.href=t,r.origin!==location.origin?it(r.href)?et(t,e,i):nt(r,r.target="_blank"):nt(r)):(r.href=n.createObjectURL(t),setTimeout((function(){n.revokeObjectURL(r.href)}),4e4),setTimeout((function(){nt(r)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,e,i){if(e=e||t.name||"download","string"==typeof t)if(it(t))et(t,e,i);else{var n=document.createElement("a");n.href=t,n.target="_blank",setTimeout((function(){nt(n)}))}else navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(tt.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t}(t,i),e)}:function(t,e,i,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof t)return et(t,e,i);var r="application/octet-stream"===t.type,s=/constructor/i.test($.HTMLElement)||$.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||r&&s)&&"object"==typeof FileReader){var o=new FileReader;o.onloadend=function(){var t=o.result;t=a?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=t:location=t,n=null},o.readAsDataURL(t)}else{var l=$.URL||$.webkitURL,c=l.createObjectURL(t);n?n.location=c:location.href=c,n=null,setTimeout((function(){l.revokeObjectURL(c)}),4e4)}});
/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function ot(t){var e;t=t||"",this.ok=!1,"#"==t.charAt(0)&&(t=t.substr(1,6)),t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[t=(t=t.replace(/ /g,"")).toLowerCase()]||t;for(var i=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}],n=0;n<i.length;n++){var r=i[n].re,s=i[n].process,a=r.exec(t);a&&(e=s(a),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var t=this.r.toString(16),e=this.g.toString(16),i=this.b.toString(16);return 1==t.length&&(t="0"+t),1==e.length&&(e="0"+e),1==i.length&&(i="0"+i),"#"+t+e+i
/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */}}function lt(t,e){var i=t[0],n=t[1],r=t[2],s=t[3];i=ht(i,n,r,s,e[0],7,-680876936),s=ht(s,i,n,r,e[1],12,-389564586),r=ht(r,s,i,n,e[2],17,606105819),n=ht(n,r,s,i,e[3],22,-1044525330),i=ht(i,n,r,s,e[4],7,-176418897),s=ht(s,i,n,r,e[5],12,1200080426),r=ht(r,s,i,n,e[6],17,-1473231341),n=ht(n,r,s,i,e[7],22,-45705983),i=ht(i,n,r,s,e[8],7,1770035416),s=ht(s,i,n,r,e[9],12,-1958414417),r=ht(r,s,i,n,e[10],17,-42063),n=ht(n,r,s,i,e[11],22,-1990404162),i=ht(i,n,r,s,e[12],7,1804603682),s=ht(s,i,n,r,e[13],12,-40341101),r=ht(r,s,i,n,e[14],17,-1502002290),i=ut(i,n=ht(n,r,s,i,e[15],22,1236535329),r,s,e[1],5,-165796510),s=ut(s,i,n,r,e[6],9,-1069501632),r=ut(r,s,i,n,e[11],14,643717713),n=ut(n,r,s,i,e[0],20,-373897302),i=ut(i,n,r,s,e[5],5,-701558691),s=ut(s,i,n,r,e[10],9,38016083),r=ut(r,s,i,n,e[15],14,-660478335),n=ut(n,r,s,i,e[4],20,-405537848),i=ut(i,n,r,s,e[9],5,568446438),s=ut(s,i,n,r,e[14],9,-1019803690),r=ut(r,s,i,n,e[3],14,-187363961),n=ut(n,r,s,i,e[8],20,1163531501),i=ut(i,n,r,s,e[13],5,-1444681467),s=ut(s,i,n,r,e[2],9,-51403784),r=ut(r,s,i,n,e[7],14,1735328473),i=dt(i,n=ut(n,r,s,i,e[12],20,-1926607734),r,s,e[5],4,-378558),s=dt(s,i,n,r,e[8],11,-2022574463),r=dt(r,s,i,n,e[11],16,1839030562),n=dt(n,r,s,i,e[14],23,-35309556),i=dt(i,n,r,s,e[1],4,-1530992060),s=dt(s,i,n,r,e[4],11,1272893353),r=dt(r,s,i,n,e[7],16,-155497632),n=dt(n,r,s,i,e[10],23,-1094730640),i=dt(i,n,r,s,e[13],4,681279174),s=dt(s,i,n,r,e[0],11,-358537222),r=dt(r,s,i,n,e[3],16,-722521979),n=dt(n,r,s,i,e[6],23,76029189),i=dt(i,n,r,s,e[9],4,-640364487),s=dt(s,i,n,r,e[12],11,-421815835),r=dt(r,s,i,n,e[15],16,530742520),i=pt(i,n=dt(n,r,s,i,e[2],23,-995338651),r,s,e[0],6,-198630844),s=pt(s,i,n,r,e[7],10,1126891415),r=pt(r,s,i,n,e[14],15,-1416354905),n=pt(n,r,s,i,e[5],21,-57434055),i=pt(i,n,r,s,e[12],6,1700485571),s=pt(s,i,n,r,e[3],10,-1894986606),r=pt(r,s,i,n,e[10],15,-1051523),n=pt(n,r,s,i,e[1],21,-2054922799),i=pt(i,n,r,s,e[8],6,1873313359),s=pt(s,i,n,r,e[15],10,-30611744),r=pt(r,s,i,n,e[6],15,-1560198380),n=pt(n,r,s,i,e[13],21,1309151649),i=pt(i,n,r,s,e[4],6,-145523070),s=pt(s,i,n,r,e[11],10,-1120210379),r=pt(r,s,i,n,e[2],15,718787259),n=pt(n,r,s,i,e[9],21,-343485551),t[0]=bt(i,t[0]),t[1]=bt(n,t[1]),t[2]=bt(r,t[2]),t[3]=bt(s,t[3])}function ct(t,e,i,n,r,s){return e=bt(bt(e,t),bt(n,s)),bt(e<<r|e>>>32-r,i)}function ht(t,e,i,n,r,s,a){return ct(e&i|~e&n,t,e,r,s,a)}function ut(t,e,i,n,r,s,a){return ct(e&n|i&~n,t,e,r,s,a)}function dt(t,e,i,n,r,s,a){return ct(e^i^n,t,e,r,s,a)}function pt(t,e,i,n,r,s,a){return ct(i^(e|~n),t,e,r,s,a)}function ft(t){var e,i=t.length,n=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)lt(n,mt(t.substring(e-64,e)));t=t.substring(e-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)r[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(lt(n,r),e=0;e<16;e++)r[e]=0;return r[14]=8*i,lt(n,r),n}function mt(t){var e,i=[];for(e=0;e<64;e+=4)i[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return i}rt=$.atob.bind($),st=$.btoa.bind($);var gt="0123456789abcdef".split("");function _t(t){for(var e="",i=0;i<4;i++)e+=gt[t>>8*i+4&15]+gt[t>>8*i&15];return e}function vt(t){return String.fromCharCode((255&t)>>0,(65280&t)>>8,(16711680&t)>>16,(4278190080&t)>>24)}function yt(t){return ft(t).map(vt).join("")}function bt(t,e){return t+e&4294967295}if("5d41402abc4b2a76b9719d911017c592"!=function(t){for(var e=0;e<t.length;e++)t[e]=_t(t[e]);return t.join("")}(ft("hello"))){function b(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}}
/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function xt(t,e){var i,n,r,s;if(t!==i){for(var a=(r=t,s=1+(256/t.length>>0),new Array(s+1).join(r)),o=[],l=0;l<256;l++)o[l]=l;var c=0;for(l=0;l<256;l++){var h=o[l];c=(c+h+a.charCodeAt(l))%256,o[l]=o[c],o[c]=h}i=t,n=o}else o=n;var u=e.length,d=0,p=0,f="";for(l=0;l<u;l++)p=(p+(h=o[d=(d+1)%256]))%256,o[d]=o[p],o[p]=h,a=o[(o[d]+o[p])%256],f+=String.fromCharCode(e.charCodeAt(l)^a);return f}
/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var wt={print:4,modify:8,copy:16,"annot-forms":32};function St(t,e,i,n){this.v=1,this.r=2;let r=192;t.forEach((function(t){if(void 0!==wt.perm)throw new Error("Invalid permission: "+t);r+=wt[t]})),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";let s=(e+this.padding).substr(0,32),a=(i+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,a),this.P=-(1+(255^r)),this.encryptionKey=yt(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=xt(this.encryptionKey,this.padding)}function Mt(t){if("object"!=typeof t)throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,i,n){if(n=n||!1,"string"!=typeof t||"function"!=typeof i||"boolean"!=typeof n)throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var r=Math.random().toString(35);return e[t][r]=[i,!!n],r},this.unsubscribe=function(t){for(var i in e)if(e[i][t])return delete e[i][t],0===Object.keys(e[i]).length&&delete e[i],!0;return!1},this.publish=function(i){if(e.hasOwnProperty(i)){var n=Array.prototype.slice.call(arguments,1),r=[];for(var s in e[i]){var a=e[i][s];try{a[0].apply(t,n)}catch(t){$.console&&tt.error("jsPDF PubSub Error",t.message,t)}a[1]&&r.push(s)}r.length&&r.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function At(t){if(!(this instanceof At))return new At(t);var e="opacity,stroke-opacity".split(",");for(var i in t)t.hasOwnProperty(i)&&e.indexOf(i)>=0&&(this[i]=t[i]);this.id="",this.objectNumber=-1}function Et(t,e){this.gState=t,this.matrix=e,this.id="",this.objectNumber=-1}function Lt(t,e,i,n,r){if(!(this instanceof Lt))return new Lt(t,e,i,n,r);this.type="axial"===t?2:3,this.coords=e,this.colors=i,Et.call(this,n,r)}function Tt(t,e,i,n,r){if(!(this instanceof Tt))return new Tt(t,e,i,n,r);this.boundingBox=t,this.xStep=e,this.yStep=i,this.stream="",this.cloneIndex=0,Et.call(this,n,r)}function Ct(t){var e,i="string"==typeof arguments[0]?arguments[0]:"p",n=arguments[1],r=arguments[2],s=arguments[3],a=[],o=1,l=16,c="S",h=null;"object"==typeof(t=t||{})&&(i=t.orientation,n=t.unit||n,r=t.format||r,s=t.compress||t.compressPdf||s,null!==(h=t.encryption||null)&&(h.userPassword=h.userPassword||"",h.ownerPassword=h.ownerPassword||"",h.userPermissions=h.userPermissions||[]),o="number"==typeof t.userUnit?Math.abs(t.userUnit):1,void 0!==t.precision&&(e=t.precision),void 0!==t.floatPrecision&&(l=t.floatPrecision),c=t.defaultPathOperation||"S"),a=t.filters||(!0===s?["FlateEncode"]:a),n=n||"mm",i=(""+(i||"P")).toLowerCase();var u=t.putOnlyUsedFonts||!1,d={},p={internal:{},__private__:{}};p.__private__.PubSub=Mt;var f="1.3",m=p.__private__.getPdfVersion=function(){return f};p.__private__.setPdfVersion=function(t){f=t};var g={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};p.__private__.getPageFormats=function(){return g};var _=p.__private__.getPageFormat=function(t){return g[t]};r=r||"a4";var v={COMPAT:"compat",ADVANCED:"advanced"},y=v.COMPAT;function b(){this.saveGraphicsState(),Q(new Ht(vt,0,0,-vt,0,ki()*vt).toString()+" cm"),this.setFontSize(this.getFontSize()/vt),c="n",y=v.ADVANCED}function x(){this.restoreGraphicsState(),c="S",y=v.COMPAT}var w=function(t,e){if("bold"==t&&"normal"==e||"bold"==t&&400==e||"normal"==t&&"italic"==e||"bold"==t&&"italic"==e)throw new Error("Invalid Combination of fontweight and fontstyle");return e&&t!==e&&(t=400==e?"italic"==t?"italic":"normal":700==e&&"italic"!==t?"bold":t+""+e),t};p.advancedAPI=function(t){var e=y===v.COMPAT;return e&&b.call(this),"function"!=typeof t||(t(this),e&&x.call(this)),this},p.compatAPI=function(t){var e=y===v.ADVANCED;return e&&x.call(this),"function"!=typeof t||(t(this),e&&b.call(this)),this},p.isAdvancedAPI=function(){return y===v.ADVANCED};var S,M=function(t){if(y!==v.ADVANCED)throw new Error(t+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},A=p.roundToPrecision=p.__private__.roundToPrecision=function(t,i){var n=e||i;if(isNaN(t)||isNaN(n))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return t.toFixed(n).replace(/0+$/,"")};S=p.hpf=p.__private__.hpf="number"==typeof l?function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.hpf");return A(t,l)}:"smart"===l?function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.hpf");return A(t,t>-1&&t<1?16:5)}:function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.hpf");return A(t,16)};var E=p.f2=p.__private__.f2=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.f2");return A(t,2)},L=p.__private__.f3=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.f3");return A(t,3)},T=p.scale=p.__private__.scale=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.scale");return y===v.COMPAT?t*vt:y===v.ADVANCED?t:void 0},C=function(t){return y===v.COMPAT?ki()-t:y===v.ADVANCED?t:void 0},P=function(t){return T(C(t))};p.__private__.setPrecision=p.setPrecision=function(t){"number"==typeof parseInt(t,10)&&(e=parseInt(t,10))};var N,R="00000000000000000000000000000000",D=p.__private__.getFileId=function(){return R},I=p.__private__.setFileId=function(t){return R=void 0!==t&&/^[a-fA-F0-9]{32}$/.test(t)?t.toUpperCase():R.split("").map((function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))})).join(""),null!==h&&(We=new St(h.userPermissions,h.userPassword,h.ownerPassword,R)),R};p.setFileId=function(t){return I(t),this},p.getFileId=function(){return D()};var O=p.__private__.convertDateToPDFDate=function(t){var e=t.getTimezoneOffset(),i=e<0?"+":"-",n=Math.floor(Math.abs(e/60)),r=Math.abs(e%60),s=[i,j(n),"'",j(r),"'"].join("");return["D:",t.getFullYear(),j(t.getMonth()+1),j(t.getDate()),j(t.getHours()),j(t.getMinutes()),j(t.getSeconds()),s].join("")},k=p.__private__.convertPDFDateToDate=function(t){var e=parseInt(t.substr(2,4),10),i=parseInt(t.substr(6,2),10)-1,n=parseInt(t.substr(8,2),10),r=parseInt(t.substr(10,2),10),s=parseInt(t.substr(12,2),10),a=parseInt(t.substr(14,2),10);return new Date(e,i,n,r,s,a,0)},F=p.__private__.setCreationDate=function(t){var e;if(void 0===t&&(t=new Date),t instanceof Date)e=O(t);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(t))throw new Error("Invalid argument passed to jsPDF.setCreationDate");e=t}return N=e},B=p.__private__.getCreationDate=function(t){var e=N;return"jsDate"===t&&(e=k(N)),e};p.setCreationDate=function(t){return F(t),this},p.getCreationDate=function(t){return B(t)};var z,j=p.__private__.padd2=function(t){return("0"+parseInt(t)).slice(-2)},U=p.__private__.padd2Hex=function(t){return("00"+(t=t.toString())).substr(t.length)},V=0,H=[],G=[],W=0,q=[],Y=[],J=!1,X=G,K=function(){V=0,W=0,G=[],H=[],q=[],Zt=Jt(),$t=Jt()};p.__private__.setCustomOutputDestination=function(t){J=!0,X=t};var Z=function(t){J||(X=t)};p.__private__.resetCustomOutputDestination=function(){J=!1,X=G};var Q=p.__private__.out=function(t){return t=t.toString(),W+=t.length+1,X.push(t),X},et=p.__private__.write=function(t){return Q(1===arguments.length?t.toString():Array.prototype.join.call(arguments," "))},it=p.__private__.getArrayBuffer=function(t){for(var e=t.length,i=new ArrayBuffer(e),n=new Uint8Array(i);e--;)n[e]=t.charCodeAt(e);return i},nt=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];p.__private__.getStandardFonts=function(){return nt};var rt=t.fontSize||16;p.__private__.setFontSize=p.setFontSize=function(t){return rt=y===v.ADVANCED?t/vt:t,this};var lt,ct=p.__private__.getFontSize=p.getFontSize=function(){return y===v.COMPAT?rt:rt*vt},ht=t.R2L||!1;p.__private__.setR2L=p.setR2L=function(t){return ht=t,this},p.__private__.getR2L=p.getR2L=function(){return ht};var ut,dt=p.__private__.setZoomMode=function(t){if(/^\d*\.?\d*%$/.test(t))lt=t;else if(isNaN(t)){if(-1===[void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(t))throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+t+'" is not recognized.');lt=t}else lt=parseInt(t,10)};p.__private__.getZoomMode=function(){return lt};var pt,ft=p.__private__.setPageMode=function(t){if(-1==[void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(t))throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+t+'" is not recognized.');ut=t};p.__private__.getPageMode=function(){return ut};var mt=p.__private__.setLayoutMode=function(t){if(-1==[void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(t))throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+t+'" is not recognized.');pt=t};p.__private__.getLayoutMode=function(){return pt},p.__private__.setDisplayMode=p.setDisplayMode=function(t,e,i){return dt(t),mt(e),ft(i),this};var gt={title:"",subject:"",author:"",keywords:"",creator:""};p.__private__.getDocumentProperty=function(t){if(-1===Object.keys(gt).indexOf(t))throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return gt[t]},p.__private__.getDocumentProperties=function(){return gt},p.__private__.setDocumentProperties=p.setProperties=p.setDocumentProperties=function(t){for(var e in gt)gt.hasOwnProperty(e)&&t[e]&&(gt[e]=t[e]);return this},p.__private__.setDocumentProperty=function(t,e){if(-1===Object.keys(gt).indexOf(t))throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return gt[t]=e};var _t,vt,yt,bt,xt,wt={},Et={},Pt=[],Nt={},Rt={},Dt={},It={},Ot=null,kt=0,Ft=[],Bt=new Mt(p),zt=t.hotfixes||[],jt={},Ut={},Vt=[],Ht=function(t,e,i,n,r,s){if(!(this instanceof Ht))return new Ht(t,e,i,n,r,s);isNaN(t)&&(t=1),isNaN(e)&&(e=0),isNaN(i)&&(i=0),isNaN(n)&&(n=1),isNaN(r)&&(r=0),isNaN(s)&&(s=0),this._matrix=[t,e,i,n,r,s]};Object.defineProperty(Ht.prototype,"sx",{get:function(){return this._matrix[0]},set:function(t){this._matrix[0]=t}}),Object.defineProperty(Ht.prototype,"shy",{get:function(){return this._matrix[1]},set:function(t){this._matrix[1]=t}}),Object.defineProperty(Ht.prototype,"shx",{get:function(){return this._matrix[2]},set:function(t){this._matrix[2]=t}}),Object.defineProperty(Ht.prototype,"sy",{get:function(){return this._matrix[3]},set:function(t){this._matrix[3]=t}}),Object.defineProperty(Ht.prototype,"tx",{get:function(){return this._matrix[4]},set:function(t){this._matrix[4]=t}}),Object.defineProperty(Ht.prototype,"ty",{get:function(){return this._matrix[5]},set:function(t){this._matrix[5]=t}}),Object.defineProperty(Ht.prototype,"a",{get:function(){return this._matrix[0]},set:function(t){this._matrix[0]=t}}),Object.defineProperty(Ht.prototype,"b",{get:function(){return this._matrix[1]},set:function(t){this._matrix[1]=t}}),Object.defineProperty(Ht.prototype,"c",{get:function(){return this._matrix[2]},set:function(t){this._matrix[2]=t}}),Object.defineProperty(Ht.prototype,"d",{get:function(){return this._matrix[3]},set:function(t){this._matrix[3]=t}}),Object.defineProperty(Ht.prototype,"e",{get:function(){return this._matrix[4]},set:function(t){this._matrix[4]=t}}),Object.defineProperty(Ht.prototype,"f",{get:function(){return this._matrix[5]},set:function(t){this._matrix[5]=t}}),Object.defineProperty(Ht.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Ht.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Ht.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Ht.prototype,"isIdentity",{get:function(){return 1===this.sx&&0===this.shy&&0===this.shx&&1===this.sy&&0===this.tx&&0===this.ty}}),Ht.prototype.join=function(t){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(S).join(t)},Ht.prototype.multiply=function(t){var e=t.sx*this.sx+t.shy*this.shx,i=t.sx*this.shy+t.shy*this.sy,n=t.shx*this.sx+t.sy*this.shx,r=t.shx*this.shy+t.sy*this.sy,s=t.tx*this.sx+t.ty*this.shx+this.tx,a=t.tx*this.shy+t.ty*this.sy+this.ty;return new Ht(e,i,n,r,s,a)},Ht.prototype.decompose=function(){var t=this.sx,e=this.shy,i=this.shx,n=this.sy,r=this.tx,s=this.ty,a=Math.sqrt(t*t+e*e),o=(t/=a)*i+(e/=a)*n;i-=t*o,n-=e*o;var l=Math.sqrt(i*i+n*n);return o/=l,t*(n/=l)<e*(i/=l)&&(t=-t,e=-e,o=-o,a=-a),{scale:new Ht(a,0,0,l,0,0),translate:new Ht(1,0,0,1,r,s),rotate:new Ht(t,e,-e,t,0,0),skew:new Ht(1,0,o,1,0,0)}},Ht.prototype.toString=function(t){return this.join(" ")},Ht.prototype.inversed=function(){var t=this.sx,e=this.shy,i=this.shx,n=this.sy,r=this.tx,s=this.ty,a=1/(t*n-e*i),o=n*a,l=-e*a,c=-i*a,h=t*a;return new Ht(o,l,c,h,-o*r-c*s,-l*r-h*s)},Ht.prototype.applyToPoint=function(t){var e=t.x*this.sx+t.y*this.shx+this.tx,i=t.x*this.shy+t.y*this.sy+this.ty;return new Ti(e,i)},Ht.prototype.applyToRectangle=function(t){var e=this.applyToPoint(t),i=this.applyToPoint(new Ti(t.x+t.w,t.y+t.h));return new Ci(e.x,e.y,i.x-e.x,i.y-e.y)},Ht.prototype.clone=function(){var t=this.sx,e=this.shy,i=this.shx,n=this.sy,r=this.tx,s=this.ty;return new Ht(t,e,i,n,r,s)},p.Matrix=Ht;var Gt=p.matrixMult=function(t,e){return e.multiply(t)},Wt=new Ht(1,0,0,1,0,0);p.unitMatrix=p.identityMatrix=Wt;var qt=function(t,e){if(!Rt[t]){var i=(e instanceof Lt?"Sh":"P")+(Object.keys(Nt).length+1).toString(10);e.id=i,Rt[t]=i,Nt[i]=e,Bt.publish("addPattern",e)}};p.ShadingPattern=Lt,p.TilingPattern=Tt,p.addShadingPattern=function(t,e){return M("addShadingPattern()"),qt(t,e),this},p.beginTilingPattern=function(t){M("beginTilingPattern()"),Ni(t.boundingBox[0],t.boundingBox[1],t.boundingBox[2]-t.boundingBox[0],t.boundingBox[3]-t.boundingBox[1],t.matrix)},p.endTilingPattern=function(t,e){M("endTilingPattern()"),e.stream=Y[z].join("\n"),qt(t,e),Bt.publish("endTilingPattern",e),Vt.pop().restore()};var Yt=p.__private__.newObject=function(){var t=Jt();return Xt(t,!0),t},Jt=p.__private__.newObjectDeferred=function(){return V++,H[V]=function(){return W},V},Xt=function(t,e){return e="boolean"==typeof e&&e,H[t]=W,e&&Q(t+" 0 obj"),t},Kt=p.__private__.newAdditionalObject=function(){var t={objId:Jt(),content:""};return q.push(t),t},Zt=Jt(),$t=Jt(),Qt=p.__private__.decodeColorString=function(t){var e=t.split(" ");if(2!==e.length||"g"!==e[1]&&"G"!==e[1])5!==e.length||"k"!==e[4]&&"K"!==e[4]||(e=[(1-e[0])*(1-e[3]),(1-e[1])*(1-e[3]),(1-e[2])*(1-e[3]),"r"]);else{var i=parseFloat(e[0]);e=[i,i,i,"r"]}for(var n="#",r=0;r<3;r++)n+=("0"+Math.floor(255*parseFloat(e[r])).toString(16)).slice(-2);return n},te=p.__private__.encodeColorString=function(t){var e;"string"==typeof t&&(t={ch1:t});var i=t.ch1,n=t.ch2,r=t.ch3,s=t.ch4,a="draw"===t.pdfColorType?["G","RG","K"]:["g","rg","k"];if("string"==typeof i&&"#"!==i.charAt(0)){var o=new ot(i);if(o.ok)i=o.toHex();else if(!/^\d*\.?\d*$/.test(i))throw new Error('Invalid color "'+i+'" passed to jsPDF.encodeColorString.')}if("string"==typeof i&&/^#[0-9A-Fa-f]{3}$/.test(i)&&(i="#"+i[1]+i[1]+i[2]+i[2]+i[3]+i[3]),"string"==typeof i&&/^#[0-9A-Fa-f]{6}$/.test(i)){var l=parseInt(i.substr(1),16);i=l>>16&255,n=l>>8&255,r=255&l}if(void 0===n||void 0===s&&i===n&&n===r)if("string"==typeof i)e=i+" "+a[0];else switch(t.precision){case 2:e=E(i/255)+" "+a[0];break;case 3:default:e=L(i/255)+" "+a[0]}else if(void 0===s||"object"==typeof s){if(s&&!isNaN(s.a)&&0===s.a)return["1.","1.","1.",a[1]].join(" ");if("string"==typeof i)e=[i,n,r,a[1]].join(" ");else switch(t.precision){case 2:e=[E(i/255),E(n/255),E(r/255),a[1]].join(" ");break;default:case 3:e=[L(i/255),L(n/255),L(r/255),a[1]].join(" ")}}else if("string"==typeof i)e=[i,n,r,s,a[2]].join(" ");else switch(t.precision){case 2:e=[E(i),E(n),E(r),E(s),a[2]].join(" ");break;case 3:default:e=[L(i),L(n),L(r),L(s),a[2]].join(" ")}return e},ee=p.__private__.getFilters=function(){return a},ie=p.__private__.putStream=function(t){var e=(t=t||{}).data||"",i=t.filters||ee(),n=t.alreadyAppliedFilters||[],r=t.addLength1||!1,s=e.length,a=t.objectId,o=function(t){return t};if(null!==h&&void 0===a)throw new Error("ObjectId must be passed to putStream for file encryption");null!==h&&(o=We.encryptor(a,0));var l={};!0===i&&(i=["FlateEncode"]);var c=t.additionalKeyValues||[],u=(l=void 0!==Ct.API.processDataByFilters?Ct.API.processDataByFilters(e,i):{data:e,reverseChain:[]}).reverseChain+(Array.isArray(n)?n.join(" "):n.toString());if(0!==l.data.length&&(c.push({key:"Length",value:l.data.length}),!0===r&&c.push({key:"Length1",value:s})),0!=u.length)if(u.split("/").length-1==1)c.push({key:"Filter",value:u});else{c.push({key:"Filter",value:"["+u+"]"});for(var d=0;d<c.length;d+=1)if("DecodeParms"===c[d].key){for(var p=[],f=0;f<l.reverseChain.split("/").length-1;f+=1)p.push("null");p.push(c[d].value),c[d].value="["+p.join(" ")+"]"}}Q("<<");for(var m=0;m<c.length;m++)Q("/"+c[m].key+" "+c[m].value);Q(">>"),0!==l.data.length&&(Q("stream"),Q(o(l.data)),Q("endstream"))},ne=p.__private__.putPage=function(t){var e=t.number,i=t.data,n=t.objId,r=t.contentsObjId;Xt(n,!0),Q("<</Type /Page"),Q("/Parent "+t.rootDictionaryObjId+" 0 R"),Q("/Resources "+t.resourceDictionaryObjId+" 0 R"),Q("/MediaBox ["+parseFloat(S(t.mediaBox.bottomLeftX))+" "+parseFloat(S(t.mediaBox.bottomLeftY))+" "+S(t.mediaBox.topRightX)+" "+S(t.mediaBox.topRightY)+"]"),null!==t.cropBox&&Q("/CropBox ["+S(t.cropBox.bottomLeftX)+" "+S(t.cropBox.bottomLeftY)+" "+S(t.cropBox.topRightX)+" "+S(t.cropBox.topRightY)+"]"),null!==t.bleedBox&&Q("/BleedBox ["+S(t.bleedBox.bottomLeftX)+" "+S(t.bleedBox.bottomLeftY)+" "+S(t.bleedBox.topRightX)+" "+S(t.bleedBox.topRightY)+"]"),null!==t.trimBox&&Q("/TrimBox ["+S(t.trimBox.bottomLeftX)+" "+S(t.trimBox.bottomLeftY)+" "+S(t.trimBox.topRightX)+" "+S(t.trimBox.topRightY)+"]"),null!==t.artBox&&Q("/ArtBox ["+S(t.artBox.bottomLeftX)+" "+S(t.artBox.bottomLeftY)+" "+S(t.artBox.topRightX)+" "+S(t.artBox.topRightY)+"]"),"number"==typeof t.userUnit&&1!==t.userUnit&&Q("/UserUnit "+t.userUnit),Bt.publish("putPage",{objId:n,pageContext:Ft[e],pageNumber:e,page:i}),Q("/Contents "+r+" 0 R"),Q(">>"),Q("endobj");var s=i.join("\n");return y===v.ADVANCED&&(s+="\nQ"),Xt(r,!0),ie({data:s,filters:ee(),objectId:r}),Q("endobj"),n},re=p.__private__.putPages=function(){var t,e,i=[];for(t=1;t<=kt;t++)Ft[t].objId=Jt(),Ft[t].contentsObjId=Jt();for(t=1;t<=kt;t++)i.push(ne({number:t,data:Y[t],objId:Ft[t].objId,contentsObjId:Ft[t].contentsObjId,mediaBox:Ft[t].mediaBox,cropBox:Ft[t].cropBox,bleedBox:Ft[t].bleedBox,trimBox:Ft[t].trimBox,artBox:Ft[t].artBox,userUnit:Ft[t].userUnit,rootDictionaryObjId:Zt,resourceDictionaryObjId:$t}));Xt(Zt,!0),Q("<</Type /Pages");var n="/Kids [";for(e=0;e<kt;e++)n+=i[e]+" 0 R ";Q(n+"]"),Q("/Count "+kt),Q(">>"),Q("endobj"),Bt.publish("postPutPages")},se=function(t){var e=function(t,e){return-1!==t.indexOf(" ")?"("+Ce(t,e)+")":Ce(t,e)};Bt.publish("putFont",{font:t,out:Q,newObject:Yt,putStream:ie,pdfEscapeWithNeededParanthesis:e}),!0!==t.isAlreadyPutted&&(t.objectNumber=Yt(),Q("<<"),Q("/Type /Font"),Q("/BaseFont /"+e(t.postScriptName)),Q("/Subtype /Type1"),"string"==typeof t.encoding&&Q("/Encoding /"+t.encoding),Q("/FirstChar 32"),Q("/LastChar 255"),Q(">>"),Q("endobj"))},ae=function(){for(var t in wt)wt.hasOwnProperty(t)&&(!1===u||!0===u&&d.hasOwnProperty(t))&&se(wt[t])},oe=function(t){t.objectNumber=Yt();var e=[];e.push({key:"Type",value:"/XObject"}),e.push({key:"Subtype",value:"/Form"}),e.push({key:"BBox",value:"["+[S(t.x),S(t.y),S(t.x+t.width),S(t.y+t.height)].join(" ")+"]"}),e.push({key:"Matrix",value:"["+t.matrix.toString()+"]"});var i=t.pages[1].join("\n");ie({data:i,additionalKeyValues:e,objectId:t.objectNumber}),Q("endobj")},le=function(){for(var t in jt)jt.hasOwnProperty(t)&&oe(jt[t])},ce=function(t,e){var i,n=[],r=1/(e-1);for(i=0;i<1;i+=r)n.push(i);if(n.push(1),0!=t[0].offset){var s={offset:0,color:t[0].color};t.unshift(s)}if(1!=t[t.length-1].offset){var a={offset:1,color:t[t.length-1].color};t.push(a)}for(var o="",l=0,c=0;c<n.length;c++){for(i=n[c];i>t[l+1].offset;)l++;var h=t[l].offset,u=(i-h)/(t[l+1].offset-h),d=t[l].color,p=t[l+1].color;o+=U(Math.round((1-u)*d[0]+u*p[0]).toString(16))+U(Math.round((1-u)*d[1]+u*p[1]).toString(16))+U(Math.round((1-u)*d[2]+u*p[2]).toString(16))}return o.trim()},he=function(t,e){e||(e=21);var i=Yt(),n=ce(t.colors,e),r=[];r.push({key:"FunctionType",value:"0"}),r.push({key:"Domain",value:"[0.0 1.0]"}),r.push({key:"Size",value:"["+e+"]"}),r.push({key:"BitsPerSample",value:"8"}),r.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),r.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),ie({data:n,additionalKeyValues:r,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:i}),Q("endobj"),t.objectNumber=Yt(),Q("<< /ShadingType "+t.type),Q("/ColorSpace /DeviceRGB");var s="/Coords ["+S(parseFloat(t.coords[0]))+" "+S(parseFloat(t.coords[1]))+" ";2===t.type?s+=S(parseFloat(t.coords[2]))+" "+S(parseFloat(t.coords[3])):s+=S(parseFloat(t.coords[2]))+" "+S(parseFloat(t.coords[3]))+" "+S(parseFloat(t.coords[4]))+" "+S(parseFloat(t.coords[5])),Q(s+="]"),t.matrix&&Q("/Matrix ["+t.matrix.toString()+"]"),Q("/Function "+i+" 0 R"),Q("/Extend [true true]"),Q(">>"),Q("endobj")},ue=function(t,e){var i=Jt(),n=Yt();e.push({resourcesOid:i,objectOid:n}),t.objectNumber=n;var r=[];r.push({key:"Type",value:"/Pattern"}),r.push({key:"PatternType",value:"1"}),r.push({key:"PaintType",value:"1"}),r.push({key:"TilingType",value:"1"}),r.push({key:"BBox",value:"["+t.boundingBox.map(S).join(" ")+"]"}),r.push({key:"XStep",value:S(t.xStep)}),r.push({key:"YStep",value:S(t.yStep)}),r.push({key:"Resources",value:i+" 0 R"}),t.matrix&&r.push({key:"Matrix",value:"["+t.matrix.toString()+"]"}),ie({data:t.stream,additionalKeyValues:r,objectId:t.objectNumber}),Q("endobj")},de=function(t){var e;for(e in Nt)Nt.hasOwnProperty(e)&&(Nt[e]instanceof Lt?he(Nt[e]):Nt[e]instanceof Tt&&ue(Nt[e],t))},pe=function(t){for(var e in t.objectNumber=Yt(),Q("<<"),t)switch(e){case"opacity":Q("/ca "+E(t[e]));break;case"stroke-opacity":Q("/CA "+E(t[e]))}Q(">>"),Q("endobj")},fe=function(){var t;for(t in Dt)Dt.hasOwnProperty(t)&&pe(Dt[t])},me=function(){for(var t in Q("/XObject <<"),jt)jt.hasOwnProperty(t)&&jt[t].objectNumber>=0&&Q("/"+t+" "+jt[t].objectNumber+" 0 R");Bt.publish("putXobjectDict"),Q(">>")},ge=function(){We.oid=Yt(),Q("<<"),Q("/Filter /Standard"),Q("/V "+We.v),Q("/R "+We.r),Q("/U <"+We.toHexString(We.U)+">"),Q("/O <"+We.toHexString(We.O)+">"),Q("/P "+We.P),Q(">>"),Q("endobj")},_e=function(){for(var t in Q("/Font <<"),wt)wt.hasOwnProperty(t)&&(!1===u||!0===u&&d.hasOwnProperty(t))&&Q("/"+t+" "+wt[t].objectNumber+" 0 R");Q(">>")},ve=function(){if(Object.keys(Nt).length>0){for(var t in Q("/Shading <<"),Nt)Nt.hasOwnProperty(t)&&Nt[t]instanceof Lt&&Nt[t].objectNumber>=0&&Q("/"+t+" "+Nt[t].objectNumber+" 0 R");Bt.publish("putShadingPatternDict"),Q(">>")}},ye=function(t){if(Object.keys(Nt).length>0){for(var e in Q("/Pattern <<"),Nt)Nt.hasOwnProperty(e)&&Nt[e]instanceof p.TilingPattern&&Nt[e].objectNumber>=0&&Nt[e].objectNumber<t&&Q("/"+e+" "+Nt[e].objectNumber+" 0 R");Bt.publish("putTilingPatternDict"),Q(">>")}},be=function(){if(Object.keys(Dt).length>0){var t;for(t in Q("/ExtGState <<"),Dt)Dt.hasOwnProperty(t)&&Dt[t].objectNumber>=0&&Q("/"+t+" "+Dt[t].objectNumber+" 0 R");Bt.publish("putGStateDict"),Q(">>")}},xe=function(t){Xt(t.resourcesOid,!0),Q("<<"),Q("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),_e(),ve(),ye(t.objectOid),be(),me(),Q(">>"),Q("endobj")},we=function(){var t=[];ae(),fe(),le(),de(t),Bt.publish("putResources"),t.forEach(xe),xe({resourcesOid:$t,objectOid:Number.MAX_SAFE_INTEGER}),Bt.publish("postPutResources")},Se=function(){Bt.publish("putAdditionalObjects");for(var t=0;t<q.length;t++){var e=q[t];Xt(e.objId,!0),Q(e.content),Q("endobj")}Bt.publish("postPutAdditionalObjects")},Me=function(t){Et[t.fontName]=Et[t.fontName]||{},Et[t.fontName][t.fontStyle]=t.id},Ae=function(t,e,i,n,r){var s={id:"F"+(Object.keys(wt).length+1).toString(10),postScriptName:t,fontName:e,fontStyle:i,encoding:n,isStandardFont:r||!1,metadata:{}};return Bt.publish("addFont",{font:s,instance:this}),wt[s.id]=s,Me(s),s.id},Ee=function(t){for(var e=0,i=nt.length;e<i;e++){var n=Ae.call(this,t[e][0],t[e][1],t[e][2],nt[e][3],!0);!1===u&&(d[n]=!0);var r=t[e][0].split("-");Me({id:n,fontName:r[0],fontStyle:r[1]||""})}Bt.publish("addFonts",{fonts:wt,dictionary:Et})},Le=function(t){return t.foo=function(){try{return t.apply(this,arguments)}catch(t){var e=t.stack||"";~e.indexOf(" at ")&&(e=e.split(" at ")[1]);var i="Error in function "+e.split("\n")[0].split("<")[0]+": "+t.message;if(!$.console)throw new Error(i);$.console.error(i,t),$.alert&&alert(i)}},t.foo.bar=t,t.foo},Te=function(t,e){var i,n,r,s,a,o,l,c,h;if(r=(e=e||{}).sourceEncoding||"Unicode",a=e.outputEncoding,(e.autoencode||a)&&wt[_t].metadata&&wt[_t].metadata[r]&&wt[_t].metadata[r].encoding&&(s=wt[_t].metadata[r].encoding,!a&&wt[_t].encoding&&(a=wt[_t].encoding),!a&&s.codePages&&(a=s.codePages[0]),"string"==typeof a&&(a=s[a]),a)){for(l=!1,o=[],i=0,n=t.length;i<n;i++)(c=a[t.charCodeAt(i)])?o.push(String.fromCharCode(c)):o.push(t[i]),o[i].charCodeAt(0)>>8&&(l=!0);t=o.join("")}for(i=t.length;void 0===l&&0!==i;)t.charCodeAt(i-1)>>8&&(l=!0),i--;if(!l)return t;for(o=e.noBOM?[]:[254,255],i=0,n=t.length;i<n;i++){if((h=(c=t.charCodeAt(i))>>8)>>8)throw new Error("Character at position "+i+" of string '"+t+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");o.push(h),o.push(c-(h<<8))}return String.fromCharCode.apply(void 0,o)},Ce=p.__private__.pdfEscape=p.pdfEscape=function(t,e){return Te(t,e).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Pe=p.__private__.beginPage=function(t){Y[++kt]=[],Ft[kt]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(t[0]),topRightY:Number(t[1])}},De(kt),Z(Y[z])},Ne=function(t,e){var n,s,a;switch(i=e||i,"string"==typeof t&&(n=_(t.toLowerCase()),Array.isArray(n)&&(s=n[0],a=n[1])),Array.isArray(t)&&(s=t[0]*vt,a=t[1]*vt),isNaN(s)&&(s=r[0],a=r[1]),(s>14400||a>14400)&&(tt.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),s=Math.min(14400,s),a=Math.min(14400,a)),r=[s,a],i.substr(0,1)){case"l":a>s&&(r=[a,s]);break;case"p":s>a&&(r=[a,s])}Pe(r),ui(hi),Q(yi),0!==Ai&&Q(Ai+" J"),0!==Ei&&Q(Ei+" j"),Bt.publish("addPage",{pageNumber:kt})},Re=function(t){t>0&&t<=kt&&(Y.splice(t,1),Ft.splice(t,1),kt--,z>kt&&(z=kt),this.setPage(z))},De=function(t){t>0&&t<=kt&&(z=t)},Ie=p.__private__.getNumberOfPages=p.getNumberOfPages=function(){return Y.length-1},Oe=function(t,e,i){var n,r=void 0;return i=i||{},t=void 0!==t?t:wt[_t].fontName,e=void 0!==e?e:wt[_t].fontStyle,n=t.toLowerCase(),void 0!==Et[n]&&void 0!==Et[n][e]?r=Et[n][e]:void 0!==Et[t]&&void 0!==Et[t][e]?r=Et[t][e]:!1===i.disableWarning&&tt.warn("Unable to look up font label for font '"+t+"', '"+e+"'. Refer to getFontList() for available fonts."),r||i.noFallback||null==(r=Et.times[e])&&(r=Et.times.normal),r},ke=p.__private__.putInfo=function(){var t=Yt(),e=function(t){return t};for(var i in null!==h&&(e=We.encryptor(t,0)),Q("<<"),Q("/Producer ("+Ce(e("jsPDF "+Ct.version))+")"),gt)gt.hasOwnProperty(i)&&gt[i]&&Q("/"+i.substr(0,1).toUpperCase()+i.substr(1)+" ("+Ce(e(gt[i]))+")");Q("/CreationDate ("+Ce(e(N))+")"),Q(">>"),Q("endobj")},Fe=p.__private__.putCatalog=function(t){var e=(t=t||{}).rootDictionaryObjId||Zt;switch(Yt(),Q("<<"),Q("/Type /Catalog"),Q("/Pages "+e+" 0 R"),lt||(lt="fullwidth"),lt){case"fullwidth":Q("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Q("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Q("/OpenAction [3 0 R /Fit]");break;case"original":Q("/OpenAction [3 0 R /XYZ null null 1]");break;default:var i=""+lt;"%"===i.substr(i.length-1)&&(lt=parseInt(lt)/100),"number"==typeof lt&&Q("/OpenAction [3 0 R /XYZ null null "+E(lt)+"]")}switch(pt||(pt="continuous"),pt){case"continuous":Q("/PageLayout /OneColumn");break;case"single":Q("/PageLayout /SinglePage");break;case"two":case"twoleft":Q("/PageLayout /TwoColumnLeft");break;case"tworight":Q("/PageLayout /TwoColumnRight")}ut&&Q("/PageMode /"+ut),Bt.publish("putCatalog"),Q(">>"),Q("endobj")},Be=p.__private__.putTrailer=function(){Q("trailer"),Q("<<"),Q("/Size "+(V+1)),Q("/Root "+V+" 0 R"),Q("/Info "+(V-1)+" 0 R"),null!==h&&Q("/Encrypt "+We.oid+" 0 R"),Q("/ID [ <"+R+"> <"+R+"> ]"),Q(">>")},ze=p.__private__.putHeader=function(){Q("%PDF-"+f),Q("%")},je=p.__private__.putXRef=function(){var t="0000000000";Q("xref"),Q("0 "+(V+1)),Q("0000000000 65535 f ");for(var e=1;e<=V;e++)"function"==typeof H[e]?Q((t+H[e]()).slice(-10)+" 00000 n "):void 0!==H[e]?Q((t+H[e]).slice(-10)+" 00000 n "):Q("0000000000 00000 n ")},Ue=p.__private__.buildDocument=function(){K(),Z(G),Bt.publish("buildDocument"),ze(),re(),Se(),we(),null!==h&&ge(),ke(),Fe();var t=W;return je(),Be(),Q("startxref"),Q(""+t),Q("%%EOF"),Z(Y[z]),G.join("\n")},Ve=p.__private__.getBlob=function(t){return new Blob([it(t)],{type:"application/pdf"})},He=p.output=p.__private__.output=Le((function(t,e){switch("string"==typeof(e=e||{})?e={filename:e}:e.filename=e.filename||"generated.pdf",t){case void 0:return Ue();case"save":p.save(e.filename);break;case"arraybuffer":return it(Ue());case"blob":return Ve(Ue());case"bloburi":case"bloburl":if(void 0!==$.URL&&"function"==typeof $.URL.createObjectURL)return $.URL&&$.URL.createObjectURL(Ve(Ue()))||void 0;tt.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var i="",n=Ue();try{i=st(n)}catch(t){i=st(unescape(encodeURIComponent(n)))}return"data:application/pdf;filename="+e.filename+";base64,"+i;case"pdfobjectnewwindow":if("[object Window]"===Object.prototype.toString.call($)){var r='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+(e.pdfObjectUrl||"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js")+'"><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(e)+");<\/script></body></html>",s=$.open();return null!==s&&s.document.write(r),s}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if("[object Window]"===Object.prototype.toString.call($)){var a='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(e.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+e.filename+'" width="500px" height="400px" /></body></html>',o=$.open();if(null!==o){o.document.write(a);var l=this;o.document.documentElement.querySelector("#pdfViewer").onload=function(){o.document.title=e.filename,o.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(l.output("bloburl"))}}return o}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if("[object Window]"!==Object.prototype.toString.call($))throw new Error("The option dataurlnewwindow just works in a browser-environment.");var c='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",e)+'"></iframe></body></html>',h=$.open();if(null!==h&&(h.document.write(c),h.document.title=e.filename),h||"undefined"==typeof safari)return h;break;case"datauri":case"dataurl":return $.document.location.href=this.output("datauristring",e);default:return null}})),Ge=function(t){return!0===Array.isArray(zt)&&zt.indexOf(t)>-1};switch(n){case"pt":vt=1;break;case"mm":vt=72/25.4;break;case"cm":vt=72/2.54;break;case"in":vt=72;break;case"px":vt=1==Ge("px_scaling")?.75:96/72;break;case"pc":case"em":vt=12;break;case"ex":vt=6;break;default:throw new Error("Invalid unit: "+n)}var We=null;F(),I();var qe=function(t){return null!==h?We.encryptor(t,0):function(t){return t}},Ye=p.__private__.getPageInfo=p.getPageInfo=function(t){if(isNaN(t)||t%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Ft[t].objId,pageNumber:t,pageContext:Ft[t]}},Je=p.__private__.getPageInfoByObjId=function(t){if(isNaN(t)||t%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var e in Ft)if(Ft[e].objId===t)break;return Ye(e)},Xe=p.__private__.getCurrentPageInfo=p.getCurrentPageInfo=function(){return{objId:Ft[z].objId,pageNumber:z,pageContext:Ft[z]}};p.addPage=function(){return Ne.apply(this,arguments),this},p.setPage=function(){return De.apply(this,arguments),Z.call(this,Y[z]),this},p.insertPage=function(t){return this.addPage(),this.movePage(z,t),this},p.movePage=function(t,e){var i,n;if(t>e){i=Y[t],n=Ft[t];for(var r=t;r>e;r--)Y[r]=Y[r-1],Ft[r]=Ft[r-1];Y[e]=i,Ft[e]=n,this.setPage(e)}else if(t<e){i=Y[t],n=Ft[t];for(var s=t;s<e;s++)Y[s]=Y[s+1],Ft[s]=Ft[s+1];Y[e]=i,Ft[e]=n,this.setPage(e)}return this},p.deletePage=function(){return Re.apply(this,arguments),this},p.__private__.text=p.text=function(t,e,i,n,r){var s,a,o,l,c,h,u,p,f=(n=n||{}).scope||this;if("number"==typeof t&&"number"==typeof e&&("string"==typeof i||Array.isArray(i))){var m=i;i=e,e=t,t=m}if(arguments[3]instanceof Ht==0?(o=arguments[4],l=arguments[5],"object"==typeof(u=arguments[3])&&null!==u||("string"==typeof o&&(l=o,o=null),"string"==typeof u&&(l=u,u=null),"number"==typeof u&&(o=u,u=null),n={flags:u,angle:o,align:l})):(M("The transform parameter of text() with a Matrix value"),p=r),isNaN(e)||isNaN(i)||null==t)throw new Error("Invalid arguments passed to jsPDF.text");if(0===t.length)return f;var g="",_=!1,b="number"==typeof n.lineHeightFactor?n.lineHeightFactor:ci,x=f.internal.scaleFactor;function w(t){return t=t.split("\t").join(Array(n.TabLen||9).join(" ")),Ce(t,u)}function A(t){for(var e,i=t.concat(),n=[],r=i.length;r--;)"string"==typeof(e=i.shift())?n.push(e):Array.isArray(t)&&(1===e.length||void 0===e[1]&&void 0===e[2])?n.push(e[0]):n.push([e[0],e[1],e[2]]);return n}function E(t,e){var i;if("string"==typeof t)i=e(t)[0];else if(Array.isArray(t)){for(var n,r,s=t.concat(),a=[],o=s.length;o--;)"string"==typeof(n=s.shift())?a.push(e(n)[0]):Array.isArray(n)&&"string"==typeof n[0]&&(r=e(n[0],n[1],n[2]),a.push([r[0],r[1],r[2]]));i=a}return i}var L=!1,C=!0;if("string"==typeof t)L=!0;else if(Array.isArray(t)){var P=t.concat();a=[];for(var N,R=P.length;R--;)("string"!=typeof(N=P.shift())||Array.isArray(N)&&"string"!=typeof N[0])&&(C=!1);L=C}if(!1===L)throw new Error('Type of text must be string or Array. "'+t+'" is not recognized.');"string"==typeof t&&(t=t.match(/[\r?\n]/)?t.split(/\r\n|\r|\n/g):[t]);var D=rt/f.internal.scaleFactor,I=D*(ci-1);switch(n.baseline){case"bottom":i-=I;break;case"top":i+=D-I;break;case"hanging":i+=D-2*I;break;case"middle":i+=D/2-I}if((h=n.maxWidth||0)>0&&("string"==typeof t?t=f.splitTextToSize(t,h):"[object Array]"===Object.prototype.toString.call(t)&&(t=t.reduce((function(t,e){return t.concat(f.splitTextToSize(e,h))}),[]))),s={text:t,x:e,y:i,options:n,mutex:{pdfEscape:Ce,activeFontKey:_t,fonts:wt,activeFontSize:rt}},Bt.publish("preProcessText",s),t=s.text,o=(n=s.options).angle,p instanceof Ht==0&&o&&"number"==typeof o){o*=Math.PI/180,0===n.rotationDirection&&(o=-o),y===v.ADVANCED&&(o=-o);var O=Math.cos(o),k=Math.sin(o);p=new Ht(O,k,-k,O,0,0)}else o&&o instanceof Ht&&(p=o);y!==v.ADVANCED||p||(p=Wt),void 0!==(c=n.charSpace||Si)&&(g+=S(T(c))+" Tc\n",this.setCharSpace(this.getCharSpace()||0)),n.lang;var F=-1,B=void 0!==n.renderingMode?n.renderingMode:n.stroke,z=f.internal.getCurrentPageInfo().pageContext;switch(B){case 0:case!1:case"fill":F=0;break;case 1:case!0:case"stroke":F=1;break;case 2:case"fillThenStroke":F=2;break;case 3:case"invisible":F=3;break;case 4:case"fillAndAddForClipping":F=4;break;case 5:case"strokeAndAddPathForClipping":F=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":F=6;break;case 7:case"addToPathForClipping":F=7}var j=void 0!==z.usedRenderingMode?z.usedRenderingMode:-1;-1!==F?g+=F+" Tr\n":-1!==j&&(g+="0 Tr\n"),-1!==F&&(z.usedRenderingMode=F),l=n.align||"left";var U,V=rt*b,H=f.internal.pageSize.getWidth(),G=wt[_t];c=n.charSpace||Si,h=n.maxWidth||0,u=Object.assign({autoencode:!0,noBOM:!0},n.flags);var W=[];if("[object Array]"===Object.prototype.toString.call(t)){var q;a=A(t),"left"!==l&&(U=a.map((function(t){return f.getStringUnitWidth(t,{font:G,charSpace:c,fontSize:rt,doKerning:!1})*rt/x})));var Y,J=0;if("right"===l){e-=U[0],t=[],R=a.length;for(var X=0;X<R;X++)0===X?(Y=mi(e),q=gi(i)):(Y=T(J-U[X]),q=-V),t.push([a[X],Y,q]),J=U[X]}else if("center"===l){e-=U[0]/2,t=[],R=a.length;for(var K=0;K<R;K++)0===K?(Y=mi(e),q=gi(i)):(Y=T((J-U[K])/2),q=-V),t.push([a[K],Y,q]),J=U[K]}else if("left"===l){t=[],R=a.length;for(var Z=0;Z<R;Z++)t.push(a[Z])}else{if("justify"!==l)throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');t=[],R=a.length,h=0!==h?h:H;for(var $=0;$<R;$++)q=0===$?gi(i):-V,Y=0===$?mi(e):0,$<R-1&&W.push(S(T((h-U[$])/(a[$].split(" ").length-1)))),t.push([a[$],Y,q])}}var tt="boolean"==typeof n.R2L?n.R2L:ht;!0===tt&&(t=E(t,(function(t,e,i){return[t.split("").reverse().join(""),e,i]}))),s={text:t,x:e,y:i,options:n,mutex:{pdfEscape:Ce,activeFontKey:_t,fonts:wt,activeFontSize:rt}},Bt.publish("postProcessText",s),t=s.text,_=s.mutex.isHex||!1;var et=wt[_t].encoding;"WinAnsiEncoding"!==et&&"StandardEncoding"!==et||(t=E(t,(function(t,e,i){return[w(t),e,i]}))),a=A(t),t=[];for(var it,nt,st,at=0,ot=1,lt=Array.isArray(a[0])?ot:at,ct="",ut=function(t,e,i){var r="";return i instanceof Ht?(i="number"==typeof n.angle?Gt(i,new Ht(1,0,0,1,t,e)):Gt(new Ht(1,0,0,1,t,e),i),y===v.ADVANCED&&(i=Gt(new Ht(1,0,0,-1,0,0),i)),r=i.join(" ")+" Tm\n"):r=S(t)+" "+S(e)+" Td\n",r},dt=0;dt<a.length;dt++){switch(ct="",lt){case ot:st=(_?"<":"(")+a[dt][0]+(_?">":")"),it=parseFloat(a[dt][1]),nt=parseFloat(a[dt][2]);break;case at:st=(_?"<":"(")+a[dt]+(_?">":")"),it=mi(e),nt=gi(i)}void 0!==W&&void 0!==W[dt]&&(ct=W[dt]+" Tw\n"),0===dt?t.push(ct+ut(it,nt,p)+st):lt===at?t.push(ct+st):lt===ot&&t.push(ct+ut(it,nt,p)+st)}t=lt===at?t.join(" Tj\nT* "):t.join(" Tj\n"),t+=" Tj\n";var pt="BT\n/";return pt+=_t+" "+rt+" Tf\n",pt+=S(rt*b)+" TL\n",pt+=xi+"\n",pt+=g,pt+=t,Q(pt+="ET"),d[_t]=!0,f};var Ke=p.__private__.clip=p.clip=function(t){return Q("evenodd"===t?"W*":"W"),this};p.clipEvenOdd=function(){return Ke("evenodd")},p.__private__.discardPath=p.discardPath=function(){return Q("n"),this};var Ze=p.__private__.isValidStyle=function(t){var e=!1;return-1!==[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(t)&&(e=!0),e};p.__private__.setDefaultPathOperation=p.setDefaultPathOperation=function(t){return Ze(t)&&(c=t),this};var $e=p.__private__.getStyle=p.getStyle=function(t){var e=c;switch(t){case"D":case"S":e="S";break;case"F":e="f";break;case"FD":case"DF":e="B";break;case"f":case"f*":case"B":case"B*":e=t}return e},Qe=p.close=function(){return Q("h"),this};p.stroke=function(){return Q("S"),this},p.fill=function(t){return ti("f",t),this},p.fillEvenOdd=function(t){return ti("f*",t),this},p.fillStroke=function(t){return ti("B",t),this},p.fillStrokeEvenOdd=function(t){return ti("B*",t),this};var ti=function(t,e){"object"==typeof e?ni(e,t):Q(t)},ei=function(t){null===t||y===v.ADVANCED&&void 0===t||(t=$e(t),Q(t))};function ii(t,e,i,n,r){var s=new Tt(e||this.boundingBox,i||this.xStep,n||this.yStep,this.gState,r||this.matrix);s.stream=this.stream;var a=t+"$$"+this.cloneIndex+++"$$";return qt(a,s),s}var ni=function(t,e){var i=Rt[t.key],n=Nt[i];if(n instanceof Lt)Q("q"),Q(ri(e)),n.gState&&p.setGState(n.gState),Q(t.matrix.toString()+" cm"),Q("/"+i+" sh"),Q("Q");else if(n instanceof Tt){var r=new Ht(1,0,0,-1,0,ki());t.matrix&&(r=r.multiply(t.matrix||Wt),i=ii.call(n,t.key,t.boundingBox,t.xStep,t.yStep,r).id),Q("q"),Q("/Pattern cs"),Q("/"+i+" scn"),n.gState&&p.setGState(n.gState),Q(e),Q("Q")}},ri=function(t){switch(t){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},si=p.moveTo=function(t,e){return Q(S(T(t))+" "+S(P(e))+" m"),this},ai=p.lineTo=function(t,e){return Q(S(T(t))+" "+S(P(e))+" l"),this},oi=p.curveTo=function(t,e,i,n,r,s){return Q([S(T(t)),S(P(e)),S(T(i)),S(P(n)),S(T(r)),S(P(s)),"c"].join(" ")),this};p.__private__.line=p.line=function(t,e,i,n,r){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n)||!Ze(r))throw new Error("Invalid arguments passed to jsPDF.line");return y===v.COMPAT?this.lines([[i-t,n-e]],t,e,[1,1],r||"S"):this.lines([[i-t,n-e]],t,e,[1,1]).stroke()},p.__private__.lines=p.lines=function(t,e,i,n,r,s){var a,o,l,c,h,u,d,p,f,m,g,_;if("number"==typeof t&&(_=i,i=e,e=t,t=_),n=n||[1,1],s=s||!1,isNaN(e)||isNaN(i)||!Array.isArray(t)||!Array.isArray(n)||!Ze(r)||"boolean"!=typeof s)throw new Error("Invalid arguments passed to jsPDF.lines");for(si(e,i),a=n[0],o=n[1],c=t.length,m=e,g=i,l=0;l<c;l++)2===(h=t[l]).length?(m=h[0]*a+m,g=h[1]*o+g,ai(m,g)):(u=h[0]*a+m,d=h[1]*o+g,p=h[2]*a+m,f=h[3]*o+g,m=h[4]*a+m,g=h[5]*o+g,oi(u,d,p,f,m,g));return s&&Qe(),ei(r),this},p.path=function(t){for(var e=0;e<t.length;e++){var i=t[e],n=i.c;switch(i.op){case"m":si(n[0],n[1]);break;case"l":ai(n[0],n[1]);break;case"c":oi.apply(this,n);break;case"h":Qe()}}return this},p.__private__.rect=p.rect=function(t,e,i,n,r){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n)||!Ze(r))throw new Error("Invalid arguments passed to jsPDF.rect");return y===v.COMPAT&&(n=-n),Q([S(T(t)),S(P(e)),S(T(i)),S(T(n)),"re"].join(" ")),ei(r),this},p.__private__.triangle=p.triangle=function(t,e,i,n,r,s,a){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n)||isNaN(r)||isNaN(s)||!Ze(a))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[i-t,n-e],[r-i,s-n],[t-r,e-s]],t,e,[1,1],a,!0),this},p.__private__.roundedRect=p.roundedRect=function(t,e,i,n,r,s,a){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n)||isNaN(r)||isNaN(s)||!Ze(a))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var o=4/3*(Math.SQRT2-1);return r=Math.min(r,.5*i),s=Math.min(s,.5*n),this.lines([[i-2*r,0],[r*o,0,r,s-s*o,r,s],[0,n-2*s],[0,s*o,-r*o,s,-r,s],[2*r-i,0],[-r*o,0,-r,-s*o,-r,-s],[0,2*s-n],[0,-s*o,r*o,-s,r,-s]],t+r,e,[1,1],a,!0),this},p.__private__.ellipse=p.ellipse=function(t,e,i,n,r){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n)||!Ze(r))throw new Error("Invalid arguments passed to jsPDF.ellipse");var s=4/3*(Math.SQRT2-1)*i,a=4/3*(Math.SQRT2-1)*n;return si(t+i,e),oi(t+i,e-a,t+s,e-n,t,e-n),oi(t-s,e-n,t-i,e-a,t-i,e),oi(t-i,e+a,t-s,e+n,t,e+n),oi(t+s,e+n,t+i,e+a,t+i,e),ei(r),this},p.__private__.circle=p.circle=function(t,e,i,n){if(isNaN(t)||isNaN(e)||isNaN(i)||!Ze(n))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(t,e,i,i,n)},p.setFont=function(t,e,i){return i&&(e=w(e,i)),_t=Oe(t,e,{disableWarning:!1}),this};var li=p.__private__.getFont=p.getFont=function(){return wt[Oe.apply(p,arguments)]};p.__private__.getFontList=p.getFontList=function(){var t,e,i={};for(t in Et)if(Et.hasOwnProperty(t))for(e in i[t]=[],Et[t])Et[t].hasOwnProperty(e)&&i[t].push(e);return i},p.addFont=function(t,e,i,n,r){var s=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&-1!==s.indexOf(arguments[3])?r=arguments[3]:arguments[3]&&-1==s.indexOf(arguments[3])&&(i=w(i,n)),r=r||"Identity-H",Ae.call(this,t,e,i,r)};var ci,hi=t.lineWidth||.200025,ui=p.__private__.setLineWidth=p.setLineWidth=function(t){return Q(S(T(t))+" w"),this};p.__private__.setLineDash=Ct.API.setLineDash=Ct.API.setLineDashPattern=function(t,e){if(t=t||[],e=e||0,isNaN(e)||!Array.isArray(t))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return t=t.map((function(t){return S(T(t))})).join(" "),e=S(T(e)),Q("["+t+"] "+e+" d"),this};var di=p.__private__.getLineHeight=p.getLineHeight=function(){return rt*ci};p.__private__.getLineHeight=p.getLineHeight=function(){return rt*ci};var pi=p.__private__.setLineHeightFactor=p.setLineHeightFactor=function(t){return"number"==typeof(t=t||1.15)&&(ci=t),this},fi=p.__private__.getLineHeightFactor=p.getLineHeightFactor=function(){return ci};pi(t.lineHeight);var mi=p.__private__.getHorizontalCoordinate=function(t){return T(t)},gi=p.__private__.getVerticalCoordinate=function(t){return y===v.ADVANCED?t:Ft[z].mediaBox.topRightY-Ft[z].mediaBox.bottomLeftY-T(t)},_i=p.__private__.getHorizontalCoordinateString=p.getHorizontalCoordinateString=function(t){return S(mi(t))},vi=p.__private__.getVerticalCoordinateString=p.getVerticalCoordinateString=function(t){return S(gi(t))},yi=t.strokeColor||"0 G";p.__private__.getStrokeColor=p.getDrawColor=function(){return Qt(yi)},p.__private__.setStrokeColor=p.setDrawColor=function(t,e,i,n){return yi=te({ch1:t,ch2:e,ch3:i,ch4:n,pdfColorType:"draw",precision:2}),Q(yi),this};var bi=t.fillColor||"0 g";p.__private__.getFillColor=p.getFillColor=function(){return Qt(bi)},p.__private__.setFillColor=p.setFillColor=function(t,e,i,n){return bi=te({ch1:t,ch2:e,ch3:i,ch4:n,pdfColorType:"fill",precision:2}),Q(bi),this};var xi=t.textColor||"0 g",wi=p.__private__.getTextColor=p.getTextColor=function(){return Qt(xi)};p.__private__.setTextColor=p.setTextColor=function(t,e,i,n){return xi=te({ch1:t,ch2:e,ch3:i,ch4:n,pdfColorType:"text",precision:3}),this};var Si=t.charSpace,Mi=p.__private__.getCharSpace=p.getCharSpace=function(){return parseFloat(Si||0)};p.__private__.setCharSpace=p.setCharSpace=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Si=t,this};var Ai=0;p.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},p.__private__.setLineCap=p.setLineCap=function(t){var e=p.CapJoinStyles[t];if(void 0===e)throw new Error("Line cap style of '"+t+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Ai=e,Q(e+" J"),this};var Ei=0;p.__private__.setLineJoin=p.setLineJoin=function(t){var e=p.CapJoinStyles[t];if(void 0===e)throw new Error("Line join style of '"+t+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Ei=e,Q(e+" j"),this},p.__private__.setLineMiterLimit=p.__private__.setMiterLimit=p.setLineMiterLimit=p.setMiterLimit=function(t){if(t=t||0,isNaN(t))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Q(S(T(t))+" M"),this},p.GState=At,p.setGState=function(t){(t="string"==typeof t?Dt[It[t]]:Li(null,t)).equals(Ot)||(Q("/"+t.id+" gs"),Ot=t)};var Li=function(t,e){if(!t||!It[t]){var i=!1;for(var n in Dt)if(Dt.hasOwnProperty(n)&&Dt[n].equals(e)){i=!0;break}if(i)e=Dt[n];else{var r="GS"+(Object.keys(Dt).length+1).toString(10);Dt[r]=e,e.id=r}return t&&(It[t]=e.id),Bt.publish("addGState",e),e}};p.addGState=function(t,e){return Li(t,e),this},p.saveGraphicsState=function(){return Q("q"),Pt.push({key:_t,size:rt,color:xi}),this},p.restoreGraphicsState=function(){Q("Q");var t=Pt.pop();return _t=t.key,rt=t.size,xi=t.color,Ot=null,this},p.setCurrentTransformationMatrix=function(t){return Q(t.toString()+" cm"),this},p.comment=function(t){return Q("#"+t),this};var Ti=function(t,e){var i=t||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return i},set:function(t){isNaN(t)||(i=parseFloat(t))}});var n=e||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return n},set:function(t){isNaN(t)||(n=parseFloat(t))}});var r="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return r},set:function(t){r=t.toString()}}),this},Ci=function(t,e,i,n){Ti.call(this,t,e),this.type="rect";var r=i||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return r},set:function(t){isNaN(t)||(r=parseFloat(t))}});var s=n||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return s},set:function(t){isNaN(t)||(s=parseFloat(t))}}),this},Pi=function(){this.page=kt,this.currentPage=z,this.pages=Y.slice(0),this.pagesContext=Ft.slice(0),this.x=yt,this.y=bt,this.matrix=xt,this.width=Ii(z),this.height=ki(z),this.outputDestination=X,this.id="",this.objectNumber=-1};Pi.prototype.restore=function(){kt=this.page,z=this.currentPage,Ft=this.pagesContext,Y=this.pages,yt=this.x,bt=this.y,xt=this.matrix,Oi(z,this.width),Fi(z,this.height),X=this.outputDestination};var Ni=function(t,e,i,n,r){Vt.push(new Pi),kt=z=0,Y=[],yt=t,bt=e,xt=r,Pe([i,n])},Ri=function(t){if(!Ut[t]){var e=new Pi,i="Xo"+(Object.keys(jt).length+1).toString(10);e.id=i,Ut[t]=i,jt[i]=e,Bt.publish("addFormObject",e),Vt.pop().restore()}};for(var Di in p.beginFormObject=function(t,e,i,n,r){return Ni(t,e,i,n,r),this},p.endFormObject=function(t){return Ri(t),this},p.doFormObject=function(t,e){var i=jt[Ut[t]];return Q("q"),Q(e.toString()+" cm"),Q("/"+i.id+" Do"),Q("Q"),this},p.getFormObject=function(t){var e=jt[Ut[t]];return{x:e.x,y:e.y,width:e.width,height:e.height,matrix:e.matrix}},p.save=function(t,e){return t=t||"generated.pdf",(e=e||{}).returnPromise=e.returnPromise||!1,!1===e.returnPromise?(at(Ve(Ue()),t),"function"==typeof at.unload&&$.setTimeout&&setTimeout(at.unload,911),this):new Promise((function(e,i){try{var n=at(Ve(Ue()),t);"function"==typeof at.unload&&$.setTimeout&&setTimeout(at.unload,911),e(n)}catch(t){i(t.message)}}))},Ct.API)Ct.API.hasOwnProperty(Di)&&("events"===Di&&Ct.API.events.length?function(t,e){var i,n,r;for(r=e.length-1;-1!==r;r--)i=e[r][0],n=e[r][1],t.subscribe.apply(t,[i].concat("function"==typeof n?[n]:n))}(Bt,Ct.API.events):p[Di]=Ct.API[Di]);var Ii=p.getPageWidth=function(t){return(Ft[t=t||z].mediaBox.topRightX-Ft[t].mediaBox.bottomLeftX)/vt},Oi=p.setPageWidth=function(t,e){Ft[t].mediaBox.topRightX=e*vt+Ft[t].mediaBox.bottomLeftX},ki=p.getPageHeight=function(t){return(Ft[t=t||z].mediaBox.topRightY-Ft[t].mediaBox.bottomLeftY)/vt},Fi=p.setPageHeight=function(t,e){Ft[t].mediaBox.topRightY=e*vt+Ft[t].mediaBox.bottomLeftY};return p.internal={pdfEscape:Ce,getStyle:$e,getFont:li,getFontSize:ct,getCharSpace:Mi,getTextColor:wi,getLineHeight:di,getLineHeightFactor:fi,write:et,getHorizontalCoordinate:mi,getVerticalCoordinate:gi,getCoordinateString:_i,getVerticalCoordinateString:vi,collections:{},newObject:Yt,newAdditionalObject:Kt,newObjectDeferred:Jt,newObjectDeferredBegin:Xt,getFilters:ee,putStream:ie,events:Bt,scaleFactor:vt,pageSize:{getWidth:function(){return Ii(z)},setWidth:function(t){Oi(z,t)},getHeight:function(){return ki(z)},setHeight:function(t){Fi(z,t)}},encryptionOptions:h,encryption:We,getEncryptor:qe,output:He,getNumberOfPages:Ie,pages:Y,out:Q,f2:E,f3:L,getPageInfo:Ye,getPageInfoByObjId:Je,getCurrentPageInfo:Xe,getPDFVersion:m,Point:Ti,Rectangle:Ci,Matrix:Ht,hasHotfix:Ge},Object.defineProperty(p.internal.pageSize,"width",{get:function(){return Ii(z)},set:function(t){Oi(z,t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.internal.pageSize,"height",{get:function(){return ki(z)},set:function(t){Fi(z,t)},enumerable:!0,configurable:!0}),Ee.call(p,nt),_t="F1",Ne(r,i),Bt.publish("initialized"),p}St.prototype.lsbFirstWord=function(t){return String.fromCharCode(t>>0&255,t>>8&255,t>>16&255,t>>24&255)},St.prototype.toHexString=function(t){return t.split("").map((function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)})).join("")},St.prototype.hexToBytes=function(t){for(var e=[],i=0;i<t.length;i+=2)e.push(String.fromCharCode(parseInt(t.substr(i,2),16)));return e.join("")},St.prototype.processOwnerPassword=function(t,e){return xt(yt(e).substr(0,5),t)},St.prototype.encryptor=function(t,e){let i=yt(this.encryptionKey+String.fromCharCode(255&t,t>>8&255,t>>16&255,255&e,e>>8&255)).substr(0,10);return function(t){return xt(i,t)}},At.prototype.equals=function(t){var e,i="id,objectNumber,equals";if(!t||typeof t!=typeof this)return!1;var n=0;for(e in this)if(!(i.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!t.hasOwnProperty(e))return!1;if(this[e]!==t[e])return!1;n++}for(e in t)t.hasOwnProperty(e)&&i.indexOf(e)<0&&n--;return 0===n},Ct.API={events:[]},Ct.version="2.3.1";var Pt=Ct.API,Nt=1,Rt=function(t){return t.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Dt=function(t){return t.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},It=function(t){return t.toFixed(2)},Ot=function(t){return t.toFixed(5)};Pt.__acroform__={};var kt=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},Ft=function(t){return t*Nt},Bt=function(t){var e=new te,i=fe.internal.getHeight(t)||0,n=fe.internal.getWidth(t)||0;return e.BBox=[0,0,Number(It(n)),Number(It(i))],e},zt=Pt.__acroform__.setBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return t|1<<e},jt=Pt.__acroform__.clearBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return t&~(1<<e)},Ut=Pt.__acroform__.getBit=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return 0==(t&1<<e)?0:1},Vt=Pt.__acroform__.getBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Ut(t,e-1)},Ht=Pt.__acroform__.setBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return zt(t,e-1)},Gt=Pt.__acroform__.clearBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return jt(t,e-1)},Wt=Pt.__acroform__.calculateCoordinates=function(t,e){var i=e.internal.getHorizontalCoordinate,n=e.internal.getVerticalCoordinate,r=t[0],s=t[1],a=t[2],o=t[3],l={};return l.lowerLeft_X=i(r)||0,l.lowerLeft_Y=n(s+o)||0,l.upperRight_X=i(r+a)||0,l.upperRight_Y=n(s)||0,[Number(It(l.lowerLeft_X)),Number(It(l.lowerLeft_Y)),Number(It(l.upperRight_X)),Number(It(l.upperRight_Y))]},qt=function(t){if(t.appearanceStreamContent)return t.appearanceStreamContent;if(t.V||t.DV){var e=[],i=t._V||t.DV,n=Yt(t,i),r=t.scope.internal.getFont(t.fontName,t.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(t.scope.__private__.encodeColorString(t.color)),e.push("/"+r+" "+It(n.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(n.text),e.push("ET"),e.push("Q"),e.push("EMC");var s=Bt(t);return s.scope=t.scope,s.stream=e.join("\n"),s}},Yt=function(t,e){var i=0===t.fontSize?t.maxFontSize:t.fontSize,n={text:"",fontSize:""},r=(e=")"==(e="("==e.substr(0,1)?e.substr(1):e).substr(e.length-1)?e.substr(0,e.length-1):e).split(" "),s=i,a=fe.internal.getHeight(t)||0;a=a<0?-a:a;var o=fe.internal.getWidth(t)||0;o=o<0?-o:o;var l=function(e,i,n){if(e+1<r.length){var s=i+" "+r[e+1];return Jt(s,t,n).width<=o-4}return!1};s++;t:for(;s>0;){e="",s--;var c,h,u=Jt("3",t,s).height,d=t.multiline?a-s:(a-u)/2,p=d+=2,f=0,m=0;if(s<=0){e="(...) Tj\n",e+="% Width of Text: "+Jt(e,t,s=12).width+", FieldWidth:"+o+"\n";break}var g="",_=0;for(var v in r)if(r.hasOwnProperty(v)){g=" "==(g+=r[v]+" ").substr(g.length-1)?g.substr(0,g.length-1):g;var y=parseInt(v),b=l(y,g,s),x=v>=r.length-1;if(b&&!x){g+=" ";continue}if(b||x){if(x)m=y;else if(t.multiline&&(u+2)*(_+2)+2>a)continue t}else{if(!t.multiline)continue t;if((u+2)*(_+2)+2>a)continue t;m=y}for(var w="",S=f;S<=m;S++)w+=r[S]+" ";switch(w=" "==w.substr(w.length-1)?w.substr(0,w.length-1):w,h=Jt(w,t,s).width,t.textAlign){case"right":c=o-h-2;break;case"center":c=(o-h)/2;break;case"left":default:c=2}e+=It(c)+" "+It(p)+" Td\n",e+="("+Rt(w)+") Tj\n",e+=-It(c)+" 0 Td\n",p=-(s+2),h=0,f=m+1,_++,g=""}break}return n.text=e,n.fontSize=s,n},Jt=function(t,e,i){var n=e.scope.internal.getFont(e.fontName,e.fontStyle),r=e.scope.getStringUnitWidth(t,{font:n,fontSize:parseFloat(i),charSpace:0})*parseFloat(i);return{height:e.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(i),charSpace:0})*parseFloat(i)*1.5,width:r}},Xt={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Kt=function(t,e){var i={type:"reference",object:t};void 0===e.internal.getPageInfo(t.page).pageContext.annotations.find((function(t){return t.type===i.type&&t.object===i.object}))&&e.internal.getPageInfo(t.page).pageContext.annotations.push(i)},Zt=Pt.__acroform__.arrayToPdfArray=function(t,e,i){var n=function(t){return t};if(Array.isArray(t)){for(var r="[",s=0;s<t.length;s++)switch(0!==s&&(r+=" "),typeof t[s]){case"boolean":case"number":case"object":r+=t[s].toString();break;case"string":"/"!==t[s].substr(0,1)?(void 0!==e&&i&&(n=i.internal.getEncryptor(e)),r+="("+Rt(n(t[s].toString()))+")"):r+=t[s].toString()}return r+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},$t=function(t,e,i){var n=function(t){return t};return void 0!==e&&i&&(n=i.internal.getEncryptor(e)),(t=t||"").toString(),"("+Rt(n(t))+")"},Qt=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(void 0===this._objId){if(void 0===this.scope)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(t){this._objId=t}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Qt.prototype.toString=function(){return this.objId+" 0 R"},Qt.prototype.putStream=function(){var t=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:t,objectId:this.objId}),this.scope.internal.out("endobj")},Qt.prototype.getKeyValueListForStream=function(){var t=[],e=Object.getOwnPropertyNames(this).filter((function(t){return"content"!=t&&"appearanceStreamContent"!=t&&"scope"!=t&&"objId"!=t&&"_"!=t.substring(0,1)}));for(var i in e)if(!1===Object.getOwnPropertyDescriptor(this,e[i]).configurable){var n=e[i],r=this[n];r&&(Array.isArray(r)?t.push({key:n,value:Zt(r,this.objId,this.scope)}):r instanceof Qt?(r.scope=this.scope,t.push({key:n,value:r.objId+" 0 R"})):"function"!=typeof r&&t.push({key:n,value:r}))}return t};var te=function(){Qt.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var t,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){t=e.trim()},get:function(){return t||null}})};kt(te,Qt);var ee=function(){Qt.call(this);var t,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(t){var e=function(t){return t};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+Rt(e(t))+")"}},set:function(e){t=e}})};kt(ee,Qt);var ie=function(){Qt.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute F supplied.');t=e}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(t,3))},set:function(e){!0===Boolean(e)?this.F=Ht(t,3):this.F=Gt(t,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){if(isNaN(t))throw new Error('Invalid value "'+t+'" for attribute Ff supplied.');e=t}});var i=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(0!==i.length)return i},set:function(t){i=void 0!==t?t:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[0])?0:i[0]},set:function(t){i[0]=t}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[1])?0:i[1]},set:function(t){i[1]=t}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[2])?0:i[2]},set:function(t){i[2]=t}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[3])?0:i[3]},set:function(t){i[3]=t}});var n="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return n},set:function(t){switch(t){case"/Btn":case"/Tx":case"/Ch":case"/Sig":n=t;break;default:throw new Error('Invalid value "'+t+'" for attribute FT supplied.')}}});var r=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!r||r.length<1){if(this instanceof he)return;r="FieldObject"+ie.FieldNum++}var t=function(t){return t};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Rt(t(r))+")"},set:function(t){r=t.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return r},set:function(t){r=t}});var s="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return s},set:function(t){s=t}});var a="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return a},set:function(t){a=t}});var o=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return o},set:function(t){o=t}});var l=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return void 0===l?50/Nt:l},set:function(t){l=t}});var c="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return c},set:function(t){c=t}});var h="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!h||this instanceof he||this instanceof de))return $t(h,this.objId,this.scope)},set:function(t){t=t.toString(),h=t}});var u=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(u)return this instanceof oe==0?$t(u,this.objId,this.scope):u},set:function(t){t=t.toString(),u=this instanceof oe==0?"("===t.substr(0,1)?Dt(t.substr(1,t.length-2)):Dt(t):t}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof oe==1?Dt(u.substr(1,u.length-1)):u},set:function(t){t=t.toString(),u=this instanceof oe==1?"/"+t:t}});var d=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(d)return d},set:function(t){this.V=t}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(d)return this instanceof oe==0?$t(d,this.objId,this.scope):d},set:function(t){t=t.toString(),d=this instanceof oe==0?"("===t.substr(0,1)?Dt(t.substr(1,t.length-2)):Dt(t):t}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof oe==1?Dt(d.substr(1,d.length-1)):d},set:function(t){t=t.toString(),d=this instanceof oe==1?"/"+t:t}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var p,f=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return f},set:function(t){t=Boolean(t),f=t}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(p)return p},set:function(t){p=t}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,1))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,1):this.Ff=Gt(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,2))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,2):this.Ff=Gt(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,3))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,3):this.Ff=Gt(this.Ff,3)}});var m=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(null!==m)return m},set:function(t){if(-1===[0,1,2].indexOf(t))throw new Error('Invalid value "'+t+'" for attribute Q supplied.');m=t}}),Object.defineProperty(this,"textAlign",{get:function(){var t;switch(m){case 0:default:t="left";break;case 1:t="center";break;case 2:t="right"}return t},configurable:!0,enumerable:!0,set:function(t){switch(t){case"right":case 2:m=2;break;case"center":case 1:m=1;break;case"left":case 0:default:m=0}}})};kt(ie,Qt);var ne=function(){ie.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var t=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){t=e}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return Zt(e,this.objId,this.scope)},set:function(t){var i,n;n=[],"string"==typeof(i=t)&&(n=function(t,e,i){i||(i=1);for(var n,r=[];n=e.exec(t);)r.push(n[i]);return r}(i,/\((.*?)\)/g)),e=n}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,i){for(i=i||!1,t=(t=t||"").toString();-1!==e.indexOf(t)&&(e.splice(e.indexOf(t),1),!1!==i););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,18))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,18):this.Ff=Gt(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,19))},set:function(t){!0===this.combo&&(!0===Boolean(t)?this.Ff=Ht(this.Ff,19):this.Ff=Gt(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,20))},set:function(t){!0===Boolean(t)?(this.Ff=Ht(this.Ff,20),e.sort()):this.Ff=Gt(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,22))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,22):this.Ff=Gt(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,23))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,23):this.Ff=Gt(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,27))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,27):this.Ff=Gt(this.Ff,27)}}),this.hasAppearanceStream=!1};kt(ne,ie);var re=function(){ne.call(this),this.fontName="helvetica",this.combo=!1};kt(re,ne);var se=function(){re.call(this),this.combo=!0};kt(se,re);var ae=function(){se.call(this),this.edit=!0};kt(ae,se);var oe=function(){ie.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,15))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,15):this.Ff=Gt(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,16))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,16):this.Ff=Gt(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,17))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,17):this.Ff=Gt(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,26))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,26):this.Ff=Gt(this.Ff,26)}});var t,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(t){return t};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),0!==Object.keys(e).length){var i,n=[];for(i in n.push("<<"),e)n.push("/"+i+" ("+Rt(t(e[i]))+")");return n.push(">>"),n.join("\n")}},set:function(t){"object"==typeof t&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){"string"==typeof t&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(e){t="/"+e}})};kt(oe,ie);var le=function(){oe.call(this),this.pushButton=!0};kt(le,oe);var ce=function(){oe.call(this),this.radio=!0,this.pushButton=!1;var t=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=void 0!==e?e:[]}})};kt(ce,oe);var he=function(){var t,e;ie.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(t){e=t}});var i,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(t){return t};this.scope&&(t=this.scope.internal.getEncryptor(this.objId));var e,i=[];for(e in i.push("<<"),n)i.push("/"+e+" ("+Rt(t(n[e]))+")");return i.push(">>"),i.join("\n")},set:function(t){"object"==typeof t&&(n=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(t){"string"==typeof t&&(n.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return i.substr(1,i.length-1)},set:function(t){i="/"+t}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=fe.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};kt(he,ie),ce.prototype.setAppearance=function(t){if(!("createAppearanceStream"in t)||!("getCA"in t))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var i=this.Kids[e];i.appearanceStreamContent=t.createAppearanceStream(i.optionName),i.caption=t.getCA()}},ce.prototype.createOption=function(t){var e=new he;return e.Parent=this,e.optionName=t,this.Kids.push(e),me.call(this.scope,e),e};var ue=function(){oe.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=fe.CheckBox.createAppearanceStream()};kt(ue,oe);var de=function(){ie.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,13))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,13):this.Ff=Gt(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,21))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,21):this.Ff=Gt(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,23))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,23):this.Ff=Gt(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,24))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,24):this.Ff=Gt(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,25))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,25):this.Ff=Gt(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,26))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,26):this.Ff=Gt(this.Ff,26)}});var t=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){Number.isInteger(e)&&(t=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};kt(de,ie);var pe=function(){de.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return Boolean(Vt(this.Ff,14))},set:function(t){!0===Boolean(t)?this.Ff=Ht(this.Ff,14):this.Ff=Gt(this.Ff,14)}}),this.password=!0};kt(pe,de);var fe={CheckBox:{createAppearanceStream:function(){return{N:{On:fe.CheckBox.YesNormal},D:{On:fe.CheckBox.YesPushDown,Off:fe.CheckBox.OffPushDown}}},YesPushDown:function(t){var e=Bt(t);e.scope=t.scope;var i=[],n=t.scope.internal.getFont(t.fontName,t.fontStyle).id,r=t.scope.__private__.encodeColorString(t.color),s=Yt(t,t.caption);return i.push("0.749023 g"),i.push("0 0 "+It(fe.internal.getWidth(t))+" "+It(fe.internal.getHeight(t))+" re"),i.push("f"),i.push("BMC"),i.push("q"),i.push("0 0 1 rg"),i.push("/"+n+" "+It(s.fontSize)+" Tf "+r),i.push("BT"),i.push(s.text),i.push("ET"),i.push("Q"),i.push("EMC"),e.stream=i.join("\n"),e},YesNormal:function(t){var e=Bt(t);e.scope=t.scope;var i=t.scope.internal.getFont(t.fontName,t.fontStyle).id,n=t.scope.__private__.encodeColorString(t.color),r=[],s=fe.internal.getHeight(t),a=fe.internal.getWidth(t),o=Yt(t,t.caption);return r.push("1 g"),r.push("0 0 "+It(a)+" "+It(s)+" re"),r.push("f"),r.push("q"),r.push("0 0 1 rg"),r.push("0 0 "+It(a-1)+" "+It(s-1)+" re"),r.push("W"),r.push("n"),r.push("0 g"),r.push("BT"),r.push("/"+i+" "+It(o.fontSize)+" Tf "+n),r.push(o.text),r.push("ET"),r.push("Q"),e.stream=r.join("\n"),e},OffPushDown:function(t){var e=Bt(t);e.scope=t.scope;var i=[];return i.push("0.749023 g"),i.push("0 0 "+It(fe.internal.getWidth(t))+" "+It(fe.internal.getHeight(t))+" re"),i.push("f"),e.stream=i.join("\n"),e}},RadioButton:{Circle:{createAppearanceStream:function(t){var e={D:{Off:fe.RadioButton.Circle.OffPushDown},N:{}};return e.N[t]=fe.RadioButton.Circle.YesNormal,e.D[t]=fe.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(t){var e=Bt(t);e.scope=t.scope;var i=[],n=fe.internal.getWidth(t)<=fe.internal.getHeight(t)?fe.internal.getWidth(t)/4:fe.internal.getHeight(t)/4;n=Number((.9*n).toFixed(5));var r=fe.internal.Bezier_C,s=Number((n*r).toFixed(5));return i.push("q"),i.push("1 0 0 1 "+Ot(fe.internal.getWidth(t)/2)+" "+Ot(fe.internal.getHeight(t)/2)+" cm"),i.push(n+" 0 m"),i.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),i.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),i.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),i.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),i.push("f"),i.push("Q"),e.stream=i.join("\n"),e},YesPushDown:function(t){var e=Bt(t);e.scope=t.scope;var i=[],n=fe.internal.getWidth(t)<=fe.internal.getHeight(t)?fe.internal.getWidth(t)/4:fe.internal.getHeight(t)/4;n=Number((.9*n).toFixed(5));var r=Number((2*n).toFixed(5)),s=Number((r*fe.internal.Bezier_C).toFixed(5)),a=Number((n*fe.internal.Bezier_C).toFixed(5));return i.push("0.749023 g"),i.push("q"),i.push("1 0 0 1 "+Ot(fe.internal.getWidth(t)/2)+" "+Ot(fe.internal.getHeight(t)/2)+" cm"),i.push(r+" 0 m"),i.push(r+" "+s+" "+s+" "+r+" 0 "+r+" c"),i.push("-"+s+" "+r+" -"+r+" "+s+" -"+r+" 0 c"),i.push("-"+r+" -"+s+" -"+s+" -"+r+" 0 -"+r+" c"),i.push(s+" -"+r+" "+r+" -"+s+" "+r+" 0 c"),i.push("f"),i.push("Q"),i.push("0 g"),i.push("q"),i.push("1 0 0 1 "+Ot(fe.internal.getWidth(t)/2)+" "+Ot(fe.internal.getHeight(t)/2)+" cm"),i.push(n+" 0 m"),i.push(n+" "+a+" "+a+" "+n+" 0 "+n+" c"),i.push("-"+a+" "+n+" -"+n+" "+a+" -"+n+" 0 c"),i.push("-"+n+" -"+a+" -"+a+" -"+n+" 0 -"+n+" c"),i.push(a+" -"+n+" "+n+" -"+a+" "+n+" 0 c"),i.push("f"),i.push("Q"),e.stream=i.join("\n"),e},OffPushDown:function(t){var e=Bt(t);e.scope=t.scope;var i=[],n=fe.internal.getWidth(t)<=fe.internal.getHeight(t)?fe.internal.getWidth(t)/4:fe.internal.getHeight(t)/4;n=Number((.9*n).toFixed(5));var r=Number((2*n).toFixed(5)),s=Number((r*fe.internal.Bezier_C).toFixed(5));return i.push("0.749023 g"),i.push("q"),i.push("1 0 0 1 "+Ot(fe.internal.getWidth(t)/2)+" "+Ot(fe.internal.getHeight(t)/2)+" cm"),i.push(r+" 0 m"),i.push(r+" "+s+" "+s+" "+r+" 0 "+r+" c"),i.push("-"+s+" "+r+" -"+r+" "+s+" -"+r+" 0 c"),i.push("-"+r+" -"+s+" -"+s+" -"+r+" 0 -"+r+" c"),i.push(s+" -"+r+" "+r+" -"+s+" "+r+" 0 c"),i.push("f"),i.push("Q"),e.stream=i.join("\n"),e}},Cross:{createAppearanceStream:function(t){var e={D:{Off:fe.RadioButton.Cross.OffPushDown},N:{}};return e.N[t]=fe.RadioButton.Cross.YesNormal,e.D[t]=fe.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(t){var e=Bt(t);e.scope=t.scope;var i=[],n=fe.internal.calculateCross(t);return i.push("q"),i.push("1 1 "+It(fe.internal.getWidth(t)-2)+" "+It(fe.internal.getHeight(t)-2)+" re"),i.push("W"),i.push("n"),i.push(It(n.x1.x)+" "+It(n.x1.y)+" m"),i.push(It(n.x2.x)+" "+It(n.x2.y)+" l"),i.push(It(n.x4.x)+" "+It(n.x4.y)+" m"),i.push(It(n.x3.x)+" "+It(n.x3.y)+" l"),i.push("s"),i.push("Q"),e.stream=i.join("\n"),e},YesPushDown:function(t){var e=Bt(t);e.scope=t.scope;var i=fe.internal.calculateCross(t),n=[];return n.push("0.749023 g"),n.push("0 0 "+It(fe.internal.getWidth(t))+" "+It(fe.internal.getHeight(t))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+It(fe.internal.getWidth(t)-2)+" "+It(fe.internal.getHeight(t)-2)+" re"),n.push("W"),n.push("n"),n.push(It(i.x1.x)+" "+It(i.x1.y)+" m"),n.push(It(i.x2.x)+" "+It(i.x2.y)+" l"),n.push(It(i.x4.x)+" "+It(i.x4.y)+" m"),n.push(It(i.x3.x)+" "+It(i.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join("\n"),e},OffPushDown:function(t){var e=Bt(t);e.scope=t.scope;var i=[];return i.push("0.749023 g"),i.push("0 0 "+It(fe.internal.getWidth(t))+" "+It(fe.internal.getHeight(t))+" re"),i.push("f"),e.stream=i.join("\n"),e}}},createDefaultAppearanceStream:function(t){var e=t.scope.internal.getFont(t.fontName,t.fontStyle).id,i=t.scope.__private__.encodeColorString(t.color);return"/"+e+" "+t.fontSize+" Tf "+i}};fe.internal={Bezier_C:.551915024494,calculateCross:function(t){var e=fe.internal.getWidth(t),i=fe.internal.getHeight(t),n=Math.min(e,i);return{x1:{x:(e-n)/2,y:(i-n)/2+n},x2:{x:(e-n)/2+n,y:(i-n)/2},x3:{x:(e-n)/2,y:(i-n)/2},x4:{x:(e-n)/2+n,y:(i-n)/2+n}}}},fe.internal.getWidth=function(t){var e=0;return"object"==typeof t&&(e=Ft(t.Rect[2])),e},fe.internal.getHeight=function(t){var e=0;return"object"==typeof t&&(e=Ft(t.Rect[3])),e};var me=Pt.addField=function(t){if(function(t,e){if(e.scope=t,void 0!==t.internal&&(void 0===t.internal.acroformPlugin||!1===t.internal.acroformPlugin.isInitialized)){if(ie.FieldNum=0,t.internal.acroformPlugin=JSON.parse(JSON.stringify(Xt)),t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Nt=t.internal.scaleFactor,t.internal.acroformPlugin.acroFormDictionaryRoot=new ee,t.internal.acroformPlugin.acroFormDictionaryRoot.scope=t,t.internal.acroformPlugin.acroFormDictionaryRoot._eventID=t.internal.events.subscribe("postPutResources",(function(){!function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0}(t)})),t.internal.events.subscribe("buildDocument",(function(){!function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var e=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n.objId=void 0,n.hasAnnotation&&Kt(n,t)}}(t)})),t.internal.events.subscribe("putCatalog",(function(){!function(t){if(void 0===t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")}(t)})),t.internal.events.subscribe("postPutPages",(function(e){!function(t,e){var i=!t;for(var n in t||(e.internal.newObjectDeferredBegin(e.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),e.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),t=t||e.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(t.hasOwnProperty(n)){var r=t[n],s=[],a=r.Rect;if(r.Rect&&(r.Rect=Wt(r.Rect,e)),e.internal.newObjectDeferredBegin(r.objId,!0),r.DA=fe.createDefaultAppearanceStream(r),"object"==typeof r&&"function"==typeof r.getKeyValueListForStream&&(s=r.getKeyValueListForStream()),r.Rect=a,r.hasAppearanceStream&&!r.appearanceStreamContent){var o=qt(r);s.push({key:"AP",value:"<</N "+o+">>"}),e.internal.acroformPlugin.xForms.push(o)}if(r.appearanceStreamContent){var l="";for(var c in r.appearanceStreamContent)if(r.appearanceStreamContent.hasOwnProperty(c)){var h=r.appearanceStreamContent[c];if(l+="/"+c+" ",l+="<<",Object.keys(h).length>=1||Array.isArray(h)){for(var n in h)if(h.hasOwnProperty(n)){var u=h[n];"function"==typeof u&&(u=u.call(e,r)),l+="/"+n+" "+u+" ",e.internal.acroformPlugin.xForms.indexOf(u)>=0||e.internal.acroformPlugin.xForms.push(u)}}else"function"==typeof(u=h)&&(u=u.call(e,r)),l+="/"+n+" "+u,e.internal.acroformPlugin.xForms.indexOf(u)>=0||e.internal.acroformPlugin.xForms.push(u);l+=">>"}s.push({key:"AP",value:"<<\n"+l+">>"})}e.internal.putStream({additionalKeyValues:s,objectId:r.objId}),e.internal.out("endobj")}i&&function(t,e){for(var i in t)if(t.hasOwnProperty(i)){var n=i,r=t[i];e.internal.newObjectDeferredBegin(r.objId,!0),"object"==typeof r&&"function"==typeof r.putStream&&r.putStream(),delete t[n]}}(e.internal.acroformPlugin.xForms,e)}(e,t)})),t.internal.acroformPlugin.isInitialized=!0}}(this,t),!(t instanceof ie))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=t).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),t.page=t.scope.internal.getCurrentPageInfo().pageNumber,this};Pt.AcroFormChoiceField=ne,Pt.AcroFormListBox=re,Pt.AcroFormComboBox=se,Pt.AcroFormEditBox=ae,Pt.AcroFormButton=oe,Pt.AcroFormPushButton=le,Pt.AcroFormRadioButton=ce,Pt.AcroFormCheckBox=ue,Pt.AcroFormTextField=de,Pt.AcroFormPasswordField=pe,Pt.AcroFormAppearance=fe,Pt.AcroForm={ChoiceField:ne,ListBox:re,ComboBox:se,EditBox:ae,Button:oe,PushButton:le,RadioButton:ce,CheckBox:ue,TextField:de,PasswordField:pe,Appearance:fe},Ct.AcroForm={ChoiceField:ne,ListBox:re,ComboBox:se,EditBox:ae,Button:oe,PushButton:le,RadioButton:ce,CheckBox:ue,TextField:de,PasswordField:pe,Appearance:fe};var ge,_e;
/** @license
 * jsPDF addImage plugin
 * Copyright (c) 2012 Jason Siefken, https://github.com/siefkenj/
 *               2013 Chris Dowling, https://github.com/gingerchris
 *               2013 Trinh Ho, https://github.com/ineedfat
 *               2013 Edwin Alejandro Perez, https://github.com/eaparango
 *               2013 Norah Smith, https://github.com/burnburnrocket
 *               2014 Diego Casorran, https://github.com/diegocr
 *               2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */Ct.AcroForm;function ve(t){return t.reduce((function(t,e,i){return t[e]=i,t}),{})}!function(t){t.__addimage__={};var e="UNKNOWN",i={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=t.__addimage__.getImageFileTypeByImageData=function(t,n){var r,s;n=n||e;var a,o,l,c=e;if(w(t))for(l in i)for(a=i[l],r=0;r<a.length;r+=1){for(o=!0,s=0;s<a[r].length;s+=1)if(void 0!==a[r][s]&&a[r][s]!==t[s]){o=!1;break}if(!0===o){c=l;break}}else for(l in i)for(a=i[l],r=0;r<a.length;r+=1){for(o=!0,s=0;s<a[r].length;s+=1)if(void 0!==a[r][s]&&a[r][s]!==t.charCodeAt(s)){o=!1;break}if(!0===o){c=l;break}}return c===e&&n!==e&&(c=n),c},r=function(t){for(var e=this.internal.write,i=this.internal.putStream,n=(0,this.internal.getFilters)();-1!==n.indexOf("FlateEncode");)n.splice(n.indexOf("FlateEncode"),1);t.objectId=this.internal.newObject();var s=[];if(s.push({key:"Type",value:"/XObject"}),s.push({key:"Subtype",value:"/Image"}),s.push({key:"Width",value:t.width}),s.push({key:"Height",value:t.height}),t.colorSpace===g.INDEXED?s.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(t.palette.length/3-1)+" "+("sMask"in t&&void 0!==t.sMask?t.objectId+2:t.objectId+1)+" 0 R]"}):(s.push({key:"ColorSpace",value:"/"+t.colorSpace}),t.colorSpace===g.DEVICE_CMYK&&s.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),s.push({key:"BitsPerComponent",value:t.bitsPerComponent}),"decodeParameters"in t&&void 0!==t.decodeParameters&&s.push({key:"DecodeParms",value:"<<"+t.decodeParameters+">>"}),"transparency"in t&&Array.isArray(t.transparency)){for(var a="",o=0,l=t.transparency.length;o<l;o++)a+=t.transparency[o]+" "+t.transparency[o]+" ";s.push({key:"Mask",value:"["+a+"]"})}void 0!==t.sMask&&s.push({key:"SMask",value:t.objectId+1+" 0 R"});var c=void 0!==t.filter?["/"+t.filter]:void 0;if(i({data:t.data,additionalKeyValues:s,alreadyAppliedFilters:c,objectId:t.objectId}),e("endobj"),"sMask"in t&&void 0!==t.sMask){var h="/Predictor "+t.predictor+" /Colors 1 /BitsPerComponent "+t.bitsPerComponent+" /Columns "+t.width,u={width:t.width,height:t.height,colorSpace:"DeviceGray",bitsPerComponent:t.bitsPerComponent,decodeParameters:h,data:t.sMask};"filter"in t&&(u.filter=t.filter),r.call(this,u)}if(t.colorSpace===g.INDEXED){var d=this.internal.newObject();i({data:M(new Uint8Array(t.palette)),objectId:d}),e("endobj")}},s=function(){var t=this.internal.collections.addImage_images;for(var e in t)r.call(this,t[e])},a=function(){var t,e=this.internal.collections.addImage_images,i=this.internal.write;for(var n in e)i("/I"+(t=e[n]).index,t.objectId,"0","R")},o=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",s),this.internal.events.subscribe("putXobjectDict",a))},l=function(){var t=this.internal.collections.addImage_images;return o.call(this),t},c=function(){return Object.keys(this.internal.collections.addImage_images).length},h=function(e){return"function"==typeof t["process"+e.toUpperCase()]},u=function(t){return"object"==typeof t&&1===t.nodeType},d=function(e,i){if("IMG"===e.nodeName&&e.hasAttribute("src")){var n=""+e.getAttribute("src");if(0===n.indexOf("data:image/"))return rt(unescape(n).split("base64,").pop());var r=t.loadFile(n,!0);if(void 0!==r)return r}if("CANVAS"===e.nodeName){var s;switch(i){case"PNG":s="image/png";break;case"WEBP":s="image/webp";break;case"JPEG":case"JPG":default:s="image/jpeg"}return rt(e.toDataURL(s,1).split("base64,").pop())}},p=function(t){var e=this.internal.collections.addImage_images;if(e)for(var i in e)if(t===e[i].alias)return e[i]},f=function(t,e,i){return t||e||(t=-96,e=-96),t<0&&(t=-1*i.width*72/t/this.internal.scaleFactor),e<0&&(e=-1*i.height*72/e/this.internal.scaleFactor),0===t&&(t=e*i.width/i.height),0===e&&(e=t*i.height/i.width),[t,e]},m=function(t,e,i,n,r,s){var a=f.call(this,i,n,r),o=this.internal.getCoordinateString,c=this.internal.getVerticalCoordinateString,h=l.call(this);if(i=a[0],n=a[1],h[r.index]=r,s){s*=Math.PI/180;var u=Math.cos(s),d=Math.sin(s),p=function(t){return t.toFixed(4)},m=[p(u),p(d),p(-1*d),p(u),0,0,"cm"]}this.internal.write("q"),s?(this.internal.write([1,"0","0",1,o(t),c(e+n),"cm"].join(" ")),this.internal.write(m.join(" ")),this.internal.write([o(i),"0","0",o(n),"0","0","cm"].join(" "))):this.internal.write([o(i),"0","0",o(n),o(t),c(e+n),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+r.index+" Do"),this.internal.write("Q")},g=t.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};t.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var _=t.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},v=t.__addimage__.sHashCode=function(t){var e,i,n=0;if("string"==typeof t)for(i=t.length,e=0;e<i;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;else if(w(t))for(i=t.byteLength/2,e=0;e<i;e++)n=(n<<5)-n+t[e],n|=0;return n},y=t.__addimage__.validateStringAsBase64=function(t){(t=t||"").toString().trim();var e=!0;return 0===t.length&&(e=!1),t.length%4!=0&&(e=!1),!1===/^[A-Za-z0-9+/]+$/.test(t.substr(0,t.length-2))&&(e=!1),!1===/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(t.substr(-2))&&(e=!1),e},b=t.__addimage__.extractImageFromDataUrl=function(t){var e=(t=t||"").split("base64,"),i=null;if(2===e.length){var n=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(e[0]);Array.isArray(n)&&(i={mimeType:n[1],charset:n[2],data:e[1]})}return i},x=t.__addimage__.supportsArrayBuffer=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array};t.__addimage__.isArrayBuffer=function(t){return x()&&t instanceof ArrayBuffer};var w=t.__addimage__.isArrayBufferView=function(t){return x()&&"undefined"!=typeof Uint32Array&&(t instanceof Int8Array||t instanceof Uint8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)},S=t.__addimage__.binaryStringToUint8Array=function(t){for(var e=t.length,i=new Uint8Array(e),n=0;n<e;n++)i[n]=t.charCodeAt(n);return i},M=t.__addimage__.arrayBufferToBinaryString=function(t){try{return rt(st(String.fromCharCode.apply(null,t)))}catch(e){if("undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.reduce)return new Uint8Array(t).reduce((function(t,e){return t.push(String.fromCharCode(e)),t}),[]).join("")}};t.addImage=function(){var t,i,n,r,s,a,l,c,h;if("number"==typeof arguments[1]?(i=e,n=arguments[1],r=arguments[2],s=arguments[3],a=arguments[4],l=arguments[5],c=arguments[6],h=arguments[7]):(i=arguments[1],n=arguments[2],r=arguments[3],s=arguments[4],a=arguments[5],l=arguments[6],c=arguments[7],h=arguments[8]),"object"==typeof(t=arguments[0])&&!u(t)&&"imageData"in t){var d=t;t=d.imageData,i=d.format||i||e,n=d.x||n||0,r=d.y||r||0,s=d.w||d.width||s,a=d.h||d.height||a,l=d.alias||l,c=d.compression||c,h=d.rotation||d.angle||h}var p=this.internal.getFilters();if(void 0===c&&-1!==p.indexOf("FlateEncode")&&(c="SLOW"),isNaN(n)||isNaN(r))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var f=A.call(this,t,i,l,c);return m.call(this,n,r,s,a,f,h),this};var A=function(i,r,s,a){var o,l,f;if("string"==typeof i&&n(i)===e){i=unescape(i);var m=E(i,!1);(""!==m||void 0!==(m=t.loadFile(i,!0)))&&(i=m)}if(u(i)&&(i=d(i,r)),r=n(i,r),!h(r))throw new Error("addImage does not support files of type '"+r+"', please ensure that a plugin for '"+r+"' support is added.");if((null==(f=s)||0===f.length)&&(s=function(t){return"string"==typeof t||w(t)?v(t):null}(i)),(o=p.call(this,s))||(x()&&(i instanceof Uint8Array||(l=i,i=S(i))),o=this["process"+r.toUpperCase()](i,c.call(this),s,function(e){return e&&"string"==typeof e&&(e=e.toUpperCase()),e in t.image_compression?e:_.NONE}(a),l)),!o)throw new Error("An unknown error occurred whilst processing the image.");return o},E=t.__addimage__.convertBase64ToBinaryString=function(t,e){var i;e="boolean"!=typeof e||e;var n,r="";if("string"==typeof t){n=null!==(i=b(t))?i.data:t;try{r=rt(n)}catch(t){if(e)throw y(n)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+t.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return r};t.getImageProperties=function(i){var r,s,a="";if(u(i)&&(i=d(i)),"string"==typeof i&&n(i)===e&&(""===(a=E(i,!1))&&(a=t.loadFile(i)||""),i=a),s=n(i),!h(s))throw new Error("addImage does not support files of type '"+s+"', please ensure that a plugin for '"+s+"' support is added.");if(!x()||i instanceof Uint8Array||(i=S(i)),!(r=this["process"+s.toUpperCase()](i)))throw new Error("An unknown error occurred whilst processing the image");return r.fileType=s,r}}(Ct.API),
/**
 * @license
 * Copyright (c) 2014 Steven Spungin (TwelveTone LLC)  steven@twelvetone.tv
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
ge=Ct.API,_e=function(t){if(void 0!==t&&""!=t)return!0},Ct.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),ge.events.push(["putPage",function(t){for(var e,i,n,r=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,a=this.internal.getPageInfoByObjId(t.objId),o=t.pageContext.annotations,l=!1,c=0;c<o.length&&!l;c++)switch((e=o[c]).type){case"link":(_e(e.options.url)||_e(e.options.pageNumber))&&(l=!0);break;case"reference":case"text":case"freetext":l=!0}if(0!=l){this.internal.write("/Annots [");for(var h=0;h<o.length;h++){e=o[h];var u=this.internal.pdfEscape,d=this.internal.getEncryptor(t.objId);switch(e.type){case"reference":this.internal.write(" "+e.object.objId+" 0 R ");break;case"text":var p=this.internal.newAdditionalObject(),f=this.internal.newAdditionalObject(),m=this.internal.getEncryptor(p.objId),g=e.title||"Note";n="<</Type /Annot /Subtype /Text "+(i="/Rect ["+r(e.bounds.x)+" "+s(e.bounds.y+e.bounds.h)+" "+r(e.bounds.x+e.bounds.w)+" "+s(e.bounds.y)+"] ")+"/Contents ("+u(m(e.contents))+")",n+=" /Popup "+f.objId+" 0 R",n+=" /P "+a.objId+" 0 R",n+=" /T ("+u(m(g))+") >>",p.content=n;var _=p.objId+" 0 R";n="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+r(e.bounds.x+30)+" "+s(e.bounds.y+e.bounds.h)+" "+r(e.bounds.x+e.bounds.w+30)+" "+s(e.bounds.y)+"] ")+" /Parent "+_,e.open&&(n+=" /Open true"),n+=" >>",f.content=n,this.internal.write(p.objId,"0 R",f.objId,"0 R");break;case"freetext":i="/Rect ["+r(e.bounds.x)+" "+s(e.bounds.y)+" "+r(e.bounds.x+e.bounds.w)+" "+s(e.bounds.y+e.bounds.h)+"] ";var v=e.color||"#000000";n="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+u(d(e.contents))+")",n+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+v+")",n+=" /Border [0 0 0]",n+=" >>",this.internal.write(n);break;case"link":if(e.options.name){var y=this.annotations._nameMap[e.options.name];e.options.pageNumber=y.page,e.options.top=y.y}else e.options.top||(e.options.top=0);if(i="/Rect ["+e.finalBounds.x+" "+e.finalBounds.y+" "+e.finalBounds.w+" "+e.finalBounds.h+"] ",n="",e.options.url)n="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+u(d(e.options.url))+") >>";else if(e.options.pageNumber)switch(n="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(e.options.pageNumber).objId+" 0 R",e.options.magFactor=e.options.magFactor||"XYZ",e.options.magFactor){case"Fit":n+=" /Fit]";break;case"FitH":n+=" /FitH "+e.options.top+"]";break;case"FitV":e.options.left=e.options.left||0,n+=" /FitV "+e.options.left+"]";break;case"XYZ":default:var b=s(e.options.top);e.options.left=e.options.left||0,void 0===e.options.zoom&&(e.options.zoom=0),n+=" /XYZ "+e.options.left+" "+b+" "+e.options.zoom+"]"}""!=n&&(n+=" >>",this.internal.write(n))}}this.internal.write("]")}}]),ge.createAnnotation=function(t){var e=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":e.pageContext.annotations.push(t)}},ge.link=function(t,e,i,n,r){var s=this.internal.getCurrentPageInfo(),a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString;s.pageContext.annotations.push({finalBounds:{x:a(t),y:o(e),w:a(t+i),h:o(e+n)},options:r,type:"link"})},ge.textWithLink=function(t,e,i,n){var r=this.getTextWidth(t),s=this.internal.getLineHeight()/this.internal.scaleFactor;return this.text(t,e,i,n),i+=.2*s,"center"===n.align&&(e-=r/2),"right"===n.align&&(e-=r),this.link(e,i-s,r,s,n),r},ge.getTextWidth=function(t){var e=this.internal.getFontSize();return this.getStringUnitWidth(t)*e/this.internal.scaleFactor},
/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},i={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},r=[1570,1571,1573,1575];t.__arabicParser__={};var s=t.__arabicParser__.isInArabicSubstitutionA=function(t){return void 0!==e[t.charCodeAt(0)]},a=t.__arabicParser__.isArabicLetter=function(t){return"string"==typeof t&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(t)},o=t.__arabicParser__.isArabicEndLetter=function(t){return a(t)&&s(t)&&e[t.charCodeAt(0)].length<=2},l=t.__arabicParser__.isArabicAlfLetter=function(t){return a(t)&&r.indexOf(t.charCodeAt(0))>=0};t.__arabicParser__.arabicLetterHasIsolatedForm=function(t){return a(t)&&s(t)&&e[t.charCodeAt(0)].length>=1};var c=t.__arabicParser__.arabicLetterHasFinalForm=function(t){return a(t)&&s(t)&&e[t.charCodeAt(0)].length>=2};t.__arabicParser__.arabicLetterHasInitialForm=function(t){return a(t)&&s(t)&&e[t.charCodeAt(0)].length>=3};var h=t.__arabicParser__.arabicLetterHasMedialForm=function(t){return a(t)&&s(t)&&4==e[t.charCodeAt(0)].length},u=t.__arabicParser__.resolveLigatures=function(t){var e=0,n=i,r="",s=0;for(e=0;e<t.length;e+=1)void 0!==n[t.charCodeAt(e)]?(s++,"number"==typeof(n=n[t.charCodeAt(e)])&&(r+=String.fromCharCode(n),n=i,s=0),e===t.length-1&&(n=i,r+=t.charAt(e-(s-1)),e-=s-1,s=0)):(n=i,r+=t.charAt(e-s),e-=s,s=0);return r};t.__arabicParser__.isArabicDiacritic=function(t){return void 0!==t&&void 0!==n[t.charCodeAt(0)]};var d=t.__arabicParser__.getCorrectForm=function(t,e,i){return a(t)?!1===s(t)?-1:!c(t)||!a(e)&&!a(i)||!a(i)&&o(e)||o(t)&&!a(e)||o(t)&&l(e)||o(t)&&o(e)?0:h(t)&&a(e)&&!o(e)&&a(i)&&c(i)?3:o(t)||!a(i)?1:2:-1},p=function(t){var i=0,n=0,r=0,s="",o="",l="",c=(t=t||"").split("\\s+"),h=[];for(i=0;i<c.length;i+=1){for(h.push(""),n=0;n<c[i].length;n+=1)s=c[i][n],o=c[i][n-1],l=c[i][n+1],a(s)?(r=d(s,o,l),h[i]+=-1!==r?String.fromCharCode(e[s.charCodeAt(0)][r]):s):h[i]+=s;h[i]=u(h[i])}return h.join(" ")},f=t.__arabicParser__.processArabic=t.processArabic=function(){var t,e="string"==typeof arguments[0]?arguments[0]:arguments[0].text,i=[];if(Array.isArray(e)){var n=0;for(i=[],n=0;n<e.length;n+=1)Array.isArray(e[n])?i.push([p(e[n][0]),e[n][1],e[n][2]]):i.push([p(e[n])]);t=i}else t=p(e);return"string"==typeof arguments[0]?t:(arguments[0].text=t,arguments[0])};t.events.push(["preProcessText",f])}(Ct.API),Ct.API.autoPrint=function(t){var e;switch((t=t||{}).variant=t.variant||"non-conform",t.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",(function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")})),this.internal.events.subscribe("putCatalog",(function(){this.internal.out("/OpenAction "+e+" 0 R")}))}return this},
/**
 * @license
 * Copyright (c) 2014 Steven Spungin (TwelveTone LLC)  steven@twelvetone.tv
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(e){t=e}});var e=150;Object.defineProperty(this,"width",{get:function(){return e},set:function(t){e=isNaN(t)||!1===Number.isInteger(t)||t<0?150:t,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=e+1)}});var i=300;Object.defineProperty(this,"height",{get:function(){return i},set:function(t){i=isNaN(t)||!1===Number.isInteger(t)||t<0?300:t,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=i+1)}});var n=[];Object.defineProperty(this,"childNodes",{get:function(){return n},set:function(t){n=t}});var r={};Object.defineProperty(this,"style",{get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,e){var i;if("2d"!==(t=t||"2d"))return null;for(i in e)this.pdf.context2d.hasOwnProperty(i)&&(this.pdf.context2d[i]=e[i]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},t.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(Ct.API),
/**
 * @license
 * ====================================================================
 * Copyright (c) 2013 Youssef Beddad, youssef.beddad@gmail.com
 *               2013 Eduardo Menezes de Morais, eduardo.morais@usp.br
 *               2013 Lee Driscoll, https://github.com/lsdriscoll
 *               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
 *               2014 James Hall, james@parall.ax
 *               2014 Diego Casorran, https://github.com/diegocr
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */
function(t){var e={left:0,top:0,bottom:0,right:0},i=!1,n=function(){void 0===this.internal.__cell__&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),r.call(this))},r=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var t=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return t},set:function(e){t=e}});var e=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return e},set:function(t){e=t}});var i=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return i},set:function(t){i=t}});var n=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return n},set:function(t){n=t}});var r=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return r},set:function(t){r=t}});var s=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return s},set:function(t){s=t}});var a=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return a},set:function(t){a=t}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},t.setHeaderFunction=function(t){return n.call(this),this.internal.__cell__.headerFunction="function"==typeof t?t:void 0,this},t.getTextDimensions=function(t,e){n.call(this);var i=(e=e||{}).fontSize||this.getFontSize(),r=e.font||this.getFont(),s=e.scaleFactor||this.internal.scaleFactor,a=0,o=0,l=0,c=this;if(!Array.isArray(t)&&"string"!=typeof t){if("number"!=typeof t)throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");t=String(t)}const h=e.maxWidth;h>0?"string"==typeof t?t=this.splitTextToSize(t,h):"[object Array]"===Object.prototype.toString.call(t)&&(t=t.reduce((function(t,e){return t.concat(c.splitTextToSize(e,h))}),[])):t=Array.isArray(t)?t:[t];for(var u=0;u<t.length;u++)a<(l=this.getStringUnitWidth(t[u],{font:r})*i)&&(a=l);return 0!==a&&(o=t.length),{w:a/=s,h:Math.max((o*i*this.getLineHeightFactor()-i*(this.getLineHeightFactor()-1))/s,0)}},t.cellAddPage=function(){n.call(this),this.addPage();var t=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new s(t.left,t.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=t.cell=function(){var t;t=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var r=this.internal.__cell__.lastCell,a=this.internal.__cell__.padding,o=this.internal.__cell__.margins||e,l=this.internal.__cell__.tableHeaderRow,c=this.internal.__cell__.printHeaders;return void 0!==r.lineNumber&&(r.lineNumber===t.lineNumber?(t.x=(r.x||0)+(r.width||0),t.y=r.y||0):r.y+r.height+t.height+o.bottom>this.getPageHeight()?(this.cellAddPage(),t.y=o.top,c&&l&&(this.printHeaderRow(t.lineNumber,!0),t.y+=l[0].height)):t.y=r.y+r.height||t.y),void 0!==t.text[0]&&(this.rect(t.x,t.y,t.width,t.height,!0===i?"FD":void 0),"right"===t.align?this.text(t.text,t.x+t.width-a,t.y+a,{align:"right",baseline:"top"}):"center"===t.align?this.text(t.text,t.x+t.width/2,t.y+a,{align:"center",baseline:"top",maxWidth:t.width-a-a}):this.text(t.text,t.x+a,t.y+a,{align:"left",baseline:"top",maxWidth:t.width-a-a})),this.internal.__cell__.lastCell=t,this};t.table=function(t,i,l,c,h){if(n.call(this),!l)throw new Error("No data for PDF table.");var u,d,p,f,m=[],g=[],_=[],v={},y={},b=[],x=[],w=(h=h||{}).autoSize||!1,S=!1!==h.printHeaders,M=h.css&&void 0!==h.css["font-size"]?16*h.css["font-size"]:h.fontSize||12,A=h.margins||Object.assign({width:this.getPageWidth()},e),E="number"==typeof h.padding?h.padding:3,L=h.headerBackgroundColor||"#c8c8c8";if(r.call(this),this.internal.__cell__.printHeaders=S,this.internal.__cell__.margins=A,this.internal.__cell__.table_font_size=M,this.internal.__cell__.padding=E,this.internal.__cell__.headerBackgroundColor=L,this.setFontSize(M),null==c)g=m=Object.keys(l[0]),_=m.map((function(){return"left"}));else if(Array.isArray(c)&&"object"==typeof c[0])for(m=c.map((function(t){return t.name})),g=c.map((function(t){return t.prompt||t.name||""})),_=c.map((function(t){return t.align||"left"})),u=0;u<c.length;u+=1)y[c[u].name]=c[u].width*(19.049976/25.4);else Array.isArray(c)&&"string"==typeof c[0]&&(g=m=c,_=m.map((function(){return"left"})));if(w||Array.isArray(c)&&"string"==typeof c[0])for(u=0;u<m.length;u+=1){for(v[f=m[u]]=l.map((function(t){return t[f]})),this.setFont(void 0,"bold"),b.push(this.getTextDimensions(g[u],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),d=v[f],this.setFont(void 0,"normal"),p=0;p<d.length;p+=1)b.push(this.getTextDimensions(d[p],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);y[f]=Math.max.apply(null,b)+E+E,b=[]}if(S){var T={};for(u=0;u<m.length;u+=1)T[m[u]]={},T[m[u]].text=g[u],T[m[u]].align=_[u];var C=o.call(this,T,y);x=m.map((function(e){return new s(t,i,y[e],C,T[e].text,void 0,T[e].align)})),this.setTableHeaderRow(x),this.printHeaderRow(1,!1)}var P=c.reduce((function(t,e){return t[e.name]=e.align,t}),{});for(u=0;u<l.length;u+=1){var N=o.call(this,l[u],y);for(p=0;p<m.length;p+=1)a.call(this,new s(t,i,y[m[p]],N,l[u][m[p]],u+2,P[m[p]]))}return this.internal.__cell__.table_x=t,this.internal.__cell__.table_y=i,this};var o=function(t,e){var i=this.internal.__cell__.padding,n=this.internal.__cell__.table_font_size,r=this.internal.scaleFactor;return Object.keys(t).map((function(n){var r=t[n];return this.splitTextToSize(r.hasOwnProperty("text")?r.text:r,e[n]-i-i)}),this).map((function(t){return this.getLineHeightFactor()*t.length*n/r+i+i}),this).reduce((function(t,e){return Math.max(t,e)}),0)};t.setTableHeaderRow=function(t){n.call(this),this.internal.__cell__.tableHeaderRow=t},t.printHeaderRow=function(t,e){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var r;if(i=!0,"function"==typeof this.internal.__cell__.headerFunction){var o=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(o[0],o[1],o[2],o[3],void 0,-1)}this.setFont(void 0,"bold");for(var l=[],c=0;c<this.internal.__cell__.tableHeaderRow.length;c+=1)r=this.internal.__cell__.tableHeaderRow[c].clone(),e&&(r.y=this.internal.__cell__.margins.top||0,l.push(r)),r.lineNumber=t,this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,r);l.length>0&&this.setTableHeaderRow(l),this.setFont(void 0,"normal"),i=!1}}(Ct.API);var ye={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},be=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],xe=ve(be),we=[100,200,300,400,500,600,700,800,900],Se=ve(we);function Me(t){var e=t.family.replace(/"|'/g,"").toLowerCase(),i=function(t){return ye[t=t||"normal"]?t:"normal"}(t.style),n=function(t){if(!t)return 400;if("number"==typeof t)return t>=100&&t<=900&&t%100==0?t:400;if(/^\d00$/.test(t))return parseInt(t);switch(t){case"bold":return 700;case"normal":default:return 400}}(t.weight),r=function(t){return"number"==typeof xe[t=t||"normal"]?t:"normal"}(t.stretch);return{family:e,style:i,weight:n,stretch:r,src:t.src||[],ref:t.ref||{name:e,style:[r,i,n].join(" ")}}}function Ae(t,e,i,n){var r;for(r=i;r>=0&&r<e.length;r+=n)if(t[e[r]])return t[e[r]];for(r=i;r>=0&&r<e.length;r-=n)if(t[e[r]])return t[e[r]]}var Ee={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Le={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function Te(t){return[t.stretch,t.style,t.weight,t.family].join(" ")}function Ce(t){return t.trimLeft()}function Pe(t,e){for(var i=0;i<t.length;){if(t.charAt(i)===e)return[t.substring(0,i),t.substring(i+1)];i+=1}return null}function Ne(t){var e=t.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return null===e?null:[e[0],t.substring(e[0].length)]}var Re,De,Ie,Oe=["times"];!function(t){var e,i,n,r,s,a,o,l,c,h=function(t){return t=t||{},this.isStrokeTransparent=t.isStrokeTransparent||!1,this.strokeOpacity=t.strokeOpacity||1,this.strokeStyle=t.strokeStyle||"#000000",this.fillStyle=t.fillStyle||"#000000",this.isFillTransparent=t.isFillTransparent||!1,this.fillOpacity=t.fillOpacity||1,this.font=t.font||"10px sans-serif",this.textBaseline=t.textBaseline||"alphabetic",this.textAlign=t.textAlign||"left",this.lineWidth=t.lineWidth||1,this.lineJoin=t.lineJoin||"miter",this.lineCap=t.lineCap||"butt",this.path=t.path||[],this.transform=void 0!==t.transform?t.transform.clone():new l,this.globalCompositeOperation=t.globalCompositeOperation||"normal",this.globalAlpha=t.globalAlpha||1,this.clip_path=t.clip_path||[],this.currentPoint=t.currentPoint||new a,this.miterLimit=t.miterLimit||10,this.lastPoint=t.lastPoint||new a,this.ignoreClearRect="boolean"!=typeof t.ignoreClearRect||t.ignoreClearRect,this};t.events.push(["initialized",function(){this.context2d=new u(this),e=this.internal.f2,i=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,r=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,a=this.internal.Point,o=this.internal.Rectangle,l=this.internal.Matrix,c=new h}]);var u=function(t){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var e=t;Object.defineProperty(this,"pdf",{get:function(){return e}});var i=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return i},set:function(t){i=Boolean(t)}});var n=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return n},set:function(t){n=Boolean(t)}});var r=0;Object.defineProperty(this,"posX",{get:function(){return r},set:function(t){isNaN(t)||(r=t)}});var s=0;Object.defineProperty(this,"posY",{get:function(){return s},set:function(t){isNaN(t)||(s=t)}});var a=!1;Object.defineProperty(this,"autoPaging",{get:function(){return a},set:function(t){a=Boolean(t)}});var o=0;Object.defineProperty(this,"lastBreak",{get:function(){return o},set:function(t){o=t}});var l=[];Object.defineProperty(this,"pageBreaks",{get:function(){return l},set:function(t){l=t}}),Object.defineProperty(this,"ctx",{get:function(){return c},set:function(t){t instanceof h&&(c=t)}}),Object.defineProperty(this,"path",{get:function(){return c.path},set:function(t){c.path=t}});var u=[];Object.defineProperty(this,"ctxStack",{get:function(){return u},set:function(t){u=t}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(t){var e;e=d(t),this.ctx.fillStyle=e.style,this.ctx.isFillTransparent=0===e.a,this.ctx.fillOpacity=e.a,this.pdf.setFillColor(e.r,e.g,e.b,{a:e.a}),this.pdf.setTextColor(e.r,e.g,e.b,{a:e.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(t){var e=d(t);this.ctx.strokeStyle=e.style,this.ctx.isStrokeTransparent=0===e.a,this.ctx.strokeOpacity=e.a,0===e.a?this.pdf.setDrawColor(255,255,255):(e.a,this.pdf.setDrawColor(e.r,e.g,e.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(t){-1!==["butt","round","square"].indexOf(t)&&(this.ctx.lineCap=t,this.pdf.setLineCap(t))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(t){isNaN(t)||(this.ctx.lineWidth=t,this.pdf.setLineWidth(t))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(t){-1!==["bevel","round","miter"].indexOf(t)&&(this.ctx.lineJoin=t,this.pdf.setLineJoin(t))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(t){isNaN(t)||(this.ctx.miterLimit=t,this.pdf.setMiterLimit(t))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(t){this.ctx.textBaseline=t}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(t){-1!==["right","end","center","left","start"].indexOf(t)&&(this.ctx.textAlign=t)}});var p=null;function f(t,e){if(null===p){var i=function(t){var e=[];return Object.keys(t).forEach((function(i){t[i].forEach((function(t){var n=null;switch(t){case"bold":n={family:i,weight:"bold"};break;case"italic":n={family:i,style:"italic"};break;case"bolditalic":n={family:i,weight:"bold",style:"italic"};break;case"":case"normal":n={family:i}}null!==n&&(n.ref={name:i,style:t},e.push(n))}))})),e}(t.getFontList());p=function(t){for(var e={},i=0;i<t.length;++i){var n=Me(t[i]),r=n.family,s=n.stretch,a=n.style,o=n.weight;e[r]=e[r]||{},e[r][s]=e[r][s]||{},e[r][s][a]=e[r][s][a]||{},e[r][s][a][o]=n}return e}(i.concat(e))}return p}var m=null;Object.defineProperty(this,"fontFaces",{get:function(){return m},set:function(t){p=null,m=t}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(t){var e;if(this.ctx.font=t,null!==(e=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(t))){var i=e[1],n=(e[2],e[3]),r=e[4],s=(e[5],e[6]),a=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(r)[2];r="px"===a?Math.floor(parseFloat(r)*this.pdf.internal.scaleFactor):"em"===a?Math.floor(parseFloat(r)*this.pdf.getFontSize()):Math.floor(parseFloat(r)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(r);var o=function(t){var e,i,n=[],r=t.trim();if(""===r)return Oe;if(r in Le)return[Le[r]];for(;""!==r;){switch(i=null,e=(r=Ce(r)).charAt(0)){case'"':case"'":i=Pe(r.substring(1),e);break;default:i=Ne(r)}if(null===i)return Oe;if(n.push(i[0]),""!==(r=Ce(i[1]))&&","!==r.charAt(0))return Oe;r=r.replace(/^,/,"")}return n}(s);if(this.fontFaces){var l=function(t,e,i){for(var n=(i=i||{}).defaultFontFamily||"times",r=Object.assign({},Ee,i.genericFontFamilies||{}),s=null,a=null,o=0;o<e.length;++o)if(r[(s=Me(e[o])).family]&&(s.family=r[s.family]),t.hasOwnProperty(s.family)){a=t[s.family];break}if(!(a=a||t[n]))throw new Error("Could not find a font-family for the rule '"+Te(s)+"' and default family '"+n+"'.");if(a=function(t,e){if(e[t])return e[t];var i=xe[t],n=i<=xe.normal?-1:1,r=Ae(e,be,i,n);if(!r)throw new Error("Could not find a matching font-stretch value for "+t);return r}(s.stretch,a),a=function(t,e){if(e[t])return e[t];for(var i=ye[t],n=0;n<i.length;++n)if(e[i[n]])return e[i[n]];throw new Error("Could not find a matching font-style for "+t)}(s.style,a),!(a=function(t,e){if(e[t])return e[t];if(400===t&&e[500])return e[500];if(500===t&&e[400])return e[400];var i=Se[t],n=Ae(e,we,i,t<400?-1:1);if(!n)throw new Error("Could not find a matching font-weight for value "+t);return n}(s.weight,a)))throw new Error("Failed to resolve a font for the rule '"+Te(s)+"'.");return a}(f(this.pdf,this.fontFaces),o.map((function(t){return{family:t,stretch:"normal",weight:n,style:i}})));this.pdf.setFont(l.ref.name,l.ref.style)}else{var c="";("bold"===n||parseInt(n,10)>=700||"bold"===i)&&(c="bold"),"italic"===i&&(c+="italic"),0===c.length&&(c="normal");for(var h="",u={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},d=0;d<o.length;d++){if(void 0!==this.pdf.internal.getFont(o[d],c,{noFallback:!0,disableWarning:!0})){h=o[d];break}if("bolditalic"===c&&void 0!==this.pdf.internal.getFont(o[d],"bold",{noFallback:!0,disableWarning:!0}))h=o[d],c="bold";else if(void 0!==this.pdf.internal.getFont(o[d],"normal",{noFallback:!0,disableWarning:!0})){h=o[d],c="normal";break}}if(""===h)for(var p=0;p<o.length;p++)if(u[o[p]]){h=u[o[p]];break}h=""===h?"Times":h,this.pdf.setFont(h,c)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(t){this.ctx.globalCompositeOperation=t}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(t){this.ctx.globalAlpha=t}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(t){this.ctx.ignoreClearRect=Boolean(t)}})};u.prototype.fill=function(){y.call(this,"fill",!1)},u.prototype.stroke=function(){y.call(this,"stroke",!1)},u.prototype.beginPath=function(){this.path=[{type:"begin"}]},u.prototype.moveTo=function(t,e){if(isNaN(t)||isNaN(e))throw tt.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var i=this.ctx.transform.applyToPoint(new a(t,e));this.path.push({type:"mt",x:i.x,y:i.y}),this.ctx.lastPoint=new a(t,e)},u.prototype.closePath=function(){var t=new a(0,0),e=0;for(e=this.path.length-1;-1!==e;e--)if("begin"===this.path[e].type&&"object"==typeof this.path[e+1]&&"number"==typeof this.path[e+1].x){t=new a(this.path[e+1].x,this.path[e+1].y),this.path.push({type:"lt",x:t.x,y:t.y});break}"object"==typeof this.path[e+2]&&"number"==typeof this.path[e+2].x&&this.path.push(JSON.parse(JSON.stringify(this.path[e+2]))),this.path.push({type:"close"}),this.ctx.lastPoint=new a(t.x,t.y)},u.prototype.lineTo=function(t,e){if(isNaN(t)||isNaN(e))throw tt.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var i=this.ctx.transform.applyToPoint(new a(t,e));this.path.push({type:"lt",x:i.x,y:i.y}),this.ctx.lastPoint=new a(i.x,i.y)},u.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),y.call(this,null,!0)},u.prototype.quadraticCurveTo=function(t,e,i,n){if(isNaN(i)||isNaN(n)||isNaN(t)||isNaN(e))throw tt.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var r=this.ctx.transform.applyToPoint(new a(i,n)),s=this.ctx.transform.applyToPoint(new a(t,e));this.path.push({type:"qct",x1:s.x,y1:s.y,x:r.x,y:r.y}),this.ctx.lastPoint=new a(r.x,r.y)},u.prototype.bezierCurveTo=function(t,e,i,n,r,s){if(isNaN(r)||isNaN(s)||isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n))throw tt.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var o=this.ctx.transform.applyToPoint(new a(r,s)),l=this.ctx.transform.applyToPoint(new a(t,e)),c=this.ctx.transform.applyToPoint(new a(i,n));this.path.push({type:"bct",x1:l.x,y1:l.y,x2:c.x,y2:c.y,x:o.x,y:o.y}),this.ctx.lastPoint=new a(o.x,o.y)},u.prototype.arc=function(t,e,i,n,r,s){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n)||isNaN(r))throw tt.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(s=Boolean(s),!this.ctx.transform.isIdentity){var o=this.ctx.transform.applyToPoint(new a(t,e));t=o.x,e=o.y;var l=this.ctx.transform.applyToPoint(new a(0,i)),c=this.ctx.transform.applyToPoint(new a(0,0));i=Math.sqrt(Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2))}Math.abs(r-n)>=2*Math.PI&&(n=0,r=2*Math.PI),this.path.push({type:"arc",x:t,y:e,radius:i,startAngle:n,endAngle:r,counterclockwise:s})},u.prototype.arcTo=function(t,e,i,n,r){throw new Error("arcTo not implemented.")},u.prototype.rect=function(t,e,i,n){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n))throw tt.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+n),this.lineTo(t,e+n),this.lineTo(t,e),this.lineTo(t+i,e),this.lineTo(t,e)},u.prototype.fillRect=function(t,e,i,n){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n))throw tt.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!p.call(this)){var r={};"butt"!==this.lineCap&&(r.lineCap=this.lineCap,this.lineCap="butt"),"miter"!==this.lineJoin&&(r.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(t,e,i,n),this.fill(),r.hasOwnProperty("lineCap")&&(this.lineCap=r.lineCap),r.hasOwnProperty("lineJoin")&&(this.lineJoin=r.lineJoin)}},u.prototype.strokeRect=function(t,e,i,n){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n))throw tt.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");f.call(this)||(this.beginPath(),this.rect(t,e,i,n),this.stroke())},u.prototype.clearRect=function(t,e,i,n){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n))throw tt.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(t,e,i,n))},u.prototype.save=function(t){t="boolean"!=typeof t||t;for(var e=this.pdf.internal.getCurrentPageInfo().pageNumber,i=0;i<this.pdf.internal.getNumberOfPages();i++)this.pdf.setPage(i+1),this.pdf.internal.out("q");if(this.pdf.setPage(e),t){this.ctx.fontSize=this.pdf.internal.getFontSize();var n=new h(this.ctx);this.ctxStack.push(this.ctx),this.ctx=n}},u.prototype.restore=function(t){t="boolean"!=typeof t||t;for(var e=this.pdf.internal.getCurrentPageInfo().pageNumber,i=0;i<this.pdf.internal.getNumberOfPages();i++)this.pdf.setPage(i+1),this.pdf.internal.out("Q");this.pdf.setPage(e),t&&0!==this.ctxStack.length&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin)},u.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var d=function(t){var e,i,n,r;if(!0===t.isCanvasGradient&&(t=t.getColor()),!t)return{r:0,g:0,b:0,a:0,style:t};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(t))e=0,i=0,n=0,r=0;else{var s=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(t);if(null!==s)e=parseInt(s[1]),i=parseInt(s[2]),n=parseInt(s[3]),r=1;else if(null!==(s=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(t)))e=parseInt(s[1]),i=parseInt(s[2]),n=parseInt(s[3]),r=parseFloat(s[4]);else{if(r=1,"string"==typeof t&&"#"!==t.charAt(0)){var a=new ot(t);t=a.ok?a.toHex():"#000000"}4===t.length?(e=t.substring(1,2),e+=e,i=t.substring(2,3),i+=i,n=t.substring(3,4),n+=n):(e=t.substring(1,3),i=t.substring(3,5),n=t.substring(5,7)),e=parseInt(e,16),i=parseInt(i,16),n=parseInt(n,16)}}return{r:e,g:i,b:n,a:r,style:t}},p=function(){return this.ctx.isFillTransparent||0==this.globalAlpha},f=function(){return Boolean(this.ctx.isStrokeTransparent||0==this.globalAlpha)};u.prototype.fillText=function(t,e,i,n){if(isNaN(e)||isNaN(i)||"string"!=typeof t)throw tt.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(n=isNaN(n)?void 0:n,!p.call(this)){i=x.call(this,i);var r=R(this.ctx.transform.rotation),s=this.ctx.transform.scaleX;E.call(this,{text:t,x:e,y:i,scale:s,angle:r,align:this.textAlign,maxWidth:n})}},u.prototype.strokeText=function(t,e,i,n){if(isNaN(e)||isNaN(i)||"string"!=typeof t)throw tt.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!f.call(this)){n=isNaN(n)?void 0:n,i=x.call(this,i);var r=R(this.ctx.transform.rotation),s=this.ctx.transform.scaleX;E.call(this,{text:t,x:e,y:i,scale:s,renderingMode:"stroke",angle:r,align:this.textAlign,maxWidth:n})}},u.prototype.measureText=function(t){if("string"!=typeof t)throw tt.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var e=this.pdf,i=this.pdf.internal.scaleFactor,n=e.internal.getFontSize(),r=e.getStringUnitWidth(t)*n/e.internal.scaleFactor,s=function(t){var e=(t=t||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return e}}),this};return new s({width:r*=Math.round(96*i/72*1e4)/1e4})},u.prototype.scale=function(t,e){if(isNaN(t)||isNaN(e))throw tt.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var i=new l(t,0,0,e,0,0);this.ctx.transform=this.ctx.transform.multiply(i)},u.prototype.rotate=function(t){if(isNaN(t))throw tt.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var e=new l(Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0);this.ctx.transform=this.ctx.transform.multiply(e)},u.prototype.translate=function(t,e){if(isNaN(t)||isNaN(e))throw tt.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var i=new l(1,0,0,1,t,e);this.ctx.transform=this.ctx.transform.multiply(i)},u.prototype.transform=function(t,e,i,n,r,s){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n)||isNaN(r)||isNaN(s))throw tt.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var a=new l(t,e,i,n,r,s);this.ctx.transform=this.ctx.transform.multiply(a)},u.prototype.setTransform=function(t,e,i,n,r,s){t=isNaN(t)?1:t,e=isNaN(e)?0:e,i=isNaN(i)?0:i,n=isNaN(n)?1:n,r=isNaN(r)?0:r,s=isNaN(s)?0:s,this.ctx.transform=new l(t,e,i,n,r,s)},u.prototype.drawImage=function(t,e,i,n,r,s,a,c,h){var u=this.pdf.getImageProperties(t),d=1,p=1,f=1,g=1;void 0!==n&&void 0!==c&&(f=c/n,g=h/r,d=u.width/n*c/n,p=u.height/r*h/r),void 0===s&&(s=e,a=i,e=0,i=0),void 0!==n&&void 0===c&&(c=n,h=r),void 0===n&&void 0===c&&(c=u.width,h=u.height);for(var y,x=this.ctx.transform.decompose(),w=R(x.rotate.shx),S=new l,M=(S=(S=(S=S.multiply(x.translate)).multiply(x.skew)).multiply(x.scale)).applyToRectangle(new o(s-e*f,a-i*g,n*d,r*p)),A=m.call(this,M),E=[],L=0;L<A.length;L+=1)-1===E.indexOf(A[L])&&E.push(A[L]);if(v(E),this.autoPaging)for(var T=E[0],C=E[E.length-1],P=T;P<C+1;P++){if(this.pdf.setPage(P),0!==this.ctx.clip_path.length){var N=this.path;y=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(y,this.posX,-1*this.pdf.internal.pageSize.height*(P-1)+this.posY),b.call(this,"fill",!0),this.path=N}var D=JSON.parse(JSON.stringify(M));D=_([D],this.posX,-1*this.pdf.internal.pageSize.height*(P-1)+this.posY)[0],this.pdf.addImage(t,"JPEG",D.x,D.y,D.w,D.h,null,null,w)}else this.pdf.addImage(t,"JPEG",M.x,M.y,M.w,M.h,null,null,w)};var m=function(t,e,i){var n=[];switch(e=e||this.pdf.internal.pageSize.width,i=i||this.pdf.internal.pageSize.height,t.type){default:case"mt":case"lt":n.push(Math.floor((t.y+this.posY)/i)+1);break;case"arc":n.push(Math.floor((t.y+this.posY-t.radius)/i)+1),n.push(Math.floor((t.y+this.posY+t.radius)/i)+1);break;case"qct":var r=D(this.ctx.lastPoint.x,this.ctx.lastPoint.y,t.x1,t.y1,t.x,t.y);n.push(Math.floor(r.y/i)+1),n.push(Math.floor((r.y+r.h)/i)+1);break;case"bct":var s=I(this.ctx.lastPoint.x,this.ctx.lastPoint.y,t.x1,t.y1,t.x2,t.y2,t.x,t.y);n.push(Math.floor(s.y/i)+1),n.push(Math.floor((s.y+s.h)/i)+1);break;case"rect":n.push(Math.floor((t.y+this.posY)/i)+1),n.push(Math.floor((t.y+t.h+this.posY)/i)+1)}for(var a=0;a<n.length;a+=1)for(;this.pdf.internal.getNumberOfPages()<n[a];)g.call(this);return n},g=function(){var t=this.fillStyle,e=this.strokeStyle,i=this.font,n=this.lineCap,r=this.lineWidth,s=this.lineJoin;this.pdf.addPage(),this.fillStyle=t,this.strokeStyle=e,this.font=i,this.lineCap=n,this.lineWidth=r,this.lineJoin=s},_=function(t,e,i){for(var n=0;n<t.length;n++)switch(t[n].type){case"bct":t[n].x2+=e,t[n].y2+=i;case"qct":t[n].x1+=e,t[n].y1+=i;case"mt":case"lt":case"arc":default:t[n].x+=e,t[n].y+=i}return t},v=function(t){return t.sort((function(t,e){return t-e}))},y=function(t,e){for(var i,n,r=this.fillStyle,s=this.strokeStyle,a=this.lineCap,o=this.lineWidth,l=o*this.ctx.transform.scaleX,c=this.lineJoin,h=JSON.parse(JSON.stringify(this.path)),u=JSON.parse(JSON.stringify(this.path)),d=[],p=0;p<u.length;p++)if(void 0!==u[p].x)for(var f=m.call(this,u[p]),y=0;y<f.length;y+=1)-1===d.indexOf(f[y])&&d.push(f[y]);for(var x=0;x<d.length;x++)for(;this.pdf.internal.getNumberOfPages()<d[x];)g.call(this);if(v(d),this.autoPaging)for(var w=d[0],S=d[d.length-1],M=w;M<S+1;M++){if(this.pdf.setPage(M),this.fillStyle=r,this.strokeStyle=s,this.lineCap=a,this.lineWidth=l,this.lineJoin=c,0!==this.ctx.clip_path.length){var A=this.path;i=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(i,this.posX,-1*this.pdf.internal.pageSize.height*(M-1)+this.posY),b.call(this,t,!0),this.path=A}n=JSON.parse(JSON.stringify(h)),this.path=_(n,this.posX,-1*this.pdf.internal.pageSize.height*(M-1)+this.posY),!1!==e&&0!==M||b.call(this,t,e),this.lineWidth=o}else this.lineWidth=l,b.call(this,t,e),this.lineWidth=o;this.path=h},b=function(t,e){if(("stroke"!==t||e||!f.call(this))&&("stroke"===t||e||!p.call(this))){for(var i,n,r=[],s=this.path,a=0;a<s.length;a++){var o=s[a];switch(o.type){case"begin":r.push({begin:!0});break;case"close":r.push({close:!0});break;case"mt":r.push({start:o,deltas:[],abs:[]});break;case"lt":var l=r.length;if(!isNaN(s[a-1].x)&&(i=[o.x-s[a-1].x,o.y-s[a-1].y],l>0))for(;l>=0;l--)if(!0!==r[l-1].close&&!0!==r[l-1].begin){r[l-1].deltas.push(i),r[l-1].abs.push(o);break}break;case"bct":i=[o.x1-s[a-1].x,o.y1-s[a-1].y,o.x2-s[a-1].x,o.y2-s[a-1].y,o.x-s[a-1].x,o.y-s[a-1].y],r[r.length-1].deltas.push(i);break;case"qct":var c=s[a-1].x+2/3*(o.x1-s[a-1].x),h=s[a-1].y+2/3*(o.y1-s[a-1].y),u=o.x+2/3*(o.x1-o.x),d=o.y+2/3*(o.y1-o.y),m=o.x,g=o.y;i=[c-s[a-1].x,h-s[a-1].y,u-s[a-1].x,d-s[a-1].y,m-s[a-1].x,g-s[a-1].y],r[r.length-1].deltas.push(i);break;case"arc":r.push({deltas:[],abs:[],arc:!0}),Array.isArray(r[r.length-1].abs)&&r[r.length-1].abs.push(o)}}n=e?null:"stroke"===t?"stroke":"fill";for(var _=0;_<r.length;_++){if(r[_].arc){for(var v=r[_].abs,y=0;y<v.length;y++){var b=v[y];"arc"===b.type?w.call(this,b.x,b.y,b.radius,b.startAngle,b.endAngle,b.counterclockwise,void 0,e):L.call(this,b.x,b.y)}S.call(this,n),this.pdf.internal.out("h")}if(!r[_].arc&&!0!==r[_].close&&!0!==r[_].begin){var x=r[_].start.x,A=r[_].start.y;T.call(this,r[_].deltas,x,A)}}n&&S.call(this,n),e&&M.call(this)}},x=function(t){var e=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,i=e*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return t-i;case"top":return t+e-i;case"hanging":return t+e-2*i;case"middle":return t+e/2-i;case"ideographic":return t;case"alphabetic":default:return t}};u.prototype.createLinearGradient=function(){var t=function(){};return t.colorStops=[],t.addColorStop=function(t,e){this.colorStops.push([t,e])},t.getColor=function(){return 0===this.colorStops.length?"#000000":this.colorStops[0][1]},t.isCanvasGradient=!0,t},u.prototype.createPattern=function(){return this.createLinearGradient()},u.prototype.createRadialGradient=function(){return this.createLinearGradient()};var w=function(t,e,i,n,r,s,a,o){for(var l=P.call(this,i,n,r,s),c=0;c<l.length;c++){var h=l[c];0===c&&A.call(this,h.x1+t,h.y1+e),C.call(this,t,e,h.x2,h.y2,h.x3,h.y3,h.x4,h.y4)}o?M.call(this):S.call(this,a)},S=function(t){switch(t){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},M=function(){this.pdf.clip(),this.pdf.discardPath()},A=function(t,e){this.pdf.internal.out(i(t)+" "+n(e)+" m")},E=function(t){var e;switch(t.align){case"right":case"end":e="right";break;case"center":e="center";break;case"left":case"start":default:e="left"}var i=this.ctx.transform.applyToPoint(new a(t.x,t.y)),n=this.ctx.transform.decompose(),r=new l;r=(r=(r=r.multiply(n.translate)).multiply(n.skew)).multiply(n.scale);for(var s,c,h,u=this.pdf.getTextDimensions(t.text),d=this.ctx.transform.applyToRectangle(new o(t.x,t.y,u.w,u.h)),p=r.applyToRectangle(new o(t.x,t.y-u.h,u.w,u.h)),f=m.call(this,p),g=[],y=0;y<f.length;y+=1)-1===g.indexOf(f[y])&&g.push(f[y]);if(v(g),!0===this.autoPaging)for(var x=g[0],w=g[g.length-1],S=x;S<w+1;S++){if(this.pdf.setPage(S),0!==this.ctx.clip_path.length){var M=this.path;s=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(s,this.posX,-1*this.pdf.internal.pageSize.height*(S-1)+this.posY),b.call(this,"fill",!0),this.path=M}var A=JSON.parse(JSON.stringify(d));A=_([A],this.posX,-1*this.pdf.internal.pageSize.height*(S-1)+this.posY)[0],t.scale>=.01&&(c=this.pdf.internal.getFontSize(),this.pdf.setFontSize(c*t.scale),h=this.lineWidth,this.lineWidth=h*t.scale),this.pdf.text(t.text,A.x,A.y,{angle:t.angle,align:e,renderingMode:t.renderingMode,maxWidth:t.maxWidth}),t.scale>=.01&&(this.pdf.setFontSize(c),this.lineWidth=h)}else t.scale>=.01&&(c=this.pdf.internal.getFontSize(),this.pdf.setFontSize(c*t.scale),h=this.lineWidth,this.lineWidth=h*t.scale),this.pdf.text(t.text,i.x+this.posX,i.y+this.posY,{angle:t.angle,align:e,renderingMode:t.renderingMode,maxWidth:t.maxWidth}),t.scale>=.01&&(this.pdf.setFontSize(c),this.lineWidth=h)},L=function(t,e,r,s){r=r||0,s=s||0,this.pdf.internal.out(i(t+r)+" "+n(e+s)+" l")},T=function(t,e,i){return this.pdf.lines(t,e,i,null,null)},C=function(t,i,n,a,o,l,c,h){this.pdf.internal.out([e(r(n+t)),e(s(a+i)),e(r(o+t)),e(s(l+i)),e(r(c+t)),e(s(h+i)),"c"].join(" "))},P=function(t,e,i,n){for(var r=2*Math.PI,s=Math.PI/2;e>i;)e-=r;var a=Math.abs(i-e);a<r&&n&&(a=r-a);for(var o=[],l=n?-1:1,c=e;a>1e-5;){var h=c+l*Math.min(a,s);o.push(N.call(this,t,c,h)),a-=Math.abs(h-c),c=h}return o},N=function(t,e,i){var n=(i-e)/2,r=t*Math.cos(n),s=t*Math.sin(n),a=r,o=-s,l=a*a+o*o,c=l+a*r+o*s,h=4/3*(Math.sqrt(2*l*c)-c)/(a*s-o*r),u=a-h*o,d=o+h*a,p=u,f=-d,m=n+e,g=Math.cos(m),_=Math.sin(m);return{x1:t*Math.cos(e),y1:t*Math.sin(e),x2:u*g-d*_,y2:u*_+d*g,x3:p*g-f*_,y3:p*_+f*g,x4:t*Math.cos(i),y4:t*Math.sin(i)}},R=function(t){return 180*t/Math.PI},D=function(t,e,i,n,r,s){var a=t+.5*(i-t),l=e+.5*(n-e),c=r+.5*(i-r),h=s+.5*(n-s),u=Math.min(t,r,a,c),d=Math.max(t,r,a,c),p=Math.min(e,s,l,h),f=Math.max(e,s,l,h);return new o(u,p,d-u,f-p)},I=function(t,e,i,n,r,s,a,l){var c,h,u,d,p,f,m,g,_,v,y,b,x,w,S=i-t,M=n-e,A=r-i,E=s-n,L=a-r,T=l-s;for(h=0;h<41;h++)_=(m=(u=t+(c=h/40)*S)+c*((p=i+c*A)-u))+c*(p+c*(r+c*L-p)-m),v=(g=(d=e+c*M)+c*((f=n+c*E)-d))+c*(f+c*(s+c*T-f)-g),0==h?(y=_,b=v,x=_,w=v):(y=Math.min(y,_),b=Math.min(b,v),x=Math.max(x,_),w=Math.max(w,v));return new o(Math.round(y),Math.round(b),Math.round(x-y),Math.round(w-b))}}(Ct.API),
/**
 * @license
 * jsPDF filters PlugIn
 * Copyright (c) 2014 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t){var e=function(t){var e,i,n,r,s,a,o,l,c,h;for(/[^\x00-\xFF]/.test(t),i=[],n=0,r=(t+=e="\0\0\0\0".slice(t.length%4||4)).length;r>n;n+=4)0!==(s=(t.charCodeAt(n)<<24)+(t.charCodeAt(n+1)<<16)+(t.charCodeAt(n+2)<<8)+t.charCodeAt(n+3))?(a=(s=((s=((s=((s=(s-(h=s%85))/85)-(c=s%85))/85)-(l=s%85))/85)-(o=s%85))/85)%85,i.push(a+33,o+33,l+33,c+33,h+33)):i.push(122);return function(t,e){for(var i=e;i>0;i--)t.pop()}(i,e.length),String.fromCharCode.apply(String,i)+"~>"},i=function(t){var e,i,n,r,s,a=String,o="length",l=255,c="charCodeAt",h="slice",u="replace";for(t[h](-2),t=t[h](0,-2)[u](/\s/g,"")[u]("z","!!!!!"),n=[],r=0,s=(t+=e="uuuuu"[h](t[o]%5||5))[o];s>r;r+=5)i=52200625*(t[c](r)-33)+614125*(t[c](r+1)-33)+7225*(t[c](r+2)-33)+85*(t[c](r+3)-33)+(t[c](r+4)-33),n.push(l&i>>24,l&i>>16,l&i>>8,l&i);return function(t,e){for(var i=e;i>0;i--)t.pop()}(n,e[o]),a.fromCharCode.apply(a,n)},n=function(t){var e=new RegExp(/^([0-9A-Fa-f]{2})+$/);if(-1!==(t=t.replace(/\s/g,"")).indexOf(">")&&(t=t.substr(0,t.indexOf(">"))),t.length%2&&(t+="0"),!1===e.test(t))return"";for(var i="",n=0;n<t.length;n+=2)i+=String.fromCharCode("0x"+(t[n]+t[n+1]));return i},r=function(t){for(var e=new Uint8Array(t.length),i=t.length;i--;)e[i]=t.charCodeAt(i);return(e=K(e)).reduce((function(t,e){return t+String.fromCharCode(e)}),"")};t.processDataByFilters=function(t,s){var a=0,o=t||"",l=[];for("string"==typeof(s=s||[])&&(s=[s]),a=0;a<s.length;a+=1)switch(s[a]){case"ASCII85Decode":case"/ASCII85Decode":o=i(o),l.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":o=e(o),l.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":o=n(o),l.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":o=o.split("").map((function(t){return("0"+t.charCodeAt().toString(16)).slice(-2)})).join("")+">",l.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":o=r(o),l.push("/FlateDecode");break;default:throw new Error('The filter: "'+s[a]+'" is not implemented')}return{data:o,reverseChain:l.reverse().join(" ")}}}(Ct.API),
/**
 * @license
 * jsPDF fileloading PlugIn
 * Copyright (c) 2018 Aras Abbasi (aras.abbasi@gmail.com)
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t){t.loadFile=function(t,e,i){return function(t,e,i){e=!1!==e,i="function"==typeof i?i:function(){};var n=void 0;try{n=function(t,e,i){var n=new XMLHttpRequest,r=0,s=function(t){var e=t.length,i=[],n=String.fromCharCode;for(r=0;r<e;r+=1)i.push(n(255&t.charCodeAt(r)));return i.join("")};if(n.open("GET",t,!e),n.overrideMimeType("text/plain; charset=x-user-defined"),!1===e&&(n.onload=function(){200===n.status?i(s(this.responseText)):i(void 0)}),n.send(null),e&&200===n.status)return s(n.responseText)}(t,e,i)}catch(t){}return n}(t,e,i)},t.loadImageFile=t.loadFile}(Ct.API),
/**
 * @license
 * Copyright (c) 2018 Erik Koopmans
 * Released under the MIT License.
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t){function e(){return($.html2canvas?Promise.resolve($.html2canvas):i.e(120).then(i.t.bind(i,1120,23))).catch((function(t){return Promise.reject(new Error("Could not load html2canvas: "+t))})).then((function(t){return t.default?t.default:t}))}function n(){return($.DOMPurify?Promise.resolve($.DOMPurify):i.e(856).then(i.t.bind(i,7856,23))).catch((function(t){return Promise.reject(new Error("Could not load dompurify: "+t))})).then((function(t){return t.default?t.default:t}))}var r=function(t){var e=typeof t;return"undefined"===e?"undefined":"string"===e||t instanceof String?"string":"number"===e||t instanceof Number?"number":"function"===e||t instanceof Function?"function":t&&t.constructor===Array?"array":t&&1===t.nodeType?"element":"object"===e?"object":"unknown"},s=function(t,e){var i=document.createElement(t);for(var n in e.className&&(i.className=e.className),e.innerHTML&&e.dompurify&&(i.innerHTML=e.dompurify.sanitize(e.innerHTML)),e.style)i.style[n]=e.style[n];return i},a=function(t,e){for(var i=3===t.nodeType?document.createTextNode(t.nodeValue):t.cloneNode(!1),n=t.firstChild;n;n=n.nextSibling)!0!==e&&1===n.nodeType&&"SCRIPT"===n.nodeName||i.appendChild(a(n,e));return 1===t.nodeType&&("CANVAS"===t.nodeName?(i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0)):"TEXTAREA"!==t.nodeName&&"SELECT"!==t.nodeName||(i.value=t.value),i.addEventListener("load",(function(){i.scrollTop=t.scrollTop,i.scrollLeft=t.scrollLeft}),!0)),i},o=function t(e){var i=Object.assign(t.convert(Promise.resolve()),JSON.parse(JSON.stringify(t.template))),n=t.convert(Promise.resolve(),i);return(n=n.setProgress(1,t,1,[t])).set(e)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(t,e){return t.__proto__=e||o.prototype,t},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(t,e){return this.then((function(){switch(e=e||function(t){switch(r(t)){case"string":return"string";case"element":return"canvas"===t.nodeName.toLowerCase()?"canvas":"element";default:return"unknown"}}(t)){case"string":return this.then(n).then((function(e){return this.set({src:s("div",{innerHTML:t,dompurify:e})})}));case"element":return this.set({src:t});case"canvas":return this.set({canvas:t});case"img":return this.set({img:t});default:return this.error("Unknown source type.")}}))},o.prototype.to=function(t){switch(t){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then((function(){var t={position:"relative",display:"inline-block",width:Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},e=a(this.prop.src,this.opt.html2canvas.javascriptEnabled);"BODY"===e.tagName&&(t.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=s("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=s("div",{className:"html2pdf__container",style:t}),this.prop.container.appendChild(e),this.prop.container.firstChild.appendChild(s("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"}))},o.prototype.toCanvas=function(){var t=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(t).then(e).then((function(t){var e=Object.assign({},this.opt.html2canvas);return delete e.onrendered,t(this.prop.container,e)})).then((function(t){(this.opt.html2canvas.onrendered||function(){})(t),this.prop.canvas=t,document.body.removeChild(this.prop.overlay)}))},o.prototype.toContext2d=function(){var t=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(t).then(e).then((function(t){var e=this.opt.jsPDF,i=this.opt.fontFaces,n=Object.assign({async:!0,allowTaint:!0,scale:1,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete n.onrendered,e.context2d.autoPaging=!0,e.context2d.posX=this.opt.x,e.context2d.posY=this.opt.y,e.context2d.fontFaces=i,i)for(var r=0;r<i.length;++r){var s=i[r],a=s.src.find((function(t){return"truetype"===t.format}));a&&e.addFont(a.url,s.ref.name,s.ref.style)}return n.windowHeight=n.windowHeight||0,n.windowHeight=0==n.windowHeight?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):n.windowHeight,t(this.prop.container,n)})).then((function(t){(this.opt.html2canvas.onrendered||function(){})(t),this.prop.canvas=t,document.body.removeChild(this.prop.overlay)}))},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then((function(){var t=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=t}))},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then((function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF}))},o.prototype.output=function(t,e,i){return"img"===(i=i||"pdf").toLowerCase()||"image"===i.toLowerCase()?this.outputImg(t,e):this.outputPdf(t,e)},o.prototype.outputPdf=function(t,e){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then((function(){return this.prop.pdf.output(t,e)}))},o.prototype.outputImg=function(t){return this.thenList([function(){return this.prop.img||this.toImg()}]).then((function(){switch(t){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+t+'" is not supported.'}}))},o.prototype.save=function(t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(t?{filename:t}:null).then((function(){this.prop.pdf.save(this.opt.filename)}))},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then((function(){this.prop.callback(this.prop.pdf)}))},o.prototype.set=function(t){if("object"!==r(t))return this;var e=Object.keys(t||{}).map((function(e){if(e in o.template.prop)return function(){this.prop[e]=t[e]};switch(e){case"margin":return this.setMargin.bind(this,t.margin);case"jsPDF":return function(){return this.opt.jsPDF=t.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,t.pageSize);default:return function(){this.opt[e]=t[e]}}}),this);return this.then((function(){return this.thenList(e)}))},o.prototype.get=function(t,e){return this.then((function(){var i=t in o.template.prop?this.prop[t]:this.opt[t];return e?e(i):i}))},o.prototype.setMargin=function(t){return this.then((function(){switch(r(t)){case"number":t=[t,t,t,t];case"array":if(2===t.length&&(t=[t[0],t[1],t[0],t[1]]),4===t.length)break;default:return this.error("Invalid margin array.")}this.opt.margin=t})).then(this.setPageSize)},o.prototype.setPageSize=function(t){function e(t,e){return Math.floor(t*e/72*96)}return this.then((function(){(t=t||Ct.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(t.inner={width:t.width-this.opt.margin[1]-this.opt.margin[3],height:t.height-this.opt.margin[0]-this.opt.margin[2]},t.inner.px={width:e(t.inner.width,t.k),height:e(t.inner.height,t.k)},t.inner.ratio=t.inner.height/t.inner.width),this.prop.pageSize=t}))},o.prototype.setProgress=function(t,e,i,n){return null!=t&&(this.progress.val=t),null!=e&&(this.progress.state=e),null!=i&&(this.progress.n=i),null!=n&&(this.progress.stack=n),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(t,e,i,n){return this.setProgress(t?this.progress.val+t:null,e||null,i?this.progress.n+i:null,n?this.progress.stack.concat(n):null)},o.prototype.then=function(t,e){var i=this;return this.thenCore(t,e,(function(t,e){return i.updateProgress(null,null,1,[t]),Promise.prototype.then.call(this,(function(e){return i.updateProgress(null,t),e})).then(t,e).then((function(t){return i.updateProgress(1),t}))}))},o.prototype.thenCore=function(t,e,i){i=i||Promise.prototype.then,t&&(t=t.bind(this)),e&&(e=e.bind(this));var n=-1!==Promise.toString().indexOf("[native code]")&&"Promise"===Promise.name?this:o.convert(Object.assign({},this),Promise.prototype),r=i.call(n,t,e);return o.convert(r,this.__proto__)},o.prototype.thenExternal=function(t,e){return Promise.prototype.then.call(this,t,e)},o.prototype.thenList=function(t){var e=this;return t.forEach((function(t){e=e.thenCore(t)})),e},o.prototype.catch=function(t){t&&(t=t.bind(this));var e=Promise.prototype.catch.call(this,t);return o.convert(e,this)},o.prototype.catchExternal=function(t){return Promise.prototype.catch.call(this,t)},o.prototype.error=function(t){return this.then((function(){throw new Error(t)}))},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,Ct.getPageSize=function(t,e,i){if("object"==typeof t){var n=t;t=n.orientation,e=n.unit||e,i=n.format||i}e=e||"mm",i=i||"a4",t=(""+(t||"P")).toLowerCase();var r,s=(""+i).toLowerCase(),a={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(e){case"pt":r=1;break;case"mm":r=72/25.4;break;case"cm":r=72/2.54;break;case"in":r=72;break;case"px":r=.75;break;case"pc":case"em":r=12;break;case"ex":r=6;break;default:throw"Invalid unit: "+e}var o,l=0,c=0;if(a.hasOwnProperty(s))l=a[s][1]/r,c=a[s][0]/r;else try{l=i[1],c=i[0]}catch(t){throw new Error("Invalid format: "+i)}if("p"===t||"portrait"===t)t="p",c>l&&(o=c,c=l,l=o);else{if("l"!==t&&"landscape"!==t)throw"Invalid orientation: "+t;t="l",l>c&&(o=c,c=l,l=o)}return{width:c,height:l,unit:e,k:r,orientation:t}},t.html=function(t,e){(e=e||{}).callback=e.callback||function(){},e.html2canvas=e.html2canvas||{},e.html2canvas.canvas=e.html2canvas.canvas||this.canvas,e.jsPDF=e.jsPDF||this,e.fontFaces=e.fontFaces?e.fontFaces.map(Me):null;var i=new o(e);return e.worker?i:i.from(t).doCallback()}}(Ct.API),Ct.API.addJS=function(t){return Ie=t,this.internal.events.subscribe("postPutResources",(function(){Re=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Re+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),De=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+Ie+")"),this.internal.out(">>"),this.internal.out("endobj")})),this.internal.events.subscribe("putCatalog",(function(){void 0!==Re&&void 0!==De&&this.internal.out("/Names <</JavaScript "+Re+" 0 R>>")})),this
/**
 * @license
 * Copyright (c) 2014 Steven Spungin (TwelveTone LLC)  steven@twelvetone.tv
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */},function(t){var e;t.events.push(["postPutResources",function(){var t=this,i=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var n=t.outline.render().split(/\r\n/),r=0;r<n.length;r++){var s=n[r],a=i.exec(s);if(null!=a){var o=a[1];t.internal.newObjectDeferredBegin(o,!1)}t.internal.write(s)}if(this.outline.createNamedDestinations){var l=this.internal.pages.length,c=[];for(r=0;r<l;r++){var h=t.internal.newObject();c.push(h);var u=t.internal.getPageInfo(r+1);t.internal.write("<< /D["+u.objId+" 0 R /XYZ null null null]>> endobj")}var d=t.internal.newObject();for(t.internal.write("<< /Names [ "),r=0;r<c.length;r++)t.internal.write("(page_"+(r+1)+")"+c[r]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+d+" 0 R"),t.internal.write(">>","endobj")}}]),t.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+e+" 0 R"))}]),t.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(t,e,i){var n={title:e,options:i,children:[]};return null==t&&(t=this.root),t.children.push(n),n},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(e){e.id=t.internal.newObjectDeferred();for(var i=0;i<e.children.length;i++)this.genIds_r(e.children[i])},t.outline.renderRoot=function(t){this.objStart(t),this.line("/Type /Outlines"),t.children.length>0&&(this.line("/First "+this.makeRef(t.children[0])),this.line("/Last "+this.makeRef(t.children[t.children.length-1]))),this.line("/Count "+this.count_r({count:0},t)),this.objEnd()},t.outline.renderItems=function(e){for(var i=this.ctx.pdf.internal.getVerticalCoordinateString,n=0;n<e.children.length;n++){var r=e.children[n];this.objStart(r),this.line("/Title "+this.makeString(r.title)),this.line("/Parent "+this.makeRef(e)),n>0&&this.line("/Prev "+this.makeRef(e.children[n-1])),n<e.children.length-1&&this.line("/Next "+this.makeRef(e.children[n+1])),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1])));var s=this.count=this.count_r({count:0},r);if(s>0&&this.line("/Count "+s),r.options&&r.options.pageNumber){var a=t.internal.getPageInfo(r.options.pageNumber);this.line("/Dest ["+a.objId+" 0 R /XYZ 0 "+i(0)+" 0]")}this.objEnd()}for(var o=0;o<e.children.length;o++)this.renderItems(e.children[o])},t.outline.line=function(t){this.ctx.val+=t+"\r\n"},t.outline.makeRef=function(t){return t.id+" 0 R"},t.outline.makeString=function(e){return"("+t.internal.pdfEscape(e)+")"},t.outline.objStart=function(t){this.ctx.val+="\r\n"+t.id+" 0 obj\r\n<<\r\n"},t.outline.objEnd=function(){this.ctx.val+=">> \r\nendobj\r\n"},t.outline.count_r=function(t,e){for(var i=0;i<e.children.length;i++)t.count++,this.count_r(t,e.children[i]);return t.count}}])}(Ct.API),
/**
 * @license
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t){var e=[192,193,194,195,196,197,198,199];t.processJPEG=function(t,i,n,r,s,a){var o,l=this.decode.DCT_DECODE,c=null;if("string"==typeof t||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=s||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,(o=function(t){for(var i,n=256*t.charCodeAt(4)+t.charCodeAt(5),r=t.length,s={width:0,height:0,numcomponents:1},a=4;a<r;a+=2){if(a+=n,-1!==e.indexOf(t.charCodeAt(a+1))){i=256*t.charCodeAt(a+5)+t.charCodeAt(a+6),s={width:256*t.charCodeAt(a+7)+t.charCodeAt(a+8),height:i,numcomponents:t.charCodeAt(a+9)};break}n=256*t.charCodeAt(a+2)+t.charCodeAt(a+3)}return s}(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t)).numcomponents){case 1:a=this.color_spaces.DEVICE_GRAY;break;case 4:a=this.color_spaces.DEVICE_CMYK;break;case 3:a=this.color_spaces.DEVICE_RGB}c={data:t,width:o.width,height:o.height,colorSpace:a,bitsPerComponent:8,filter:l,index:i,alias:n}}return c}}(Ct.API);var ke,Fe,Be,ze,je,Ue=function(){var t,e,i;function n(t){var e,i,n,r,s,a,o,l,c,h,u,d,p,f;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},a=null;;){switch(e=this.readUInt32(),c=function(){var t,e;for(e=[],t=0;t<4;++t)e.push(String.fromCharCode(this.data[this.pos++]));return e}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":a&&this.animation.frames.push(a),this.pos+=4,a={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},s=this.readUInt16(),r=this.readUInt16()||100,a.delay=1e3*s/r,a.disposeOp=this.data[this.pos++],a.blendOp=this.data[this.pos++],a.data=[];break;case"IDAT":case"fdAT":for("fdAT"===c&&(this.pos+=4,e-=4),t=(null!=a?a.data:void 0)||this.imgData,d=0;0<=e?d<e:d>e;0<=e?++d:--d)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(n=this.palette.length/3,this.transparency.indexed=this.read(e),this.transparency.indexed.length>n)throw new Error("More transparent colors than palette size");if((h=n-this.transparency.indexed.length)>0)for(p=0;0<=h?p<h:p>h;0<=h?++p:--p)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":o=(u=this.read(e)).indexOf(0),l=String.fromCharCode.apply(String,u.slice(0,o)),this.text[l]=String.fromCharCode.apply(String,u.slice(o+1));break;case"IEND":return a&&this.animation.frames.push(a),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(f=this.colorType)||6===f,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=e}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}n.prototype.read=function(t){var e,i;for(i=[],e=0;0<=t?e<t:e>t;0<=t?++e:--e)i.push(this.data[this.pos++]);return i},n.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.decodePixels=function(t){var e=this.pixelBitlength/8,i=new Uint8Array(this.width*this.height*e),n=0,r=this;if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);function s(s,a,o,l){var c,h,u,d,p,f,m,g,_,v,y,b,x,w,S,M,A,E,L,T,C,P=Math.ceil((r.width-s)/o),N=Math.ceil((r.height-a)/l),R=r.width==P&&r.height==N;for(w=e*P,b=R?i:new Uint8Array(w*N),f=t.length,x=0,h=0;x<N&&n<f;){switch(t[n++]){case 0:for(d=A=0;A<w;d=A+=1)b[h++]=t[n++];break;case 1:for(d=E=0;E<w;d=E+=1)c=t[n++],p=d<e?0:b[h-e],b[h++]=(c+p)%256;break;case 2:for(d=L=0;L<w;d=L+=1)c=t[n++],u=(d-d%e)/e,S=x&&b[(x-1)*w+u*e+d%e],b[h++]=(S+c)%256;break;case 3:for(d=T=0;T<w;d=T+=1)c=t[n++],u=(d-d%e)/e,p=d<e?0:b[h-e],S=x&&b[(x-1)*w+u*e+d%e],b[h++]=(c+Math.floor((p+S)/2))%256;break;case 4:for(d=C=0;C<w;d=C+=1)c=t[n++],u=(d-d%e)/e,p=d<e?0:b[h-e],0===x?S=M=0:(S=b[(x-1)*w+u*e+d%e],M=u&&b[(x-1)*w+(u-1)*e+d%e]),m=p+S-M,g=Math.abs(m-p),v=Math.abs(m-S),y=Math.abs(m-M),_=g<=v&&g<=y?p:v<=y?S:M,b[h++]=(c+_)%256;break;default:throw new Error("Invalid filter algorithm: "+t[n-1])}if(!R){var D=((a+x*l)*r.width+s)*e,I=x*w;for(d=0;d<P;d+=1){for(var O=0;O<e;O+=1)i[D++]=b[I++];D+=(o-1)*e}}x++}}return t=Z(t),1==r.interlaceMethod?(s(0,0,8,8),s(4,0,8,8),s(0,4,4,8),s(2,0,4,4),s(0,2,2,4),s(1,0,2,2),s(0,1,1,2)):s(0,0,1,1),i},n.prototype.decodePalette=function(){var t,e,i,n,r,s,a,o,l;for(i=this.palette,s=this.transparency.indexed||[],r=new Uint8Array((s.length||0)+i.length),n=0,t=0,e=a=0,o=i.length;a<o;e=a+=3)r[n++]=i[e],r[n++]=i[e+1],r[n++]=i[e+2],r[n++]=null!=(l=s[t++])?l:255;return r},n.prototype.copyToImageData=function(t,e){var i,n,r,s,a,o,l,c,h,u,d;if(n=this.colors,h=null,i=this.hasAlphaChannel,this.palette.length&&(h=null!=(d=this._decodedPalette)?d:this._decodedPalette=this.decodePalette(),n=4,i=!0),c=(r=t.data||t).length,a=h||e,s=o=0,1===n)for(;s<c;)l=h?4*e[s/4]:o,u=a[l++],r[s++]=u,r[s++]=u,r[s++]=u,r[s++]=i?a[l++]:255,o=l;else for(;s<c;)l=h?4*e[s/4]:o,r[s++]=a[l++],r[s++]=a[l++],r[s++]=a[l++],r[s++]=i?a[l++]:255,o=l},n.prototype.decode=function(){var t;return t=new Uint8Array(this.width*this.height*4),this.copyToImageData(t,this.decodePixels()),t};var r=function(){if("[object Window]"===Object.prototype.toString.call($)){try{e=$.document.createElement("canvas"),i=e.getContext("2d")}catch(t){return!1}return!0}return!1};return r(),t=function(t){var n;if(!0===r())return i.width=t.width,i.height=t.height,i.clearRect(0,0,t.width,t.height),i.putImageData(t,0,0),(n=new Image).src=e.toDataURL(),n;throw new Error("This method requires a Browser with Canvas-capability.")},n.prototype.decodeFrames=function(e){var i,n,r,s,a,o,l,c;if(this.animation){for(c=[],n=a=0,o=(l=this.animation.frames).length;a<o;n=++a)i=l[n],r=e.createImageData(i.width,i.height),s=this.decodePixels(new Uint8Array(i.data)),this.copyToImageData(r,s),i.imageData=r,c.push(i.image=t(r));return c}},n.prototype.renderFrame=function(t,e){var i,n,r;return i=(n=this.animation.frames)[e],r=n[e-1],0===e&&t.clearRect(0,0,this.width,this.height),1===(null!=r?r.disposeOp:void 0)?t.clearRect(r.xOffset,r.yOffset,r.width,r.height):2===(null!=r?r.disposeOp:void 0)&&t.putImageData(r.imageData,r.xOffset,r.yOffset),0===i.blendOp&&t.clearRect(i.xOffset,i.yOffset,i.width,i.height),t.drawImage(i.image,i.xOffset,i.yOffset)},n.prototype.animate=function(t){var e,i,n,r,s,a,o=this;return i=0,a=this.animation,r=a.numFrames,n=a.frames,s=a.numPlays,(e=function(){var a,l;if(a=i++%r,l=n[a],o.renderFrame(t,a),r>1&&i/r<s)return o.animation._timeout=setTimeout(e,l.delay)})()},n.prototype.stopAnimation=function(){var t;return clearTimeout(null!=(t=this.animation)?t._timeout:void 0)},n.prototype.render=function(t){var e,i;return t._png&&t._png.stopAnimation(),t._png=this,t.width=this.width,t.height=this.height,e=t.getContext("2d"),this.animation?(this.decodeFrames(e),this.animate(e)):(i=e.createImageData(this.width,this.height),this.copyToImageData(i,this.decodePixels()),e.putImageData(i,0,0))},n}();
/**
 * @license
 *
 * Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */
/**
 * @license
 * (c) Dean McNamee <dean@gmail.com>, 2013.
 *
 * https://github.com/deanm/omggif
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
 * including animation and compression.  It does not rely on any specific
 * underlying system, so should run in the browser, Node, or Plask.
 */function Ve(t){var e=0;if(71!==t[e++]||73!==t[e++]||70!==t[e++]||56!==t[e++]||56!=(t[e++]+1&253)||97!==t[e++])throw new Error("Invalid GIF 87a/89a header.");var i=t[e++]|t[e++]<<8,n=t[e++]|t[e++]<<8,r=t[e++],s=r>>7,a=1<<1+(7&r);t[e++],t[e++];var o=null,l=null;s&&(o=e,l=a,e+=3*a);var c=!0,h=[],u=0,d=null,p=0,f=null;for(this.width=i,this.height=n;c&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(11!==t[e]||78==t[e+1]&&69==t[e+2]&&84==t[e+3]&&83==t[e+4]&&67==t[e+5]&&65==t[e+6]&&80==t[e+7]&&69==t[e+8]&&50==t[e+9]&&46==t[e+10]&&48==t[e+11]&&3==t[e+12]&&1==t[e+13]&&0==t[e+16])e+=14,f=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((L=t[e++])>=0))throw Error("Invalid block size");if(0===L)break;e+=L}break;case 249:if(4!==t[e++]||0!==t[e+4])throw new Error("Invalid graphics extension block.");var m=t[e++];u=t[e++]|t[e++]<<8,d=t[e++],0==(1&m)&&(d=null),p=m>>2&7,e++;break;case 254:for(;;){if(!((L=t[e++])>=0))throw Error("Invalid block size");if(0===L)break;e+=L}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var g=t[e++]|t[e++]<<8,_=t[e++]|t[e++]<<8,v=t[e++]|t[e++]<<8,y=t[e++]|t[e++]<<8,b=t[e++],x=b>>6&1,w=1<<1+(7&b),S=o,M=l,A=!1;b>>7&&(A=!0,S=e,M=w,e+=3*w);var E=e;for(e++;;){var L;if(!((L=t[e++])>=0))throw Error("Invalid block size");if(0===L)break;e+=L}h.push({x:g,y:_,width:v,height:y,has_local_palette:A,palette_offset:S,palette_size:M,data_offset:E,data_length:e-E,transparent_index:d,interlaced:!!x,delay:u,disposal:p});break;case 59:c=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return h.length},this.loopCount=function(){return f},this.frameInfo=function(t){if(t<0||t>=h.length)throw new Error("Frame index out of range.");return h[t]},this.decodeAndBlitFrameBGRA=function(e,n){var r=this.frameInfo(e),s=r.width*r.height,a=new Uint8Array(s);He(t,r.data_offset,a,s);var o=r.palette_offset,l=r.transparent_index;null===l&&(l=256);var c=r.width,h=i-c,u=c,d=4*(r.y*i+r.x),p=4*((r.y+r.height)*i+r.x),f=d,m=4*h;!0===r.interlaced&&(m+=4*i*7);for(var g=8,_=0,v=a.length;_<v;++_){var y=a[_];if(0===u&&(u=c,(f+=m)>=p&&(m=4*h+4*i*(g-1),f=d+(c+h)*(g<<1),g>>=1)),y===l)f+=4;else{var b=t[o+3*y],x=t[o+3*y+1],w=t[o+3*y+2];n[f++]=w,n[f++]=x,n[f++]=b,n[f++]=255}--u}},this.decodeAndBlitFrameRGBA=function(e,n){var r=this.frameInfo(e),s=r.width*r.height,a=new Uint8Array(s);He(t,r.data_offset,a,s);var o=r.palette_offset,l=r.transparent_index;null===l&&(l=256);var c=r.width,h=i-c,u=c,d=4*(r.y*i+r.x),p=4*((r.y+r.height)*i+r.x),f=d,m=4*h;!0===r.interlaced&&(m+=4*i*7);for(var g=8,_=0,v=a.length;_<v;++_){var y=a[_];if(0===u&&(u=c,(f+=m)>=p&&(m=4*h+4*i*(g-1),f=d+(c+h)*(g<<1),g>>=1)),y===l)f+=4;else{var b=t[o+3*y],x=t[o+3*y+1],w=t[o+3*y+2];n[f++]=b,n[f++]=x,n[f++]=w,n[f++]=255}--u}}}function He(t,e,i,n){for(var r=t[e++],s=1<<r,a=s+1,o=a+1,l=r+1,c=(1<<l)-1,h=0,u=0,d=0,p=t[e++],f=new Int32Array(4096),m=null;;){for(;h<16&&0!==p;)u|=t[e++]<<h,h+=8,1===p?p=t[e++]:--p;if(h<l)break;var g=u&c;if(u>>=l,h-=l,g!==s){if(g===a)break;for(var _=g<o?g:m,v=0,y=_;y>s;)y=f[y]>>8,++v;var b=y;if(d+v+(_!==g?1:0)>n)return void tt.log("Warning, gif stream longer than expected.");i[d++]=b;var x=d+=v;for(_!==g&&(i[d++]=b),y=_;v--;)y=f[y],i[--x]=255&y,y>>=8;null!==m&&o<4096&&(f[o++]=m<<8|b,o>=c+1&&l<12&&(++l,c=c<<1|1)),m=g}else o=a+1,c=(1<<(l=r+1))-1,m=null}return d!==n&&tt.log("Warning, gif stream shorter than expected."),i}
/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function Ge(t){var e,i,n,r,s,a=Math.floor,o=new Array(64),l=new Array(64),c=new Array(64),h=new Array(64),u=new Array(65535),d=new Array(65535),p=new Array(64),f=new Array(64),m=[],g=0,_=7,v=new Array(64),y=new Array(64),b=new Array(64),x=new Array(256),w=new Array(2048),S=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],M=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],A=[0,1,2,3,4,5,6,7,8,9,10,11],E=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],L=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],T=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],C=[0,1,2,3,4,5,6,7,8,9,10,11],P=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],N=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function R(t,e){for(var i=0,n=0,r=new Array,s=1;s<=16;s++){for(var a=1;a<=t[s];a++)r[e[n]]=[],r[e[n]][0]=i,r[e[n]][1]=s,n++,i++;i*=2}return r}function D(t){for(var e=t[0],i=t[1]-1;i>=0;)e&1<<i&&(g|=1<<_),i--,--_<0&&(255==g?(I(255),I(0)):I(g),_=7,g=0)}function I(t){m.push(t)}function O(t){I(t>>8&255),I(255&t)}function k(t,e,i,n,r){for(var s,a=r[0],o=r[240],l=function(t,e){var i,n,r,s,a,o,l,c,h,u,d=0;for(h=0;h<8;++h){i=t[d],n=t[d+1],r=t[d+2],s=t[d+3],a=t[d+4],o=t[d+5],l=t[d+6];var f=i+(c=t[d+7]),m=i-c,g=n+l,_=n-l,v=r+o,y=r-o,b=s+a,x=s-a,w=f+b,S=f-b,M=g+v,A=g-v;t[d]=w+M,t[d+4]=w-M;var E=.707106781*(A+S);t[d+2]=S+E,t[d+6]=S-E;var L=.382683433*((w=x+y)-(A=_+m)),T=.5411961*w+L,C=1.306562965*A+L,P=.707106781*(M=y+_),N=m+P,R=m-P;t[d+5]=R+T,t[d+3]=R-T,t[d+1]=N+C,t[d+7]=N-C,d+=8}for(d=0,h=0;h<8;++h){i=t[d],n=t[d+8],r=t[d+16],s=t[d+24],a=t[d+32],o=t[d+40],l=t[d+48];var D=i+(c=t[d+56]),I=i-c,O=n+l,k=n-l,F=r+o,B=r-o,z=s+a,j=s-a,U=D+z,V=D-z,H=O+F,G=O-F;t[d]=U+H,t[d+32]=U-H;var W=.707106781*(G+V);t[d+16]=V+W,t[d+48]=V-W;var q=.382683433*((U=j+B)-(G=k+I)),Y=.5411961*U+q,J=1.306562965*G+q,X=.707106781*(H=B+k),K=I+X,Z=I-X;t[d+40]=Z+Y,t[d+24]=Z-Y,t[d+8]=K+J,t[d+56]=K-J,d++}for(h=0;h<64;++h)u=t[h]*e[h],p[h]=u>0?u+.5|0:u-.5|0;return p}(t,e),c=0;c<64;++c)f[S[c]]=l[c];var h=f[0]-i;i=f[0],0==h?D(n[0]):(D(n[d[s=32767+h]]),D(u[s]));for(var m=63;m>0&&0==f[m];)m--;if(0==m)return D(a),i;for(var g,_=1;_<=m;){for(var v=_;0==f[_]&&_<=m;)++_;var y=_-v;if(y>=16){g=y>>4;for(var b=1;b<=g;++b)D(o);y&=15}s=32767+f[_],D(r[(y<<4)+d[s]]),D(u[s]),_++}return 63!=m&&D(a),i}function F(t){t=Math.min(Math.max(t,1),100),s!=t&&(function(t){for(var e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],i=0;i<64;i++){var n=a((e[i]*t+50)/100);n=Math.min(Math.max(n,1),255),o[S[i]]=n}for(var r=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],s=0;s<64;s++){var u=a((r[s]*t+50)/100);u=Math.min(Math.max(u,1),255),l[S[s]]=u}for(var d=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],p=0,f=0;f<8;f++)for(var m=0;m<8;m++)c[p]=1/(o[S[p]]*d[f]*d[m]*8),h[p]=1/(l[S[p]]*d[f]*d[m]*8),p++}(t<50?Math.floor(5e3/t):Math.floor(200-2*t)),s=t)}this.encode=function(t,s){s&&F(s),m=new Array,g=0,_=7,O(65496),O(65504),O(16),I(74),I(70),I(73),I(70),I(0),I(1),I(1),I(0),O(1),O(1),I(0),I(0),function(){O(65499),O(132),I(0);for(var t=0;t<64;t++)I(o[t]);I(1);for(var e=0;e<64;e++)I(l[e])}(),function(t,e){O(65472),O(17),I(8),O(e),O(t),I(3),I(1),I(17),I(0),I(2),I(17),I(1),I(3),I(17),I(1)}(t.width,t.height),function(){O(65476),O(418),I(0);for(var t=0;t<16;t++)I(M[t+1]);for(var e=0;e<=11;e++)I(A[e]);I(16);for(var i=0;i<16;i++)I(E[i+1]);for(var n=0;n<=161;n++)I(L[n]);I(1);for(var r=0;r<16;r++)I(T[r+1]);for(var s=0;s<=11;s++)I(C[s]);I(17);for(var a=0;a<16;a++)I(P[a+1]);for(var o=0;o<=161;o++)I(N[o])}(),O(65498),O(12),I(3),I(1),I(0),I(2),I(17),I(3),I(17),I(0),I(63),I(0);var a=0,u=0,d=0;g=0,_=7,this.encode.displayName="_encode_";for(var p,f,x,S,R,B,z,j,U,V=t.data,H=t.width,G=t.height,W=4*H,q=0;q<G;){for(p=0;p<W;){for(R=W*q+p,z=-1,j=0,U=0;U<64;U++)B=R+(j=U>>3)*W+(z=4*(7&U)),q+j>=G&&(B-=W*(q+1+j-G)),p+z>=W&&(B-=p+z-W+4),f=V[B++],x=V[B++],S=V[B++],v[U]=(w[f]+w[x+256>>0]+w[S+512>>0]>>16)-128,y[U]=(w[f+768>>0]+w[x+1024>>0]+w[S+1280>>0]>>16)-128,b[U]=(w[f+1280>>0]+w[x+1536>>0]+w[S+1792>>0]>>16)-128;a=k(v,c,a,e,n),u=k(y,h,u,i,r),d=k(b,h,d,i,r),p+=32}q+=8}if(_>=0){var Y=[];Y[1]=_+1,Y[0]=(1<<_+1)-1,D(Y)}return O(65497),new Uint8Array(m)},t=t||50,function(){for(var t=String.fromCharCode,e=0;e<256;e++)x[e]=t(e)}(),e=R(M,A),i=R(T,C),n=R(E,L),r=R(P,N),function(){for(var t=1,e=2,i=1;i<=15;i++){for(var n=t;n<e;n++)d[32767+n]=i,u[32767+n]=[],u[32767+n][1]=i,u[32767+n][0]=n;for(var r=-(e-1);r<=-t;r++)d[32767+r]=i,u[32767+r]=[],u[32767+r][1]=i,u[32767+r][0]=e-1+r;t<<=1,e<<=1}}(),function(){for(var t=0;t<256;t++)w[t]=19595*t,w[t+256>>0]=38470*t,w[t+512>>0]=7471*t+32768,w[t+768>>0]=-11059*t,w[t+1024>>0]=-21709*t,w[t+1280>>0]=32768*t+8421375,w[t+1536>>0]=-27439*t,w[t+1792>>0]=-5329*t}(),F(t)}
/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function We(t,e){if(this.pos=0,this.buffer=t,this.datav=new DataView(t.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,-1===["BM","BA","CI","CP","IC","PT"].indexOf(this.flag))throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function qe(t){function e(t){if(!t)throw Error("assert :P")}function i(t,e,i){for(var n=0;4>n;n++)if(t[e+n]!=i.charCodeAt(n))return!0;return!1}function n(t,e,i,n,r){for(var s=0;s<r;s++)t[e+s]=i[n+s]}function r(t,e,i,n){for(var r=0;r<n;r++)t[e+r]=i}function s(t){return new Int32Array(t)}function a(t,e){for(var i=[],n=0;n<t;n++)i.push(new e);return i}function o(t,e){var i=[];return function t(i,n,r){for(var s=r[n],a=0;a<s&&(i.push(r.length>n+1?[]:new e),!(r.length<n+1));a++)t(i[a],n+1,r)}(i,0,t),i}function l(t,e){for(var i="",n=0;n<4;n++)i+=String.fromCharCode(t[e++]);return i}function c(t,e){return(t[e+0]<<0|t[e+1]<<8|t[e+2]<<16)>>>0}function h(t,e){return(t[e+0]<<0|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}new(qe=function(){var t=this;function l(t,e){for(var i=1<<e-1>>>0;t&i;)i>>>=1;return i?(t&i-1)+i:t}function c(t,i,n,r,s){e(!(r%n));do{t[i+(r-=n)]=s}while(0<r)}function h(t,i,n,r,a){if(e(2328>=a),512>=a)var o=s(512);else if(null==(o=s(a)))return 0;return function(t,i,n,r,a,o){var h,d,p=i,f=1<<n,m=s(16),g=s(16);for(e(0!=a),e(null!=r),e(null!=t),e(0<n),d=0;d<a;++d){if(15<r[d])return 0;++m[r[d]]}if(m[0]==a)return 0;for(g[1]=0,h=1;15>h;++h){if(m[h]>1<<h)return 0;g[h+1]=g[h]+m[h]}for(d=0;d<a;++d)h=r[d],0<r[d]&&(o[g[h]++]=d);if(1==g[15])return(r=new u).g=0,r.value=o[0],c(t,p,1,f,r),f;var _,v=-1,y=f-1,b=0,x=1,w=1,S=1<<n;for(d=0,h=1,a=2;h<=n;++h,a<<=1){if(x+=w<<=1,0>(w-=m[h]))return 0;for(;0<m[h];--m[h])(r=new u).g=h,r.value=o[d++],c(t,p+b,a,S,r),b=l(b,h)}for(h=n+1,a=2;15>=h;++h,a<<=1){if(x+=w<<=1,0>(w-=m[h]))return 0;for(;0<m[h];--m[h]){if(r=new u,(b&y)!=v){for(p+=S,_=1<<(v=h)-n;15>v&&!(0>=(_-=m[v]));)++v,_<<=1;f+=S=1<<(_=v-n),t[i+(v=b&y)].g=_+n,t[i+v].value=p-i-v}r.g=h-n,r.value=o[d++],c(t,p+(b>>n),a,S,r),b=l(b,h)}}return x!=2*g[15]-1?0:f}(t,i,n,r,a,o)}function u(){this.value=this.g=0}function d(){this.value=this.g=0}function p(){this.G=a(5,u),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(Bi,d)}function f(t,i,n,r){e(null!=t),e(null!=i),e(2147483648>r),t.Ca=254,t.I=0,t.b=-8,t.Ka=0,t.oa=i,t.pa=n,t.Jd=i,t.Yc=n+r,t.Zc=4<=r?n+r-4+1:n,E(t)}function m(t,e){for(var i=0;0<e--;)i|=T(t,128)<<e;return i}function g(t,e){var i=m(t,e);return L(t)?-i:i}function _(t,i,n,r){var s,a=0;for(e(null!=t),e(null!=i),e(4294967288>r),t.Sb=r,t.Ra=0,t.u=0,t.h=0,4<r&&(r=4),s=0;s<r;++s)a+=i[n+s]<<8*s;t.Ra=a,t.bb=r,t.oa=i,t.pa=n}function v(t){for(;8<=t.u&&t.bb<t.Sb;)t.Ra>>>=8,t.Ra+=t.oa[t.pa+t.bb]<<Ui-8>>>0,++t.bb,t.u-=8;S(t)&&(t.h=1,t.u=0)}function y(t,i){if(e(0<=i),!t.h&&i<=ji){var n=w(t)&zi[i];return t.u+=i,v(t),n}return t.h=1,t.u=0}function b(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function x(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function w(t){return t.Ra>>>(t.u&Ui-1)>>>0}function S(t){return e(t.bb<=t.Sb),t.h||t.bb==t.Sb&&t.u>Ui}function M(t,e){t.u=e,t.h=S(t)}function A(t){t.u>=Vi&&(e(t.u>=Vi),v(t))}function E(t){e(null!=t&&null!=t.oa),t.pa<t.Zc?(t.I=(t.oa[t.pa++]|t.I<<8)>>>0,t.b+=8):(e(null!=t&&null!=t.oa),t.pa<t.Yc?(t.b+=8,t.I=t.oa[t.pa++]|t.I<<8):t.Ka?t.b=0:(t.I<<=8,t.b+=8,t.Ka=1))}function L(t){return m(t,1)}function T(t,e){var i=t.Ca;0>t.b&&E(t);var n=t.b,r=i*e>>>8,s=(t.I>>>n>r)+0;for(s?(i-=r,t.I-=r+1<<n>>>0):i=r+1,n=i,r=0;256<=n;)r+=8,n>>=8;return n=7^r+Hi[n],t.b-=n,t.Ca=(i<<n)-1,s}function C(t,e,i){t[e+0]=i>>24&255,t[e+1]=i>>16&255,t[e+2]=i>>8&255,t[e+3]=i>>0&255}function P(t,e){return t[e+0]<<0|t[e+1]<<8}function N(t,e){return P(t,e)|t[e+2]<<16}function R(t,e){return P(t,e)|P(t,e+2)<<16}function D(t,i){var n=1<<i;return e(null!=t),e(0<i),t.X=s(n),null==t.X?0:(t.Mb=32-i,t.Xa=i,1)}function I(t,i){e(null!=t),e(null!=i),e(t.Xa==i.Xa),n(i.X,0,t.X,0,1<<i.Xa)}function O(){this.X=[],this.Xa=this.Mb=0}function k(t,i,n,r){e(null!=n),e(null!=r);var s=n[0],a=r[0];return 0==s&&(s=(t*a+i/2)/i),0==a&&(a=(i*s+t/2)/t),0>=s||0>=a?0:(n[0]=s,r[0]=a,1)}function F(t,e){return t+(1<<e)-1>>>e}function B(t,e){return((4278255360&t)+(4278255360&e)>>>0&4278255360)+((16711935&t)+(16711935&e)>>>0&16711935)>>>0}function z(e,i){t[i]=function(i,n,r,s,a,o,l){var c;for(c=0;c<a;++c){var h=t[e](o[l+c-1],r,s+c);o[l+c]=B(i[n+c],h)}}}function j(){this.ud=this.hd=this.jd=0}function U(t,e){return((4278124286&(t^e))>>>1)+(t&e)>>>0}function V(t){return 0<=t&&256>t?t:0>t?0:255<t?255:void 0}function H(t,e){return V(t+(t-e+.5>>1))}function G(t,e,i){return Math.abs(e-i)-Math.abs(t-i)}function W(t,e,i,n,r,s,a){for(n=s[a-1],i=0;i<r;++i)s[a+i]=n=B(t[e+i],n)}function q(t,e,i,n,r){var s;for(s=0;s<i;++s){var a=t[e+s],o=a>>8&255,l=16711935&(l=(l=16711935&a)+((o<<16)+o));n[r+s]=(4278255360&a)+l>>>0}}function Y(t,e){e.jd=t>>0&255,e.hd=t>>8&255,e.ud=t>>16&255}function J(t,e,i,n,r,s){var a;for(a=0;a<n;++a){var o=e[i+a],l=o>>>8,c=o,h=255&(h=(h=o>>>16)+((t.jd<<24>>24)*(l<<24>>24)>>>5));c=255&(c=(c+=(t.hd<<24>>24)*(l<<24>>24)>>>5)+((t.ud<<24>>24)*(h<<24>>24)>>>5)),r[s+a]=(4278255360&o)+(h<<16)+c}}function X(e,i,n,r,s){t[i]=function(t,e,i,n,a,o,l,c,h){for(n=l;n<c;++n)for(l=0;l<h;++l)a[o++]=s(i[r(t[e++])])},t[e]=function(e,i,a,o,l,c,h){var u=8>>e.b,d=e.Ea,p=e.K[0],f=e.w;if(8>u)for(e=(1<<e.b)-1,f=(1<<u)-1;i<a;++i){var m,g=0;for(m=0;m<d;++m)m&e||(g=r(o[l++])),c[h++]=s(p[g&f]),g>>=u}else t["VP8LMapColor"+n](o,l,p,f,c,h,i,a,d)}}function K(t,e,i,n,r){for(i=e+i;e<i;){var s=t[e++];n[r++]=s>>16&255,n[r++]=s>>8&255,n[r++]=s>>0&255}}function Z(t,e,i,n,r){for(i=e+i;e<i;){var s=t[e++];n[r++]=s>>16&255,n[r++]=s>>8&255,n[r++]=s>>0&255,n[r++]=s>>24&255}}function $(t,e,i,n,r){for(i=e+i;e<i;){var s=(a=t[e++])>>16&240|a>>12&15,a=a>>0&240|a>>28&15;n[r++]=s,n[r++]=a}}function Q(t,e,i,n,r){for(i=e+i;e<i;){var s=(a=t[e++])>>16&248|a>>13&7,a=a>>5&224|a>>3&31;n[r++]=s,n[r++]=a}}function tt(t,e,i,n,r){for(i=e+i;e<i;){var s=t[e++];n[r++]=s>>0&255,n[r++]=s>>8&255,n[r++]=s>>16&255}}function et(t,e,i,r,s,a){if(0==a)for(i=e+i;e<i;)C(r,((a=t[e++])[0]>>24|a[1]>>8&65280|a[2]<<8&16711680|a[3]<<24)>>>0),s+=32;else n(r,s,t,e,i)}function it(e,i){t[i][0]=t[e+"0"],t[i][1]=t[e+"1"],t[i][2]=t[e+"2"],t[i][3]=t[e+"3"],t[i][4]=t[e+"4"],t[i][5]=t[e+"5"],t[i][6]=t[e+"6"],t[i][7]=t[e+"7"],t[i][8]=t[e+"8"],t[i][9]=t[e+"9"],t[i][10]=t[e+"10"],t[i][11]=t[e+"11"],t[i][12]=t[e+"12"],t[i][13]=t[e+"13"],t[i][14]=t[e+"0"],t[i][15]=t[e+"0"]}function nt(t){return t==Hn||t==Gn||t==Wn||t==qn}function rt(){this.eb=[],this.size=this.A=this.fb=0}function st(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function at(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new rt,this.f.kb=new st,this.sd=null}function ot(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function lt(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ct(t){return alert("todo:WebPSamplerProcessPlane"),t.T}function ht(t,e){var i=t.T,r=e.ba.f.RGBA,s=r.eb,a=r.fb+t.ka*r.A,o=_r[e.ba.S],l=t.y,c=t.O,h=t.f,u=t.N,d=t.ea,p=t.W,f=e.cc,m=e.dc,g=e.Mc,_=e.Nc,v=t.ka,y=t.ka+t.T,b=t.U,x=b+1>>1;for(0==v?o(l,c,null,null,h,u,d,p,h,u,d,p,s,a,null,null,b):(o(e.ec,e.fc,l,c,f,m,g,_,h,u,d,p,s,a-r.A,s,a,b),++i);v+2<y;v+=2)f=h,m=u,g=d,_=p,u+=t.Rc,p+=t.Rc,a+=2*r.A,o(l,(c+=2*t.fa)-t.fa,l,c,f,m,g,_,h,u,d,p,s,a-r.A,s,a,b);return c+=t.fa,t.j+y<t.o?(n(e.ec,e.fc,l,c,b),n(e.cc,e.dc,h,u,x),n(e.Mc,e.Nc,d,p,x),i--):1&y||o(l,c,null,null,h,u,d,p,h,u,d,p,s,a+r.A,null,null,b),i}function ut(t,i,n){var r=t.F,s=[t.J];if(null!=r){var a=t.U,o=i.ba.S,l=o==jn||o==Wn;i=i.ba.f.RGBA;var c=[0],h=t.ka;c[0]=t.T,t.Kb&&(0==h?--c[0]:(--h,s[0]-=t.width),t.j+t.ka+t.T==t.o&&(c[0]=t.o-t.j-h));var u=i.eb;h=i.fb+h*i.A,t=An(r,s[0],t.width,a,c,u,h+(l?0:3),i.A),e(n==c),t&&nt(o)&&Sn(u,h,l,a,c,i.A)}return 0}function dt(t){var e=t.ma,i=e.ba.S,n=11>i,r=i==Fn||i==zn||i==jn||i==Un||12==i||nt(i);if(e.memory=null,e.Ib=null,e.Jb=null,e.Nd=null,!Oi(e.Oa,t,r?11:12))return 0;if(r&&nt(i)&&vi(),t.da)alert("todo:use_scaling");else{if(n){if(e.Ib=ct,t.Kb){if(i=t.U+1>>1,e.memory=s(t.U+2*i),null==e.memory)return 0;e.ec=e.memory,e.fc=0,e.cc=e.ec,e.dc=e.fc+t.U,e.Mc=e.cc,e.Nc=e.dc+i,e.Ib=ht,vi()}}else alert("todo:EmitYUV");r&&(e.Jb=ut,n&&gi())}if(n&&!Nr){for(t=0;256>t;++t)Rr[t]=89858*(t-128)+Er>>Ar,Or[t]=-22014*(t-128)+Er,Ir[t]=-45773*(t-128),Dr[t]=113618*(t-128)+Er>>Ar;for(t=Lr;t<Tr;++t)e=76283*(t-16)+Er>>Ar,kr[t-Lr]=Wt(e,255),Fr[t-Lr]=Wt(e+8>>4,15);Nr=1}return 1}function pt(t){var i=t.ma,n=t.U,r=t.T;return e(!(1&t.ka)),0>=n||0>=r?0:(n=i.Ib(t,i),null!=i.Jb&&i.Jb(t,i,n),i.Dc+=n,1)}function ft(t){t.ma.memory=null}function mt(t,e,i,n){return 47!=y(t,8)?0:(e[0]=y(t,14)+1,i[0]=y(t,14)+1,n[0]=y(t,1),0!=y(t,3)?0:!t.h)}function gt(t,e){if(4>t)return t+1;var i=t-2>>1;return(2+(1&t)<<i)+y(e,i)+1}function _t(t,e){return 120<e?e-120:1<=(i=((i=$n[e-1])>>4)*t+(8-(15&i)))?i:1;var i}function vt(t,e,i){var n=w(i),r=t[e+=255&n].g-8;return 0<r&&(M(i,i.u+8),n=w(i),e+=t[e].value,e+=n&(1<<r)-1),M(i,i.u+t[e].g),t[e].value}function yt(t,i,n){return n.g+=t.g,n.value+=t.value<<i>>>0,e(8>=n.g),t.g}function bt(t,i,n){var r=t.xc;return e((i=0==r?0:t.vc[t.md*(n>>r)+(i>>r)])<t.Wb),t.Ya[i]}function xt(t,i,r,s){var a=t.ab,o=t.c*i,l=t.C;i=l+i;var c=r,h=s;for(s=t.Ta,r=t.Ua;0<a--;){var u=t.gc[a],d=l,p=i,f=c,m=h,g=(h=s,c=r,u.Ea);switch(e(d<p),e(p<=u.nc),u.hc){case 2:qi(f,m,(p-d)*g,h,c);break;case 0:var _=d,v=p,y=h,b=c,x=(E=u).Ea;0==_&&(Gi(f,m,null,null,1,y,b),W(f,m+1,0,0,x-1,y,b+1),m+=x,b+=x,++_);for(var w=1<<E.b,S=w-1,M=F(x,E.b),A=E.K,E=E.w+(_>>E.b)*M;_<v;){var L=A,T=E,C=1;for(Wi(f,m,y,b-x,1,y,b);C<x;){var P=(C&~S)+w;P>x&&(P=x),(0,Zi[L[T++]>>8&15])(f,m+ +C,y,b+C-x,P-C,y,b+C),C=P}m+=x,b+=x,++_&S||(E+=M)}p!=u.nc&&n(h,c-g,h,c+(p-d-1)*g,g);break;case 1:for(g=f,v=m,x=(f=u.Ea)-(b=f&~(y=(m=1<<u.b)-1)),_=F(f,u.b),w=u.K,u=u.w+(d>>u.b)*_;d<p;){for(S=w,M=u,A=new j,E=v+b,L=v+f;v<E;)Y(S[M++],A),$i(A,g,v,m,h,c),v+=m,c+=m;v<L&&(Y(S[M++],A),$i(A,g,v,x,h,c),v+=x,c+=x),++d&y||(u+=_)}break;case 3:if(f==h&&m==c&&0<u.b){for(v=h,f=g=c+(p-d)*g-(b=(p-d)*F(u.Ea,u.b)),m=h,y=c,_=[],b=(x=b)-1;0<=b;--b)_[b]=m[y+b];for(b=x-1;0<=b;--b)v[f+b]=_[b];Yi(u,d,p,h,g,h,c)}else Yi(u,d,p,f,m,h,c)}c=s,h=r}h!=r&&n(s,r,c,h,o)}function wt(t,i){var n=t.V,r=t.Ba+t.c*t.C,s=i-t.C;if(e(i<=t.l.o),e(16>=s),0<s){var a=t.l,o=t.Ta,l=t.Ua,c=a.width;if(xt(t,s,n,r),s=l=[l],e((n=t.C)<(r=i)),e(a.v<a.va),r>a.o&&(r=a.o),n<a.j){var h=a.j-n;n=a.j,s[0]+=h*c}if(n>=r?n=0:(s[0]+=4*a.v,a.ka=n-a.j,a.U=a.va-a.v,a.T=r-n,n=1),n){if(l=l[0],11>(n=t.ca).S){var u=n.f.RGBA,d=(r=n.S,s=a.U,a=a.T,h=u.eb,u.A),p=a;for(u=u.fb+t.Ma*u.A;0<p--;){var f=o,m=l,g=s,_=h,v=u;switch(r){case kn:Qi(f,m,g,_,v);break;case Fn:tn(f,m,g,_,v);break;case Hn:tn(f,m,g,_,v),Sn(_,v,0,g,1,0);break;case Bn:rn(f,m,g,_,v);break;case zn:et(f,m,g,_,v,1);break;case Gn:et(f,m,g,_,v,1),Sn(_,v,0,g,1,0);break;case jn:et(f,m,g,_,v,0);break;case Wn:et(f,m,g,_,v,0),Sn(_,v,1,g,1,0);break;case Un:en(f,m,g,_,v);break;case qn:en(f,m,g,_,v),Mn(_,v,g,1,0);break;case Vn:nn(f,m,g,_,v);break;default:e(0)}l+=c,u+=d}t.Ma+=a}else alert("todo:EmitRescaledRowsYUVA");e(t.Ma<=n.height)}}t.C=i,e(t.C<=t.i)}function St(t){var e;if(0<t.ua)return 0;for(e=0;e<t.Wb;++e){var i=t.Ya[e].G,n=t.Ya[e].H;if(0<i[1][n[1]+0].g||0<i[2][n[2]+0].g||0<i[3][n[3]+0].g)return 0}return 1}function Mt(t,i,n,r,s,a){if(0!=t.Z){var o=t.qd,l=t.rd;for(e(null!=gr[t.Z]);i<n;++i)gr[t.Z](o,l,r,s,r,s,a),o=r,l=s,s+=a;t.qd=o,t.rd=l}}function At(t,i){var n=t.l.ma,r=0==n.Z||1==n.Z?t.l.j:t.C;if(r=t.C<r?r:t.C,e(i<=t.l.o),i>r){var s=t.l.width,a=n.ca,o=n.tb+s*r,l=t.V,c=t.Ba+t.c*r,h=t.gc;e(1==t.ab),e(3==h[0].hc),Xi(h[0],r,i,l,c,a,o),Mt(n,r,i,a,o,s)}t.C=t.Ma=i}function Et(t,i,n,r,s,a,o){var l=t.$/r,c=t.$%r,h=t.m,u=t.s,d=n+t.$,p=d;s=n+r*s;var f=n+r*a,m=280+u.ua,g=t.Pb?l:16777216,_=0<u.ua?u.Wa:null,v=u.wc,y=d<f?bt(u,c,l):null;e(t.C<a),e(f<=s);var b=!1;t:for(;;){for(;b||d<f;){var x=0;if(l>=g){var E=d-n;e((g=t).Pb),g.wd=g.m,g.xd=E,0<g.s.ua&&I(g.s.Wa,g.s.vb),g=l+tr}if(c&v||(y=bt(u,c,l)),e(null!=y),y.Qb&&(i[d]=y.qb,b=!0),!b)if(A(h),y.jc){x=h,E=i;var L=d,T=y.pd[w(x)&Bi-1];e(y.jc),256>T.g?(M(x,x.u+T.g),E[L]=T.value,x=0):(M(x,x.u+T.g-256),e(256<=T.value),x=T.value),0==x&&(b=!0)}else x=vt(y.G[0],y.H[0],h);if(h.h)break;if(b||256>x){if(!b)if(y.nd)i[d]=(y.qb|x<<8)>>>0;else{if(A(h),b=vt(y.G[1],y.H[1],h),A(h),E=vt(y.G[2],y.H[2],h),L=vt(y.G[3],y.H[3],h),h.h)break;i[d]=(L<<24|b<<16|x<<8|E)>>>0}if(b=!1,++d,++c>=r&&(c=0,++l,null!=o&&l<=a&&!(l%16)&&o(t,l),null!=_))for(;p<d;)x=i[p++],_.X[(506832829*x&4294967295)>>>_.Mb]=x}else if(280>x){if(x=gt(x-256,h),E=vt(y.G[4],y.H[4],h),A(h),E=_t(r,E=gt(E,h)),h.h)break;if(d-n<E||s-d<x)break t;for(L=0;L<x;++L)i[d+L]=i[d+L-E];for(d+=x,c+=x;c>=r;)c-=r,++l,null!=o&&l<=a&&!(l%16)&&o(t,l);if(e(d<=s),c&v&&(y=bt(u,c,l)),null!=_)for(;p<d;)x=i[p++],_.X[(506832829*x&4294967295)>>>_.Mb]=x}else{if(!(x<m))break t;for(b=x-280,e(null!=_);p<d;)x=i[p++],_.X[(506832829*x&4294967295)>>>_.Mb]=x;x=d,e(!(b>>>(E=_).Xa)),i[x]=E.X[b],b=!0}b||e(h.h==S(h))}if(t.Pb&&h.h&&d<s)e(t.m.h),t.a=5,t.m=t.wd,t.$=t.xd,0<t.s.ua&&I(t.s.vb,t.s.Wa);else{if(h.h)break t;null!=o&&o(t,l>a?a:l),t.a=0,t.$=d-n}return 1}return t.a=3,0}function Lt(t){e(null!=t),t.vc=null,t.yc=null,t.Ya=null;var i=t.Wa;null!=i&&(i.X=null),t.vb=null,e(null!=t)}function Tt(){var e=new ai;return null==e?null:(e.a=0,e.xb=mr,it("Predictor","VP8LPredictors"),it("Predictor","VP8LPredictors_C"),it("PredictorAdd","VP8LPredictorsAdd"),it("PredictorAdd","VP8LPredictorsAdd_C"),qi=q,$i=J,Qi=K,tn=Z,en=$,nn=Q,rn=tt,t.VP8LMapColor32b=Ji,t.VP8LMapColor8b=Ki,e)}function Ct(t,i,n,o,l){var c=1,d=[t],f=[i],m=o.m,g=o.s,_=null,v=0;t:for(;;){if(n)for(;c&&y(m,1);){var b=d,x=f,S=o,E=1,L=S.m,T=S.gc[S.ab],C=y(L,2);if(S.Oc&1<<C)c=0;else{switch(S.Oc|=1<<C,T.hc=C,T.Ea=b[0],T.nc=x[0],T.K=[null],++S.ab,e(4>=S.ab),C){case 0:case 1:T.b=y(L,3)+2,E=Ct(F(T.Ea,T.b),F(T.nc,T.b),0,S,T.K),T.K=T.K[0];break;case 3:var P,N=y(L,8)+1,R=16<N?0:4<N?1:2<N?2:3;if(b[0]=F(T.Ea,R),T.b=R,P=E=Ct(N,1,0,S,T.K)){var I,O=N,k=T,z=1<<(8>>k.b),j=s(z);if(null==j)P=0;else{var U=k.K[0],V=k.w;for(j[0]=k.K[0][0],I=1;I<1*O;++I)j[I]=B(U[V+I],j[I-1]);for(;I<4*z;++I)j[I]=0;k.K[0]=null,k.K[0]=j,P=1}}E=P;break;case 2:break;default:e(0)}c=E}}if(d=d[0],f=f[0],c&&y(m,1)&&!(c=1<=(v=y(m,4))&&11>=v)){o.a=3;break t}var H;if(H=c)e:{var G,W,q,Y=o,J=d,X=f,K=v,Z=n,$=Y.m,Q=Y.s,tt=[null],et=1,it=0,nt=Qn[K];i:for(;;){if(Z&&y($,1)){var rt=y($,3)+2,st=F(J,rt),at=F(X,rt),ot=st*at;if(!Ct(st,at,0,Y,tt))break i;for(tt=tt[0],Q.xc=rt,G=0;G<ot;++G){var lt=tt[G]>>8&65535;tt[G]=lt,lt>=et&&(et=lt+1)}}if($.h)break i;for(W=0;5>W;++W){var ct=Xn[W];!W&&0<K&&(ct+=1<<K),it<ct&&(it=ct)}var ht=a(et*nt,u),ut=et,dt=a(ut,p);if(null==dt)var pt=null;else e(65536>=ut),pt=dt;var ft=s(it);if(null==pt||null==ft||null==ht){Y.a=1;break i}var mt=ht;for(G=q=0;G<et;++G){var gt=pt[G],_t=gt.G,vt=gt.H,bt=0,xt=1,wt=0;for(W=0;5>W;++W){ct=Xn[W],_t[W]=mt,vt[W]=q,!W&&0<K&&(ct+=1<<K);n:{var St,Mt=ct,At=Y,Tt=ft,Pt=mt,Nt=q,Rt=0,Dt=At.m,It=y(Dt,1);if(r(Tt,0,0,Mt),It){var Ot=y(Dt,1)+1,kt=y(Dt,1),Ft=y(Dt,0==kt?1:8);Tt[Ft]=1,2==Ot&&(Tt[Ft=y(Dt,8)]=1);var Bt=1}else{var zt=s(19),jt=y(Dt,4)+4;if(19<jt){At.a=3;var Ut=0;break n}for(St=0;St<jt;++St)zt[Zn[St]]=y(Dt,3);var Vt=void 0,Ht=void 0,Gt=At,Wt=zt,qt=Mt,Yt=Tt,Jt=0,Xt=Gt.m,Kt=8,Zt=a(128,u);r:for(;h(Zt,0,7,Wt,19);){if(y(Xt,1)){var $t=2+2*y(Xt,3);if((Vt=2+y(Xt,$t))>qt)break r}else Vt=qt;for(Ht=0;Ht<qt&&Vt--;){A(Xt);var Qt=Zt[0+(127&w(Xt))];M(Xt,Xt.u+Qt.g);var te=Qt.value;if(16>te)Yt[Ht++]=te,0!=te&&(Kt=te);else{var ee=16==te,ie=te-16,ne=Jn[ie],re=y(Xt,Yn[ie])+ne;if(Ht+re>qt)break r;for(var se=ee?Kt:0;0<re--;)Yt[Ht++]=se}}Jt=1;break r}Jt||(Gt.a=3),Bt=Jt}(Bt=Bt&&!Dt.h)&&(Rt=h(Pt,Nt,8,Tt,Mt)),Bt&&0!=Rt?Ut=Rt:(At.a=3,Ut=0)}if(0==Ut)break i;if(xt&&1==Kn[W]&&(xt=0==mt[q].g),bt+=mt[q].g,q+=Ut,3>=W){var ae,oe=ft[0];for(ae=1;ae<ct;++ae)ft[ae]>oe&&(oe=ft[ae]);wt+=oe}}if(gt.nd=xt,gt.Qb=0,xt&&(gt.qb=(_t[3][vt[3]+0].value<<24|_t[1][vt[1]+0].value<<16|_t[2][vt[2]+0].value)>>>0,0==bt&&256>_t[0][vt[0]+0].value&&(gt.Qb=1,gt.qb+=_t[0][vt[0]+0].value<<8)),gt.jc=!gt.Qb&&6>wt,gt.jc){var le,ce=gt;for(le=0;le<Bi;++le){var he=le,ue=ce.pd[he],de=ce.G[0][ce.H[0]+he];256<=de.value?(ue.g=de.g+256,ue.value=de.value):(ue.g=0,ue.value=0,he>>=yt(de,8,ue),he>>=yt(ce.G[1][ce.H[1]+he],16,ue),he>>=yt(ce.G[2][ce.H[2]+he],0,ue),yt(ce.G[3][ce.H[3]+he],24,ue))}}}Q.vc=tt,Q.Wb=et,Q.Ya=pt,Q.yc=ht,H=1;break e}H=0}if(!(c=H)){o.a=3;break t}if(0<v){if(g.ua=1<<v,!D(g.Wa,v)){o.a=1,c=0;break t}}else g.ua=0;var pe=o,fe=d,me=f,ge=pe.s,_e=ge.xc;if(pe.c=fe,pe.i=me,ge.md=F(fe,_e),ge.wc=0==_e?-1:(1<<_e)-1,n){o.xb=fr;break t}if(null==(_=s(d*f))){o.a=1,c=0;break t}c=(c=Et(o,_,0,d,f,f,null))&&!m.h;break t}return c?(null!=l?l[0]=_:(e(null==_),e(n)),o.$=0,n||Lt(g)):Lt(g),c}function Pt(t,i){var n=t.c*t.i,r=n+i+16*i;return e(t.c<=i),t.V=s(r),null==t.V?(t.Ta=null,t.Ua=0,t.a=1,0):(t.Ta=t.V,t.Ua=t.Ba+n+i,1)}function Nt(t,i){var n=t.C,r=i-n,s=t.V,a=t.Ba+t.c*n;for(e(i<=t.l.o);0<r;){var o=16<r?16:r,l=t.l.ma,c=t.l.width,h=c*o,u=l.ca,d=l.tb+c*n,p=t.Ta,f=t.Ua;xt(t,o,s,a),En(p,f,u,d,h),Mt(l,n,n+o,u,d,c),r-=o,s+=o*t.c,n+=o}e(n==i),t.C=t.Ma=i}function Rt(){this.ub=this.yd=this.td=this.Rb=0}function Dt(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function It(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function Ot(){this.Yb=function(){var t=[];return function t(e,i,n){for(var r=n[i],s=0;s<r&&(e.push(n.length>i+1?[]:0),!(n.length<i+1));s++)t(e[s],i+1,n)}(t,0,[3,11]),t}()}function kt(){this.jb=s(3),this.Wc=o([4,8],Ot),this.Xc=o([4,17],Ot)}function Ft(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function Bt(){this.ld=this.La=this.dd=this.tc=0}function zt(){this.Na=this.la=0}function jt(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Ut(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Vt(){this.uc=this.M=this.Nb=0,this.wa=Array(new Bt),this.Y=0,this.ya=Array(new Ut),this.aa=0,this.l=new qt}function Ht(){this.y=s(16),this.f=s(8),this.ea=s(8)}function Gt(){this.cb=this.a=0,this.sc="",this.m=new b,this.Od=new Rt,this.Kc=new Dt,this.ed=new Ft,this.Qa=new It,this.Ic=this.$c=this.Aa=0,this.D=new Vt,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,b),this.ia=0,this.pb=a(4,jt),this.Pa=new kt,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Ht),this.Hd=0,this.rb=Array(new zt),this.sb=0,this.wa=Array(new Bt),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Ut),this.L=this.aa=0,this.gd=o([4,2],Bt),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Wt(t,e){return 0>t?0:t>e?e:t}function qt(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Yt(){var t=new Gt;return null!=t&&(t.a=0,t.sc="OK",t.cb=0,t.Xb=0,nr||(nr=Zt)),t}function Jt(t,e,i){return 0==t.a&&(t.a=e,t.sc=i,t.cb=0),0}function Xt(t,e,i){return 3<=i&&157==t[e+0]&&1==t[e+1]&&42==t[e+2]}function Kt(t,i){if(null==t)return 0;if(t.a=0,t.sc="OK",null==i)return Jt(t,2,"null VP8Io passed to VP8GetHeaders()");var n=i.data,s=i.w,a=i.ha;if(4>a)return Jt(t,7,"Truncated header.");var o=n[s+0]|n[s+1]<<8|n[s+2]<<16,l=t.Od;if(l.Rb=!(1&o),l.td=o>>1&7,l.yd=o>>4&1,l.ub=o>>5,3<l.td)return Jt(t,3,"Incorrect keyframe parameters.");if(!l.yd)return Jt(t,4,"Frame not displayable.");s+=3,a-=3;var c=t.Kc;if(l.Rb){if(7>a)return Jt(t,7,"cannot parse picture header");if(!Xt(n,s,a))return Jt(t,3,"Bad code word");c.c=16383&(n[s+4]<<8|n[s+3]),c.Td=n[s+4]>>6,c.i=16383&(n[s+6]<<8|n[s+5]),c.Ud=n[s+6]>>6,s+=7,a-=7,t.za=c.c+15>>4,t.Ub=c.i+15>>4,i.width=c.c,i.height=c.i,i.Da=0,i.j=0,i.v=0,i.va=i.width,i.o=i.height,i.da=0,i.ib=i.width,i.hb=i.height,i.U=i.width,i.T=i.height,r((o=t.Pa).jb,0,255,o.jb.length),e(null!=(o=t.Qa)),o.Cb=0,o.Bb=0,o.Fb=1,r(o.Zb,0,0,o.Zb.length),r(o.Lb,0,0,o.Lb)}if(l.ub>a)return Jt(t,7,"bad partition length");f(o=t.m,n,s,l.ub),s+=l.ub,a-=l.ub,l.Rb&&(c.Ld=L(o),c.Kd=L(o)),c=t.Qa;var h,u=t.Pa;if(e(null!=o),e(null!=c),c.Cb=L(o),c.Cb){if(c.Bb=L(o),L(o)){for(c.Fb=L(o),h=0;4>h;++h)c.Zb[h]=L(o)?g(o,7):0;for(h=0;4>h;++h)c.Lb[h]=L(o)?g(o,6):0}if(c.Bb)for(h=0;3>h;++h)u.jb[h]=L(o)?m(o,8):255}else c.Bb=0;if(o.Ka)return Jt(t,3,"cannot parse segment header");if((c=t.ed).zd=L(o),c.Tb=m(o,6),c.wb=m(o,3),c.Pc=L(o),c.Pc&&L(o)){for(u=0;4>u;++u)L(o)&&(c.vd[u]=g(o,6));for(u=0;4>u;++u)L(o)&&(c.od[u]=g(o,6))}if(t.L=0==c.Tb?0:c.zd?1:2,o.Ka)return Jt(t,3,"cannot parse filter header");var d=a;if(a=h=s,s=h+d,c=d,t.Xb=(1<<m(t.m,2))-1,d<3*(u=t.Xb))n=7;else{for(h+=3*u,c-=3*u,d=0;d<u;++d){var p=n[a+0]|n[a+1]<<8|n[a+2]<<16;p>c&&(p=c),f(t.Jc[+d],n,h,p),h+=p,c-=p,a+=3}f(t.Jc[+u],n,h,c),n=h<s?0:5}if(0!=n)return Jt(t,n,"cannot parse partitions");for(n=m(h=t.m,7),a=L(h)?g(h,4):0,s=L(h)?g(h,4):0,c=L(h)?g(h,4):0,u=L(h)?g(h,4):0,h=L(h)?g(h,4):0,d=t.Qa,p=0;4>p;++p){if(d.Cb){var _=d.Zb[p];d.Fb||(_+=n)}else{if(0<p){t.pb[p]=t.pb[0];continue}_=n}var v=t.pb[p];v.Sc[0]=er[Wt(_+a,127)],v.Sc[1]=ir[Wt(_+0,127)],v.Eb[0]=2*er[Wt(_+s,127)],v.Eb[1]=101581*ir[Wt(_+c,127)]>>16,8>v.Eb[1]&&(v.Eb[1]=8),v.Qc[0]=er[Wt(_+u,117)],v.Qc[1]=ir[Wt(_+h,127)],v.lc=_+h}if(!l.Rb)return Jt(t,4,"Not a key frame.");for(L(o),l=t.Pa,n=0;4>n;++n){for(a=0;8>a;++a)for(s=0;3>s;++s)for(c=0;11>c;++c)u=T(o,cr[n][a][s][c])?m(o,8):or[n][a][s][c],l.Wc[n][a].Yb[s][c]=u;for(a=0;17>a;++a)l.Xc[n][a]=l.Wc[n][hr[a]]}return t.kc=L(o),t.kc&&(t.Bd=m(o,8)),t.cb=1}function Zt(t,e,i,n,r,s,a){var o=e[r].Yb[i];for(i=0;16>r;++r){if(!T(t,o[i+0]))return r;for(;!T(t,o[i+1]);)if(o=e[++r].Yb[0],i=0,16==r)return 16;var l=e[r+1].Yb;if(T(t,o[i+2])){var c=t,h=0;if(T(c,(d=o)[(u=i)+3]))if(T(c,d[u+6])){for(o=0,u=2*(h=T(c,d[u+8]))+(d=T(c,d[u+9+h])),h=0,d=rr[u];d[o];++o)h+=h+T(c,d[o]);h+=3+(8<<u)}else T(c,d[u+7])?(h=7+2*T(c,165),h+=T(c,145)):h=5+T(c,159);else h=T(c,d[u+4])?3+T(c,d[u+5]):2;o=l[2]}else h=1,o=l[1];l=a+sr[r],0>(c=t).b&&E(c);var u,d=c.b,p=(u=c.Ca>>1)-(c.I>>d)>>31;--c.b,c.Ca+=p,c.Ca|=1,c.I-=(u+1&p)<<d,s[l]=((h^p)-p)*n[(0<r)+0]}return 16}function $t(t){var e=t.rb[t.sb-1];e.la=0,e.Na=0,r(t.zc,0,0,t.zc.length),t.ja=0}function Qt(t,i){if(null==t)return 0;if(null==i)return Jt(t,2,"NULL VP8Io parameter in VP8Decode().");if(!t.cb&&!Kt(t,i))return 0;if(e(t.cb),null==i.ac||i.ac(i)){i.ob&&(t.L=0);var o=zr[t.L];if(2==t.L?(t.yb=0,t.zb=0):(t.yb=i.v-o>>4,t.zb=i.j-o>>4,0>t.yb&&(t.yb=0),0>t.zb&&(t.zb=0)),t.Va=i.o+15+o>>4,t.Hb=i.va+15+o>>4,t.Hb>t.za&&(t.Hb=t.za),t.Va>t.Ub&&(t.Va=t.Ub),0<t.L){var l=t.ed;for(o=0;4>o;++o){var c;if(t.Qa.Cb){var h=t.Qa.Lb[o];t.Qa.Fb||(h+=l.Tb)}else h=l.Tb;for(c=0;1>=c;++c){var u=t.gd[o][c],d=h;if(l.Pc&&(d+=l.vd[0],c&&(d+=l.od[0])),0<(d=0>d?0:63<d?63:d)){var p=d;0<l.wb&&(p=4<l.wb?p>>2:p>>1)>9-l.wb&&(p=9-l.wb),1>p&&(p=1),u.dd=p,u.tc=2*d+p,u.ld=40<=d?2:15<=d?1:0}else u.tc=0;u.La=c}}}o=0}else Jt(t,6,"Frame setup failed"),o=t.a;if(o=0==o){if(o){t.$c=0,0<t.Aa||(t.Ic=Ur);t:{o=t.Ic,l=4*(p=t.za);var f=32*p,m=p+1,g=0<t.L?p*(0<t.Aa?2:1):0,_=(2==t.Aa?2:1)*p;if((u=l+832+(c=3*(16*o+zr[t.L])/2*f)+(h=null!=t.Fa&&0<t.Fa.length?t.Kc.c*t.Kc.i:0))!=u)o=0;else{if(u>t.Vb){if(t.Vb=0,t.Ec=s(u),t.Fc=0,null==t.Ec){o=Jt(t,1,"no memory during frame initialization.");break t}t.Vb=u}u=t.Ec,d=t.Fc,t.Ac=u,t.Bc=d,d+=l,t.Gd=a(f,Ht),t.Hd=0,t.rb=a(m+1,zt),t.sb=1,t.wa=g?a(g,Bt):null,t.Y=0,t.D.Nb=0,t.D.wa=t.wa,t.D.Y=t.Y,0<t.Aa&&(t.D.Y+=p),e(!0),t.oc=u,t.pc=d,d+=832,t.ya=a(_,Ut),t.aa=0,t.D.ya=t.ya,t.D.aa=t.aa,2==t.Aa&&(t.D.aa+=p),t.R=16*p,t.B=8*p,p=(f=zr[t.L])*t.R,f=f/2*t.B,t.sa=u,t.ta=d+p,t.qa=t.sa,t.ra=t.ta+16*o*t.R+f,t.Ha=t.qa,t.Ia=t.ra+8*o*t.B+f,t.$c=0,d+=c,t.mb=h?u:null,t.nb=h?d:null,e(d+h<=t.Fc+t.Vb),$t(t),r(t.Ac,t.Bc,0,l),o=1}}if(o){if(i.ka=0,i.y=t.sa,i.O=t.ta,i.f=t.qa,i.N=t.ra,i.ea=t.Ha,i.Vd=t.Ia,i.fa=t.R,i.Rc=t.B,i.F=null,i.J=0,!Nn){for(o=-255;255>=o;++o)Ln[255+o]=0>o?-o:o;for(o=-1020;1020>=o;++o)Tn[1020+o]=-128>o?-128:127<o?127:o;for(o=-112;112>=o;++o)Cn[112+o]=-16>o?-16:15<o?15:o;for(o=-255;510>=o;++o)Pn[255+o]=0>o?0:255<o?255:o;Nn=1}sn=ce,an=se,ln=ae,cn=oe,hn=le,on=re,un=Je,dn=Xe,pn=$e,fn=Qe,mn=Ke,gn=Ze,_n=ti,vn=ei,yn=Ve,bn=He,xn=Ge,wn=We,dr[0]=Me,dr[1]=ue,dr[2]=we,dr[3]=Se,dr[4]=Ae,dr[5]=Le,dr[6]=Ee,dr[7]=Te,dr[8]=Pe,dr[9]=Ce,ur[0]=_e,ur[1]=pe,ur[2]=fe,ur[3]=me,ur[4]=ve,ur[5]=ye,ur[6]=be,pr[0]=Ie,pr[1]=de,pr[2]=Ne,pr[3]=Re,pr[4]=ke,pr[5]=Oe,pr[6]=Fe,o=1}else o=0}o&&(o=function(t,i){for(t.M=0;t.M<t.Va;++t.M){var a,o=t.Jc[t.M&t.Xb],l=t.m,c=t;for(a=0;a<c.za;++a){var h=l,u=c,d=u.Ac,p=u.Bc+4*a,f=u.zc,m=u.ya[u.aa+a];if(u.Qa.Bb?m.$b=T(h,u.Pa.jb[0])?2+T(h,u.Pa.jb[2]):T(h,u.Pa.jb[1]):m.$b=0,u.kc&&(m.Ad=T(h,u.Bd)),m.Za=!T(h,145)+0,m.Za){var g=m.Ob,_=0;for(u=0;4>u;++u){var v,y=f[0+u];for(v=0;4>v;++v){y=lr[d[p+v]][y];for(var b=ar[T(h,y[0])];0<b;)b=ar[2*b+T(h,y[b])];y=-b,d[p+v]=y}n(g,_,d,p,4),_+=4,f[0+u]=y}}else y=T(h,156)?T(h,128)?1:3:T(h,163)?2:0,m.Ob[0]=y,r(d,p,y,4),r(f,0,y,4);m.Dd=T(h,142)?T(h,114)?T(h,183)?1:3:2:0}if(c.m.Ka)return Jt(t,7,"Premature end-of-partition0 encountered.");for(;t.ja<t.za;++t.ja){if(c=o,h=(l=t).rb[l.sb-1],d=l.rb[l.sb+l.ja],a=l.ya[l.aa+l.ja],p=l.kc?a.Ad:0)h.la=d.la=0,a.Za||(h.Na=d.Na=0),a.Hc=0,a.Gc=0,a.ia=0;else{var x,w;if(h=d,d=c,p=l.Pa.Xc,f=l.ya[l.aa+l.ja],m=l.pb[f.$b],u=f.ad,g=0,_=l.rb[l.sb-1],y=v=0,r(u,g,0,384),f.Za)var S=0,M=p[3];else{b=s(16);var A=h.Na+_.Na;if(A=nr(d,p[1],A,m.Eb,0,b,0),h.Na=_.Na=(0<A)+0,1<A)sn(b,0,u,g);else{var E=b[0]+3>>3;for(b=0;256>b;b+=16)u[g+b]=E}S=1,M=p[0]}var L=15&h.la,C=15&_.la;for(b=0;4>b;++b){var P=1&C;for(E=w=0;4>E;++E)L=L>>1|(P=(A=nr(d,M,A=P+(1&L),m.Sc,S,u,g))>S)<<7,w=w<<2|(3<A?3:1<A?2:0!=u[g+0]),g+=16;L>>=4,C=C>>1|P<<7,v=(v<<8|w)>>>0}for(M=L,S=C>>4,x=0;4>x;x+=2){for(w=0,L=h.la>>4+x,C=_.la>>4+x,b=0;2>b;++b){for(P=1&C,E=0;2>E;++E)A=P+(1&L),L=L>>1|(P=0<(A=nr(d,p[2],A,m.Qc,0,u,g)))<<3,w=w<<2|(3<A?3:1<A?2:0!=u[g+0]),g+=16;L>>=2,C=C>>1|P<<5}y|=w<<4*x,M|=L<<4<<x,S|=(240&C)<<x}h.la=M,_.la=S,f.Hc=v,f.Gc=y,f.ia=43690&y?0:m.ia,p=!(v|y)}if(0<l.L&&(l.wa[l.Y+l.ja]=l.gd[a.$b][a.Za],l.wa[l.Y+l.ja].La|=!p),c.Ka)return Jt(t,7,"Premature end-of-file encountered.")}if($t(t),l=i,c=1,a=(o=t).D,h=0<o.L&&o.M>=o.zb&&o.M<=o.Va,0==o.Aa)t:{if(a.M=o.M,a.uc=h,Di(o,a),c=1,a=(w=o.D).Nb,h=(y=zr[o.L])*o.R,d=y/2*o.B,b=16*a*o.R,E=8*a*o.B,p=o.sa,f=o.ta-h+b,m=o.qa,u=o.ra-d+E,g=o.Ha,_=o.Ia-d+E,C=0==(L=w.M),v=L>=o.Va-1,2==o.Aa&&Di(o,w),w.uc)for(P=(A=o).D.M,e(A.D.uc),w=A.yb;w<A.Hb;++w){S=w,M=P;var N=(R=(U=A).D).Nb;x=U.R;var R=R.wa[R.Y+S],D=U.sa,I=U.ta+16*N*x+16*S,O=R.dd,k=R.tc;if(0!=k)if(e(3<=k),1==U.L)0<S&&bn(D,I,x,k+4),R.La&&wn(D,I,x,k),0<M&&yn(D,I,x,k+4),R.La&&xn(D,I,x,k);else{var F=U.B,B=U.qa,z=U.ra+8*N*F+8*S,j=U.Ha,U=U.Ia+8*N*F+8*S;N=R.ld,0<S&&(dn(D,I,x,k+4,O,N),fn(B,z,j,U,F,k+4,O,N)),R.La&&(gn(D,I,x,k,O,N),vn(B,z,j,U,F,k,O,N)),0<M&&(un(D,I,x,k+4,O,N),pn(B,z,j,U,F,k+4,O,N)),R.La&&(mn(D,I,x,k,O,N),_n(B,z,j,U,F,k,O,N))}}if(o.ia&&alert("todo:DitherRow"),null!=l.put){if(w=16*L,L=16*(L+1),C?(l.y=o.sa,l.O=o.ta+b,l.f=o.qa,l.N=o.ra+E,l.ea=o.Ha,l.W=o.Ia+E):(w-=y,l.y=p,l.O=f,l.f=m,l.N=u,l.ea=g,l.W=_),v||(L-=y),L>l.o&&(L=l.o),l.F=null,l.J=null,null!=o.Fa&&0<o.Fa.length&&w<L&&(l.J=ui(o,l,w,L-w),l.F=o.mb,null==l.F&&0==l.F.length)){c=Jt(o,3,"Could not decode alpha data.");break t}w<l.j&&(y=l.j-w,w=l.j,e(!(1&y)),l.O+=o.R*y,l.N+=o.B*(y>>1),l.W+=o.B*(y>>1),null!=l.F&&(l.J+=l.width*y)),w<L&&(l.O+=l.v,l.N+=l.v>>1,l.W+=l.v>>1,null!=l.F&&(l.J+=l.v),l.ka=w-l.j,l.U=l.va-l.v,l.T=L-w,c=l.put(l))}a+1!=o.Ic||v||(n(o.sa,o.ta-h,p,f+16*o.R,h),n(o.qa,o.ra-d,m,u+8*o.B,d),n(o.Ha,o.Ia-d,g,_+8*o.B,d))}if(!c)return Jt(t,6,"Output aborted.")}return 1}(t,i)),null!=i.bc&&i.bc(i),o&=1}return o?(t.cb=0,o):0}function te(t,e,i,n,r){r=t[e+i+32*n]+(r>>3),t[e+i+32*n]=-256&r?0>r?0:255:r}function ee(t,e,i,n,r,s){te(t,e,0,i,n+r),te(t,e,1,i,n+s),te(t,e,2,i,n-s),te(t,e,3,i,n-r)}function ie(t){return(20091*t>>16)+t}function ne(t,e,i,n){var r,a=0,o=s(16);for(r=0;4>r;++r){var l=t[e+0]+t[e+8],c=t[e+0]-t[e+8],h=(35468*t[e+4]>>16)-ie(t[e+12]),u=ie(t[e+4])+(35468*t[e+12]>>16);o[a+0]=l+u,o[a+1]=c+h,o[a+2]=c-h,o[a+3]=l-u,a+=4,e++}for(r=a=0;4>r;++r)l=(t=o[a+0]+4)+o[a+8],c=t-o[a+8],h=(35468*o[a+4]>>16)-ie(o[a+12]),te(i,n,0,0,l+(u=ie(o[a+4])+(35468*o[a+12]>>16))),te(i,n,1,0,c+h),te(i,n,2,0,c-h),te(i,n,3,0,l-u),a++,n+=32}function re(t,e,i,n){var r=t[e+0]+4,s=35468*t[e+4]>>16,a=ie(t[e+4]),o=35468*t[e+1]>>16;ee(i,n,0,r+a,t=ie(t[e+1]),o),ee(i,n,1,r+s,t,o),ee(i,n,2,r-s,t,o),ee(i,n,3,r-a,t,o)}function se(t,e,i,n,r){ne(t,e,i,n),r&&ne(t,e+16,i,n+4)}function ae(t,e,i,n){an(t,e+0,i,n,1),an(t,e+32,i,n+128,1)}function oe(t,e,i,n){var r;for(t=t[e+0]+4,r=0;4>r;++r)for(e=0;4>e;++e)te(i,n,e,r,t)}function le(t,e,i,n){t[e+0]&&cn(t,e+0,i,n),t[e+16]&&cn(t,e+16,i,n+4),t[e+32]&&cn(t,e+32,i,n+128),t[e+48]&&cn(t,e+48,i,n+128+4)}function ce(t,e,i,n){var r,a=s(16);for(r=0;4>r;++r){var o=t[e+0+r]+t[e+12+r],l=t[e+4+r]+t[e+8+r],c=t[e+4+r]-t[e+8+r],h=t[e+0+r]-t[e+12+r];a[0+r]=o+l,a[8+r]=o-l,a[4+r]=h+c,a[12+r]=h-c}for(r=0;4>r;++r)o=(t=a[0+4*r]+3)+a[3+4*r],l=a[1+4*r]+a[2+4*r],c=a[1+4*r]-a[2+4*r],h=t-a[3+4*r],i[n+0]=o+l>>3,i[n+16]=h+c>>3,i[n+32]=o-l>>3,i[n+48]=h-c>>3,n+=64}function he(t,e,i){var n,r=e-32,s=In,a=255-t[r-1];for(n=0;n<i;++n){var o,l=s,c=a+t[e-1];for(o=0;o<i;++o)t[e+o]=l[c+t[r+o]];e+=32}}function ue(t,e){he(t,e,4)}function de(t,e){he(t,e,8)}function pe(t,e){he(t,e,16)}function fe(t,e){var i;for(i=0;16>i;++i)n(t,e+32*i,t,e-32,16)}function me(t,e){var i;for(i=16;0<i;--i)r(t,e,t[e-1],16),e+=32}function ge(t,e,i){var n;for(n=0;16>n;++n)r(e,i+32*n,t,16)}function _e(t,e){var i,n=16;for(i=0;16>i;++i)n+=t[e-1+32*i]+t[e+i-32];ge(n>>5,t,e)}function ve(t,e){var i,n=8;for(i=0;16>i;++i)n+=t[e-1+32*i];ge(n>>4,t,e)}function ye(t,e){var i,n=8;for(i=0;16>i;++i)n+=t[e+i-32];ge(n>>4,t,e)}function be(t,e){ge(128,t,e)}function xe(t,e,i){return t+2*e+i+2>>2}function we(t,e){var i,r=e-32;for(r=new Uint8Array([xe(t[r-1],t[r+0],t[r+1]),xe(t[r+0],t[r+1],t[r+2]),xe(t[r+1],t[r+2],t[r+3]),xe(t[r+2],t[r+3],t[r+4])]),i=0;4>i;++i)n(t,e+32*i,r,0,r.length)}function Se(t,e){var i=t[e-1],n=t[e-1+32],r=t[e-1+64],s=t[e-1+96];C(t,e+0,16843009*xe(t[e-1-32],i,n)),C(t,e+32,16843009*xe(i,n,r)),C(t,e+64,16843009*xe(n,r,s)),C(t,e+96,16843009*xe(r,s,s))}function Me(t,e){var i,n=4;for(i=0;4>i;++i)n+=t[e+i-32]+t[e-1+32*i];for(n>>=3,i=0;4>i;++i)r(t,e+32*i,n,4)}function Ae(t,e){var i=t[e-1+0],n=t[e-1+32],r=t[e-1+64],s=t[e-1-32],a=t[e+0-32],o=t[e+1-32],l=t[e+2-32],c=t[e+3-32];t[e+0+96]=xe(n,r,t[e-1+96]),t[e+1+96]=t[e+0+64]=xe(i,n,r),t[e+2+96]=t[e+1+64]=t[e+0+32]=xe(s,i,n),t[e+3+96]=t[e+2+64]=t[e+1+32]=t[e+0+0]=xe(a,s,i),t[e+3+64]=t[e+2+32]=t[e+1+0]=xe(o,a,s),t[e+3+32]=t[e+2+0]=xe(l,o,a),t[e+3+0]=xe(c,l,o)}function Ee(t,e){var i=t[e+1-32],n=t[e+2-32],r=t[e+3-32],s=t[e+4-32],a=t[e+5-32],o=t[e+6-32],l=t[e+7-32];t[e+0+0]=xe(t[e+0-32],i,n),t[e+1+0]=t[e+0+32]=xe(i,n,r),t[e+2+0]=t[e+1+32]=t[e+0+64]=xe(n,r,s),t[e+3+0]=t[e+2+32]=t[e+1+64]=t[e+0+96]=xe(r,s,a),t[e+3+32]=t[e+2+64]=t[e+1+96]=xe(s,a,o),t[e+3+64]=t[e+2+96]=xe(a,o,l),t[e+3+96]=xe(o,l,l)}function Le(t,e){var i=t[e-1+0],n=t[e-1+32],r=t[e-1+64],s=t[e-1-32],a=t[e+0-32],o=t[e+1-32],l=t[e+2-32],c=t[e+3-32];t[e+0+0]=t[e+1+64]=s+a+1>>1,t[e+1+0]=t[e+2+64]=a+o+1>>1,t[e+2+0]=t[e+3+64]=o+l+1>>1,t[e+3+0]=l+c+1>>1,t[e+0+96]=xe(r,n,i),t[e+0+64]=xe(n,i,s),t[e+0+32]=t[e+1+96]=xe(i,s,a),t[e+1+32]=t[e+2+96]=xe(s,a,o),t[e+2+32]=t[e+3+96]=xe(a,o,l),t[e+3+32]=xe(o,l,c)}function Te(t,e){var i=t[e+0-32],n=t[e+1-32],r=t[e+2-32],s=t[e+3-32],a=t[e+4-32],o=t[e+5-32],l=t[e+6-32],c=t[e+7-32];t[e+0+0]=i+n+1>>1,t[e+1+0]=t[e+0+64]=n+r+1>>1,t[e+2+0]=t[e+1+64]=r+s+1>>1,t[e+3+0]=t[e+2+64]=s+a+1>>1,t[e+0+32]=xe(i,n,r),t[e+1+32]=t[e+0+96]=xe(n,r,s),t[e+2+32]=t[e+1+96]=xe(r,s,a),t[e+3+32]=t[e+2+96]=xe(s,a,o),t[e+3+64]=xe(a,o,l),t[e+3+96]=xe(o,l,c)}function Ce(t,e){var i=t[e-1+0],n=t[e-1+32],r=t[e-1+64],s=t[e-1+96];t[e+0+0]=i+n+1>>1,t[e+2+0]=t[e+0+32]=n+r+1>>1,t[e+2+32]=t[e+0+64]=r+s+1>>1,t[e+1+0]=xe(i,n,r),t[e+3+0]=t[e+1+32]=xe(n,r,s),t[e+3+32]=t[e+1+64]=xe(r,s,s),t[e+3+64]=t[e+2+64]=t[e+0+96]=t[e+1+96]=t[e+2+96]=t[e+3+96]=s}function Pe(t,e){var i=t[e-1+0],n=t[e-1+32],r=t[e-1+64],s=t[e-1+96],a=t[e-1-32],o=t[e+0-32],l=t[e+1-32],c=t[e+2-32];t[e+0+0]=t[e+2+32]=i+a+1>>1,t[e+0+32]=t[e+2+64]=n+i+1>>1,t[e+0+64]=t[e+2+96]=r+n+1>>1,t[e+0+96]=s+r+1>>1,t[e+3+0]=xe(o,l,c),t[e+2+0]=xe(a,o,l),t[e+1+0]=t[e+3+32]=xe(i,a,o),t[e+1+32]=t[e+3+64]=xe(n,i,a),t[e+1+64]=t[e+3+96]=xe(r,n,i),t[e+1+96]=xe(s,r,n)}function Ne(t,e){var i;for(i=0;8>i;++i)n(t,e+32*i,t,e-32,8)}function Re(t,e){var i;for(i=0;8>i;++i)r(t,e,t[e-1],8),e+=32}function De(t,e,i){var n;for(n=0;8>n;++n)r(e,i+32*n,t,8)}function Ie(t,e){var i,n=8;for(i=0;8>i;++i)n+=t[e+i-32]+t[e-1+32*i];De(n>>4,t,e)}function Oe(t,e){var i,n=4;for(i=0;8>i;++i)n+=t[e+i-32];De(n>>3,t,e)}function ke(t,e){var i,n=4;for(i=0;8>i;++i)n+=t[e-1+32*i];De(n>>3,t,e)}function Fe(t,e){De(128,t,e)}function Be(t,e,i){var n=t[e-i],r=t[e+0],s=3*(r-n)+Rn[1020+t[e-2*i]-t[e+i]],a=Dn[112+(s+4>>3)];t[e-i]=In[255+n+Dn[112+(s+3>>3)]],t[e+0]=In[255+r-a]}function ze(t,e,i,n){var r=t[e+0],s=t[e+i];return On[255+t[e-2*i]-t[e-i]]>n||On[255+s-r]>n}function je(t,e,i,n){return 4*On[255+t[e-i]-t[e+0]]+On[255+t[e-2*i]-t[e+i]]<=n}function Ue(t,e,i,n,r){var s=t[e-3*i],a=t[e-2*i],o=t[e-i],l=t[e+0],c=t[e+i],h=t[e+2*i],u=t[e+3*i];return 4*On[255+o-l]+On[255+a-c]>n?0:On[255+t[e-4*i]-s]<=r&&On[255+s-a]<=r&&On[255+a-o]<=r&&On[255+u-h]<=r&&On[255+h-c]<=r&&On[255+c-l]<=r}function Ve(t,e,i,n){var r=2*n+1;for(n=0;16>n;++n)je(t,e+n,i,r)&&Be(t,e+n,i)}function He(t,e,i,n){var r=2*n+1;for(n=0;16>n;++n)je(t,e+n*i,1,r)&&Be(t,e+n*i,1)}function Ge(t,e,i,n){var r;for(r=3;0<r;--r)Ve(t,e+=4*i,i,n)}function We(t,e,i,n){var r;for(r=3;0<r;--r)He(t,e+=4,i,n)}function qe(t,e,i,n,r,s,a,o){for(s=2*s+1;0<r--;){if(Ue(t,e,i,s,a))if(ze(t,e,i,o))Be(t,e,i);else{var l=t,c=e,h=i,u=l[c-2*h],d=l[c-h],p=l[c+0],f=l[c+h],m=l[c+2*h],g=27*(v=Rn[1020+3*(p-d)+Rn[1020+u-f]])+63>>7,_=18*v+63>>7,v=9*v+63>>7;l[c-3*h]=In[255+l[c-3*h]+v],l[c-2*h]=In[255+u+_],l[c-h]=In[255+d+g],l[c+0]=In[255+p-g],l[c+h]=In[255+f-_],l[c+2*h]=In[255+m-v]}e+=n}}function Ye(t,e,i,n,r,s,a,o){for(s=2*s+1;0<r--;){if(Ue(t,e,i,s,a))if(ze(t,e,i,o))Be(t,e,i);else{var l=t,c=e,h=i,u=l[c-h],d=l[c+0],p=l[c+h],f=Dn[112+(4+(m=3*(d-u))>>3)],m=Dn[112+(m+3>>3)],g=f+1>>1;l[c-2*h]=In[255+l[c-2*h]+g],l[c-h]=In[255+u+m],l[c+0]=In[255+d-f],l[c+h]=In[255+p-g]}e+=n}}function Je(t,e,i,n,r,s){qe(t,e,i,1,16,n,r,s)}function Xe(t,e,i,n,r,s){qe(t,e,1,i,16,n,r,s)}function Ke(t,e,i,n,r,s){var a;for(a=3;0<a;--a)Ye(t,e+=4*i,i,1,16,n,r,s)}function Ze(t,e,i,n,r,s){var a;for(a=3;0<a;--a)Ye(t,e+=4,1,i,16,n,r,s)}function $e(t,e,i,n,r,s,a,o){qe(t,e,r,1,8,s,a,o),qe(i,n,r,1,8,s,a,o)}function Qe(t,e,i,n,r,s,a,o){qe(t,e,1,r,8,s,a,o),qe(i,n,1,r,8,s,a,o)}function ti(t,e,i,n,r,s,a,o){Ye(t,e+4*r,r,1,8,s,a,o),Ye(i,n+4*r,r,1,8,s,a,o)}function ei(t,e,i,n,r,s,a,o){Ye(t,e+4,1,r,8,s,a,o),Ye(i,n+4,1,r,8,s,a,o)}function ii(){this.ba=new at,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new lt,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function ni(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function ri(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function si(){this.ua=0,this.Wa=new O,this.vb=new O,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new p,this.yc=new u}function ai(){this.xb=this.a=0,this.l=new qt,this.ca=new at,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new x,this.Pb=0,this.wd=new x,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new si,this.ab=0,this.gc=a(4,ri),this.Oc=0}function oi(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new qt,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function li(t,e,i,n,r,s,a){for(t=null==t?0:t[e+0],e=0;e<a;++e)r[s+e]=t+i[n+e]&255,t=r[s+e]}function ci(t,e,i,n,r,s,a){var o;if(null==t)li(null,null,i,n,r,s,a);else for(o=0;o<a;++o)r[s+o]=t[e+o]+i[n+o]&255}function hi(t,e,i,n,r,s,a){if(null==t)li(null,null,i,n,r,s,a);else{var o,l=t[e+0],c=l,h=l;for(o=0;o<a;++o)c=h+(l=t[e+o])-c,h=i[n+o]+(-256&c?0>c?0:255:c)&255,c=l,r[s+o]=h}}function ui(t,i,r,a){var o=i.width,l=i.o;if(e(null!=t&&null!=i),0>r||0>=a||r+a>l)return null;if(!t.Cc){if(null==t.ga){var c;if(t.ga=new oi,(c=null==t.ga)||(c=i.width*i.o,e(0==t.Gb.length),t.Gb=s(c),t.Uc=0,null==t.Gb?c=0:(t.mb=t.Gb,t.nb=t.Uc,t.rc=null,c=1),c=!c),!c){c=t.ga;var h=t.Fa,u=t.P,d=t.qc,p=t.mb,f=t.nb,m=u+1,g=d-1,v=c.l;if(e(null!=h&&null!=p&&null!=i),gr[0]=null,gr[1]=li,gr[2]=ci,gr[3]=hi,c.ca=p,c.tb=f,c.c=i.width,c.i=i.height,e(0<c.c&&0<c.i),1>=d)i=0;else if(c.$a=h[u+0]>>0&3,c.Z=h[u+0]>>2&3,c.Lc=h[u+0]>>4&3,u=h[u+0]>>6&3,0>c.$a||1<c.$a||4<=c.Z||1<c.Lc||u)i=0;else if(v.put=pt,v.ac=dt,v.bc=ft,v.ma=c,v.width=i.width,v.height=i.height,v.Da=i.Da,v.v=i.v,v.va=i.va,v.j=i.j,v.o=i.o,c.$a)t:{e(1==c.$a),i=Tt();e:for(;;){if(null==i){i=0;break t}if(e(null!=c),c.mc=i,i.c=c.c,i.i=c.i,i.l=c.l,i.l.ma=c,i.l.width=c.c,i.l.height=c.i,i.a=0,_(i.m,h,m,g),!Ct(c.c,c.i,1,i,null))break e;if(1==i.ab&&3==i.gc[0].hc&&St(i.s)?(c.ic=1,h=i.c*i.i,i.Ta=null,i.Ua=0,i.V=s(h),i.Ba=0,null==i.V?(i.a=1,i=0):i=1):(c.ic=0,i=Pt(i,c.c)),!i)break e;i=1;break t}c.mc=null,i=0}else i=g>=c.c*c.i;c=!i}if(c)return null;1!=t.ga.Lc?t.Ga=0:a=l-r}e(null!=t.ga),e(r+a<=l);t:{if(i=(h=t.ga).c,l=h.l.o,0==h.$a){if(m=t.rc,g=t.Vc,v=t.Fa,u=t.P+1+r*i,d=t.mb,p=t.nb+r*i,e(u<=t.P+t.qc),0!=h.Z)for(e(null!=gr[h.Z]),c=0;c<a;++c)gr[h.Z](m,g,v,u,d,p,i),m=d,g=p,p+=i,u+=i;else for(c=0;c<a;++c)n(d,p,v,u,i),m=d,g=p,p+=i,u+=i;t.rc=m,t.Vc=g}else{if(e(null!=h.mc),i=r+a,e(null!=(c=h.mc)),e(i<=c.i),c.C>=i)i=1;else if(h.ic||gi(),h.ic){h=c.V,m=c.Ba,g=c.c;var y=c.i,b=(v=1,u=c.$/g,d=c.$%g,p=c.m,f=c.s,c.$),x=g*y,w=g*i,M=f.wc,E=b<w?bt(f,d,u):null;e(b<=x),e(i<=y),e(St(f));e:for(;;){for(;!p.h&&b<w;){if(d&M||(E=bt(f,d,u)),e(null!=E),A(p),256>(y=vt(E.G[0],E.H[0],p)))h[m+b]=y,++b,++d>=g&&(d=0,++u<=i&&!(u%16)&&At(c,u));else{if(!(280>y)){v=0;break e}y=gt(y-256,p);var L,T=vt(E.G[4],E.H[4],p);if(A(p),!(b>=(T=_t(g,T=gt(T,p)))&&x-b>=y)){v=0;break e}for(L=0;L<y;++L)h[m+b+L]=h[m+b+L-T];for(b+=y,d+=y;d>=g;)d-=g,++u<=i&&!(u%16)&&At(c,u);b<w&&d&M&&(E=bt(f,d,u))}e(p.h==S(p))}At(c,u>i?i:u);break e}!v||p.h&&b<x?(v=0,c.a=p.h?5:3):c.$=b,i=v}else i=Et(c,c.V,c.Ba,c.c,c.i,i,Nt);if(!i){a=0;break t}}r+a>=l&&(t.Cc=1),a=1}if(!a)return null;if(t.Cc&&(null!=(a=t.ga)&&(a.mc=null),t.ga=null,0<t.Ga))return alert("todo:WebPDequantizeLevels"),null}return t.nb+r*o}function di(t,e,i,n,r,s){for(;0<r--;){var a,o=t,l=e+(i?1:0),c=t,h=e+(i?0:3);for(a=0;a<n;++a){var u=c[h+4*a];255!=u&&(u*=32897,o[l+4*a+0]=o[l+4*a+0]*u>>23,o[l+4*a+1]=o[l+4*a+1]*u>>23,o[l+4*a+2]=o[l+4*a+2]*u>>23)}e+=s}}function pi(t,e,i,n,r){for(;0<n--;){var s;for(s=0;s<i;++s){var a=t[e+2*s+0],o=15&(c=t[e+2*s+1]),l=4369*o,c=(240&c|c>>4)*l>>16;t[e+2*s+0]=(240&a|a>>4)*l>>16&240|(15&a|a<<4)*l>>16>>4&15,t[e+2*s+1]=240&c|o}e+=r}}function fi(t,e,i,n,r,s,a,o){var l,c,h=255;for(c=0;c<r;++c){for(l=0;l<n;++l){var u=t[e+l];s[a+4*l]=u,h&=u}e+=i,a+=o}return 255!=h}function mi(t,e,i,n,r){var s;for(s=0;s<r;++s)i[n+s]=t[e+s]>>8}function gi(){Sn=di,Mn=pi,An=fi,En=mi}function _i(i,n,r){t[i]=function(t,i,s,a,o,l,c,h,u,d,p,f,m,g,_,v,y){var b,x=y-1>>1,w=o[l+0]|c[h+0]<<16,S=u[d+0]|p[f+0]<<16;e(null!=t);var M=3*w+S+131074>>2;for(n(t[i+0],255&M,M>>16,m,g),null!=s&&(M=3*S+w+131074>>2,n(s[a+0],255&M,M>>16,_,v)),b=1;b<=x;++b){var A=o[l+b]|c[h+b]<<16,E=u[d+b]|p[f+b]<<16,L=w+A+S+E+524296,T=L+2*(A+S)>>3;M=T+w>>1,w=(L=L+2*(w+E)>>3)+A>>1,n(t[i+2*b-1],255&M,M>>16,m,g+(2*b-1)*r),n(t[i+2*b-0],255&w,w>>16,m,g+(2*b-0)*r),null!=s&&(M=L+S>>1,w=T+E>>1,n(s[a+2*b-1],255&M,M>>16,_,v+(2*b-1)*r),n(s[a+2*b+0],255&w,w>>16,_,v+(2*b+0)*r)),w=A,S=E}1&y||(M=3*w+S+131074>>2,n(t[i+y-1],255&M,M>>16,m,g+(y-1)*r),null!=s&&(M=3*S+w+131074>>2,n(s[a+y-1],255&M,M>>16,_,v+(y-1)*r)))}}function vi(){_r[kn]=vr,_r[Fn]=br,_r[Bn]=yr,_r[zn]=xr,_r[jn]=wr,_r[Un]=Sr,_r[Vn]=Mr,_r[Hn]=br,_r[Gn]=xr,_r[Wn]=wr,_r[qn]=Sr}function yi(t){return t&~Pr?0>t?0:255:t>>Cr}function bi(t,e){return yi((19077*t>>8)+(26149*e>>8)-14234)}function xi(t,e,i){return yi((19077*t>>8)-(6419*e>>8)-(13320*i>>8)+8708)}function wi(t,e){return yi((19077*t>>8)+(33050*e>>8)-17685)}function Si(t,e,i,n,r){n[r+0]=bi(t,i),n[r+1]=xi(t,e,i),n[r+2]=wi(t,e)}function Mi(t,e,i,n,r){n[r+0]=wi(t,e),n[r+1]=xi(t,e,i),n[r+2]=bi(t,i)}function Ai(t,e,i,n,r){var s=xi(t,e,i);e=s<<3&224|wi(t,e)>>3,n[r+0]=248&bi(t,i)|s>>5,n[r+1]=e}function Ei(t,e,i,n,r){var s=240&wi(t,e)|15;n[r+0]=240&bi(t,i)|xi(t,e,i)>>4,n[r+1]=s}function Li(t,e,i,n,r){n[r+0]=255,Si(t,e,i,n,r+1)}function Ti(t,e,i,n,r){Mi(t,e,i,n,r),n[r+3]=255}function Ci(t,e,i,n,r){Si(t,e,i,n,r),n[r+3]=255}function Wt(t,e){return 0>t?0:t>e?e:t}function Pi(e,i,n){t[e]=function(t,e,r,s,a,o,l,c,h){for(var u=c+(-2&h)*n;c!=u;)i(t[e+0],r[s+0],a[o+0],l,c),i(t[e+1],r[s+0],a[o+0],l,c+n),e+=2,++s,++o,c+=2*n;1&h&&i(t[e+0],r[s+0],a[o+0],l,c)}}function Ni(t,e,i){return 0==i?0==t?0==e?6:5:0==e?4:0:i}function Ri(t,e,i,n,r){switch(t>>>30){case 3:an(e,i,n,r,0);break;case 2:on(e,i,n,r);break;case 1:cn(e,i,n,r)}}function Di(t,e){var i,s,a=e.M,o=e.Nb,l=t.oc,c=t.pc+40,h=t.oc,u=t.pc+584,d=t.oc,p=t.pc+600;for(i=0;16>i;++i)l[c+32*i-1]=129;for(i=0;8>i;++i)h[u+32*i-1]=129,d[p+32*i-1]=129;for(0<a?l[c-1-32]=h[u-1-32]=d[p-1-32]=129:(r(l,c-32-1,127,21),r(h,u-32-1,127,9),r(d,p-32-1,127,9)),s=0;s<t.za;++s){var f=e.ya[e.aa+s];if(0<s){for(i=-1;16>i;++i)n(l,c+32*i-4,l,c+32*i+12,4);for(i=-1;8>i;++i)n(h,u+32*i-4,h,u+32*i+4,4),n(d,p+32*i-4,d,p+32*i+4,4)}var m=t.Gd,g=t.Hd+s,_=f.ad,v=f.Hc;if(0<a&&(n(l,c-32,m[g].y,0,16),n(h,u-32,m[g].f,0,8),n(d,p-32,m[g].ea,0,8)),f.Za){var y=l,b=c-32+16;for(0<a&&(s>=t.za-1?r(y,b,m[g].y[15],4):n(y,b,m[g+1].y,0,4)),i=0;4>i;i++)y[b+128+i]=y[b+256+i]=y[b+384+i]=y[b+0+i];for(i=0;16>i;++i,v<<=2)y=l,b=c+Br[i],dr[f.Ob[i]](y,b),Ri(v,_,16*+i,y,b)}else if(y=Ni(s,a,f.Ob[0]),ur[y](l,c),0!=v)for(i=0;16>i;++i,v<<=2)Ri(v,_,16*+i,l,c+Br[i]);for(i=f.Gc,y=Ni(s,a,f.Dd),pr[y](h,u),pr[y](d,p),v=_,y=h,b=u,255&(f=i>>0)&&(170&f?ln(v,256,y,b):hn(v,256,y,b)),f=d,v=p,255&(i>>=8)&&(170&i?ln(_,320,f,v):hn(_,320,f,v)),a<t.Ub-1&&(n(m[g].y,0,l,c+480,16),n(m[g].f,0,h,u+224,8),n(m[g].ea,0,d,p+224,8)),i=8*o*t.B,m=t.sa,g=t.ta+16*s+16*o*t.R,_=t.qa,f=t.ra+8*s+i,v=t.Ha,y=t.Ia+8*s+i,i=0;16>i;++i)n(m,g+i*t.R,l,c+32*i,16);for(i=0;8>i;++i)n(_,f+i*t.B,h,u+32*i,8),n(v,y+i*t.B,d,p+32*i,8)}}function Ii(t,n,r,s,a,o,l,c,h){var u=[0],d=[0],p=0,f=null!=h?h.kd:0,m=null!=h?h:new ni;if(null==t||12>r)return 7;m.data=t,m.w=n,m.ha=r,n=[n],r=[r],m.gb=[m.gb];t:{var g=n,v=r,y=m.gb;if(e(null!=t),e(null!=v),e(null!=y),y[0]=0,12<=v[0]&&!i(t,g[0],"RIFF")){if(i(t,g[0]+8,"WEBP")){y=3;break t}var b=R(t,g[0]+4);if(12>b||4294967286<b){y=3;break t}if(f&&b>v[0]-8){y=7;break t}y[0]=b,g[0]+=12,v[0]-=12}y=0}if(0!=y)return y;for(b=0<m.gb[0],r=r[0];;){t:{var w=t;v=n,y=r;var S=u,M=d,A=g=[0];if((T=p=[p])[0]=0,8>y[0])y=7;else{if(!i(w,v[0],"VP8X")){if(10!=R(w,v[0]+4)){y=3;break t}if(18>y[0]){y=7;break t}var E=R(w,v[0]+8),L=1+N(w,v[0]+12);if(2147483648<=L*(w=1+N(w,v[0]+15))){y=3;break t}null!=A&&(A[0]=E),null!=S&&(S[0]=L),null!=M&&(M[0]=w),v[0]+=18,y[0]-=18,T[0]=1}y=0}}if(p=p[0],g=g[0],0!=y)return y;if(v=!!(2&g),!b&&p)return 3;if(null!=o&&(o[0]=!!(16&g)),null!=l&&(l[0]=v),null!=c&&(c[0]=0),l=u[0],g=d[0],p&&v&&null==h){y=0;break}if(4>r){y=7;break}if(b&&p||!b&&!p&&!i(t,n[0],"ALPH")){r=[r],m.na=[m.na],m.P=[m.P],m.Sa=[m.Sa];t:{E=t,y=n,b=r;var T=m.gb;S=m.na,M=m.P,A=m.Sa,L=22,e(null!=E),e(null!=b),w=y[0];var C=b[0];for(e(null!=S),e(null!=A),S[0]=null,M[0]=null,A[0]=0;;){if(y[0]=w,b[0]=C,8>C){y=7;break t}var P=R(E,w+4);if(4294967286<P){y=3;break t}var D=8+P+1&-2;if(L+=D,0<T&&L>T){y=3;break t}if(!i(E,w,"VP8 ")||!i(E,w,"VP8L")){y=0;break t}if(C[0]<D){y=7;break t}i(E,w,"ALPH")||(S[0]=E,M[0]=w+8,A[0]=P),w+=D,C-=D}}if(r=r[0],m.na=m.na[0],m.P=m.P[0],m.Sa=m.Sa[0],0!=y)break}r=[r],m.Ja=[m.Ja],m.xa=[m.xa];t:if(T=t,y=n,b=r,S=m.gb[0],M=m.Ja,A=m.xa,E=y[0],w=!i(T,E,"VP8 "),L=!i(T,E,"VP8L"),e(null!=T),e(null!=b),e(null!=M),e(null!=A),8>b[0])y=7;else{if(w||L){if(T=R(T,E+4),12<=S&&T>S-12){y=3;break t}if(f&&T>b[0]-8){y=7;break t}M[0]=T,y[0]+=8,b[0]-=8,A[0]=L}else A[0]=5<=b[0]&&47==T[E+0]&&!(T[E+4]>>5),M[0]=b[0];y=0}if(r=r[0],m.Ja=m.Ja[0],m.xa=m.xa[0],n=n[0],0!=y)break;if(4294967286<m.Ja)return 3;if(null==c||v||(c[0]=m.xa?2:1),l=[l],g=[g],m.xa){if(5>r){y=7;break}c=l,f=g,v=o,null==t||5>r?t=0:5<=r&&47==t[n+0]&&!(t[n+4]>>5)?(b=[0],T=[0],S=[0],_(M=new x,t,n,r),mt(M,b,T,S)?(null!=c&&(c[0]=b[0]),null!=f&&(f[0]=T[0]),null!=v&&(v[0]=S[0]),t=1):t=0):t=0}else{if(10>r){y=7;break}c=g,null==t||10>r||!Xt(t,n+3,r-3)?t=0:(f=t[n+0]|t[n+1]<<8|t[n+2]<<16,v=16383&(t[n+7]<<8|t[n+6]),t=16383&(t[n+9]<<8|t[n+8]),1&f||3<(f>>1&7)||!(f>>4&1)||f>>5>=m.Ja||!v||!t?t=0:(l&&(l[0]=v),c&&(c[0]=t),t=1))}if(!t)return 3;if(l=l[0],g=g[0],p&&(u[0]!=l||d[0]!=g))return 3;null!=h&&(h[0]=m,h.offset=n-h.w,e(4294967286>n-h.w),e(h.offset==h.ha-r));break}return 0==y||7==y&&p&&null==h?(null!=o&&(o[0]|=null!=m.na&&0<m.na.length),null!=s&&(s[0]=l),null!=a&&(a[0]=g),0):y}function Oi(t,e,i){var n=e.width,r=e.height,s=0,a=0,o=n,l=r;if(e.Da=null!=t&&0<t.Da,e.Da&&(o=t.cd,l=t.bd,s=t.v,a=t.j,11>i||(s&=-2,a&=-2),0>s||0>a||0>=o||0>=l||s+o>n||a+l>r))return 0;if(e.v=s,e.j=a,e.va=s+o,e.o=a+l,e.U=o,e.T=l,e.da=null!=t&&0<t.da,e.da){if(!k(o,l,i=[t.ib],s=[t.hb]))return 0;e.ib=i[0],e.hb=s[0]}return e.ob=null!=t&&t.ob,e.Kb=null==t||!t.Sd,e.da&&(e.ob=e.ib<3*n/4&&e.hb<3*r/4,e.Kb=0),1}function ki(t){if(null==t)return 2;if(11>t.S){var e=t.f.RGBA;e.fb+=(t.height-1)*e.A,e.A=-e.A}else e=t.f.kb,t=t.height,e.O+=(t-1)*e.fa,e.fa=-e.fa,e.N+=(t-1>>1)*e.Ab,e.Ab=-e.Ab,e.W+=(t-1>>1)*e.Db,e.Db=-e.Db,null!=e.F&&(e.J+=(t-1)*e.lb,e.lb=-e.lb);return 0}function Fi(t,e,i,n){if(null==n||0>=t||0>=e)return 2;if(null!=i){if(i.Da){var r=i.cd,a=i.bd,o=-2&i.v,l=-2&i.j;if(0>o||0>l||0>=r||0>=a||o+r>t||l+a>e)return 2;t=r,e=a}if(i.da){if(!k(t,e,r=[i.ib],a=[i.hb]))return 2;t=r[0],e=a[0]}}n.width=t,n.height=e;t:{var c=n.width,h=n.height;if(t=n.S,0>=c||0>=h||!(t>=kn&&13>t))t=2;else{if(0>=n.Rd&&null==n.sd){o=a=r=e=0;var u=(l=c*Vr[t])*h;if(11>t||(a=(h+1)/2*(e=(c+1)/2),12==t&&(o=(r=c)*h)),null==(h=s(u+2*a+o))){t=1;break t}n.sd=h,11>t?((c=n.f.RGBA).eb=h,c.fb=0,c.A=l,c.size=u):((c=n.f.kb).y=h,c.O=0,c.fa=l,c.Fd=u,c.f=h,c.N=0+u,c.Ab=e,c.Cd=a,c.ea=h,c.W=0+u+a,c.Db=e,c.Ed=a,12==t&&(c.F=h,c.J=0+u+2*a),c.Tc=o,c.lb=r)}if(e=1,r=n.S,a=n.width,o=n.height,r>=kn&&13>r)if(11>r)t=n.f.RGBA,e&=(l=Math.abs(t.A))*(o-1)+a<=t.size,e&=l>=a*Vr[r],e&=null!=t.eb;else{t=n.f.kb,l=(a+1)/2,u=(o+1)/2,c=Math.abs(t.fa),h=Math.abs(t.Ab);var d=Math.abs(t.Db),p=Math.abs(t.lb),f=p*(o-1)+a;e&=c*(o-1)+a<=t.Fd,e&=h*(u-1)+l<=t.Cd,e=(e&=d*(u-1)+l<=t.Ed)&c>=a&h>=l&d>=l,e&=null!=t.y,e&=null!=t.f,e&=null!=t.ea,12==r&&(e&=p>=a,e&=f<=t.Tc,e&=null!=t.F)}else e=0;t=e?0:2}}return 0!=t||null!=i&&i.fd&&(t=ki(n)),t}var Bi=64,zi=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],ji=24,Ui=32,Vi=8,Hi=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];z("Predictor0","PredictorAdd0"),t.Predictor0=function(){return 4278190080},t.Predictor1=function(t){return t},t.Predictor2=function(t,e,i){return e[i+0]},t.Predictor3=function(t,e,i){return e[i+1]},t.Predictor4=function(t,e,i){return e[i-1]},t.Predictor5=function(t,e,i){return U(U(t,e[i+1]),e[i+0])},t.Predictor6=function(t,e,i){return U(t,e[i-1])},t.Predictor7=function(t,e,i){return U(t,e[i+0])},t.Predictor8=function(t,e,i){return U(e[i-1],e[i+0])},t.Predictor9=function(t,e,i){return U(e[i+0],e[i+1])},t.Predictor10=function(t,e,i){return U(U(t,e[i-1]),U(e[i+0],e[i+1]))},t.Predictor11=function(t,e,i){var n=e[i+0];return 0>=G(n>>24&255,t>>24&255,(e=e[i-1])>>24&255)+G(n>>16&255,t>>16&255,e>>16&255)+G(n>>8&255,t>>8&255,e>>8&255)+G(255&n,255&t,255&e)?n:t},t.Predictor12=function(t,e,i){var n=e[i+0];return(V((t>>24&255)+(n>>24&255)-((e=e[i-1])>>24&255))<<24|V((t>>16&255)+(n>>16&255)-(e>>16&255))<<16|V((t>>8&255)+(n>>8&255)-(e>>8&255))<<8|V((255&t)+(255&n)-(255&e)))>>>0},t.Predictor13=function(t,e,i){var n=e[i-1];return(H((t=U(t,e[i+0]))>>24&255,n>>24&255)<<24|H(t>>16&255,n>>16&255)<<16|H(t>>8&255,n>>8&255)<<8|H(t>>0&255,n>>0&255))>>>0};var Gi=t.PredictorAdd0;t.PredictorAdd1=W,z("Predictor2","PredictorAdd2"),z("Predictor3","PredictorAdd3"),z("Predictor4","PredictorAdd4"),z("Predictor5","PredictorAdd5"),z("Predictor6","PredictorAdd6"),z("Predictor7","PredictorAdd7"),z("Predictor8","PredictorAdd8"),z("Predictor9","PredictorAdd9"),z("Predictor10","PredictorAdd10"),z("Predictor11","PredictorAdd11"),z("Predictor12","PredictorAdd12"),z("Predictor13","PredictorAdd13");var Wi=t.PredictorAdd2;X("ColorIndexInverseTransform","MapARGB","32b",(function(t){return t>>8&255}),(function(t){return t})),X("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",(function(t){return t}),(function(t){return t>>8&255}));var qi,Yi=t.ColorIndexInverseTransform,Ji=t.MapARGB,Xi=t.VP8LColorIndexInverseTransformAlpha,Ki=t.MapAlpha,Zi=t.VP8LPredictorsAdd=[];Zi.length=16,(t.VP8LPredictors=[]).length=16,(t.VP8LPredictorsAdd_C=[]).length=16,(t.VP8LPredictors_C=[]).length=16;var $i,Qi,tn,en,nn,rn,sn,an,on,ln,cn,hn,un,dn,pn,fn,mn,gn,_n,vn,yn,bn,xn,wn,Sn,Mn,An,En,Ln=s(511),Tn=s(2041),Cn=s(225),Pn=s(767),Nn=0,Rn=Tn,Dn=Cn,In=Pn,On=Ln,kn=0,Fn=1,Bn=2,zn=3,jn=4,Un=5,Vn=6,Hn=7,Gn=8,Wn=9,qn=10,Yn=[2,3,7],Jn=[3,3,11],Xn=[280,256,256,256,40],Kn=[0,1,1,1,0],Zn=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],$n=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Qn=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],tr=8,er=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],ir=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],nr=null,rr=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],sr=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ar=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],or=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],lr=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],cr=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],hr=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ur=[],dr=[],pr=[],fr=1,mr=2,gr=[],_r=[];_i("UpsampleRgbLinePair",Si,3),_i("UpsampleBgrLinePair",Mi,3),_i("UpsampleRgbaLinePair",Ci,4),_i("UpsampleBgraLinePair",Ti,4),_i("UpsampleArgbLinePair",Li,4),_i("UpsampleRgba4444LinePair",Ei,2),_i("UpsampleRgb565LinePair",Ai,2);var vr=t.UpsampleRgbLinePair,yr=t.UpsampleBgrLinePair,br=t.UpsampleRgbaLinePair,xr=t.UpsampleBgraLinePair,wr=t.UpsampleArgbLinePair,Sr=t.UpsampleRgba4444LinePair,Mr=t.UpsampleRgb565LinePair,Ar=16,Er=1<<Ar-1,Lr=-227,Tr=482,Cr=6,Pr=(256<<Cr)-1,Nr=0,Rr=s(256),Dr=s(256),Ir=s(256),Or=s(256),kr=s(Tr-Lr),Fr=s(Tr-Lr);Pi("YuvToRgbRow",Si,3),Pi("YuvToBgrRow",Mi,3),Pi("YuvToRgbaRow",Ci,4),Pi("YuvToBgraRow",Ti,4),Pi("YuvToArgbRow",Li,4),Pi("YuvToRgba4444Row",Ei,2),Pi("YuvToRgb565Row",Ai,2);var Br=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],zr=[0,2,8],jr=[8,7,6,4,4,2,2,2,1,1,1,1],Ur=1;this.WebPDecodeRGBA=function(t,i,n,r,s){var a=Fn,o=new ii,l=new at;o.ba=l,l.S=a,l.width=[l.width],l.height=[l.height];var c=l.width,h=l.height,u=new ot;if(null==u||null==t)var d=2;else e(null!=u),d=Ii(t,i,n,u.width,u.height,u.Pd,u.Qd,u.format,null);if(0!=d?c=0:(null!=c&&(c[0]=u.width[0]),null!=h&&(h[0]=u.height[0]),c=1),c){l.width=l.width[0],l.height=l.height[0],null!=r&&(r[0]=l.width),null!=s&&(s[0]=l.height);t:{if(r=new qt,(s=new ni).data=t,s.w=i,s.ha=n,s.kd=1,i=[0],e(null!=s),(0==(t=Ii(s.data,s.w,s.ha,null,null,null,i,null,s))||7==t)&&i[0]&&(t=4),0==(i=t)){if(e(null!=o),r.data=s.data,r.w=s.w+s.offset,r.ha=s.ha-s.offset,r.put=pt,r.ac=dt,r.bc=ft,r.ma=o,s.xa){if(null==(t=Tt())){o=1;break t}if(function(t,i){var n=[0],r=[0],s=[0];e:for(;;){if(null==t)return 0;if(null==i)return t.a=2,0;if(t.l=i,t.a=0,_(t.m,i.data,i.w,i.ha),!mt(t.m,n,r,s)){t.a=3;break e}if(t.xb=mr,i.width=n[0],i.height=r[0],!Ct(n[0],r[0],1,t,null))break e;return 1}return e(0!=t.a),0}(t,r)){if(r=0==(i=Fi(r.width,r.height,o.Oa,o.ba))){e:{r=t;i:for(;;){if(null==r){r=0;break e}if(e(null!=r.s.yc),e(null!=r.s.Ya),e(0<r.s.Wb),e(null!=(n=r.l)),e(null!=(s=n.ma)),0!=r.xb){if(r.ca=s.ba,r.tb=s.tb,e(null!=r.ca),!Oi(s.Oa,n,zn)){r.a=2;break i}if(!Pt(r,n.width))break i;if(n.da)break i;if((n.da||nt(r.ca.S))&&gi(),11>r.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),null!=r.ca.f.kb.F&&gi()),r.Pb&&0<r.s.ua&&null==r.s.vb.X&&!D(r.s.vb,r.s.Wa.Xa)){r.a=1;break i}r.xb=0}if(!Et(r,r.V,r.Ba,r.c,r.i,n.o,wt))break i;s.Dc=r.Ma,r=1;break e}e(0!=r.a),r=0}r=!r}r&&(i=t.a)}else i=t.a}else{if(null==(t=new Yt)){o=1;break t}if(t.Fa=s.na,t.P=s.P,t.qc=s.Sa,Kt(t,r)){if(0==(i=Fi(r.width,r.height,o.Oa,o.ba))){if(t.Aa=0,n=o.Oa,e(null!=(s=t)),null!=n){if(0<(c=0>(c=n.Md)?0:100<c?255:255*c/100)){for(h=u=0;4>h;++h)12>(d=s.pb[h]).lc&&(d.ia=c*jr[0>d.lc?0:d.lc]>>3),u|=d.ia;u&&(alert("todo:VP8InitRandom"),s.ia=1)}s.Ga=n.Id,100<s.Ga?s.Ga=100:0>s.Ga&&(s.Ga=0)}Qt(t,r)||(i=t.a)}}else i=t.a}0==i&&null!=o.Oa&&o.Oa.fd&&(i=ki(o.ba))}o=i}a=0!=o?null:11>a?l.f.RGBA.eb:l.f.kb.y}else a=null;return a};var Vr=[3,4,3,4,4,2,2,4,4,4,2,1,1]});var u=[0],d=[0],p=[],f=new qe,m=t,g=function(t,e){var i={},n=0,r=!1,s=0,a=0;if(i.frames=[],!
/** @license
   * Copyright (c) 2017 Dominik Homberger

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

https://webpjs.appspot.com
WebPRiffParser dominikhlbg@gmail.com
*/
function(t,e,i,n){for(var r=0;r<4;r++)if(t[e+r]!="RIFF".charCodeAt(r))return!0;return!1}(t,e)){var o,u;for(h(t,e+=4),e+=8;e<t.length;){var d=l(t,e),p=h(t,e+=4);e+=4;var f=p+(1&p);switch(d){case"VP8 ":case"VP8L":void 0===i.frames[n]&&(i.frames[n]={}),(_=i.frames[n]).src_off=r?a:e-8,_.src_size=s+p+8,n++,r&&(r=!1,s=0,a=0);break;case"VP8X":(_=i.header={}).feature_flags=t[e];var m=e+4;_.canvas_width=1+c(t,m),m+=3,_.canvas_height=1+c(t,m),m+=3;break;case"ALPH":r=!0,s=f+8,a=e-8;break;case"ANIM":(_=i.header).bgcolor=h(t,e),m=e+4,_.loop_count=(o=t)[(u=m)+0]<<0|o[u+1]<<8,m+=2;break;case"ANMF":var g,_;(_=i.frames[n]={}).offset_x=2*c(t,e),e+=3,_.offset_y=2*c(t,e),e+=3,_.width=1+c(t,e),e+=3,_.height=1+c(t,e),e+=3,_.duration=c(t,e),e+=3,g=t[e++],_.dispose=1&g,_.blend=g>>1&1}"ANMF"!=d&&(e+=f)}return i}}(m,0);g.response=m,g.rgbaoutput=!0,g.dataurl=!1;var _=g.header?g.header:null,v=g.frames?g.frames:null;if(_){_.loop_counter=_.loop_count,u=[_.canvas_height],d=[_.canvas_width];for(var y=0;y<v.length&&0!=v[y].blend;y++);}var b=v[0],x=f.WebPDecodeRGBA(m,b.src_off,b.src_size,d,u);b.rgba=x,b.imgwidth=d[0],b.imgheight=u[0];for(var w=0;w<d[0]*u[0]*4;w++)p[w]=x[w];return this.width=d,this.height=u,this.data=p,this}!function(t){var e=function(e,n,l,c){var h=4,u=s;switch(c){case t.image_compression.FAST:h=1,u=r;break;case t.image_compression.MEDIUM:h=6,u=a;break;case t.image_compression.SLOW:h=9,u=o}var d=K(e=i(e,n,l,u),{level:h});return t.__addimage__.arrayBufferToBinaryString(d)},i=function(t,e,i,n){for(var r,s,a,o=t.length/e,l=new Uint8Array(t.length+o),u=c(),d=0;d<o;d+=1){if(a=d*e,r=t.subarray(a,a+e),n)l.set(n(r,i,s),a+d);else{for(var p,f=u.length,m=[];p<f;p+=1)m[p]=u[p](r,i,s);var g=h(m.concat());l.set(m[g],a+d)}s=r}return l},n=function(t){var e=Array.apply([],t);return e.unshift(0),e},r=function(t,e){var i,n=[],r=t.length;n[0]=1;for(var s=0;s<r;s+=1)i=t[s-e]||0,n[s+1]=t[s]-i+256&255;return n},s=function(t,e,i){var n,r=[],s=t.length;r[0]=2;for(var a=0;a<s;a+=1)n=i&&i[a]||0,r[a+1]=t[a]-n+256&255;return r},a=function(t,e,i){var n,r,s=[],a=t.length;s[0]=3;for(var o=0;o<a;o+=1)n=t[o-e]||0,r=i&&i[o]||0,s[o+1]=t[o]+256-(n+r>>>1)&255;return s},o=function(t,e,i){var n,r,s,a,o=[],c=t.length;o[0]=4;for(var h=0;h<c;h+=1)n=t[h-e]||0,r=i&&i[h]||0,s=i&&i[h-e]||0,a=l(n,r,s),o[h+1]=t[h]-a+256&255;return o},l=function(t,e,i){if(t===e&&e===i)return t;var n=Math.abs(e-i),r=Math.abs(t-i),s=Math.abs(t+e-i-i);return n<=r&&n<=s?t:r<=s?e:i},c=function(){return[n,r,s,a,o]},h=function(t){var e=t.map((function(t){return t.reduce((function(t,e){return t+Math.abs(e)}),0)}));return e.indexOf(Math.min.apply(null,e))};t.processPNG=function(i,n,r,s){var a,o,l,c,h,u,d,p,f,m,g,_,v,y,b,x=this.decode.FLATE_DECODE,w="";if(this.__addimage__.isArrayBuffer(i)&&(i=new Uint8Array(i)),this.__addimage__.isArrayBufferView(i)){if(i=(l=new Ue(i)).imgData,o=l.bits,a=l.colorSpace,h=l.colors,-1!==[4,6].indexOf(l.colorType)){if(8===l.bits){f=(p=32==l.pixelBitlength?new Uint32Array(l.decodePixels().buffer):16==l.pixelBitlength?new Uint16Array(l.decodePixels().buffer):new Uint8Array(l.decodePixels().buffer)).length,g=new Uint8Array(f*l.colors),m=new Uint8Array(f);var S,M=l.pixelBitlength-l.bits;for(y=0,b=0;y<f;y++){for(v=p[y],S=0;S<M;)g[b++]=v>>>S&255,S+=l.bits;m[y]=v>>>S&255}}if(16===l.bits){f=(p=new Uint32Array(l.decodePixels().buffer)).length,g=new Uint8Array(f*(32/l.pixelBitlength)*l.colors),m=new Uint8Array(f*(32/l.pixelBitlength)),_=l.colors>1,y=0,b=0;for(var A=0;y<f;)v=p[y++],g[b++]=v>>>0&255,_&&(g[b++]=v>>>16&255,v=p[y++],g[b++]=v>>>0&255),m[A++]=v>>>16&255;o=8}s!==t.image_compression.NONE?(i=e(g,l.width*l.colors,l.colors,s),d=e(m,l.width,1,s)):(i=g,d=m,x=void 0)}if(3===l.colorType&&(a=this.color_spaces.INDEXED,u=l.palette,l.transparency.indexed)){var E=l.transparency.indexed,L=0;for(y=0,f=E.length;y<f;++y)L+=E[y];if((L/=255)==f-1&&-1!==E.indexOf(0))c=[E.indexOf(0)];else if(L!==f){for(p=l.decodePixels(),m=new Uint8Array(p.length),y=0,f=p.length;y<f;y++)m[y]=E[p[y]];d=e(m,l.width,1)}}var T=function(e){var i;switch(e){case t.image_compression.FAST:i=11;break;case t.image_compression.MEDIUM:i=13;break;case t.image_compression.SLOW:i=14;break;default:i=12}return i}(s);return x===this.decode.FLATE_DECODE&&(w="/Predictor "+T+" "),w+="/Colors "+h+" /BitsPerComponent "+o+" /Columns "+l.width,(this.__addimage__.isArrayBuffer(i)||this.__addimage__.isArrayBufferView(i))&&(i=this.__addimage__.arrayBufferToBinaryString(i)),(d&&this.__addimage__.isArrayBuffer(d)||this.__addimage__.isArrayBufferView(d))&&(d=this.__addimage__.arrayBufferToBinaryString(d)),{alias:r,data:i,index:n,filter:x,decodeParameters:w,transparency:c,palette:u,sMask:d,predictor:T,width:l.width,height:l.height,bitsPerComponent:o,colorSpace:a}}}}(Ct.API),function(t){t.processGIF89A=function(e,i,n,r){var s=new Ve(e),a=s.width,o=s.height,l=[];s.decodeAndBlitFrameRGBA(0,l);var c={data:l,width:a,height:o},h=new Ge(100).encode(c,100);return t.processJPEG.call(this,h,i,n,r)},t.processGIF87A=t.processGIF89A}(Ct.API),We.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,16===this.bitPP&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var t=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var e=0;e<t;e++){var i=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:r,green:n,blue:i,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},We.prototype.parseBGR=function(){this.pos=this.offset;try{var t="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[t]()}catch(t){tt.log("bit decode error:"+t)}},We.prototype.bit1=function(){var t,e=Math.ceil(this.width/8),i=e%4;for(t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,r=0;r<e;r++)for(var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+8*r*4,o=0;o<8&&8*r+o<this.width;o++){var l=this.palette[s>>7-o&1];this.data[a+4*o]=l.blue,this.data[a+4*o+1]=l.green,this.data[a+4*o+2]=l.red,this.data[a+4*o+3]=255}0!==i&&(this.pos+=4-i)}},We.prototype.bit4=function(){for(var t=Math.ceil(this.width/2),e=t%4,i=this.height-1;i>=0;i--){for(var n=this.bottom_up?i:this.height-1-i,r=0;r<t;r++){var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+2*r*4,o=s>>4,l=15&s,c=this.palette[o];if(this.data[a]=c.blue,this.data[a+1]=c.green,this.data[a+2]=c.red,this.data[a+3]=255,2*r+1>=this.width)break;c=this.palette[l],this.data[a+4]=c.blue,this.data[a+4+1]=c.green,this.data[a+4+2]=c.red,this.data[a+4+3]=255}0!==e&&(this.pos+=4-e)}},We.prototype.bit8=function(){for(var t=this.width%4,e=this.height-1;e>=0;e--){for(var i=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),s=i*this.width*4+4*n;if(r<this.palette.length){var a=this.palette[r];this.data[s]=a.red,this.data[s+1]=a.green,this.data[s+2]=a.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}0!==t&&(this.pos+=4-t)}},We.prototype.bit15=function(){for(var t=this.width%3,e=parseInt("11111",2),i=this.height-1;i>=0;i--){for(var n=this.bottom_up?i:this.height-1-i,r=0;r<this.width;r++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(s&e)/e*255|0,o=(s>>5&e)/e*255|0,l=(s>>10&e)/e*255|0,c=s>>15?255:0,h=n*this.width*4+4*r;this.data[h]=l,this.data[h+1]=o,this.data[h+2]=a,this.data[h+3]=c}this.pos+=t}},We.prototype.bit16=function(){for(var t=this.width%3,e=parseInt("11111",2),i=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&e)/e*255|0,l=(a>>5&i)/i*255|0,c=(a>>11)/e*255|0,h=r*this.width*4+4*s;this.data[h]=c,this.data[h+1]=l,this.data[h+2]=o,this.data[h+3]=255}this.pos+=t}},We.prototype.bit24=function(){for(var t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,i=0;i<this.width;i++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=e*this.width*4+4*i;this.data[a]=s,this.data[a+1]=r,this.data[a+2]=n,this.data[a+3]=255}this.pos+=this.width%4}},We.prototype.bit32=function(){for(var t=this.height-1;t>=0;t--)for(var e=this.bottom_up?t:this.height-1-t,i=0;i<this.width;i++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*i;this.data[o]=s,this.data[o+1]=r,this.data[o+2]=n,this.data[o+3]=a}},We.prototype.getData=function(){return this.data},
/**
 * @license
 * Copyright (c) 2018 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t){t.processBMP=function(e,i,n,r){var s=new We(e,!1),a=s.width,o=s.height,l={data:s.getData(),width:a,height:o},c=new Ge(100).encode(l,100);return t.processJPEG.call(this,c,i,n,r)}}(Ct.API),qe.prototype.getData=function(){return this.data},
/**
 * @license
 * Copyright (c) 2019 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t){t.processWEBP=function(e,i,n,r){var s=new qe(e,!1),a=s.width,o=s.height,l={data:s.getData(),width:a,height:o},c=new Ge(100).encode(l,100);return t.processJPEG.call(this,c,i,n,r)}}(Ct.API),Ct.API.setLanguage=function(t){return void 0===this.internal.languageSettings&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),void 0!=={af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"FYRO Macedonian",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[t]&&(this.internal.languageSettings.languageCode=t,!1===this.internal.languageSettings.isSubscribed&&(this.internal.events.subscribe("putCatalog",(function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")})),this.internal.languageSettings.isSubscribed=!0)),this
/** @license
 * MIT license.
 * Copyright (c) 2012 Willow Systems Corporation, willow-systems.com
 *               2014 Diego Casorran, https://github.com/diegocr
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */},ke=Ct.API,Fe=ke.getCharWidthsArray=function(t,e){var i,n,r=(e=e||{}).font||this.internal.getFont(),s=e.fontSize||this.internal.getFontSize(),a=e.charSpace||this.internal.getCharSpace(),o=e.widths?e.widths:r.metadata.Unicode.widths,l=o.fof?o.fof:1,c=e.kerning?e.kerning:r.metadata.Unicode.kerning,h=c.fof?c.fof:1,u=!1!==e.doKerning,d=0,p=t.length,f=0,m=o[0]||l,g=[];for(i=0;i<p;i++)n=t.charCodeAt(i),"function"==typeof r.metadata.widthOfString?g.push((r.metadata.widthOfGlyph(r.metadata.characterToGlyph(n))+a*(1e3/s)||0)/1e3):(d=u&&"object"==typeof c[n]&&!isNaN(parseInt(c[n][f],10))?c[n][f]/h:0,g.push((o[n]||m)/l+d)),f=n;return g},Be=ke.getStringUnitWidth=function(t,e){var i=(e=e||{}).fontSize||this.internal.getFontSize(),n=e.font||this.internal.getFont(),r=e.charSpace||this.internal.getCharSpace();return ke.processArabic&&(t=ke.processArabic(t)),"function"==typeof n.metadata.widthOfString?n.metadata.widthOfString(t,i,r)/i:Fe.apply(this,arguments).reduce((function(t,e){return t+e}),0)},ze=function(t,e,i,n){for(var r=[],s=0,a=t.length,o=0;s!==a&&o+e[s]<i;)o+=e[s],s++;r.push(t.slice(0,s));var l=s;for(o=0;s!==a;)o+e[s]>n&&(r.push(t.slice(l,s)),o=0,l=s),o+=e[s],s++;return l!==s&&r.push(t.slice(l,s)),r},je=function(t,e,i){i||(i={});var n,r,s,a,o,l,c,h=[],u=[h],d=i.textIndent||0,p=0,f=0,m=t.split(" "),g=Fe.apply(this,[" ",i])[0];if(l=-1===i.lineIndent?m[0].length+2:i.lineIndent||0){var _=Array(l).join(" "),v=[];m.map((function(t){(t=t.split(/\s*\n/)).length>1?v=v.concat(t.map((function(t,e){return(e&&t.length?"\n":"")+t}))):v.push(t[0])})),m=v,l=Be.apply(this,[_,i])}for(s=0,a=m.length;s<a;s++){var y=0;if(n=m[s],l&&"\n"==n[0]&&(n=n.substr(1),y=1),d+p+(f=(r=Fe.apply(this,[n,i])).reduce((function(t,e){return t+e}),0))>e||y){if(f>e){for(o=ze.apply(this,[n,r,e-(d+p),e]),h.push(o.shift()),h=[o.pop()];o.length;)u.push([o.shift()]);f=r.slice(n.length-(h[0]?h[0].length:0)).reduce((function(t,e){return t+e}),0)}else h=[n];u.push(h),d=f+l,p=g}else h.push(n),d+=p+f,p=g}return c=l?function(t,e){return(e?_:"")+t.join(" ")}:function(t){return t.join(" ")},u.map(c)},ke.splitTextToSize=function(t,e,i){var n,r=(i=i||{}).fontSize||this.internal.getFontSize(),s=function(t){if(t.widths&&t.kerning)return{widths:t.widths,kerning:t.kerning};var e=this.internal.getFont(t.fontName,t.fontStyle);return e.metadata.Unicode?{widths:e.metadata.Unicode.widths||{0:1},kerning:e.metadata.Unicode.kerning||{}}:{font:e.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,i);n=Array.isArray(t)?t:String(t).split(/\r?\n/);var a=1*this.internal.scaleFactor*e/r;s.textIndent=i.textIndent?1*i.textIndent*this.internal.scaleFactor/r:0,s.lineIndent=i.lineIndent;var o,l,c=[];for(o=0,l=n.length;o<l;o++)c=c.concat(je.apply(this,[n[o],a,s]));return c},
/** @license
 jsPDF standard_fonts_metrics plugin
 * Copyright (c) 2012 Willow Systems Corporation, willow-systems.com
 * MIT license.
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 * 
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */
function(t){t.__fontmetrics__=t.__fontmetrics__||{};for(var e="klmnopqrstuvwxyz",i={},n={},r=0;r<e.length;r++)i[e[r]]="0123456789abcdef"[r],n["0123456789abcdef"[r]]=e[r];var s=function(t){return"0x"+parseInt(t,10).toString(16)},a=t.__fontmetrics__.compress=function(t){var e,i,r,o,l=["{"];for(var c in t){if(e=t[c],isNaN(parseInt(c,10))?i="'"+c+"'":(c=parseInt(c,10),i=(i=s(c).slice(2)).slice(0,-1)+n[i.slice(-1)]),"number"==typeof e)e<0?(r=s(e).slice(3),o="-"):(r=s(e).slice(2),o=""),r=o+r.slice(0,-1)+n[r.slice(-1)];else{if("object"!=typeof e)throw new Error("Don't know what to do with value type "+typeof e+".");r=a(e)}l.push(i+r)}return l.push("}"),l.join("")},o=t.__fontmetrics__.uncompress=function(t){if("string"!=typeof t)throw new Error("Invalid argument passed to uncompress.");for(var e,n,r,s,a={},o=1,l=a,c=[],h="",u="",d=t.length-1,p=1;p<d;p+=1)"'"==(s=t[p])?e?(r=e.join(""),e=void 0):e=[]:e?e.push(s):"{"==s?(c.push([l,r]),l={},r=void 0):"}"==s?((n=c.pop())[0][n[1]]=l,r=void 0,l=n[0]):"-"==s?o=-1:void 0===r?i.hasOwnProperty(s)?(h+=i[s],r=parseInt(h,16)*o,o=1,h=""):h+=s:i.hasOwnProperty(s)?(u+=i[s],l[r]=parseInt(u,16)*o,o=1,r=void 0,u=""):u+=s;return a},l={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},c={Unicode:{Courier:l,"Courier-Bold":l,"Courier-BoldOblique":l,"Courier-Oblique":l,Helvetica:l,"Helvetica-Bold":l,"Helvetica-BoldOblique":l,"Helvetica-Oblique":l,"Times-Roman":l,"Times-Bold":l,"Times-BoldItalic":l,"Times-Italic":l}},h={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};t.events.push(["addFont",function(t){var e=t.font,i=h.Unicode[e.postScriptName];i&&(e.metadata.Unicode={},e.metadata.Unicode.widths=i.widths,e.metadata.Unicode.kerning=i.kerning);var n=c.Unicode[e.postScriptName];n&&(e.metadata.Unicode.encoding=n,e.encoding=n.codePages[0])}])}(Ct.API),
/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t){var e=function(t){for(var e=t.length,i=new Uint8Array(e),n=0;n<e;n++)i[n]=t.charCodeAt(n);return i};t.API.events.push(["addFont",function(i){var n=void 0,r=i.font,s=i.instance;if(!r.isStandardFont){if(void 0===s)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");if("string"!=typeof(n=!1===s.existsFileInVFS(r.postScriptName)?s.loadFile(r.postScriptName):s.getFileFromVFS(r.postScriptName)))throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");!function(i,n){n=/^\x00\x01\x00\x00/.test(n)?e(n):e(rt(n)),i.metadata=t.API.TTFFont.open(n),i.metadata.Unicode=i.metadata.Unicode||{encoding:{},kerning:{},widths:[]},i.metadata.glyIdsUsed=[0]}(r,n)}}])}(Ct),
/** @license
 * Copyright (c) 2012 Willow Systems Corporation, willow-systems.com
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */
function(t){function e(){return($.canvg?Promise.resolve($.canvg):i.e(513).then(i.bind(i,5513))).catch((function(t){return Promise.reject(new Error("Could not load canvg: "+t))})).then((function(t){return t.default?t.default:t}))}Ct.API.addSvgAsImage=function(t,i,n,r,s,a,o,l){if(isNaN(i)||isNaN(n))throw tt.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(r)||isNaN(s))throw tt.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=r,c.height=s;var h=c.getContext("2d");h.fillStyle="#fff",h.fillRect(0,0,c.width,c.height);var u={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},d=this;return e().then((function(e){return e.fromString(h,t,u)}),(function(){return Promise.reject(new Error("Could not load canvg."))})).then((function(t){return t.render(u)})).then((function(){d.addImage(c.toDataURL("image/jpeg",1),i,n,r,s,o,l)}))}}(),Ct.API.putTotalPages=function(t){var e,i=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(t,"g"),i=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(t,this.internal.getFont()),"g"),i=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var r=0;r<this.internal.pages[n].length;r++)this.internal.pages[n][r]=this.internal.pages[n][r].replace(e,i);return this},Ct.API.viewerPreferences=function(t,e){var i;t=t||{},e=e||!1;var n,r,s,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(a),l=[],c=0,h=0,u=0;function d(t,e){var i,n=!1;for(i=0;i<t.length;i+=1)t[i]===e&&(n=!0);return n}if(void 0===this.internal.viewerpreferences&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),i=this.internal.viewerpreferences.configuration,"reset"===t||!0===e){var p=o.length;for(u=0;u<p;u+=1)i[o[u]].value=i[o[u]].defaultValue,i[o[u]].explicitSet=!1}if("object"==typeof t)for(r in t)if(s=t[r],d(o,r)&&void 0!==s){if("boolean"===i[r].type&&"boolean"==typeof s)i[r].value=s;else if("name"===i[r].type&&d(i[r].valueSet,s))i[r].value=s;else if("integer"===i[r].type&&Number.isInteger(s))i[r].value=s;else if("array"===i[r].type){for(c=0;c<s.length;c+=1)if(n=!0,1===s[c].length&&"number"==typeof s[c][0])l.push(String(s[c]-1));else if(s[c].length>1){for(h=0;h<s[c].length;h+=1)"number"!=typeof s[c][h]&&(n=!1);!0===n&&l.push([s[c][0]-1,s[c][1]-1].join(" "))}i[r].value="["+l.join(" ")+"]"}else i[r].value=i[r].defaultValue;i[r].explicitSet=!0}return!1===this.internal.viewerpreferences.isSubscribed&&(this.internal.events.subscribe("putCatalog",(function(){var t,e=[];for(t in i)!0===i[t].explicitSet&&("name"===i[t].type?e.push("/"+t+" /"+i[t].value):e.push("/"+t+" "+i[t].value));0!==e.length&&this.internal.write("/ViewerPreferences\n<<\n"+e.join("\n")+"\n>>")})),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=i,this
/** ====================================================================
 * @license
 * jsPDF XMP metadata plugin
 * Copyright (c) 2016 Jussi Utunen, u-jussi@suomi24.fi
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */},function(t){var e=function(){var t='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',e=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),i=unescape(encodeURIComponent(t)),n=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),r=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),s=unescape(encodeURIComponent("</x:xmpmeta>")),a=i.length+n.length+r.length+e.length+s.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+a+" >>"),this.internal.write("stream"),this.internal.write(e+i+n+r+s),this.internal.write("endstream"),this.internal.write("endobj")},i=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};t.addMetadata=function(t,n){return void 0===this.internal.__metadata__&&(this.internal.__metadata__={metadata:t,namespaceuri:n||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",i),this.internal.events.subscribe("postPutResources",e)),this}}(Ct.API),function(t){var e=t.API,i=e.pdfEscape16=function(t,e){for(var i,n=e.metadata.Unicode.widths,r=["","0","00","000","0000"],s=[""],a=0,o=t.length;a<o;++a){if(i=e.metadata.characterToGlyph(t.charCodeAt(a)),e.metadata.glyIdsUsed.push(i),e.metadata.toUnicode[i]=t.charCodeAt(a),-1==n.indexOf(i)&&(n.push(i),n.push([parseInt(e.metadata.widthOfGlyph(i),10)])),"0"==i)return s.join("");i=i.toString(16),s.push(r[4-i.length],i)}return s.join("")},n=function(t){var e,i,n,r,s,a,o;for(s="/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange",n=[],a=0,o=(i=Object.keys(t).sort((function(t,e){return t-e}))).length;a<o;a++)e=i[a],n.length>=100&&(s+="\n"+n.length+" beginbfchar\n"+n.join("\n")+"\nendbfchar",n=[]),void 0!==t[e]&&null!==t[e]&&"function"==typeof t[e].toString&&(r=("0000"+t[e].toString(16)).slice(-4),e=("0000"+(+e).toString(16)).slice(-4),n.push("<"+e+"><"+r+">"));return n.length&&(s+="\n"+n.length+" beginbfchar\n"+n.join("\n")+"\nendbfchar\n"),s+"endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend"};e.events.push(["putFont",function(e){!function(e){var i=e.font,r=e.out,s=e.newObject,a=e.putStream,o=e.pdfEscapeWithNeededParanthesis;if(i.metadata instanceof t.API.TTFFont&&"Identity-H"===i.encoding){for(var l=i.metadata.Unicode.widths,c=i.metadata.subset.encode(i.metadata.glyIdsUsed,1),h="",u=0;u<c.length;u++)h+=String.fromCharCode(c[u]);var d=s();a({data:h,addLength1:!0,objectId:d}),r("endobj");var p=s();a({data:n(i.metadata.toUnicode),addLength1:!0,objectId:p}),r("endobj");var f=s();r("<<"),r("/Type /FontDescriptor"),r("/FontName /"+o(i.fontName)),r("/FontFile2 "+d+" 0 R"),r("/FontBBox "+t.API.PDFObject.convert(i.metadata.bbox)),r("/Flags "+i.metadata.flags),r("/StemV "+i.metadata.stemV),r("/ItalicAngle "+i.metadata.italicAngle),r("/Ascent "+i.metadata.ascender),r("/Descent "+i.metadata.decender),r("/CapHeight "+i.metadata.capHeight),r(">>"),r("endobj");var m=s();r("<<"),r("/Type /Font"),r("/BaseFont /"+o(i.fontName)),r("/FontDescriptor "+f+" 0 R"),r("/W "+t.API.PDFObject.convert(l)),r("/CIDToGIDMap /Identity"),r("/DW 1000"),r("/Subtype /CIDFontType2"),r("/CIDSystemInfo"),r("<<"),r("/Supplement 0"),r("/Registry (Adobe)"),r("/Ordering ("+i.encoding+")"),r(">>"),r(">>"),r("endobj"),i.objectNumber=s(),r("<<"),r("/Type /Font"),r("/Subtype /Type0"),r("/ToUnicode "+p+" 0 R"),r("/BaseFont /"+o(i.fontName)),r("/Encoding /"+i.encoding),r("/DescendantFonts ["+m+" 0 R]"),r(">>"),r("endobj"),i.isAlreadyPutted=!0}}(e)}]),e.events.push(["putFont",function(e){!function(e){var i=e.font,r=e.out,s=e.newObject,a=e.putStream,o=e.pdfEscapeWithNeededParanthesis;if(i.metadata instanceof t.API.TTFFont&&"WinAnsiEncoding"===i.encoding){for(var l=i.metadata.rawData,c="",h=0;h<l.length;h++)c+=String.fromCharCode(l[h]);var u=s();a({data:c,addLength1:!0,objectId:u}),r("endobj");var d=s();a({data:n(i.metadata.toUnicode),addLength1:!0,objectId:d}),r("endobj");var p=s();r("<<"),r("/Descent "+i.metadata.decender),r("/CapHeight "+i.metadata.capHeight),r("/StemV "+i.metadata.stemV),r("/Type /FontDescriptor"),r("/FontFile2 "+u+" 0 R"),r("/Flags 96"),r("/FontBBox "+t.API.PDFObject.convert(i.metadata.bbox)),r("/FontName /"+o(i.fontName)),r("/ItalicAngle "+i.metadata.italicAngle),r("/Ascent "+i.metadata.ascender),r(">>"),r("endobj"),i.objectNumber=s();for(var f=0;f<i.metadata.hmtx.widths.length;f++)i.metadata.hmtx.widths[f]=parseInt(i.metadata.hmtx.widths[f]*(1e3/i.metadata.head.unitsPerEm));r("<</Subtype/TrueType/Type/Font/ToUnicode "+d+" 0 R/BaseFont/"+o(i.fontName)+"/FontDescriptor "+p+" 0 R/Encoding/"+i.encoding+" /FirstChar 29 /LastChar 255 /Widths "+t.API.PDFObject.convert(i.metadata.hmtx.widths)+">>"),r("endobj"),i.isAlreadyPutted=!0}}(e)}]);var r=function(t){var e,n=t.text||"",r=t.x,s=t.y,a=t.options||{},o=t.mutex||{},l=o.pdfEscape,c=o.activeFontKey,h=o.fonts,u=c,d="",p=0,f="",m=h[u].encoding;if("Identity-H"!==h[u].encoding)return{text:n,x:r,y:s,options:a,mutex:o};for(f=n,u=c,Array.isArray(n)&&(f=n[0]),p=0;p<f.length;p+=1)h[u].metadata.hasOwnProperty("cmap")&&(e=h[u].metadata.cmap.unicode.codeMap[f[p].charCodeAt(0)]),e||f[p].charCodeAt(0)<256&&h[u].metadata.hasOwnProperty("Unicode")?d+=f[p]:d+="";var g="";return parseInt(u.slice(1))<14||"WinAnsiEncoding"===m?g=l(d,u).split("").map((function(t){return t.charCodeAt(0).toString(16)})).join(""):"Identity-H"===m&&(g=i(d,h[u])),o.isHex=!0,{text:g,x:r,y:s,options:a,mutex:o}};e.events.push(["postProcessText",function(t){var e=t.text||"",i=[],n={text:e,x:t.x,y:t.y,options:t.options,mutex:t.mutex};if(Array.isArray(e)){var s=0;for(s=0;s<e.length;s+=1)Array.isArray(e[s])&&3===e[s].length?i.push([r(Object.assign({},n,{text:e[s][0]})).text,e[s][1],e[s][2]]):i.push(r(Object.assign({},n,{text:e[s]})).text);t.text=i}else t.text=r(Object.assign({},n,{text:e})).text}])}(Ct),
/**
 * @license
 * jsPDF virtual FileSystem functionality
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t){var e=function(){return void 0===this.internal.vFS&&(this.internal.vFS={}),!0};t.existsFileInVFS=function(t){return e.call(this),void 0!==this.internal.vFS[t]},t.addFileToVFS=function(t,i){return e.call(this),this.internal.vFS[t]=i,this},t.getFileFromVFS=function(t){return e.call(this),void 0!==this.internal.vFS[t]?this.internal.vFS[t]:null}}(Ct.API),
/**
 * @license
 * Unicode Bidi Engine based on the work of Alex Shensis (@asthensis)
 * MIT License
 */
function(t){t.__bidiEngine__=t.prototype.__bidiEngine__=function(t){var i,n,r,s,a,o,l,c=e,h=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],u=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],d={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},p={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},f=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],m=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),g=!1,_=0;this.__bidiEngine__={};var v=function(t){var e=t.charCodeAt(),i=e>>8,n=p[i];return void 0!==n?c[256*n+(255&e)]:252===i||253===i?"AL":m.test(i)?"L":8===i?"R":"N"},y=function(t){for(var e,i=0;i<t.length;i++){if("L"===(e=v(t.charAt(i))))return!1;if("R"===e)return!0}return!1},b=function(t,e,a,o){var l,c,h,u,d=e[o];switch(d){case"L":case"R":g=!1;break;case"N":case"AN":break;case"EN":g&&(d="AN");break;case"AL":g=!0,d="R";break;case"WS":d="N";break;case"CS":o<1||o+1>=e.length||"EN"!==(l=a[o-1])&&"AN"!==l||"EN"!==(c=e[o+1])&&"AN"!==c?d="N":g&&(c="AN"),d=c===l?c:"N";break;case"ES":d="EN"===(l=o>0?a[o-1]:"B")&&o+1<e.length&&"EN"===e[o+1]?"EN":"N";break;case"ET":if(o>0&&"EN"===a[o-1]){d="EN";break}if(g){d="N";break}for(h=o+1,u=e.length;h<u&&"ET"===e[h];)h++;d=h<u&&"EN"===e[h]?"EN":"N";break;case"NSM":if(r&&!s){for(u=e.length,h=o+1;h<u&&"NSM"===e[h];)h++;if(h<u){var p=t[o],f=p>=1425&&p<=2303||64286===p;if(l=e[h],f&&("R"===l||"AL"===l)){d="R";break}}}d=o<1||"B"===(l=e[o-1])?"N":a[o-1];break;case"B":g=!1,i=!0,d=_;break;case"S":n=!0,d="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":g=!1;break;case"BN":d="N"}return d},x=function(t,e,i){var n=t.split("");return i&&w(n,i,{hiLevel:_}),n.reverse(),e&&e.reverse(),n.join("")},w=function(t,e,r){var s,a,o,l,c,p=-1,f=t.length,m=0,y=[],x=_?u:h,w=[];for(g=!1,i=!1,n=!1,a=0;a<f;a++)w[a]=v(t[a]);for(o=0;o<f;o++){if(c=m,y[o]=b(t,w,y,o),s=240&(m=x[c][d[y[o]]]),m&=15,e[o]=l=x[m][5],s>0)if(16===s){for(a=p;a<o;a++)e[a]=1;p=-1}else p=-1;if(x[m][6])-1===p&&(p=o);else if(p>-1){for(a=p;a<o;a++)e[a]=l;p=-1}"B"===w[o]&&(e[o]=0),r.hiLevel|=l}n&&function(t,e,i){for(var n=0;n<i;n++)if("S"===t[n]){e[n]=_;for(var r=n-1;r>=0&&"WS"===t[r];r--)e[r]=_}}(w,e,f)},S=function(t,e,n,r,s){if(!(s.hiLevel<t)){if(1===t&&1===_&&!i)return e.reverse(),void(n&&n.reverse());for(var a,o,l,c,h=e.length,u=0;u<h;){if(r[u]>=t){for(l=u+1;l<h&&r[l]>=t;)l++;for(c=u,o=l-1;c<o;c++,o--)a=e[c],e[c]=e[o],e[o]=a,n&&(a=n[c],n[c]=n[o],n[o]=a);u=l}u++}}},M=function(t,e,i){var n=t.split(""),r={hiLevel:_};return i||(i=[]),w(n,i,r),function(t,e,i){if(0!==i.hiLevel&&l)for(var n,r=0;r<t.length;r++)1===e[r]&&(n=f.indexOf(t[r]))>=0&&(t[r]=f[n+1])}(n,i,r),S(2,n,e,i,r),S(1,n,e,i,r),n.join("")};return this.__bidiEngine__.doBidiReorder=function(t,e,i){if(function(t,e){if(e)for(var i=0;i<t.length;i++)e[i]=i;void 0===s&&(s=y(t)),void 0===o&&(o=y(t))}(t,e),r||!a||o)if(r&&a&&s^o)_=s?1:0,t=x(t,e,i);else if(!r&&a&&o)_=s?1:0,t=M(t,e,i),t=x(t,e);else if(!r||s||a||o){if(r&&!a&&s^o)t=x(t,e),s?(_=0,t=M(t,e,i)):(_=1,t=M(t,e,i),t=x(t,e));else if(r&&s&&!a&&o)_=1,t=M(t,e,i),t=x(t,e);else if(!r&&!a&&s^o){var n=l;s?(_=1,t=M(t,e,i),_=0,l=!1,t=M(t,e,i),l=n):(_=0,t=M(t,e,i),t=x(t,e),_=1,l=!1,t=M(t,e,i),l=n,t=x(t,e))}}else _=0,t=M(t,e,i);else _=s?1:0,t=M(t,e,i);return t},this.__bidiEngine__.setOptions=function(t){t&&(r=t.isInputVisual,a=t.isOutputVisual,s=t.isInputRtl,o=t.isOutputRtl,l=t.isSymmetricSwapping)},this.__bidiEngine__.setOptions(t),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],i=new t.__bidiEngine__({isInputVisual:!0});t.API.events.push(["postProcessText",function(t){var e=t.text,n=(t.x,t.y,t.options||{}),r=(t.mutex,n.lang,[]);if(n.isInputVisual="boolean"!=typeof n.isInputVisual||n.isInputVisual,i.setOptions(n),"[object Array]"===Object.prototype.toString.call(e)){var s=0;for(r=[],s=0;s<e.length;s+=1)"[object Array]"===Object.prototype.toString.call(e[s])?r.push([i.doBidiReorder(e[s][0]),e[s][1],e[s][2]]):r.push([i.doBidiReorder(e[s])]);t.text=r}else t.text=i.doBidiReorder(e);i.setOptions({isInputVisual:!0})}])}(Ct),Ct.API.TTFFont=function(){function t(t){var e;if(this.rawData=t,e=this.contents=new Je(t),this.contents.pos=4,"ttcf"===e.readString(4))throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new pi(this),this.registerTTF()}return t.open=function(e){return new t(e)},t.prototype.parse=function(){return this.directory=new Xe(this.contents),this.head=new $e(this),this.name=new si(this),this.cmap=new ti(this),this.toUnicode={},this.hhea=new ei(this),this.maxp=new ai(this),this.hmtx=new oi(this),this.post=new ni(this),this.os2=new ii(this),this.loca=new di(this),this.glyf=new ci(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},t.prototype.registerTTF=function(){var t,e,i,n,r;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var e,i,n,r;for(r=[],e=0,i=(n=this.bbox).length;e<i;e++)t=n[e],r.push(Math.round(t*this.scaleFactor));return r}.call(this),this.stemV=0,this.post.exists?(i=255&(n=this.post.italic_angle),0!=(32768&(e=n>>16))&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+i)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=1===(r=this.familyClass)||2===r||3===r||4===r||5===r||7===r,this.isScript=10===this.familyClass,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),0!==this.italicAngle&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},t.prototype.characterToGlyph=function(t){var e;return(null!=(e=this.cmap.unicode)?e.codeMap[t]:void 0)||0},t.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},t.prototype.widthOfString=function(t,e,i){var n,r,s,a;for(s=0,r=0,a=(t=""+t).length;0<=a?r<a:r>a;r=0<=a?++r:--r)n=t.charCodeAt(r),s+=this.widthOfGlyph(this.characterToGlyph(n))+i*(1e3/e)||0;return s*(e/1e3)},t.prototype.lineHeight=function(t,e){var i;return null==e&&(e=!1),i=e?this.lineGap:0,(this.ascender+i-this.decender)/1e3*t},t}();var Ye,Je=function(){function t(t){this.data=null!=t?t:[],this.pos=0,this.length=this.data.length}return t.prototype.readByte=function(){return this.data[this.pos++]},t.prototype.writeByte=function(t){return this.data[this.pos++]=t},t.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},t.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},t.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},t.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},t.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},t.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},t.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},t.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},t.prototype.readString=function(t){var e,i;for(i=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)i[e]=String.fromCharCode(this.readByte());return i.join("")},t.prototype.writeString=function(t){var e,i,n;for(n=[],e=0,i=t.length;0<=i?e<i:e>i;e=0<=i?++e:--e)n.push(this.writeByte(t.charCodeAt(e)));return n},t.prototype.readShort=function(){return this.readInt16()},t.prototype.writeShort=function(t){return this.writeInt16(t)},t.prototype.readLongLong=function(){var t,e,i,n,r,s,a,o;return t=this.readByte(),e=this.readByte(),i=this.readByte(),n=this.readByte(),r=this.readByte(),s=this.readByte(),a=this.readByte(),o=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^i)+4294967296*(255^n)+16777216*(255^r)+65536*(255^s)+256*(255^a)+(255^o)+1):72057594037927940*t+281474976710656*e+1099511627776*i+4294967296*n+16777216*r+65536*s+256*a+o},t.prototype.writeLongLong=function(t){var e,i;return e=Math.floor(t/4294967296),i=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(i>>24&255),this.writeByte(i>>16&255),this.writeByte(i>>8&255),this.writeByte(255&i)},t.prototype.readInt=function(){return this.readInt32()},t.prototype.writeInt=function(t){return this.writeInt32(t)},t.prototype.read=function(t){var e,i;for(e=[],i=0;0<=t?i<t:i>t;i=0<=t?++i:--i)e.push(this.readByte());return e},t.prototype.write=function(t){var e,i,n,r;for(r=[],i=0,n=t.length;i<n;i++)e=t[i],r.push(this.writeByte(e));return r},t}(),Xe=function(){var t;function e(t){var e,i,n;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},i=0,n=this.tableCount;0<=n?i<n:i>n;i=0<=n?++i:--i)e={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[e.tag]=e}return e.prototype.encode=function(e){var i,n,r,s,a,o,l,c,h,u,d,p,f;for(f in d=Object.keys(e).length,o=Math.log(2),h=16*Math.floor(Math.log(d)/o),s=Math.floor(h/o),c=16*d-h,(n=new Je).writeInt(this.scalarType),n.writeShort(d),n.writeShort(h),n.writeShort(s),n.writeShort(c),r=16*d,l=n.pos+r,a=null,p=[],e)for(u=e[f],n.writeString(f),n.writeInt(t(u)),n.writeInt(l),n.writeInt(u.length),p=p.concat(u),"head"===f&&(a=l),l+=u.length;l%4;)p.push(0),l++;return n.write(p),i=2981146554-t(n.data),n.pos=a+8,n.writeUInt32(i),n.data},t=function(t){var e,i,n,r;for(t=li.call(t);t.length%4;)t.push(0);for(n=new Je(t),i=0,e=0,r=t.length;e<r;e=e+=4)i+=n.readUInt32();return 4294967295&i},e}(),Ke={}.hasOwnProperty,Ze=function(t,e){for(var i in e)Ke.call(e,i)&&(t[i]=e[i]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};Ye=function(){function t(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return t.prototype.parse=function(){},t.prototype.encode=function(){},t.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},t}();var $e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Ze(e,Ye),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var e;return(e=new Je).writeInt(this.version),e.writeInt(this.revision),e.writeInt(this.checkSumAdjustment),e.writeInt(this.magicNumber),e.writeShort(this.flags),e.writeShort(this.unitsPerEm),e.writeLongLong(this.created),e.writeLongLong(this.modified),e.writeShort(this.xMin),e.writeShort(this.yMin),e.writeShort(this.xMax),e.writeShort(this.yMax),e.writeShort(this.macStyle),e.writeShort(this.lowestRecPPEM),e.writeShort(this.fontDirectionHint),e.writeShort(t),e.writeShort(this.glyphDataFormat),e.data},e}(),Qe=function(){function t(t,e){var i,n,r,s,a,o,l,c,h,u,d,p,f,m,g,_,v;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),h=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=3===this.platformID&&1===this.encodingID&&4===this.format||0===this.platformID&&4===this.format,this.codeMap={},this.format){case 0:for(o=0;o<256;++o)this.codeMap[o]=t.readByte();break;case 4:for(d=t.readUInt16(),u=d/2,t.pos+=6,r=function(){var e,i;for(i=[],o=e=0;0<=u?e<u:e>u;o=0<=u?++e:--e)i.push(t.readUInt16());return i}(),t.pos+=2,f=function(){var e,i;for(i=[],o=e=0;0<=u?e<u:e>u;o=0<=u?++e:--e)i.push(t.readUInt16());return i}(),l=function(){var e,i;for(i=[],o=e=0;0<=u?e<u:e>u;o=0<=u?++e:--e)i.push(t.readUInt16());return i}(),c=function(){var e,i;for(i=[],o=e=0;0<=u?e<u:e>u;o=0<=u?++e:--e)i.push(t.readUInt16());return i}(),n=(this.length-t.pos+this.offset)/2,a=function(){var e,i;for(i=[],o=e=0;0<=n?e<n:e>n;o=0<=n?++e:--e)i.push(t.readUInt16());return i}(),o=g=0,v=r.length;g<v;o=++g)for(m=r[o],i=_=p=f[o];p<=m?_<=m:_>=m;i=p<=m?++_:--_)0===c[o]?s=i+l[o]:0!==(s=a[c[o]/2+(i-p)-(u-o)]||0)&&(s+=l[o]),this.codeMap[i]=65535&s}t.pos=h}return t.encode=function(t,e){var i,n,r,s,a,o,l,c,h,u,d,p,f,m,g,_,v,y,b,x,w,S,M,A,E,L,T,C,P,N,R,D,I,O,k,F,B,z,j,U,V,H,G,W,q,Y;switch(C=new Je,s=Object.keys(t).sort((function(t,e){return t-e})),e){case"macroman":for(f=0,m=function(){var t=[];for(p=0;p<256;++p)t.push(0);return t}(),_={0:0},r={},P=0,I=s.length;P<I;P++)null==_[G=t[n=s[P]]]&&(_[G]=++f),r[n]={old:t[n],new:_[t[n]]},m[n]=_[t[n]];return C.writeUInt16(1),C.writeUInt16(0),C.writeUInt32(12),C.writeUInt16(0),C.writeUInt16(262),C.writeUInt16(0),C.write(m),{charMap:r,subtable:C.data,maxGlyphID:f+1};case"unicode":for(L=[],h=[],v=0,_={},i={},g=l=null,N=0,O=s.length;N<O;N++)null==_[b=t[n=s[N]]]&&(_[b]=++v),i[n]={old:b,new:_[b]},a=_[b]-n,null!=g&&a===l||(g&&h.push(g),L.push(n),l=a),g=n;for(g&&h.push(g),h.push(65535),L.push(65535),A=2*(M=L.length),S=2*Math.pow(Math.log(M)/Math.LN2,2),u=Math.log(S/2)/Math.LN2,w=2*M-S,o=[],x=[],d=[],p=R=0,k=L.length;R<k;p=++R){if(E=L[p],c=h[p],65535===E){o.push(0),x.push(0);break}if(E-(T=i[E].new)>=32768)for(o.push(0),x.push(2*(d.length+M-p)),n=D=E;E<=c?D<=c:D>=c;n=E<=c?++D:--D)d.push(i[n].new);else o.push(T-E),x.push(0)}for(C.writeUInt16(3),C.writeUInt16(1),C.writeUInt32(12),C.writeUInt16(4),C.writeUInt16(16+8*M+2*d.length),C.writeUInt16(0),C.writeUInt16(A),C.writeUInt16(S),C.writeUInt16(u),C.writeUInt16(w),V=0,F=h.length;V<F;V++)n=h[V],C.writeUInt16(n);for(C.writeUInt16(0),H=0,B=L.length;H<B;H++)n=L[H],C.writeUInt16(n);for(W=0,z=o.length;W<z;W++)a=o[W],C.writeUInt16(a);for(q=0,j=x.length;q<j;q++)y=x[q],C.writeUInt16(y);for(Y=0,U=d.length;Y<U;Y++)f=d[Y],C.writeUInt16(f);return{charMap:i,subtable:C.data,maxGlyphID:v+1}}},t}(),ti=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Ze(e,Ye),e.prototype.tag="cmap",e.prototype.parse=function(t){var e,i,n;for(t.pos=this.offset,this.version=t.readUInt16(),n=t.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=n?i<n:i>n;i=0<=n?++i:--i)e=new Qe(t,this.offset),this.tables.push(e),e.isUnicode&&null==this.unicode&&(this.unicode=e);return!0},e.encode=function(t,e){var i,n;return null==e&&(e="macroman"),i=Qe.encode(t,e),(n=new Je).writeUInt16(0),n.writeUInt16(1),i.table=n.data.concat(i.subtable),i},e}(),ei=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Ze(e,Ye),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(),ii=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Ze(e,Ye),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var e,i;for(i=[],e=0;e<10;++e)i.push(t.readByte());return i}(),this.charRange=function(){var e,i;for(i=[],e=0;e<4;++e)i.push(t.readInt());return i}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var e,i;for(i=[],e=0;e<2;e=++e)i.push(t.readInt());return i}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(),ni=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Ze(e,Ye),e.prototype.tag="post",e.prototype.parse=function(t){var e,i,n;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:break;case 131072:var r;for(i=t.readUInt16(),this.glyphNameIndex=[],r=0;0<=i?r<i:r>i;r=0<=i?++r:--r)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],n=[];t.pos<this.offset+this.length;)e=t.readByte(),n.push(this.names.push(t.readString(e)));return n;case 151552:return i=t.readUInt16(),this.offsets=t.read(i);case 196608:break;case 262144:return this.map=function(){var e,i,n;for(n=[],r=e=0,i=this.file.maxp.numGlyphs;0<=i?e<i:e>i;r=0<=i?++e:--e)n.push(t.readUInt32());return n}.call(this)}},e}(),ri=function(t,e){this.raw=t,this.length=t.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},si=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Ze(e,Ye),e.prototype.tag="name",e.prototype.parse=function(t){var e,i,n,r,s,a,o,l,c,h,u;for(t.pos=this.offset,t.readShort(),e=t.readShort(),a=t.readShort(),i=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)i.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+a+t.readShort()});for(o={},r=c=0,h=i.length;c<h;r=++c)n=i[r],t.pos=n.offset,l=t.readString(n.length),s=new ri(l,n),null==o[u=n.nameID]&&(o[u]=[]),o[n.nameID].push(s);this.strings=o,this.copyright=o[0],this.fontFamily=o[1],this.fontSubfamily=o[2],this.uniqueSubfamily=o[3],this.fontName=o[4],this.version=o[5];try{this.postscriptName=o[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch(t){this.postscriptName=o[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=o[7],this.manufacturer=o[8],this.designer=o[9],this.description=o[10],this.vendorUrl=o[11],this.designerUrl=o[12],this.license=o[13],this.licenseUrl=o[14],this.preferredFamily=o[15],this.preferredSubfamily=o[17],this.compatibleFull=o[18],this.sampleText=o[19]},e}(),ai=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Ze(e,Ye),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(),oi=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Ze(e,Ye),e.prototype.tag="hmtx",e.prototype.parse=function(t){var e,i,n,r,s,a,o;for(t.pos=this.offset,this.metrics=[],e=0,a=this.file.hhea.numberOfMetrics;0<=a?e<a:e>a;e=0<=a?++e:--e)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(n=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var i,r;for(r=[],e=i=0;0<=n?i<n:i>n;e=0<=n?++i:--i)r.push(t.readInt16());return r}(),this.widths=function(){var t,e,i,n;for(n=[],t=0,e=(i=this.metrics).length;t<e;t++)r=i[t],n.push(r.advance);return n}.call(this),i=this.widths[this.widths.length-1],o=[],e=s=0;0<=n?s<n:s>n;e=0<=n?++s:--s)o.push(this.widths.push(i));return o},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(),li=[].slice,ci=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Ze(e,Ye),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var e,i,n,r,s,a,o,l,c,h;return t in this.cache?this.cache[t]:(r=this.file.loca,e=this.file.contents,i=r.indexOf(t),0===(n=r.lengthOf(t))?this.cache[t]=null:(e.pos=this.offset+i,s=(a=new Je(e.read(n))).readShort(),l=a.readShort(),h=a.readShort(),o=a.readShort(),c=a.readShort(),this.cache[t]=-1===s?new ui(a,l,h,o,c):new hi(a,s,l,h,o,c),this.cache[t]))},e.prototype.encode=function(t,e,i){var n,r,s,a,o;for(s=[],r=[],a=0,o=e.length;a<o;a++)n=t[e[a]],r.push(s.length),n&&(s=s.concat(n.encode(i)));return r.push(s.length),{table:s,offsets:r}},e}(),hi=function(){function t(t,e,i,n,r,s){this.raw=t,this.numberOfContours=e,this.xMin=i,this.yMin=n,this.xMax=r,this.yMax=s,this.compound=!1}return t.prototype.encode=function(){return this.raw.data},t}(),ui=function(){function t(t,e,i,n,r){var s,a;for(this.raw=t,this.xMin=e,this.yMin=i,this.xMax=n,this.yMax=r,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],s=this.raw;a=s.readShort(),this.glyphOffsets.push(s.pos),this.glyphIDs.push(s.readUInt16()),32&a;)s.pos+=1&a?4:2,128&a?s.pos+=8:64&a?s.pos+=4:8&a&&(s.pos+=2)}return t.prototype.encode=function(){var t,e,i;for(e=new Je(li.call(this.raw.data)),t=0,i=this.glyphIDs.length;t<i;++t)e.pos=this.glyphOffsets[t];return e.data},t}(),di=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Ze(e,Ye),e.prototype.tag="loca",e.prototype.parse=function(t){var e,i;return t.pos=this.offset,e=this.file.head.indexToLocFormat,this.offsets=0===e?function(){var e,n;for(n=[],i=0,e=this.length;i<e;i+=2)n.push(2*t.readUInt16());return n}.call(this):function(){var e,n;for(n=[],i=0,e=this.length;i<e;i+=4)n.push(t.readUInt32());return n}.call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,e){for(var i=new Uint32Array(this.offsets.length),n=0,r=0,s=0;s<i.length;++s)if(i[s]=n,r<e.length&&e[r]==s){++r,i[s]=n;var a=this.offsets[s],o=this.offsets[s+1]-a;o>0&&(n+=o)}for(var l=new Array(4*i.length),c=0;c<i.length;++c)l[4*c+3]=255&i[c],l[4*c+2]=(65280&i[c])>>8,l[4*c+1]=(16711680&i[c])>>16,l[4*c]=(4278190080&i[c])>>24;return l},e}(),pi=function(){function t(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return t.prototype.generateCmap=function(){var t,e,i,n,r;for(e in n=this.font.cmap.tables[0].codeMap,t={},r=this.subset)i=r[e],t[e]=n[i];return t},t.prototype.glyphsFor=function(t){var e,i,n,r,s,a,o;for(n={},s=0,a=t.length;s<a;s++)n[r=t[s]]=this.font.glyf.glyphFor(r);for(r in e=[],n)(null!=(i=n[r])?i.compound:void 0)&&e.push.apply(e,i.glyphIDs);if(e.length>0)for(r in o=this.glyphsFor(e))i=o[r],n[r]=i;return n},t.prototype.encode=function(t,e){var i,n,r,s,a,o,l,c,h,u,d,p,f,m,g;for(n in i=ti.encode(this.generateCmap(),"unicode"),s=this.glyphsFor(t),d={0:0},g=i.charMap)d[(o=g[n]).old]=o.new;for(p in u=i.maxGlyphID,s)p in d||(d[p]=u++);return c=function(t){var e,i;for(e in i={},t)i[t[e]]=e;return i}(d),h=Object.keys(c).sort((function(t,e){return t-e})),f=function(){var t,e,i;for(i=[],t=0,e=h.length;t<e;t++)a=h[t],i.push(c[a]);return i}(),r=this.font.glyf.encode(s,f,d),l=this.font.loca.encode(r.offsets,f),m={cmap:this.font.cmap.raw(),glyf:r.table,loca:l,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(m["OS/2"]=this.font.os2.raw()),this.font.directory.encode(m)},t}();Ct.API.PDFObject=function(){var t;function e(){}return t=function(t,e){return(Array(e+1).join("0")+t).slice(-e)},e.convert=function(i){var n,r,s,a;if(Array.isArray(i))return"["+function(){var t,r,s;for(s=[],t=0,r=i.length;t<r;t++)n=i[t],s.push(e.convert(n));return s}().join(" ")+"]";if("string"==typeof i)return"/"+i;if(null!=i?i.isString:void 0)return"("+i+")";if(i instanceof Date)return"(D:"+t(i.getUTCFullYear(),4)+t(i.getUTCMonth(),2)+t(i.getUTCDate(),2)+t(i.getUTCHours(),2)+t(i.getUTCMinutes(),2)+t(i.getUTCSeconds(),2)+"Z)";if("[object Object]"==={}.toString.call(i)){for(r in s=["<<"],i)a=i[r],s.push("/"+r+" "+e.convert(a));return s.push(">>"),s.join("\n")}return""+i},e}();const fi=Ct;window.jsPDF=fi;class mi{constructor(t){this._width=t.width,this._height=t.height,this.context=new fi("landscape","pt",[this._width,this._height],!0,!1),this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this._domContext=this.canvas.getContext("2d"),this.background_color="#ffffff",this.foreground_color="#000000",this.font_style="Courier"}set_font(t,e,i=!1){this.context.setFontSize(t);const n=i?"bold":"normal";this.context.setFont("courier",n)}set_font_color(t){this.foreground_color=t,this.context.setTextColor(this.foreground_color)}fill_text(t,e,i){this.context.text(t,e,i)}fill_rect(t,e,i,n,r){this.context.setFillColor(t),this.context.rect(e,i,n,r,"F")}draw_image(t,e,i,n,r){this.canvas.width=n,this.canvas.height=r,this._domContext.fillStyle=this.background_color,this._domContext.fillRect(0,0,n,r),this._domContext.drawImage(t,0,0,n,r),this.context.addImage(this.canvas,"PNG",e,i,n,r)}fill_gradient(t,e,i,n,r){this.canvas.width=e+n,this.canvas.height=i+r,this._domContext.fillStyle=t,this._domContext.fillRect(e,i,n,r);const s=document.createElement("canvas");s.width=n,s.height=r,s.getContext("2d").drawImage(this.canvas,e,i,n,r,0,0,n,r),this.context.addImage(s,"PNG",e,i,n,r)}start_draw_line(){}stroke_line(){}draw_line(t){this.context.setDrawColor(this.foreground_color);for(let e=0;e<t.length-1;e++)this.context.lines([[t[e+1][0]-t[e][0],t[e+1][1]-t[e][1]]],t[e][0],t[e][1],[1,1],"S",!1)}}class gi{constructor(t,e=1){this.canvas=t,this.context=t.getContext("2d"),this.pixel_ratio=e,this.background_color="#ffffff",this.foreground_color="#000000",this.context.fillStyle=this.background_color,this.font_type="Courier New, monospace",this._lineHeight_title=Math.round(25*this.pixel_ratio),this._fontSize_title=Math.round(20*this.pixel_ratio),this._lineHeight_normal=Math.round(25*this.pixel_ratio),this._fontSize_normal=Math.round(15*this.pixel_ratio),this._lineHeight_small=Math.round(15*this.pixel_ratio),this._fontSize_small=Math.round(10*this.pixel_ratio)}set_font(t,e,i=!1){this.font_type=e||this.font_type,this.context.font=i?`bold ${t}px ${this.font_type}`:`${t}px ${this.font_type}`}set_font_color(t){this.foreground_color=t,this.context.fillStyle=this.foreground_color}fill_text(t,e,i){this.context.fillText(t,e,i)}fill_rect(t,e,i,n,r){this.context.fillStyle=t,this.context.fillRect(e,i,n,r)}draw_image(t,e,i,n,r){this.context.drawImage(t,e,i,n,r)}fill_gradient(t,e,i,n,r){this.context.fillStyle=t,this.context.fillRect(e,i,n,r)}start_draw_line(){this.context.beginPath()}stroke_line(){this.context.stroke()}draw_line(t,e=!0,i=!0){this.context.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)this.context.lineTo(t[e][0],t[e][1])}}const _i=function(){var t=0,e=document.createElement("div");function i(t){return e.appendChild(t.dom),t}function n(i){for(var n=0;n<e.children.length;n++)e.children[n].style.display=n===i?"block":"none";t=i}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",(function(i){i.preventDefault(),n(++t%e.children.length)}),!1);var r=(performance||Date).now(),s=r,a=0,o=i(new _i.Panel("FPS","#0ff","#002")),l=i(new _i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=i(new _i.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:e,addPanel:i,showPanel:n,begin:function(){r=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-r,200),t>s+1e3&&(o.update(1e3*a/(t-s),100),s=t,a=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end()},domElement:e,setMode:n}};_i.Panel=function(t,e,i){var n=1/0,r=0,s=Math.round,a=s(window.devicePixelRatio||1),o=80*a,l=48*a,c=3*a,h=2*a,u=3*a,d=15*a,p=74*a,f=30*a,m=document.createElement("canvas");m.width=o,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,o,l),g.fillStyle=e,g.fillText(t,c,h),g.fillRect(u,d,p,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u,d,p,f),{dom:m,update:function(l,_){n=Math.min(n,l),r=Math.max(r,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,o,d),g.fillStyle=e,g.fillText(s(l)+" "+t+" ("+s(n)+"-"+s(r)+")",c,h),g.drawImage(m,u+a,d,p-a,f,u,d,p-a,f),g.fillRect(u+p-a,d,a,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u+p-a,d,a,s((1-l/_)*f))}}};var vi=i(178),yi=i(5664);function bi(t){return[parseFloat(getComputedStyle(t,null).getPropertyValue("width").replace("px","")),parseFloat(getComputedStyle(t,null).getPropertyValue("height").replace("px",""))]}function xi(t,e,i,n=((t,e)=>{})){var r,s,a=0,o=0,l=0,c=0,h=[-1/0,1/0,-1/0,1/0],u="pan";function d(t){const e=u;return u="pan",p(t),u=e,!1}function p(e){if((e=e||window.event).preventDefault(),l=e.clientX,c=e.clientY,"pan"===u){if(i){const e=bi(i),n=bi(t);e[0]>n[0]?(h[1]=e[0]-n[0],h[0]=0):(h[0]=e[0]-n[0],h[1]=0),e[1]>n[1]?(h[3]=e[1]-n[1],h[2]=0):(h[2]=e[1]-n[1],h[3]=0)}document.onmousemove=m,n(e,{state:"pan"})}else r=t.getBoundingClientRect().left,s=t.getBoundingClientRect().top,document.onmousemove=f,n(e,{state:"select",x:l-r,y:c-s});document.onmouseup=g}function f(e){"select"===u&&e.shiftKey&&(l=e.clientX,c=e.clientY,r=t.getBoundingClientRect().left,s=t.getBoundingClientRect().top,n(e,{state:"select",x:l-r,y:c-s}))}function m(e){(e=e||window.event).preventDefault(),a=l-e.clientX,o=c-e.clientY,l=e.clientX,c=e.clientY;let i=t.offsetTop-o,n=t.offsetLeft-a;i<h[0]&&(i=h[0]),i>h[1]&&(i=h[1]),n<h[2]&&(n=h[2]),n>h[3]&&(n=h[3]),t.style.top=i+"px",t.style.left=n+"px"}function g(){document.onmouseup=null,document.onmousemove=null}return e?(e.onmousedown=p,e.oncontextmenu=d):(t.onmousedown=p,t.oncontextmenu=d),t=>{u=t}}var wi=i(975);var Si=i(960),Mi=i(470);class Ai extends Mi.j{constructor(t,e){let i;super(t,e),this.type="DataCube",this.isDataCube=!0;let n=new vi.J.LineBasicMaterial({color:65280,transparent:!0}),r=new vi.J.BufferGeometry;n.depthTest=!1;const s=e.get_data("datacube_value_"+t.name,t.name,t.group.group_name),a=e.get_data("datacube_dim_"+t.name,t.name,t.group.group_name),o=e.get_data("datacube_half_size_"+t.name,t.name,t.group.group_name),l=(t.position,{xLength:2*o[0],yLength:2*o[1],zLength:2*o[2]});let c=new vi.J.DataTexture2DArray(new Uint8Array(s),a[0],a[1],a[2]);c.format=vi.J.RedFormat,c.type=vi.J.UnsignedByteType,c.needsUpdate=!0,this._texture=c;const h=vi.J.Volume2dArrayShader_xy;let u=new vi.J.ShaderMaterial({uniforms:{diffuse:{value:c},depth:{value:o[2]},size:{value:new vi.J.Vector3(l.xLength,l.yLength,a[2])},threshold:{value:0},renderDepth:{value:1}},vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,side:vi.J.DoubleSide,transparent:!0}),d=new vi.J.PlaneBufferGeometry(l.xLength,l.yLength),p=new vi.J.Mesh(d,u);p.renderOrder=-1,p.position.copy(wi.t.VEC_ORIGIN),p.name="mesh_datacube__axial_"+t.name;const f=vi.J.Volume2dArrayShader_xz;let m=new vi.J.ShaderMaterial({uniforms:{diffuse:{value:c},depth:{value:o[1]},size:{value:new vi.J.Vector3(l.xLength,a[1],l.zLength)},threshold:{value:0},renderDepth:{value:1}},vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,side:vi.J.DoubleSide,transparent:!0}),g=new vi.J.PlaneBufferGeometry(l.xLength,l.zLength),_=new vi.J.Mesh(g,m);_.rotateX(Math.PI/2),_.renderOrder=-1,_.position.copy(wi.t.VEC_ORIGIN),_.name="mesh_datacube__coronal_"+t.name;const v=vi.J.Volume2dArrayShader_yz;let y=new vi.J.ShaderMaterial({uniforms:{diffuse:{value:c},depth:{value:o[0]},size:{value:new vi.J.Vector3(a[0],l.yLength,l.zLength)},threshold:{value:0},renderDepth:{value:1}},vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,side:vi.J.DoubleSide,transparent:!0}),b=new vi.J.PlaneBufferGeometry(l.xLength,l.zLength),x=new vi.J.Mesh(b,y);x.rotateY(Math.PI/2),x.rotateZ(Math.PI/2),x.renderOrder=-1,x.position.copy(wi.t.VEC_ORIGIN),x.name="mesh_datacube__sagittal_"+t.name,i=[_,p,x];const w=Math.max(...o),S=[];S.push(new vi.J.Vector3(-w,-w,0),new vi.J.Vector3(w,w,0)),r.setFromPoints(S);let M=new vi.J.Line(r,n),A=new vi.J.Line(r,n),E=new vi.J.Line(r,n);M.renderOrder=wi.t.RENDER_ORDER.DataCube,A.renderOrder=wi.t.RENDER_ORDER.DataCube,E.renderOrder=wi.t.RENDER_ORDER.DataCube,M.layers.set(wi.t.LAYER_SYS_AXIAL_10),M.layers.enable(wi.t.LAYER_SYS_SAGITTAL_11),A.layers.set(wi.t.LAYER_SYS_CORONAL_9),A.layers.enable(wi.t.LAYER_SYS_SAGITTAL_11),E.layers.set(wi.t.LAYER_SYS_CORONAL_9),E.layers.enable(wi.t.LAYER_SYS_AXIAL_10),_.add(M),p.add(A),x.add(E),p.userData.dispose=()=>{u.dispose(),d.dispose(),n.dispose(),r.dispose(),c.dispose()},p.userData.instance=this,this._line_material=n,this._line_geometry=r,this._texture=c,this._mesh_xy=p,this._material_xy=u,this._geometry_xy=d,_.userData.dispose=()=>{m.dispose(),g.dispose(),n.dispose(),r.dispose(),c.dispose()},_.userData.instance=this,this._mesh_xz=_,this._material_xz=m,this._geometry_xz=g,x.userData.dispose=()=>{y.dispose(),b.dispose(),n.dispose(),r.dispose(),c.dispose()},x.userData.instance=this,this._mesh_yz=x,this._geometry_yz=b,this._material_yz=y,this.object=i}dispose(){this._line_material.dispose(),this._line_geometry.dispose(),this._material_xy.dispose(),this._geometry_xy.dispose(),this._material_yz.dispose(),this._geometry_yz.dispose(),this._material_yz.dispose(),this._geometry_yz.dispose(),this._texture.dispose()}get_track_data(t,e){}pre_render(t){}finish_init(){this._canvas.mesh.set("_coronal_"+this.name,this._mesh_xz),this._canvas.mesh.set("_axial_"+this.name,this._mesh_xy),this._canvas.mesh.set("_sagittal_"+this.name,this._mesh_yz),this.clickable&&(this._canvas.add_clickable("_coronal_"+this.name,this._mesh_xz),this._canvas.add_clickable("_axial_"+this.name,this._mesh_xy),this._canvas.add_clickable("_sagittal_"+this.name,this._mesh_yz));let t=this.get_group_object();this._canvas.origin.remove(t),this._canvas.scene.add(t),this.object.forEach(e=>{this.set_layer([],e),t.add(e),e.userData.construct_params=this._params,e.updateMatrixWorld()}),this.register_object(["volumes"]),this._canvas._has_datacube_registered||(this._canvas._register_datacube(this.object),this._canvas._has_datacube_registered=!0)}}class Ei extends Mi.j{_compute_normals(){let t,e,i,n,r,s,a,o=0,l=0,c=new vi.J.Vector3,h=new vi.J.Vector3;const u=this._cube_dim[0],d=this._cube_dim[1],p=this._cube_dim[2];for(n=1;n<u-1;n+=1)for(i=1;i<d-1;i+=1)for(e=1;e<p-1;e+=1)if(l=e+p*(i+d*n),0!==this._map_color[4*l+3]){for(t=l+this._value_index_skip*this._voxel_length,o=this._cube_values[t],c.set(0,0,0),r=-1;r<=1;r+=1)for(s=-1;s<=1;s+=1)for(a=-1;a<=1;a+=1)this._cube_values[t+r+(s+a*d)*p]!=o&&(h.set(r,s,a).normalize(),c.add(h));c.normalize(),this._map_normals[3*l]=127*(c.x/2+1),this._map_normals[3*l+1]=127*(c.y/2+1),this._map_normals[3*l+2]=127*(c.z/2+1)}this._normals_texture&&(this._normals_texture.needsUpdate=!0)}_set_palette(t,e,i=!1){if(this._canvas.has_webgl2){if(void 0!==t){this._color_ids.length=0;for(let e=0;e<t.length;e++)this._color_ids[t[e]]=!0;this._color_ids[0]?this._color_ids_length=0:this._color_ids_length=t.length,i=!0}"number"==typeof e&&(this._value_index_skip=Math.floor(e));let n,r,s,a,o=0,l=0,c=this._value_index_skip*this._voxel_length;for(i&&(this._bounding_min=Math.max(this._cube_dim[0],this._cube_dim[1],this._cube_dim[2]),this._bounding_max=0),a=0;a<this._cube_dim[0];a++)for(s=0;s<this._cube_dim[1];s++)for(r=0;r<this._cube_dim[2];r++)o=this._cube_values[c],0!==o&&(n=this._lut_map[o],n&&(this._map_color[4*l]=n.R,this._map_color[4*l+1]=n.G,this._map_color[4*l+2]=n.B,0===this._color_ids_length||this._color_ids[o]))?(this._map_color[4*l+3]=this._map_alpha?n.A:255,i&&(Math.min(r,s,a)<this._bounding_min&&(this._bounding_min=Math.min(r,s,a)),Math.max(r,s,a)>this._bounding_max&&(this._bounding_max=Math.max(r,s,a))),l++,c++):(this._map_color[4*l+3]=0,l++,c++);i&&(this.object.material.uniforms.bounding.value=Math.min(Math.max(this._bounding_max/Math.min(...this._cube_dim)-.5,.5-this._bounding_min/Math.max(...this._cube_dim),0),.5),this.object.material.uniformsNeedUpdate=!0),this._color_texture&&(this._color_texture.needsUpdate=!0)}}constructor(t,e){let i;super(t,e),this.type="DataCube2",this.isDataCube2=!0,this._hide_flag=!1;const n=e.get_data("datacube_value_"+t.name,t.name,t.group.group_name),r=e.get_data("datacube_half_size_"+t.name,t.name,t.group.group_name),s=e.get_data("datacube_dim_"+t.name,t.name,t.group.group_name),a=2*r[0],o=2*r[1],l=2*r[2],c=e.global_data("__global_data__.VolumeColorLUT"),h=c.map,u=c.mapMaxColorID;if(e.has_webgl2){this._voxel_length=s[0]*s[1]*s[2];const e=new Uint8Array(4*this._voxel_length),d=new Uint8Array(3*this._voxel_length);this._cube_values=n,this._lut=c,this._lut_map=h,this._cube_dim=s,this._map_color=e,this._map_normals=d,this._map_alpha=c.mapAlpha,this._color_ids=[],this._color_ids_length=0,this._value_index_skip=0;let p=Math.min(s[0],s[1],s[2])/2,f=p;n.forEach((t,e)=>{t>u||t<0?n[e]=0:Number.isInteger(t)||(n[e]=Math.round(t))});let m,g=0,_=0;for(let t=0;t<s[0];t++)for(let i=0;i<s[1];i++)for(let r=0;r<s[2];r++)g=n[_],0!==g&&(m=h[g],m&&(e[4*_]=m.R,e[4*_+1]=m.G,e[4*_+2]=m.B,e[4*_+3]=void 0===m.A?255:m.A,Math.min(r,i,t)<p&&(p=Math.min(r,i,t)),Math.max(r,i,t)>f&&(f=Math.max(r,i,t)))),_++;this._compute_normals();let v=new vi.J.DataTexture3D(e,s[0],s[1],s[2]);v.minFilter=vi.J.NearestFilter,v.magFilter=vi.J.NearestFilter,v.format=vi.J.RGBAFormat,v.type=vi.J.UnsignedByteType,v.unpackAlignment=1,this._color_texture=v,this._color_texture.needsUpdate=!0;let y=new vi.J.DataTexture3D(d,s[0],s[1],s[2]);y.minFilter=vi.J.LinearFilter,y.magFilter=vi.J.NearestFilter,y.format=vi.J.RGBFormat,y.type=vi.J.UnsignedByteType,y.unpackAlignment=1,this._normals_texture=y,this._normals_texture.needsUpdate=!0;const b=vi.J.VolumeRenderShader1;let x=vi.J.UniformsUtils.clone(b.uniforms);x.cmap.value=v,x.nmap.value=y,x.alpha.value=-1,x.scale_inv.value.set(1/a,1/o,1/l),this._bounding_min=p,this._bounding_max=f;let w=Math.max(f/Math.min(...s)-.5,.5-p/Math.max(...s),0);w=Math.min(w,.5),x.bounding.value=w;let S=new vi.J.RawShaderMaterial({uniforms:x,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader,side:vi.J.BackSide,transparent:!0}),M=new vi.J.SphereBufferGeometry((new vi.J.Vector3).fromArray(r).length(),29,14);i=new vi.J.Mesh(M,S),i.name="mesh_datacube_"+t.name,i.position.fromArray(t.position),i.userData.pre_render=t=>this.pre_render(t),i.userData.dispose=()=>{this.dispose()}}this._mesh=i,this.object=i}dispose(){this._canvas.has_webgl2&&this._mesh&&(this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._color_texture.dispose(),this._normals_texture.dispose())}get_track_data(t,e){}pre_render(t){this._mesh.material.uniforms.cameraPos.value.copy(this._canvas.main_camera.position),this._canvas.__hide_voxels&&(this.object.visible=!1)}finish_init(){super.finish_init();let t=this.get_group_object();this._canvas.origin.remove(t),this._canvas.scene.add(t),this.register_object(["atlases"])}}var Li=i(7e3);class Ti extends Li.BufferGeometry{constructor(t,e,i,n,r){super(),this.type="TubeBufferGeometry2",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r},e=e||64,i=i||1,n=n||8,r=r||!1,this.tubularSegments=e,this.radialSegments=n,this.radius=i,this.closed=r,this.computeFrenetFrames(),this._vertex=new Li.Vector3,this._normal=new Li.Vector3,this._uv=new Li.Vector2,this._P=new Li.Vector3;const s=new Array((this.radialSegments+1)*(this.tubularSegments+1)*3).fill(0),a=new Array((this.radialSegments+1)*(this.tubularSegments+1)*3).fill(0),o=new Array((this.radialSegments+1)*(this.tubularSegments+1)*2).fill(0);this._indices=new Array(this.radialSegments*this.tubularSegments*6).fill(0),this._vertices=new Li.Float32BufferAttribute(s,3),this._normals=new Li.Float32BufferAttribute(a,3),this._uvs=new Li.Float32BufferAttribute(o,2),this.generateBufferData(!0,!0,!0,!1),this.setIndex(this._indices),this.setAttribute("position",this._vertices),this.setAttribute("normal",this._normals),this.setAttribute("uv",this._uvs)}computeFrenetFrames(){const t=this.parameters.path.computeFrenetFrames(this.tubularSegments,this.closed);this.tangents=t.tangents,this.normals=t.normals,this.binormals=t.binormals}generateBufferData(t=!0,e=!1,i=!1,n=!1){if(n&&(!this.normals||this.normals.length<1||0===this.normals[0].length())&&this.computeFrenetFrames(),t){for(let t=0;t<this.tubularSegments;t++)this.generateSegment(t);this.generateSegment(!1===this.closed?this.tubularSegments:0),this._vertices.needsUpdate=!0}e&&(this.generateUVs(),this._uvs.needsUpdate=!0),i&&this.generateIndices()}generateSegment(t){this._P=this.parameters.path.getPoint(t/this.tubularSegments,this._P);const e=this.normals[t],i=this.binormals[t];for(let n=0;n<=this.radialSegments;n++){const r=n/this.radialSegments*Math.PI*2,s=Math.sin(r),a=-Math.cos(r);this._normal.x=a*e.x+s*i.x,this._normal.y=a*e.y+s*i.y,this._normal.z=a*e.z+s*i.z,this._normal.normalize(),this._normals.setXYZ((this.radialSegments+1)*t+n,this._normal.x,this._normal.y,this._normal.z),this._vertex.x=this._P.x+this.radius*this._normal.x,this._vertex.y=this._P.y+this.radius*this._normal.y,this._vertex.z=this._P.z+this.radius*this._normal.z,this._vertices.setXYZ((this.radialSegments+1)*t+n,this._vertex.x,this._vertex.y,this._vertex.z)}}generateUVs(){for(let t=0;t<=this.tubularSegments;t++)for(let e=0;e<=this.radialSegments;e++)this._uv.x=t/this.tubularSegments,this._uv.y=e/this.radialSegments,this._uvs.setXY((this.radialSegments+1)*t+e,this._uv.x,this._uv.y)}generateIndices(){for(let t=1;t<=this.tubularSegments;t++)for(let e=1;e<=this.radialSegments;e++){const i=(this.radialSegments+1)*(t-1)+(e-1),n=(this.radialSegments+1)*t+(e-1),r=(this.radialSegments+1)*t+e,s=(this.radialSegments+1)*(t-1)+e,a=(t-1)*this.radialSegments+e-1;this._indices[6*a]=i,this._indices[6*a+1]=n,this._indices[6*a+2]=s,this._indices[6*a+3]=n,this._indices[6*a+4]=r,this._indices[6*a+5]=s}}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}}function Ci(t){vi.J.Curve.call(this),this.targets=t,this._cached=t.map(t=>new vi.J.Vector3)}Ci.prototype=Object.create(vi.J.Curve.prototype),Ci.prototype.constructor=Ci,Ci.prototype.getPoint=function(t,e){const i=e||new vi.J.Vector3;return i.x=this.targets[0].x*(1-t)+this.targets[1].x*t,i.y=this.targets[0].y*(1-t)+this.targets[1].y*t,i.z=this.targets[0].z*(1-t)+this.targets[1].z*t,i},Ci.prototype._changed=function(){return this.targets.every((t,e)=>{const i=this._cached[e];if(i&&i.isVector3){if(t.equals(i))return!0;this._cached[e].copy(t)}else this._cached[e]=t.clone();return!1})};class Pi extends Mi.j{constructor(t,e){let i;super(t,e),this.type="TubeMesh",this.isTubeMesh=!0,this.radius=t.radius||.4,this.tubularSegments=t.tubular_segments||3,this.radialSegments=t.radial_egments||6,this.is_closed=t.is_closed||!1,this.path_names=t.paths,this._targets=this.path_names.map(t=>{if(i=e.threebrain_instances.get(t),i&&i.isThreeBrainObject)return i;throw`Cannot find object ${t}.`}),this._target_positions=[this._targets[0].world_position,this._targets[1].world_position],this._curve=new Ci(this._target_positions),this._geometry=new Ti(this._curve,this.tubularSegments,this.radius,this.radialSegments,this.is_closed),this._material=new vi.J.MeshLambertMaterial,this.object=new vi.J.Mesh(this._geometry,this._material),this._mesh=this.object,this._geometry.name="geom_tube2_"+t.name,this._mesh.name="mesh_tube2_"+t.name,this._cached_position=[]}finish_init(){super.finish_init(),this.get_group_object().remove(this.object),this._canvas.scene.add(this.object)}dispose(){this._targets.length=0,this._mesh.material.dispose(),this._mesh.geometry.dispose()}pre_render(t){this.object&&(this._targets.forEach((e,i)=>{e._last_rendered!==t.elapsed_time&&e.get_world_position(t)}),this._geometry.generateBufferData(!0,!1,!1,!0))}}const Ni=(t,e,i)=>{if(!t.userData.compiled)return t.userData.compiled=!1,t.userData.options=e,t.onBeforeCompile=(n,r)=>{n.uniforms.which_map=e.which_map,n.uniforms.volume_map=e.volume_map,n.uniforms.scale_inv=e.scale_inv,n.uniforms.shift=e.shift,n.uniforms.sampler_bias=e.sampler_bias,n.uniforms.sampler_step=e.sampler_step,n.uniforms.elec_cols=e.elec_cols,n.uniforms.elec_locs=e.elec_locs,n.uniforms.elec_size=e.elec_size,n.uniforms.elec_active_size=e.elec_active_size,n.uniforms.blend_factor=e.blend_factor,t.userData.shader=n,void 0!==i&&i!==r||(t.userData.compiled=!0,n.vertexShader="\nprecision mediump sampler2D;\nprecision mediump sampler3D;\nuniform int which_map;\nuniform float elec_size;\nuniform float elec_active_size;\nuniform sampler3D volume_map;\nuniform sampler2D elec_cols;\nuniform sampler2D elec_locs;\nuniform vec3 scale_inv;\nuniform vec3 shift;\nuniform float sampler_bias;\nuniform float sampler_step;\nuniform float blend_factor;\n\nattribute vec3 track_color;\nvec3 zeros = vec3( 0.0 );\n\nvec4 sample1(vec3 p) {\n  vec4 re = vec4( 0.0, 0.0, 0.0, 0.0 );\n  vec3 threshold = vec3( 0.007843137, 0.007843137, 0.007843137 );\n  if( sampler_bias > 0.0 ){\n    vec3 dta = vec3( 0.0 );\n    vec4 tmp = vec4( 0.0 );\n    float count = 0.0;\n    for(dta.x = -sampler_bias; dta.x <= sampler_bias; dta.x+=sampler_step){\n      for(dta.y = -sampler_bias; dta.y <= sampler_bias; dta.y+=sampler_step){\n        for(dta.z = -sampler_bias; dta.z <= sampler_bias; dta.z+=sampler_step){\n          tmp = texture( volume_map, p + dta * scale_inv );\n          if(\n            tmp.a > 0.0 &&\n            (tmp.r > threshold.r ||\n            tmp.g > threshold.g ||\n            tmp.b > threshold.b)\n          ){\n            if( count == 0.0 ){\n              re = tmp;\n            } else {\n              re = mix( re, tmp, 1.0 / count );\n            }\n            count += 1.0;\n          }\n        }\n      }\n    }\n  } else {\n    re = texture( volume_map, p );\n  }\n  if( re.a == 0.0 ){\n    re.r = 1.0;\n    re.g = 1.0;\n    re.b = 1.0;\n  }\n  return( re );\n}\n\n\nvec3 sample2( vec3 p ) {\n  // p = (position + shift) * scale_inv\n  vec3 eloc;\n  vec3 ecol;\n  vec2 p2 = vec2( 0.0, 0.5 );\n  vec3 re = vec3( 0.0 );\n  float count = 0.0;\n  float len = 0.0;\n  float start = 0.5 / elec_size;\n  float end = elec_active_size / elec_size;\n  float step = 1.0 / elec_size;\n\n  for( p2.x = start; p2.x < end; p2.x += step ){\n    eloc = texture( elec_locs, p2 ).rgb;\n    len = max( length( ( eloc * 255.0 - 128.0 ) - p ) , 3.0 );\n    if( len < 10.0 ){\n      ecol = texture( elec_cols, p2 ).rgb;\n      re += 1.0 + ( ecol - 1.0 ) / ( len * len / 9.0 );\n      count += 1.0;\n    }\n  }\n  if( count == 0.0 ){\n    return ( vec3( 1.0 ) );\n  }\n  return (re / count);\n}\n    "+n.vertexShader,n.vertexShader=n.vertexShader.replace("#include <fog_vertex>","#include <fog_vertex>\n\nvec4 data_color0 = vec4( 0.0 );\n\nif( which_map == 1 ){\n    // is track_color is missing, or all zeros, it's invalid\n    if( track_color.rgb != zeros ){\n      vColor.rgb = mix( vColor.rgb, track_color, blend_factor );\n    }\n} else if( which_map == 2 ){\n  vec3 data_position = (position + shift) * scale_inv + 0.5;\n  data_color0 = sample1(\n    data_position -\n    scale_inv * vec3(0.5,-0.5,0.5)\n  );\n\n#if defined( USE_COLOR_ALPHA )\n\tvColor = mix( max(vec3( 1.0 ) - vColor / 2.0, vColor), data_color0, blend_factor );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor.rgb = mix( max(vec3( 1.0 ) - vColor.rgb / 2.0, vColor.rgb), data_color0.rgb, blend_factor );\n#endif\n} else if( which_map == 3 ){\n  if( elec_active_size > 0.0 ){\n    data_color0.rgb = sample2( position + shift );\n    vColor.rgb = mix( vColor.rgb, data_color0.rgb, blend_factor );\n  }\n}     ".split("\n").map(t=>t.replaceAll(/\/\/.*/g,"")).join("\n")))},t},Ri={transparent:!0,side:vi.J.DoubleSide,wireframeLinewidth:.1,vertexColors:vi.J.VertexColors};class Di extends Mi.j{_ensure_track_color(){if(!this._track_color){const t=new Uint8Array(3*this.__nvertices).fill(255);this._track_color=t,this._geometry.setAttribute("track_color",new vi.J.BufferAttribute(t,3,!0))}}_link_userData(){this._mesh.userData.pre_render=t=>this.pre_render(t),this._mesh.userData.dispose=()=>{this.dispose()}}_set_track(t){void 0!==t&&t>=0&&(this.__skip_frame=t);const e=this._params.value;if(!e)return;const i=this.__nvertices*this.__skip_frame;if(i>e.length)return;this.__initialized||e.forEach((t,i)=>{e[i]=Math.floor(t)}),this._ensure_track_color();const n=this._canvas.global_data("__global_data__.SurfaceColorLUT").map,r=this._track_color;let s,a=i;for(let t=0;t<this.__nvertices;t++,a++)a>=e.length?(r[3*t]=0,r[3*t+1]=0,r[3*t+2]=0):(s=n[e[a]],s?(r[3*t]=s.R,r[3*t+1]=s.G,r[3*t+2]=s.B):(r[3*t]=0,r[3*t+1]=0,r[3*t+2]=0));this._geometry.attributes.track_color.needsUpdate=!0}_set_primary_color(t,e=!1){let i=t||this._vertex_cname;const n=this._canvas.get_data(i,this.misc_name,this.misc_group_name);if(!n||!Array.isArray(n.value))return void(e&&(this._mesh.material.needsUpdate=!0));this._params;const r=this._mesh.geometry.attributes.position.count;(!Array.isArray(n.range)||n.range.length<2)&&(n.range=[-1,1]);let s=Math.max(n.range[1],-n.range[0]);n.value.forEach((t,e)=>{if(e>=r)return;let i=((t,e=10/s)=>(Math.floor(153.9/(1+Math.exp(e*t)))+100)/255)(t);this._vertex_color[3*e]=i,this._vertex_color[3*e+1]=i,this._vertex_color[3*e+2]=i}),e&&(this._mesh.material.needsUpdate=!0)}_check_material(t=!1){const e=this._canvas.state_data.get("surface_material_type")||this._material_type;this._mesh.material["is"+e]||this.switch_material(e,t)}_set_color_from_datacube2(t,e=3){t&&t.isDataCube2?(this._volume_texture.image=t._color_texture.image,this._material_options.scale_inv.value.set(1/t._cube_dim[0],1/t._cube_dim[1],1/t._cube_dim[2]),this._volume_texture.needsUpdate=!0,this._material_options.which_map.value=wi.t.VOXEL_COLOR,this._material_options.sampler_bias.value=e,this._material_options.sampler_step.value=e/2):this._material_options.which_map.value=wi.t.DEFAULT_COLOR}switch_material(t,e=!1){if(t in this._materials){const i=this._materials[t],n=this._canvas.state_data.get("surface_opacity_left")||0;this._material_type=t,this._mesh.material=i,this._mesh.material.vertexColors=vi.J.VertexColors,this._mesh.material.opacity=n,this._mesh.material.needsUpdate=!0,e&&this._canvas.start_animation(0)}}_link_electrodes(){if(!Array.isArray(this._linked_electrodes)){this._linked_electrodes=[],this._canvas.electrodes.forEach(t=>{for(let e in t)this._linked_electrodes.push(t[e])});const t=this._linked_electrodes.length;if(0==t)return;const e=new Uint8Array(3*t),i=new vi.J.DataTexture(e,t,1);i.minFilter=vi.J.NearestFilter,i.magFilter=vi.J.NearestFilter,i.format=vi.J.RGBFormat,i.type=vi.J.UnsignedByteType,i.unpackAlignment=1,i.needsUpdate=!0,this._material_options.elec_locs.value=i;const n=new Uint8Array(3*t),r=new vi.J.DataTexture(n,t,1);r.minFilter=vi.J.NearestFilter,r.magFilter=vi.J.NearestFilter,r.format=vi.J.RGBFormat,r.type=vi.J.UnsignedByteType,r.unpackAlignment=1,r.needsUpdate=!0,this._material_options.elec_cols.value=r,this._material_options.elec_size.value=t,this._material_options.elec_active_size.value=t}if(!this._linked_electrodes.length)return;const t=this._material_options.elec_locs.value.image.data,e=this._material_options.elec_cols.value.image.data,i=new vi.J.Vector3;let n=0;this._linked_electrodes.forEach(r=>{r.visible&&r.material.isMeshBasicMaterial&&(r.getWorldPosition(i),i.addScalar(128),t[3*n]=Math.round(i.x),t[3*n+1]=Math.round(i.y),t[3*n+2]=Math.round(i.z),e[3*n]=Math.floor(255*r.material.color.r),e[3*n+1]=Math.floor(255*r.material.color.g),e[3*n+2]=Math.floor(255*r.material.color.b),n++)}),this._material_options.elec_locs.value.needsUpdate=!0,this._material_options.elec_cols.value.needsUpdate=!0,this._material_options.elec_active_size.value=n}finish_init(){super.finish_init(),this.register_object(["surfaces"]),this._material_options.shift.value.copy(this._mesh.parent.position),this._set_primary_color(this._vertex_cname,!0),this._set_track(0),this.__initialized=!0}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose();try{this._volume_texture.dispose()}catch(t){}}pre_render(t){if(this._check_material(!1),this.object.visible)if(this._material_options.which_map.value===wi.t.VERTEX_COLOR){if(this.time_stamp.length){let e=0;this.time_stamp.forEach((i,n)=>{i<=t.current_time&&(e=n-1)}),e<0&&(e=0),this.__skip_frame!==e&&this._set_track(e)}}else this._material_options.which_map.value===wi.t.ELECTRODE_COLOR&&this._link_electrodes()}constructor(t,e){super(t,e),this.type="FreeMesh",this.isFreeMesh=!0,this.subject_code=this._params.subject_code,this.display_code=e.get_data("subject_code",this._params.name,this.group_name)||this.subject_code,this.hemisphere=this._params.hemisphere||"left",this.surface_type=this._params.surface_type,this.misc_name="_misc_"+this.subject_code,this.misc_group_name="_internal_group_data_"+this.subject_code,this._vertex_cname=this._canvas.get_data(`default_vertex_${this.hemisphere[0]}h_${this.surface_type}`,this.name,this.group_name);const i=this._canvas.get_data("free_vertices_"+this.name,this.name,this.group_name),r=this._canvas.get_data("free_faces_"+t.name,this.name,this.group_name),s=(0,n.ht)(r,0);0!==s&&(0,n.Q0)(r,s),this._volume_margin_size=128,this._volume_array=new Uint8Array(32),this._volume_texture=new vi.J.DataTexture3D(this._volume_array,2,2,2),this._volume_texture.minFilter=vi.J.NearestFilter,this._volume_texture.magFilter=vi.J.LinearFilter,this._volume_texture.format=vi.J.RGBAFormat,this._volume_texture.type=vi.J.UnsignedByteType,this._volume_texture.unpackAlignment=1,this._material_options={which_map:{value:wi.t.DEFAULT_COLOR},volume_map:{value:this._volume_texture},scale_inv:{value:new vi.J.Vector3(1/this._volume_margin_size,1/this._volume_margin_size,1/this._volume_margin_size)},shift:{value:new vi.J.Vector3},sampler_bias:{value:3},sampler_step:{value:1.5},elec_cols:{value:null},elec_locs:{value:null},elec_size:{value:0},elec_active_size:{value:0},blend_factor:{value:.4}},this._materials={MeshPhongMaterial:Ni(new vi.J.MeshPhongMaterial(Ri),this._material_options,this._canvas.main_renderer),MeshLambertMaterial:Ni(new vi.J.MeshLambertMaterial(Ri),this._material_options,this._canvas.main_renderer)},this._geometry=new vi.J.BufferGeometry,this.__nvertices=i.length;const a=new Float32Array(3*this.__nvertices),o=new Uint32Array(3*r.length),l=new Float32Array(3*this.__nvertices).fill(1);if(this._vertex_color=l,i.forEach((t,e)=>{a[3*e]=t[0],a[3*e+1]=t[1],a[3*e+2]=t[2]}),r.forEach((t,e)=>{o[3*e]=t[0],o[3*e+1]=t[1],o[3*e+2]=t[2]}),this._geometry.setIndex(new vi.J.BufferAttribute(o,1)),this._geometry.setAttribute("position",new vi.J.BufferAttribute(a,3)),this._geometry.setAttribute("color",new vi.J.BufferAttribute(l,3,!0)),this._geometry.computeVertexNormals(),this._geometry.computeBoundingBox(),this._geometry.computeBoundingSphere(),this._geometry.name="geom_free_"+t.name,this._material_type=t.material_type||"MeshPhongMaterial",this._mesh=new vi.J.Mesh(this._geometry,this._materials[this._material_type]),this._mesh.name="mesh_free_"+t.name,this._mesh.position.fromArray(t.position),this.time_stamp=(0,n.AA)(this._params.time_stamp),this.time_stamp.length>0){let t,e;if(this.time_stamp.forEach(i=>{(void 0===t||t>i)&&(t=i),(void 0===e||e<i)&&(e=i)}),void 0!==t){let e=this._canvas.state_data.get("time_range_min0");(void 0===e||t<e)&&this._canvas.state_data.set("time_range_min0",t)}if(void 0!==e){let t=this._canvas.state_data.get("time_range_max0");(void 0===t||e<t)&&this._canvas.state_data.set("time_range_max0",e)}}this._mesh.userData.construct_params=t,this._mesh.userData.ani_name="default",this._mesh.userData.ani_all_names=Object.keys(t.keyframes),this._mesh.userData.ani_exists=!1,this.object=this._mesh,this._link_userData()}}class Ii{constructor(t,e,i="RAS"){this._camera=t,this._control=e,this._text=i,this.container=new vi.J.Group;for(let t in i){let e=new vi.J.CylinderGeometry(.5,.5,3,8),n=[0,0,0];n[t]=1;let r=(new vi.J.Color).fromArray(n),s=new vi.J.Mesh(e,new vi.J.MeshBasicMaterial({color:r,side:vi.J.DoubleSide}));s.layers.set(wi.t.LAYER_SYS_MAIN_CAMERA_8);let a=["rotateZ",null,"rotateX"][t];a&&s[a](Math.PI/2),this.container.add(s),n[t]=255;let o=new vi.J.TextSprite(i[t],3,`rgba(${n[0]}, ${n[1]}, ${n[2]}, 1)`);n[t]=5,o.position.fromArray(n),o.layers.set(wi.t.LAYER_SYS_MAIN_CAMERA_8),this.container.add(o)}}update(){this.container.position.copy(this._camera.up).cross(this._camera.position).normalize().multiplyScalar(this._camera.left+10).add(this._camera.up.clone().multiplyScalar(this._camera.bottom+10)).multiplyScalar(1/this._camera.zoom).add(this._control.target)}set_visibility(t,e){this.container.visible=!0===t,"function"==typeof e&&e()}}var Oi=i(7542),ki=i(3729),Fi=i.n(ki);const Bi={sphere:Si.Lk,free:function(t,e){return new Di(t,e)},datacube:function(t,e){return new Ai(t,e)},datacube2:function(t,e){return new Ei(t,e)},tube:function(t,e){return new Pi(t,e)},blank:(t,e)=>null};window.threeBrain_GEOMETRY_FACTORY=Bi;const zi=new yi.E;window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){setTimeout((function(){t(Date.now())}),1e3/60)};class ji{constructor(t,e,i,r=250,s=!1,a=!1,o=!1,l=!0){o?(console.debug("Debug Mode: ON."),this.DEBUG=!0):this.DEBUG=!1,!0===a?(this.use_cache=!0,this.cache=zi):!1===a?this.use_cache=!1:(this.use_cache=!0,this.cache=a),this.el=t,this.container_id=this.el.getAttribute("data-target"),this.has_webgl2=l,this.side_width=r,this._side_width=r,this.shiny_mode=s,this.mesh=new Map,this.threebrain_instances=new Map,this.subject_codes=[],this.electrodes=new Map,this.volumes=new Map,this.ct_scan=new Map,this.atlases=new Map,this._show_ct=!1,this.surfaces=new Map,this.state_data=new Map,this._disposed=!1,this._dispose_functions=new Map,this.state_data.set("coronal_depth",0),this.state_data.set("axial_depth",0),this.state_data.set("sagittal_depth",0),this.shared_data=new Map,this.group=new Map,this.clickable=new Map,this.clickable_array=[],this._mouse_click_callbacks={},this._keyboard_callbacks={},this.render_flag=0,this.disable_raycast=!0,this.render_legend=!1,this.color_type="continuous",this.animation_controls={},this.animation_clips=new Map,this.color_maps=new Map,this.clock=new vi.J.Clock,this.pixel_ratio=[window.devicePixelRatio,window.devicePixelRatio],this.domElement=document.createElement("canvas"),this.domContextWrapper=new gi(this.domElement,this.pixel_ratio[0]),this.domContext=this.domContextWrapper.context,this.background_color="#ffffff",this.foreground_color="#000000",this.domContext.fillStyle=this.background_color,this.scene=new vi.J.Scene,this.origin=new vi.J.Object3D,this.origin.position.copy(wi.t.VEC_ORIGIN),this.scene.add(this.origin),this.main_camera=new vi.J.OrthographicCamera(-150,150,i/e*150,-i/e*150,1,1e4),this.main_camera.position.x=500,this.main_camera.userData.pos=[500,0,0],this.main_camera.up.set(0,0,1),this.main_camera.layers.set(wi.t.LAYER_USER_MAIN_CAMERA_0),this.main_camera.layers.enable(wi.t.LAYER_USER_ALL_CAMERA_1),this.main_camera.layers.enable(2),this.main_camera.layers.enable(3),this.main_camera.layers.enable(wi.t.LAYER_SYS_ALL_CAMERAS_7),this.main_camera.layers.enable(wi.t.LAYER_SYS_MAIN_CAMERA_8),this.main_camera.lookAt(wi.t.VEC_ORIGIN);const c=new vi.J.DirectionalLight(wi.t.COLOR_MAIN_LIGHT,.5);c.position.copy(wi.t.VEC_ANAT_I),c.layers.set(wi.t.LAYER_SYS_MAIN_CAMERA_8),c.name="main light - directional",this.main_camera.add(c),this.add_to_scene(this.main_camera,!0);const h=new vi.J.AmbientLight(wi.t.COLOR_AMBIENT_LIGHT,1);if(h.layers.set(wi.t.LAYER_SYS_ALL_CAMERAS_7),h.name="main light - ambient",this.add_to_scene(h,!0),this.has_webgl2){let t=document.createElement("canvas"),e=t.getContext("webgl2");this.main_renderer=new vi.J.WebGLRenderer({antialias:!1,alpha:!0,canvas:t,context:e})}else this.main_renderer=new vi.J.WebGLRenderer({antialias:!1,alpha:!0});if(this.main_renderer.setPixelRatio(this.pixel_ratio[0]),this.main_renderer.setSize(e,i),this.main_renderer.autoClear=!1,this.main_renderer.localClippingEnabled=!0,this.main_renderer.setClearColor(this.background_color),this.has_webgl2){let t=document.createElement("canvas"),e=t.getContext("webgl2");this.side_renderer=new vi.J.WebGLRenderer({antialias:!1,alpha:!0,canvas:t,context:e,depths:!1})}else this.side_renderer=new vi.J.WebGLRenderer({antialias:!1,alpha:!0});this.side_renderer.setPixelRatio(this.pixel_ratio[1]),this.side_renderer.autoClear=!1;let u=Math.floor(Math.max(e/3,i)/this.pixel_ratio[1]/2);u<256&&(u=256),u>512&&(u=512),this.side_renderer._render_height=u,this.side_renderer.setSize(3*u,u),this.main_canvas=document.createElement("div"),this.main_canvas.className="THREEBRAIN-MAIN-CANVAS",this.main_canvas.style.width=e+"px",this.register_main_canvas_events(),this.main_canvas.appendChild(this.domElement);let d=document.createElement("div");this.wrapper_canvas=d,this.main_canvas.style.display="inline-flex",this.wrapper_canvas.style.display="flex",this.wrapper_canvas.style.flexWrap="wrap",this.wrapper_canvas.style.width="100%",this.has_side_cameras=!1,this.side_canvas={},["coronal","axial","sagittal"].forEach((t,e)=>{const i=document.createElement("div");i.id=this.container_id+"__"+t,i.style.display="none",i.className="THREEBRAIN-SIDE resizable",i.style.zIndex=e,i.style.top=e*this.side_width+"px";const r=document.createElement("div");r.innerText=t.toUpperCase(),r.className="THREEBRAIN-SIDE-HEADER",r.id=i.id+"header",i.appendChild(r);const s=document.createElement("canvas");s.width=this.side_renderer._render_height*this.pixel_ratio[1],s.height=this.side_renderer._render_height*this.pixel_ratio[1],s.style.width="100%",s.style.height="100%",s.style.position="absolute",i.appendChild(s);let a=1;const o=e=>{e?a=e:e=a,s.style.width=parseInt(100*e)+"%",s.style.height=parseInt(100*e)+"%";const r=(0,n.nq)(s),o=(0,n.nq)(i),l=[this.state_data.get("sagittal_depth"),this.state_data.get("coronal_depth"),this.state_data.get("axial_depth")];let c=0,h=0;"coronal"===t?(c=Math.max(Math.min(o[0]/2-(128+l[0])/256*r[0],0),o[0]-r[0]),h=Math.max(Math.min(o[1]/2-(128-l[2])/256*r[1],0),o[1]-r[1])):"axial"===t?(c=Math.max(Math.min(o[0]/2-(128+l[0])/256*r[0],0),o[0]-r[0]),h=Math.max(Math.min(o[1]/2-(128-l[1])/256*r[1],0),o[1]-r[1])):"sagittal"===t&&(c=Math.max(Math.min(o[0]/2-(128-l[1])/256*r[0],0),o[0]-r[0]),h=Math.max(Math.min(o[1]/2-(128-l[2])/256*r[1],0),o[1]-r[1])),s.style.left=c+"px",s.style.top=h+"px"},l=document.createElement("div");l.className="zoom-tool",l.style.top="23px",l.innerText="+",i.appendChild(l),this.bind(t+"_zoomin_click","click",t=>{a*=1.2,a=a>10?10:a,o()},l);const c=document.createElement("div");c.className="zoom-tool",c.style.top="50px",c.innerText="-",i.appendChild(c),this.bind(t+"_zoomout_click","click",t=>{a/=1.2,a=a<1.1?1:a,o()},c);const h=document.createElement("div");h.className="zoom-tool",h.style.top="77px",h.innerText="P",i.appendChild(h),this.bind(t+"_toggle_pan_click","click",t=>{h.classList.toggle("pan-active"),g(h.classList.contains("pan-active")?"pan":"select")},h);const u=document.createElement("div");u.className="zoom-tool",u.style.top="104px",u.innerText="0",i.appendChild(u),this.bind(t+"_zoom_reset_click","click",t=>{s.style.top="0",s.style.left="0",o(1)},u);const d=new vi.J.OrthographicCamera(-150,150,150,-150,1,1e4),p=new vi.J.DirectionalLight(15724527,.5);0===e?(d.position.fromArray([0,-500,0]),d.up.set(0,0,1),d.layers.enable(wi.t.LAYER_SYS_CORONAL_9),p.position.fromArray([0,1,0]),p.layers.set(wi.t.LAYER_SYS_CORONAL_9)):1===e?(d.position.fromArray([0,0,500]),d.up.set(0,1,0),d.layers.enable(wi.t.LAYER_SYS_AXIAL_10),p.position.fromArray([0,0,-1]),p.layers.set(wi.t.LAYER_SYS_AXIAL_10)):(d.position.fromArray([-500,0,0]),d.up.set(0,0,1),d.layers.enable(wi.t.LAYER_SYS_SAGITTAL_11),p.position.fromArray([1,0,0]),p.layers.set(wi.t.LAYER_SYS_SAGITTAL_11)),d.lookAt(new vi.J.Vector3(0,0,0)),d.aspect=1,d.updateProjectionMatrix(),[1,4,5,6,7,13].forEach(t=>{d.layers.enable(t)}),d.add(p),this.add_to_scene(d,!0);let f=[document.createElement("div"),document.createElement("div")];f[0].className="resizers",f[1].className="resizer bottom-right",f[0].appendChild(f[1]),i.appendChild(f[0]),this.wrapper_canvas.appendChild(i);const m=(e,i)=>{if(this.has_side_cameras){let e=[[parseInt(this.side_canvas.coronal.container.style.zIndex),"coronal"],[parseInt(this.side_canvas.axial.container.style.zIndex),"axial"],[parseInt(this.side_canvas.sagittal.container.style.zIndex),"sagittal"]];e.sort((t,e)=>t[0]-e[0]),e.forEach((t,e)=>{this.side_canvas[t[1]].container.style.zIndex=e}),this.side_canvas[t].container.style.zIndex=4}};xi(i,r,void 0,m);const g=xi(s,void 0,i,(e,i)=>{if(m(),"select"===i.state||"move"===i.state){const r=(0,n.nq)(s),a=i.x/r[0]*256-128,o=i.y/r[1]*256-128;console.log(`x: ${a}, y: ${a} of [${r[0]}, ${r[1]}]`),"coronal"===t?(this.state_data.set("sagittal_depth",a),this.state_data.set("axial_depth",-o)):"axial"===t?(this.state_data.set("sagittal_depth",a),this.state_data.set("coronal_depth",-o)):"sagittal"===t&&(this.state_data.set("coronal_depth",-a),this.state_data.set("axial_depth",-o));const l=new vi.J.Vector3(this.state_data.get("sagittal_depth"),this.state_data.get("coronal_depth"),this.state_data.get("axial_depth")).normalize().multiplyScalar(500);if(0===l.length()&&(l.x=500),e.shiftKey){const t=new vi.J.Vector3(0,0,1);let e=this.main_camera.position.clone().cross(t).cross(l).normalize();e.length()<.5&&(e.y=1),e.dot(t)<0&&e.multiplyScalar(-1),this.main_camera.position.copy(l),this.main_camera.up.copy(e)}this.set_side_depth(this.state_data.get("coronal_depth"),this.state_data.get("axial_depth"),this.state_data.get("sagittal_depth"))}});g("select"),this.bind(t+"_cvs_mousewheel","mousewheel",e=>{e.preventDefault(),e.altKey&&(e.deltaY>0?this.state_data.set(t+"_depth",1+this.state_data.get(t+"_depth")):e.deltaY<0&&this.state_data.set(t+"_depth",-1+this.state_data.get(t+"_depth"))),this.set_side_depth(this.state_data.get("coronal_depth"),this.state_data.get("axial_depth"),this.state_data.get("sagittal_depth"))},s),function(t,e=!1,i=((t,e)=>{}),n=((t,e)=>{})){const r=t,s=t.querySelectorAll(".resizable .resizer");let a=0,o=0,l=-1,c=0,h=0,u=0,d=0,p=0,f=0;for(let t=0;t<s.length;t++){let m=s[t],g=t=>{p=a+(t.pageX-u),f=o+(t.pageY-d),e&&(a>o?p=f/l:f=p*l),p=p>20?p:20,f=e?f>20*l?f:20*l:f>20?f:20,r.style.width=p+"px",r.style.height=f+"px",m.classList.contains("bottom-right")||(m.classList.contains("bottom-left")?r.style.left=c+(t.pageX-u)+"px":(m.classList.contains("top-right")||(r.style.left=c+(t.pageX-u)+"px"),r.style.top=h+(t.pageY-d)+"px")),i(p,f)},_=()=>{window.removeEventListener("mousemove",g),n(p,f)};m.addEventListener("mousedown",t=>{t.preventDefault(),a=parseFloat(getComputedStyle(r,null).getPropertyValue("width").replace("px","")),o=parseFloat(getComputedStyle(r,null).getPropertyValue("height").replace("px","")),p=a,f=o,l<=0&&(l=o/a),c=r.getBoundingClientRect().left,h=r.getBoundingClientRect().top,u=t.pageX,d=t.pageY,window.addEventListener("mousemove",g),window.addEventListener("mouseup",_)})}}(i,!0);const _=t=>{i.style.top=e*this.side_width+"px",i.style.left="0",i.style.width=this.side_width+"px",i.style.height=this.side_width+"px",void 0!==t&&o(t||1)};this.bind(t+"_div_header_dblclick","dblclick",t=>{_()},r),this.side_canvas[t]={container:i,canvas:s,context:s.getContext("2d"),camera:d,reset:_,get_zoom_level:()=>a,set_zoom_level:o}}),this.wrapper_canvas.appendChild(this.main_canvas),this.el.appendChild(this.wrapper_canvas),this.has_stats=!1,this.controls=new vi.J.OrthographicTrackballControls(this.main_camera,this.main_canvas),this.controls.zoomSpeed=.02,this.controls.noPan=!1,this.controls.dynamicDampingFactor=.5,this.control_center=[0,0,0],this.bind("controls_start","start",t=>{this.render_flag<0&&this.handle_resize(void 0,void 0,!0),this.start_animation(1)},this.controls),this.bind("controls_end","end",t=>{this.pause_animation(1)},this.controls),this.compass=new Ii(this.main_camera,this.controls),this.compass.set_visibility(!1),this.add_to_scene(this.compass.container,!0);const p=new vi.J.Vector2,f=new vi.J.Raycaster,m=new vi.J.ArrowHelper(new vi.J.Vector3(0,0,1),new vi.J.Vector3(0,0,0),50,16711680,2),g=new vi.J.Mesh(new vi.J.BoxBufferGeometry(4,4,4),new vi.J.MeshBasicMaterial({color:16711680}));g.layers.set(wi.t.LAYER_SYS_ALL_SIDE_CAMERAS_13),m.children.forEach(t=>{t.layers.set(wi.t.LAYER_SYS_ALL_SIDE_CAMERAS_13)}),g.renderOrder=wi.t.MAX_RENDER_ORDER,g.material.depthTest=!1,m.add(g),this.mouse_helper=m,this.mouse_raycaster=f,this.mouse_pointer=p,this.add_to_scene(m,!0),this.focus_box=new vi.J.BoxHelper,this.focus_box.material.color.setRGB(1,0,0),this.focus_box.userData.added=!1,this.bounding_box=new vi.J.BoxHelper,this.bounding_box.material.color.setRGB(0,0,1),this.bounding_box.userData.added=!1,this.bounding_box.layers.set(wi.t.LAYER_INVISIBLE_31),this.set_font_size(),this.loader_triggered=!1,this.loader_manager=new vi.J.LoadingManager,this.loader_manager.onStart=()=>{this.loader_triggered=!0,console.debug("Loading start!")},this.loader_manager.onLoad=()=>{console.debug("Loading complete!"),this.start_animation(0)},this.loader_manager.onProgress=(t,e,i)=>{console.debug("Loading file: "+t+".\nLoaded "+e+" of "+i+" files.")},this.loader_manager.onError=function(t){console.debug("There was an error loading "+t)},this.json_loader=new vi.J.FileLoader(this.loader_manager),this.font_loader=new vi.J.FontLoader(this.loader_manager)}finish_init(){this.dispatch_event("canvas_finish_init")}dispatch_event(t,e){let i=new CustomEvent(t,{container_id:this.container_id,detail:e});this.el.dispatchEvent(i)}add_to_scene(t,e=!1){e?this.scene.add(t):this.origin.add(t)}set_font_size(t=1){this._lineHeight_normal=Math.round(24*this.pixel_ratio[0]*t),this._lineHeight_small=Math.round(20*this.pixel_ratio[0]*t),this._fontSize_normal=Math.round(20*this.pixel_ratio[0]*t),this._fontSize_small=Math.round(16*this.pixel_ratio[0]*t),this._lineHeight_legend=Math.round(20*this.pixel_ratio[0]*t),this._fontSize_legend=Math.round(16*this.pixel_ratio[0]*t)}bind(t,e,i,n,r=!1){const s=n||this.main_canvas,a=this._dispose_functions.get(t);"function"==typeof a&&a(),this._dispose_functions.set(t,()=>{console.debug("Calling dispose function "+t);try{s.removeEventListener(e,i)}catch(e){console.warn("Unable to dispose "+t)}}),console.debug(`Registering event ${e} (${t})`),s.addEventListener(e,i,r)}dispose_eventlisters(){this._dispose_functions.forEach(t=>{t()}),this._dispose_functions.clear()}get_main_camera_params(){return{target:this.main_camera.localToWorld(new vi.J.Vector3(-this.main_camera.userData.pos[0],-this.main_camera.userData.pos[1],-this.main_camera.userData.pos[2])),up:this.main_camera.up,position:this.main_camera.position}}draw_axis(t,e,i){if(!this._coordinates){this._coordinates={};const n=new vi.J.Vector3(0,0,0);this._coordinates.x=new vi.J.ArrowHelper(new vi.J.Vector3(1,0,0),n,0===t?1:t,16711680),this._coordinates.y=new vi.J.ArrowHelper(new vi.J.Vector3(0,1,0),n,0===e?1:e,65280),this._coordinates.z=new vi.J.ArrowHelper(new vi.J.Vector3(0,0,1),n,0===i?1:i,255),this._coordinates.x.layers.set(wi.t.LAYER_SYS_ALL_CAMERAS_7),this._coordinates.y.layers.set(wi.t.LAYER_SYS_ALL_CAMERAS_7),this._coordinates.z.layers.set(wi.t.LAYER_SYS_ALL_CAMERAS_7),this.add_to_scene(this._coordinates.x),this.add_to_scene(this._coordinates.y),this.add_to_scene(this._coordinates.z)}this._coordinates.x.visible=0!==t,this._coordinates.y.visible=0!==e,this._coordinates.z.visible=0!==i}register_main_canvas_events(){this.bind("main_canvas_mouseenter","mouseenter",t=>{this.listen_keyboard=!0},this.main_canvas),this.bind("main_canvas_mouseleave","mouseleave",t=>{this.listen_keyboard=!1},this.main_canvas),this.bind("main_canvas_dblclick","dblclick",t=>{if(void 0!==this.mouse_event&&this.mouse_event.level>2)return null;this.mouse_event={action:"dblclick",event:t,dispose:!1,level:2}},this.main_canvas,!1),this.bind("main_canvas_click","click",t=>{if(void 0!==this.mouse_event&&this.mouse_event.level>1)return null;this.mouse_event={action:"click",button:t.button,event:t,dispose:!1,level:1}},this.main_canvas,!1),this.bind("main_canvas_contextmenu","contextmenu",t=>{if(void 0!==this.mouse_event&&this.mouse_event.level>1)return null;this.mouse_event={action:"contextmenu",button:t.button,event:t,dispose:!1,level:1}},this.main_canvas,!1),this.bind("main_canvas_mousemove","mousemove",t=>{if(void 0!==this.mouse_event&&this.mouse_event.level>0)return null;this.mouse_event={action:"mousemove",event:t,dispose:!1,level:0}},this.main_canvas,!1),this.bind("main_canvas_mousedown","mousedown",t=>{this.mouse_event={action:"mousedown",event:t,dispose:!1,level:3}},this.main_canvas,!1),this.bind("main_canvas_mouseup","mouseup",t=>{this.mouse_event={action:"mouseup",event:t,dispose:!0,level:0}},this.main_canvas,!1),this.bind("main_canvas_keydown","keydown",t=>{t.isComposing||229===t.keyCode||this.listen_keyboard&&(this.keyboard_event={action:"keydown",event:t,dispose:!1,level:0})},document),this.add_mouse_callback(t=>({pass:!this.edit_mode&&(["click","dblclick"].includes(t.action)||"mousedown"===t.action&&2===t.event.button),type:"clickable"}),(t,e)=>{this.focus_object(t.target_object);try{document.activeElement.blur()}catch(t){}this.start_animation(0)},"set_obj_chosen"),this.add_mouse_callback(t=>({pass:["click","dblclick"].includes(t.action)||"mousedown"===t.action&&2===t.event.button,type:"clickable"}),(t,e)=>{const i=t.first_item;if(i){const e=t.target_object,r=i.point,s=i.face.normal.normalize();s.transformDirection(e.matrixWorld),this.mouse_raycaster.ray.direction.dot(s)>0&&s.applyMatrix3((new vi.J.Matrix3).set(-1,0,0,0,-1,0,0,0,-1)),this.mouse_helper.position.fromArray((0,n.AA)(r)),this.mouse_helper.setDirection(s),this.mouse_helper.visible=!0}else this.mouse_helper.visible=!1;this.start_animation(0)},"raycaster"),this.add_keyboard_callabck(wi.t.KEY_ZOOM,t=>{t.event.shiftKey?this.main_camera.zoom=1.2*this.main_camera.zoom:this.main_camera.zoom=this.main_camera.zoom/1.2,this.main_camera.updateProjectionMatrix(),this.start_animation(0)},"zoom"),this.add_keyboard_callabck(wi.t.KEY_CYCLE_ELECTRODES_NEXT,t=>{let e=this.object_chosen||this._last_object_chosen,i=!1,n=!1,r=!1;this.start_animation(0);for(let t of this.mesh.keys())if(n=this.mesh.get(t),n.visible&&n.isMesh&&n.userData.construct_params.is_electrode){if(!e)return this.focus_object(n,!0),null;if(i&&i.name===e.name)return this.focus_object(n,!0),null;i=n,r||(r=n)}if(!1!==i)return i.name===e.name&&(i=r),this.focus_object(i,!0),null},"electrode_cycling_next"),this.add_keyboard_callabck(wi.t.KEY_CYCLE_ELECTRODES_PREV,t=>{let e=this.object_chosen||this._last_object_chosen,i=!1,n=!1;this.start_animation(0);for(let t of this.mesh.keys())if(n=this.mesh.get(t),n.visible&&n.isMesh&&n.userData.construct_params.is_electrode){if(e&&i&&e.name==n.name)return this.focus_object(i,!0),null;i=n}i&&this.focus_object(i,!0)},"electrode_cycling_prev"),this.DEBUG&&this.add_mouse_callback(t=>({pass:"mousemove"!==t.action,type:"clickable"}),(t,e)=>{console.log(e),console.debug(t.items.length+" items found by raycaster.")},"debug")}focus_object(t,e=!1,i=!1){t?(this.object_chosen&&this.highlight(this.object_chosen,!0),this.object_chosen=t,this._last_object_chosen=t,this.highlight(this.object_chosen,!1),console.debug("object selected "+t.name),e&&(t.getWorldPosition(this.mouse_helper.position),this.mouse_helper.visible=!0)):i&&this.object_chosen&&(this.highlight(this.object_chosen,!0),this.object_chosen=void 0)}highlight(t,e=!1){const i=(0,n.jM)(this.state_data,"highlight_disabled",!1);if(!t||!t.isObject3D)return null;this.focus_box.setFromObject(t),this.focus_box.userData.added||(this.focus_box.userData.added=!0,this.add_to_scene(this.focus_box,!0)),this.focus_box.visible=!e&&!i,t.children.length>0&&t.children.forEach(t=>{t.isMesh&&t.userData.is_highlight_helper&&(t.visible=!e)})}get_mouse(){if(void 0!==this.mouse_event&&!this.mouse_event.dispose){let t=this.mouse_event.event;this.mouse_pointer.x=t.offsetX/this.main_canvas.clientWidth*2-1,this.mouse_pointer.y=-t.offsetY/this.main_canvas.clientHeight*2+1}}_add_stats(){this.has_stats||(this.has_stats=!0,this.stats=new _i,this.stats.domElement.style.display="block",this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0",this.stats.domElement.style.left="0",this.el.appendChild(this.stats.domElement))}_fast_raycast(t){let e;return this.mouse_raycaster.setFromCamera(this.mouse_pointer,this.main_camera),this.mouse_raycaster.layers.disableAll(),void 0===t||!0===t||"clickable"===t?(this.mouse_raycaster.layers.enable(wi.t.LAYER_SYS_RAYCASTER_14),e=this.mouse_raycaster.intersectObjects(this.clickable_array.filter(t=>!0===t.visible))):(t.isObject3D||Array.isArray(t))&&(this.mouse_raycaster.layers.enable(wi.t.LAYER_SYS_MAIN_CAMERA_8),e=this.mouse_raycaster.intersectObjects((0,n.AA)(t),!0)),this.DEBUG&&(this._items=e),e}add_mouse_callback(t,e,i){this._mouse_click_callbacks[i]=[t,e]}add_keyboard_callabck(t,e,i){this._keyboard_callbacks[i]=[t,e]}keyboard_update(){if(!this.keyboard_event||this.keyboard_event.dispose)return null;this.keyboard_event.dispose=!0,this.keyboard_event.level<=2&&(this.keyboard_event.level=0);for(let t in this._keyboard_callbacks)this._keyboard_callbacks[t]&&this.keyboard_event.event.code===this._keyboard_callbacks[t][0]&&this._keyboard_callbacks[t][1](this.keyboard_event)}mouse_update(){if(!this.mouse_event||this.mouse_event.dispose)return null;let t,e,i,n;this.mouse_event.dispose=!0,this.mouse_event.level<=2&&(this.mouse_event.level=0);for(let r in this._mouse_click_callbacks)if(i=this._mouse_click_callbacks[r],void 0!==i&&(n=i[0](this.mouse_event),n&&n.pass)){if(e=n.type||"clickable",(void 0===t||t!==t.type&&"clickable"!==e)&&(t={type:e,items:this._fast_raycast(e),meta:n.meta}),t.items.length>0){const e=t.items[0],i=e.object;t.first_item=e,t.target_object=i}i[1](t,this.mouse_event)}}add_colormap(t,e,i,r,s,a,o,l,c,h){const u=t+"--"+this.container_id;void 0===vi.J.ColorMapKeywords[u]?vi.J.ColorMapKeywords[u]=[]:vi.J.ColorMapKeywords[u].length=0;const d=Math.max(2,(0,n.AA)(o).length);for(let t=0;t<d;t++)vi.J.ColorMapKeywords[u].push([t/(d-1),l[t]]);const p=new vi.J.Lut(u,d);let f;"continuous"===i?(p.setMin(s[0]),s[1]===s[0]?p.setMax(s[0]+1):p.setMax(s[1])):(p.setMin(0),p.setMax(Math.max(c-1,1))),Array.isArray(h)&&2==h.length&&(f=[h[0],h[1]]);let m=e;"string"==typeof m&&""!==m||(m=t),this.color_maps.set(t,{lut:p,name:t,alias:m,value_type:i,value_names:(0,n.AA)(r),time_range:a,n_levels:c,value_range:[p.minV,p.maxV],theoretical_range:f})}switch_colormap(t,e=[]){let i;if(t?(this.state_data.set("color_map",t),i=this.color_maps.get(t),i?(this.state_data.set("time_range_min",i.time_range[0]),this.state_data.set("time_range_max",i.time_range[1])):(this.state_data.set("time_range_min",0),this.state_data.set("time_range_max",1))):(t=(0,n.jM)(this.state_data,"color_map",""),i=this.color_maps.get(t)),i&&2===e.length&&e[0]<e[1]&&"continuous"===i.value_type){const t=i.theoretical_range;let n=e[0],r=e[1];Array.isArray(t)&&2==t.length&&(n<t[0]&&(n=t[0],r<n&&(r=n+1e-100)),r>t[1]&&(r=t[1],r<n&&(n=r-1e-100))),i.lut.setMax(r),i.lut.setMin(n),this.start_animation(0)}return this.update_time_range(),i&&(i.time_range[0]=this.__min_t,i.time_range[1]=this.__max_t),i}get_color(t,e){let i;return i=e?this.color_maps.get(e):this.color_maps.get((0,n.jM)(this.state_data,"color_map","")),void 0===i?"#e2e2e2":i.lut.getColor(t)}handle_resize(t,e,i=!1,n=!1){if(this._disposed)return;if(void 0===t?(t=this.client_width,e=this.client_height):(this.client_width=t,this.client_height=e),i)return this.controls.handleResize(),void this.start_animation(0);var r=t,s=e;if(n)this.main_camera.left=-150,this.main_camera.right=150,this.main_camera.top=s/r*150,this.main_camera.bottom=-s/r*150;else{let t=s/r*(this.main_camera.right-this.main_camera.left)/(this.main_camera.top-this.main_camera.bottom);this.main_camera.top=this.main_camera.top*t||s/r*150,this.main_camera.bottom=this.main_camera.bottom*t||-s/r*150}this.main_camera.updateProjectionMatrix(),this.has_side_cameras,this.main_canvas.style.width=r+"px",this.main_canvas.style.height=s+"px",this.main_renderer.setSize(r,s);const a=this.pixel_ratio[0];this.domElement.width!=r*a&&(this.domElement.width=r*a,this.domElement.style.width=r+"px"),this.domElement.height!=s*a&&(this.domElement.height=s*a,this.domElement.style.height=s+"px"),this.controls.handleResize(),this.start_animation(0)}update_control_center(t){t=(0,n.AA)(t),this.controls.target.fromArray(t),this.control_center=(0,n.AA)(t)}reset_main_camera(t,e=1){Array.isArray(t)&&3===t.length&&(this.main_camera.userData.pos=t,this.main_camera.position.set(t[0],t[1],t[2])),void 0!==e&&(this.main_camera.zoom=e),this.main_camera.updateProjectionMatrix()}reset_side_canvas(t,e,i){let r=e;if(r||(r=this._side_width),3*r>this.client_height&&(r=Math.floor(this.client_height/3)),this.side_width=r,this.side_canvas.coronal.reset(t),this.side_canvas.axial.reset(t),this.side_canvas.sagittal.reset(t),2==(i=(0,n.AA)(i)).length){const t=this.el.getBoundingClientRect();i[0]=Math.max(i[0],-t.x),i[1]=Math.max(i[1],-t.y),this.side_canvas.coronal.container.style.top=i[1]+"px",this.side_canvas.axial.container.style.top=i[1]+r+"px",this.side_canvas.sagittal.container.style.top=i[1]+2*r+"px",this.side_canvas.coronal.container.style.left=i[0]+"px",this.side_canvas.axial.container.style.left=i[0]+"px",this.side_canvas.sagittal.container.style.left=i[0]+"px"}this.handle_resize(void 0,void 0)}reset_side_cameras(t,e=300,i=500){t?this._side_canvas_position=t:t=this._side_canvas_position||wi.t.VEC_ORIGIN,this.side_canvas.coronal.camera.position.x=t.x,this.side_canvas.coronal.camera.position.z=t.z,this.side_canvas.coronal.camera.position.y=-i,this.side_canvas.coronal.camera.lookAt(t.x,t.y,t.z),this.side_canvas.coronal.camera.top=e/2,this.side_canvas.coronal.camera.bottom=-e/2,this.side_canvas.coronal.camera.right=e/2,this.side_canvas.coronal.camera.left=-e/2,this.side_canvas.axial.camera.position.x=t.x,this.side_canvas.axial.camera.position.y=t.y,this.side_canvas.axial.camera.position.z=i,this.side_canvas.axial.camera.lookAt(t.x,t.y,t.z),this.side_canvas.axial.camera.top=e/2,this.side_canvas.axial.camera.bottom=-e/2,this.side_canvas.axial.camera.right=e/2,this.side_canvas.axial.camera.left=-e/2,this.side_canvas.sagittal.camera.position.y=t.y,this.side_canvas.sagittal.camera.position.z=t.z,this.side_canvas.sagittal.camera.position.x=-i,this.side_canvas.sagittal.camera.lookAt(t.x,t.y,t.z),this.side_canvas.sagittal.camera.top=e/2,this.side_canvas.sagittal.camera.bottom=-e/2,this.side_canvas.sagittal.camera.right=e/2,this.side_canvas.sagittal.camera.left=-e/2,this.side_canvas.coronal.camera.updateProjectionMatrix(),this.side_canvas.axial.camera.updateProjectionMatrix(),this.side_canvas.sagittal.camera.updateProjectionMatrix(),this.start_animation(0)}reset_controls(){this.controls.reset(),this.controls.target.fromArray(this.control_center);const t=this.main_camera.userData.pos;this.main_camera.position.set(t[0],t[1],t[2]),0===t[2]?this.main_camera.up.set(0,0,1):this.main_camera.up.set(0,1,0),this.main_camera.zoom=1,this.main_camera.updateProjectionMatrix(),this.start_animation(0)}update(){this.get_mouse(),this.controls.update(),this.compass.update();try{this.keyboard_update(),this.mouse_update()}catch(t){this.DEBUG&&console.error(t)}}mapToPDF(){const t=this.inc_time(),e=this.domElement.width,i=this.domElement.height,n=new mi(this.domElement);return n.set_font_color(this.foreground_color),n.background_color=this.background_color,n.draw_image(this.main_renderer.domElement,0,0,e,i),this._draw_ani(t,0,0,e,i,n),this._draw_focused_info(t,0,0,e,i,n,!0),this._draw_legend(t,0,0,e,i,n),n.context}mapToCanvas(){const t=this.domElement.width,e=this.domElement.height;if(this.domContext.fillStyle=this.background_color,this.domContext.fillRect(0,0,t,e),this.domContext.drawImage(this.main_renderer.domElement,0,0,t,e),this.has_side_cameras){const t=this.side_renderer._render_height*this.pixel_ratio[1];this.side_canvas.coronal.context.fillStyle=this.background_color,this.side_canvas.coronal.context.fillRect(0,0,t,t),this.side_canvas.coronal.context.drawImage(this.side_renderer.domElement,0,0,t,t,0,0,t,t),this.side_canvas.axial.context.fillStyle=this.background_color,this.side_canvas.axial.context.fillRect(0,0,t,t),this.side_canvas.axial.context.drawImage(this.side_renderer.domElement,t,0,t,t,0,0,t,t),this.side_canvas.sagittal.context.fillStyle=this.background_color,this.side_canvas.sagittal.context.fillRect(0,0,t,t),this.side_canvas.sagittal.context.drawImage(this.side_renderer.domElement,2*t,0,t,t,0,0,t,t)}}render(t){if(t||(t={current_time:0,current_time_delta:0,elapsed_time:(this.clock.oldTime-this.clock.startTime)/1e3}),this.main_renderer.clear(),this.mesh.forEach(e=>{if("function"==typeof e.userData.pre_render)try{e.userData.pre_render(t)}catch(e){this.__render_error||(console.warn(e),console.log(t),this.__render_error=!0)}}),this.main_renderer.render(this.scene,this.main_camera),this.has_side_cameras){this.side_plane_sendback(!0);const t=this.side_renderer._render_height;this.side_renderer.setViewport(0,0,t,t),this.side_renderer.setScissor(0,0,t,t),this.side_renderer.setScissorTest(!0),this.side_renderer.clear(),this.side_renderer.render(this.scene,this.side_canvas.coronal.camera),this.side_renderer.setViewport(t,0,t,t),this.side_renderer.setScissor(t,0,t,t),this.side_renderer.setScissorTest(!0),this.side_renderer.clear(),this.side_renderer.render(this.scene,this.side_canvas.axial.camera),this.side_renderer.setViewport(2*t,0,t,t),this.side_renderer.setScissor(2*t,0,t,t),this.side_renderer.setScissorTest(!0),this.side_renderer.clear(),this.side_renderer.render(this.scene,this.side_canvas.sagittal.camera),this.side_plane_sendback(!1)}}update_time_range(){let t=this.state_data.get("time_range_min0"),e=this.state_data.get("time_range_max0"),i=(0,n.jM)(this.state_data,"time_range_min",0),r=(0,n.jM)(this.state_data,"time_range_max",0);void 0!==t&&(i=Math.min(i,t)),void 0!==e&&(r=Math.max(r,e)),this.__min_t=i,this.__max_t=r}inc_time(){let t=this.clock.getDelta(),e={current_time_delta:0,elapsed_time:(this.clock.oldTime-this.clock.startTime)/1e3};const i=this.__min_t;if(e.time_range_min=i,void 0!==this.object_chosen&&this.object_chosen.userData&&(e.selected_object={name:this.object_chosen.userData.construct_params.name,position:this.object_chosen.getWorldPosition(new vi.J.Vector3),custom_info:this.object_chosen.userData.construct_params.custom_info,is_electrode:this.object_chosen.userData.construct_params.is_electrode||!1,MNI305_position:this.object_chosen.userData.MNI305_position,template_mapping:{mapped:this.object_chosen.userData._template_mapped||!1,shift:this.object_chosen.userData._template_shift||0,space:this.object_chosen.userData._template_space||"original",surface:this.object_chosen.userData._template_surface||"NA",hemisphere:this.object_chosen.userData._template_hemisphere||"NA",mni305:this.object_chosen.userData._template_mni305}}),"function"==typeof this.animation_controls.get_params){let n=this.animation_controls.get_params(),r=n.play,s=n.time,a=n.speed,o=n.min,l=n.max,c=r?s+t*a:s;e.current_time=c,c>l&&(c=o),e.current_time_delta=c-i,r&&this.animation_controls.set_time(c)}if(e.selected_object&&this.object_chosen.userData.ani_exists){const t=this.state_data.get("color_map"),i=this.object_chosen.userData.get_track_data(t);if(i){const t=(0,n.AA)(i.time),r=(0,n.AA)(i.value);let s=-1/0;for(let i in t)t[i]<=e.current_time&&t[i]>s&&(e.current_value=r[i],s=t[i])}}return e}start_animation(t=0){const e=this.render_flag;t>=e&&(this.render_flag=t),t>=2&&e<2&&this.clock.start()}pause_animation(t=1){const e=this.render_flag;e<=t&&(this.render_flag=-1,e>=2&&this.clock.stop())}_draw_title(t,e=10,i=10,n=100,r=100){this._fontType="Courier New, monospace",this._lineHeight_title=this._lineHeight_title||Math.round(25*this.pixel_ratio[0]),this._fontSize_title=this._fontSize_title||Math.round(20*this.pixel_ratio[0]),this.domContext.fillStyle=this.foreground_color,this.domContext.font=`${this._fontSize_title}px ${this._fontType}`;(this.title||t.title||"").split("\\n").forEach((t,n)=>{this.domContext.fillText(t,e,i+this._lineHeight_title*(n+1))})}_draw_ani_old(t,e=10,i=10,n=100,r=100){this._lineHeight_normal=this._lineHeight_normal||Math.round(25*this.pixel_ratio[0]),this._fontSize_normal=this._fontSize_normal||Math.round(15*this.pixel_ratio[0]),!1!==this.render_timestamp&&"number"==typeof t.current_time&&(this.domContext.font=`${this._fontSize_normal}px ${this._fontType}`,this.domContext.fillText(t.current_time.toFixed(3)+" s",n-8*this._fontSize_normal,r-1*this._lineHeight_normal))}_draw_ani(t,e=10,i=10,n=100,r=100,s){s||(s=this.domContextWrapper),this._lineHeight_normal=this._lineHeight_normal||Math.round(25*this.pixel_ratio[0]),this._fontSize_normal=this._fontSize_normal||Math.round(15*this.pixel_ratio[0]),s._lineHeight_normal=this._lineHeight_normal,s._fontSize_normal=this._fontSize_normal,!1!==this.render_timestamp&&"number"==typeof t.current_time&&(s.set_font(this._fontSize_normal,this._fontType),s.fill_text(t.current_time.toFixed(3)+" s",n-8*this._fontSize_normal,r-2*this._lineHeight_normal))}_draw_legend(t,e=10,i=10,r=100,s=100,a){const o=this.switch_colormap(),l=this.state_data.get("info_text_disabled"),c=this.render_legend&&o&&void 0!==o.lut.n;if(!c)return null;a||(a=this.domContextWrapper);const h=o.lut,u=o.value_type,d=o.value_names,p=o.alias||"",f=(0,n.AA)(o.value_range);this._lineHeight_legend=this._lineHeight_legend||Math.round(15*this.pixel_ratio[0]),this._fontSize_legend=this._fontSize_legend||Math.round(10*this.pixel_ratio[0]);let m=25*this.pixel_ratio[0],g=7*this._fontSize_legend+m,_=Math.ceil(p.length*this._fontSize_legend*.42-m/2+g);const v=c&&"continuous"===u&&h.n>1,y=c&&"discrete"===u&&h.n>0&&Array.isArray(d);let b=.5;if(v){const e=this.domContext.createLinearGradient(0,0,0,s);let i=b/(h.n-1);e.addColorStop(0,this.background_color),e.addColorStop(.3-4/s,this.background_color);for(let t in h.lut)e.addColorStop(.3+i*t,"#"+h.lut[h.n-1-t].getHexString());e.addColorStop(b+.3+4/s,this.background_color),a.fill_gradient(e,r-g,.3*s,m,b*s);let n=[],o=(.3+h.maxV*b/(h.maxV-h.minV))*s,c=(b+.3)*s,u=.3*s,d=Math.round(g-m),v=Math.round(r-d+this._fontSize_legend),y=Math.round(.21*this._fontSize_legend);if(a.set_font(this._fontSize_legend,this._fontType),a.set_font_color(this.foreground_color),a.fill_text(p,r-_,u-2*this._lineHeight_legend+y),2==f.length){let t=`${f[0].toPrecision(4)} ~ ${f[1].toPrecision(4)}`;t=t.replace(/\.[0]+\ ~/," ~").replace(/\.[0]+$/,"").replace(/\.[0]+e/,"e"),a.fill_text(`[${t}]`,r-Math.ceil(1.2*g),c+2*this._lineHeight_legend+y)}let x=h.minV<0&&h.maxV>0;if(l||"number"!=typeof t.current_value)n.push([h.minV.toPrecision(4),c,0]),n.push([h.maxV.toPrecision(4),u,0]);else{let e=(.3+(h.maxV-t.current_value)*b/(h.maxV-h.minV))*s;Math.abs(o-e)<=this._fontSize_legend&&(x=!1),Math.abs(e-c)>this._fontSize_legend&&n.push([h.minV.toPrecision(4),c,0]),e-c>this._lineHeight_legend&&(e=c+this._lineHeight_legend),Math.abs(e-u)>this._fontSize_legend&&n.push([h.maxV.toPrecision(4),u,0]),u-e>this._lineHeight_legend&&(e=u-this._lineHeight_legend),n.push([t.current_value.toPrecision(4),e,1])}x&&n.push(["0",o,0]),a.set_font(this._fontSize_legend,this._fontType),a.set_font_color(this.foreground_color),n.forEach(t=>{1===t[2]?(a.set_font(this._fontSize_legend,this._fontType,!0),a.fill_text(t[0],v,t[1]+y),a.set_font(this._fontSize_legend,this._fontType,!1)):a.fill_text(t[0],v,t[1]+y)}),a.start_draw_line(),n.forEach(t=>{0===t[2]?a.draw_line([[r-d,t[1]],[r-d+y,t[1]]]):1===t[2]&&a.draw_line([[r-d,t[1]],[r-d+y,t[1]-2],[r-d+y,t[1]+2],[r-d,t[1]]])}),a.stroke_line()}else if(y){const e=o.n_levels;let i=1;d.forEach(t=>{i<t.length&&(i=t.length)}),g=Math.ceil(.42*this._fontSize_legend*(i+7)+m),b=(e-1)*this._lineHeight_legend*2/s,b=b>.6?.6:b;let n=1==e?52:b/(e-1),c=Math.floor(n*s)-2;c=c>=50?50:Math.max(c,4);let u=Math.round(g-m),f=Math.round(r-u+this._fontSize_legend),v=Math.round(.21*this._fontSize_legend);a.set_font(this._fontSize_legend,this._fontType),a.set_font_color(this.foreground_color),a.fill_text(p,r-_,.3*s-50);for(let i=0;i<e;i++){let e=(.3+n*i)*s;a.fill_rect("#"+h.getColor(i).getHexString(),r-g,e-c/2,m,c),a.set_font_color(this.foreground_color),l||t.current_value!==d[i]?a.fill_text(d[i],f,e+v,r-f-1):(a.set_font(this._fontSize_legend,this._fontType,!0),a.fill_text(d[i],f,e+v,r-f-1),a.set_font(this._fontSize_legend,this._fontType,!1))}}}_draw_focused_info(t,e=10,i=10,n=100,r=100,s,a=!1){if(!t.selected_object||this.state_data.get("info_text_disabled"))return null;let o;s||(s=this.domContextWrapper),this._lineHeight_normal=this._lineHeight_normal||Math.round(25*this.pixel_ratio[0]),this._lineHeight_small=this._lineHeight_small||Math.round(15*this.pixel_ratio[0]),this._fontSize_normal=this._fontSize_normal||Math.round(15*this.pixel_ratio[0]),this._fontSize_small=this._fontSize_small||Math.round(10*this.pixel_ratio[0]),s.set_font_color(this.foreground_color),s.set_font(this._fontSize_normal,this._fontType),o=this.has_side_cameras&&!a?n-Math.ceil(50*this._fontSize_normal*.42):Math.ceil(.42*this._fontSize_normal*2);let l,c=[o,this._lineHeight_normal+this._lineHeight_small+10*this.pixel_ratio[0]];if(s.fill_text(t.selected_object.name,c[0],c[1]),s.set_font(this._fontSize_small,this._fontType),t.selected_object.is_electrode?(l=t.selected_object.MNI305_position,!l||0===l.x&&0===l.y&&0===l.z||(c[1]=c[1]+this._lineHeight_small,s.fill_text("MNI305: ",c[0],c[1]),s.set_font(this._fontSize_small,this._fontType,!0),s.fill_text(`${l.x.toFixed(0)},${l.y.toFixed(0)},${l.z.toFixed(0)}`,c[0]+5*this._fontSize_small,c[1]),s.set_font(this._fontSize_small,this._fontType,!1))):(l=t.selected_object.position,c[1]=c[1]+this._lineHeight_small,s.fill_text(`Global position: (${l.x.toFixed(2)},${l.y.toFixed(2)},${l.z.toFixed(2)})`,c[0],c[1])),t.selected_object.is_electrode){t.selected_object.template_mapping;const e=this.object_chosen.userData.display_info.threshold_name||"[None]";let i=this.object_chosen.userData.display_info.threshold_value;"number"==typeof i&&(i=i.toPrecision(4));const n=this.object_chosen.userData.display_info.display_name;let r=t.current_value;"number"==typeof r&&(r=r.toPrecision(4)),void 0!==r&&(c[1]=c[1]+this._lineHeight_small,s.fill_text(`Display:   ${n} (${r})`,c[0],c[1])),void 0!==i&&(c[1]=c[1]+this._lineHeight_small,s.fill_text(`Threshold: ${e} (${i})`,c[0],c[1]))}c[1]=c[1]+this._lineHeight_small,s.fill_text(t.selected_object.custom_info||"",c[0],c[1])}animate(){if(!this._disposed){if(requestAnimationFrame(this.animate.bind(this)),this.el.clientHeight<=0)return null;if(this.update(),this.render_flag>=0){this.has_stats&&this.stats.update();const t=this.inc_time();this.render(t),this.mapToCanvas();this.pixel_ratio[0];const e=this.domElement.width,i=this.domElement.height;this.domContext.fillStyle=this.foreground_color,this._draw_title(t,0,0,e,i),this._draw_ani(t,0,0,e,i),this._draw_legend(t,0,0,e,i),this._draw_focused_info(t,0,0,e,i),this.capturer_recording&&this.capturer&&this.capturer.add()}0===this.render_flag&&(this.render_flag=-1)}}enable_side_cameras(){this.has_side_cameras=!0;for(let t in this.side_canvas)this.side_canvas[t].container.style.display="block";this.handle_resize()}disable_side_cameras(t=!1){for(let t in this.side_canvas)this.side_canvas[t].container.style.display="none";this.has_side_cameras=!1,this.handle_resize()}remove_object(t,e=!0,i=!0,n=100){if(t||!(n<0)){if(e&&Array.isArray(t.children))for(let r=t.children.length-1;r>=0;r=Math.min(r-1,t.children.length))r<t.children.length&&this.remove_object(t.children[r],e,i,n-1);t.parent&&(console.debug("removing object - "+(t.name||t.type)),t.parent.remove(t)),i&&this.dispose_object(t)}}dispose_object(t,e=!1){if(!t||"object"!=typeof t)return;const i=t.name||t.type||"unknown";e||console.debug("Disposing - "+i),t.userData&&"function"==typeof t.userData.dispose?this._try_dispose(t.userData,t.name,e):(this._try_dispose(t.material,i+"-material",e),this._try_dispose(t.geometry,i+"-geometry",e),this._try_dispose(t,i,e))}_try_dispose(t,e,i=!1){if(t&&"object"==typeof t&&"function"==typeof t.dispose)try{t.dispose()}catch(n){i||console.warn("Failed to dispose "+(e||t.name||"unknown"))}}dispose(){this._disposed=!0,this.clock.stop(),this.dispose_eventlisters(),this.clear_all(),this.remove_object(this.scene),this.threebrain_instances.forEach(t=>{t.dispose()}),this.scene.dispose(),this.scene=null,this.el.innerHTML="",this.domContext=null,this.domContextWrapper=null,this.main_renderer.dispose(),this.side_renderer.dispose()}clear_all(){this.object_chosen=void 0,this.clickable.clear(),this.clickable_array.length=0,this.subject_codes.length=0,this.electrodes.clear(),this.volumes.clear(),this.ct_scan.clear(),this.surfaces.clear(),this.atlases.clear(),this.state_data.clear(),this.shared_data.clear(),this.color_maps.clear(),this._mouse_click_callbacks.side_viewer_depth=void 0,console.log("TODO: Need to dispose animation clips"),this.animation_clips.clear(),this.group.forEach(t=>{this.remove_object(t)}),this.mesh.forEach(t=>{this.remove_object(t)}),this.mesh.clear(),this.threebrain_instances.clear(),this.group.clear(),this.state_data.set("coronal_depth",0),this.state_data.set("axial_depth",0),this.state_data.set("sagittal_depth",0)}set_coronal_depth(t){"function"==typeof this._set_coronal_depth?this._set_coronal_depth(t):console.debug("Set coronal depth not implemented")}set_axial_depth(t){"function"==typeof this._set_axial_depth?this._set_axial_depth(t):console.debug("Set axial depth not implemented")}set_sagittal_depth(t){"function"==typeof this._set_sagittal_depth?this._set_sagittal_depth(t):console.debug("Set sagittal depth not implemented")}set_side_depth(t,e,i){console.debug("Set side depth not implemented")}set_side_visibility(t,e){console.debug("Set side visibility not implemented")}side_plane_sendback(t){"function"==typeof this._side_plane_sendback&&this._side_plane_sendback(t)}set_cube_anchor_visibility(t){this.compass&&this.compass.set_visibility(t,()=>{this.start_animation(0)})}add_object(t){this.DEBUG&&console.debug("Generating geometry "+t.type);let e=(0,Bi[t.type])(t,this);(0,n.AA)(t.layer);if("object"!=typeof e||null===e)return null;if(!e.object)return null;const i=e.subject_code;this.subject_codes.includes(i)||(this.subject_codes.push(i),this.electrodes.set(i,{}),this.volumes.set(i,{}),this.ct_scan.set(i,{}),this.surfaces.set(i,{}),this.atlases.set(i,{})),e.finish_init()}add_clickable(t,e){if(this.clickable.has(t)){const e=this.clickable.get(t),i=this.clickable_array.indexOf(e);i>-1&&this.clickable_array.splice(i,1)}this.clickable.set(t,e),this.clickable_array.push(e)}_register_datacube(t){const e=t[0].userData.construct_params,i=t[0].parent,r=this.get_data("datacube_dim_"+e.name,e.name,e.group.group_name),s=this.get_data("datacube_half_size_"+e.name,e.name,e.group.group_name),a=e.position;this.add_mouse_callback(t=>({pass:"mousedown"===t.action&&2===t.event.button,type:"clickable"}),(t,e)=>{const n=t.target_object;if(n&&n.isMesh&&n.userData.construct_params){const t=n.getWorldPosition(i.position.clone());this.set_side_depth(128*t.y/s[1]-.5,128*t.z/s[2]-.5,128*t.x/s[0]-.5)}},"side_viewer_depth"),this._set_coronal_depth=e=>{let i=r[1]/2;e>128?e=128:e<-127&&(e=-127),t[0].position.y=(e+.5)/128*s[1],t[0].material.uniforms.depth.value=i+e/128*i,t[0].material.needsUpdate=!0,this.state_data.set("coronal_depth",e),this.state_data.set("coronal_posy",t[0].position.y),this.trim_electrodes(),this.start_animation(0)},this._set_axial_depth=e=>{let i=r[2]/2;e>128?e=128:e<-127&&(e=-127),t[1].position.z=(e+.5)/128*s[2],t[1].material.uniforms.depth.value=i+e/128*i,t[1].material.needsUpdate=!0,this.state_data.set("axial_depth",e),this.state_data.set("axial_posz",t[1].position.z),this.trim_electrodes(),this.start_animation(0)},this._set_sagittal_depth=e=>{let i=r[0]/2;e>128?e=128:e<-127&&(e=-127),t[2].position.x=(e+.5)/128*s[0],t[2].material.uniforms.depth.value=i+e/128*i,t[2].material.needsUpdate=!0,this.state_data.set("sagittal_depth",e),this.state_data.set("sagittal_posx",t[2].position.x),this.trim_electrodes(),this.start_animation(0)},this._side_plane_sendback=e=>{t.forEach(t=>{t.material.uniforms.renderDepth.value=e?0:1,t.material.needsUpdate=!0})},this.set_side_visibility=(e,i)=>{let r=i?"enable":"disable";"coronal"===e?(t[0].layers[r](8),this.state_data.set("coronal_overlay",i)):"axial"===e?(t[1].layers[r](8),this.state_data.set("axial_overlay",i)):"sagittal"===e?(t[2].layers[r](8),this.state_data.set("sagittal_overlay",i)):(r=(0,n.jM)(this.state_data,"coronal_overlay",!1)?"enable":"disable",t[0].layers[r](8),r=(0,n.jM)(this.state_data,"axial_overlay",!1)?"enable":"disable",t[1].layers[r](8),r=(0,n.jM)(this.state_data,"sagittal_overlay",!1)?"enable":"disable",t[2].layers[r](8)),this.start_animation(0)},this.origin.position.set(-a[0],-a[1],-a[2]),this.reset_side_cameras(wi.t.VEC_ORIGIN,2*Math.max(...s))}_loader_finishied(){return void 0===this.json_load_finished?(this.json_load_finished=!0,!0):(this.json_load_queue.length>0&&(this.json_load_finished=!1),this.json_load_finished)}load_file(t,e,i="json_loader"){(i=this[i])||(i=this.json_loader),this.use_cache?this.cache.check_item(t)?e(this.cache.get_item(t)):(this.loader_triggered=!0,i.load(t,i=>{"string"==typeof i&&(i=JSON.parse(i)),this.cache.set_item(t,i),e(i)})):(this.loader_triggered=!0,i.load(t,t=>{"string"==typeof t&&(t=JSON.parse(t)),e(t)}))}add_group(t,e="threebrain_data",i=null){var r=new vi.J.Object3D;if(r.name="group_"+t.name,(0,n.AA)(t.layer).forEach(t=>{r.layers.enable(t)}),r.position.fromArray(t.position),null!==t.trans_mat){let e=new vi.J.Matrix4;e.set(...t.trans_mat);let i=(new vi.J.Matrix4).copy(e).invert();r.userData.trans_mat=e,r.userData.inv_trans_mat=i,t.disable_trans_mat||r.applyMatrix(e)}r.userData.construct_params=t;let s=(0,n.AA)(t.cached_items),a=s.length;if(a>0&&s.forEach(n=>{let r=t.group_data[n];if(null==r||Array.isArray(r)||void 0===r.file_name)a-=1;else{let n=e+t.cache_name+"/"+r.file_name;console.debug(n),this.load_file(n,e=>{Object.keys(e).forEach(i=>{t.group_data[i]=e[i]}),a-=1},i)}}),r.userData.group_data=t.group_data,this.group.set(t.name,r),this.add_to_scene(r),"__global_data"===t.name&&t.group_data)for(let e in t.group_data)this.shared_data.set(e.substring(15),t.group_data[e]);return function(){return 0===a}}global_data(t){const e=this.group.get("__global_data");let i=null;return e&&null!==e.userData.group_data&&e.userData.group_data.hasOwnProperty(t)&&(i=e.userData.group_data[t]),i}get_data(t,e,i){const n=this.mesh.get(e);let r,s;if(n){if(n.userData.hasOwnProperty(t))return n.userData[t];{let t=n.userData.construct_params.group;if(null!==t){let e=t.group_name;s=this.group.get(e)}}}else if(void 0!==i){let t=i;s=this.group.get(t)}else this.DEBUG&&console.error("Cannot find data with name "+e+" at group "+i);return s&&null!==s.userData.group_data&&s.userData.group_data.hasOwnProperty(t)&&(r=s.userData.group_data[t]),r}generate_animation_clips(t="Value",e=!0,i=(t=>{})){void 0===t?t=this.shared_data.get("animation_name")||"Value":this.shared_data.set("animation_name",t);const r=this.switch_colormap(t);this.mesh.forEach((e,i)=>{if(!e.isMesh||!e.userData.get_track_data)return null;if(!e.userData.ani_exists)return null;let s;const a=e.userData.get_track_data(t,!0);if(!a)return e.userData.ani_mixer&&e.userData.ani_mixer.stopAllAction(),null;if(s="function"==typeof e.userData.generate_animation?e.userData.generate_animation(a,r,this.animation_clips,e.userData.ani_mixer):function(t,e,i,r,s){const a=i.time_range[0],o=(i.time_range[1],[]),l=[];if((0,n.AA)(e.time).forEach(t=>{l.push(t-a)}),"continuous"===e.data_type)(0,n.AA)(e.value).forEach(t=>{let e=i.lut.getColor(t);o.push(e.r,e.g,e.b)});else{const t=new Map(i.value_names.map((t,e)=>[t,e]));(0,n.AA)(e.value).forEach(e=>{let n=i.lut.getColor(t.get(e));n?o.push(n.r,n.g,n.b):o.push(1,1,1)})}return new vi.J.ColorKeyframeTrack(e.target||".material.color",l,o,vi.J.InterpolateDiscrete)}(0,a,r,this.animation_clips,e.userData.ani_mixer),!s)return;const o=r.time_range[0],l=r.time_range[1],c="action_"+e.name+"__"+a.name;let h=this.animation_clips.get(c),u=!1;h?(h.duration=l-o,h.tracks[0].name=s.name,h.tracks[0].times=s.times,h.tracks[0].values=s.values):(h=new vi.J.AnimationClip(c,l-o,[s]),this.animation_clips.set(c,h),u=!0),e.userData.ani_mixer&&e.userData.ani_mixer.stopAllAction(),e.userData.ani_mixer=new vi.J.AnimationMixer(e),e.userData.ani_mixer.stopAllAction();e.userData.ani_mixer.clipAction(h).play()}),i(r)}get_surface_types(){const t={pial:1};return this.group.forEach((e,i)=>{const n=wi.t.REGEXP_SURFACE_GROUP.exec(i);n&&3===n.length&&(t[n[1]]=1)}),Object.keys(t)}get_atlas_types(){const t=this.state_data.get("target_subject")||"";let e=this.atlases.get(t);if(!e)return[];e=Object.keys(e);const i=e.map(t=>{const e=wi.t.REGEXP_ATLAS.exec(t);return e&&e.length>=2?e[1]:null}).filter(t=>"string"==typeof t);return(0,n.AA)(i)}get_volume_types(){const t={};return this.volumes.forEach((e,i)=>{Object.keys(e);let n=new RegExp("^(.*) \\("+i+"\\)$").exec(g);n&&2===n.length&&(t[n[1]]=1)}),Object.keys(t)}get_ct_types(){const t={};return this.ct_scan.forEach((e,i)=>{Object.keys(e);let n=new RegExp("^(.*) \\("+i+"\\)$").exec(g);n&&2===n.length&&(t[n[1]]=1)}),Object.keys(t)}switch_subject(t="/",e={}){if(0===this.subject_codes.length)return null;const i=this.state_data;this.subject_codes.includes(t)||((t=i.get("target_subject"))&&this.subject_codes.includes(t)||this.shared_data.get(".multiple_subjects")&&(t=this.shared_data.get(".template_subjects")),t&&this.subject_codes.includes(t)||(t=this.subject_codes[0]));i.get("target_subject");i.set("target_subject",t);let r=e.surface_type||i.get("surface_type")||"pial",s=e.atlas_type||i.get("atlas_type")||"none",a=e.material_type_left||i.get("material_type_left")||"normal",o=e.material_type_right||i.get("material_type_right")||"normal",l=e.volume_type||i.get("volume_type")||"T1",c=e.ct_type||i.get("ct_type")||"ct.aligned.t1",h=e.ct_threshold||i.get("ct_threshold")||.8,u=i.get("map_template")||!1;void 0!==e.map_template&&(u=e.map_template);let d=e.map_type_surface||i.get("map_type_surface")||"std.141",p=e.map_type_volume||i.get("map_type_volume")||"mni305",f=e.surface_opacity_left||i.get("surface_opacity_left")||1,m=e.surface_opacity_right||i.get("surface_opacity_right")||1,g=(0,n.jM)(this.shared_data,t,{}).vox2vox_MNI305,_=i.get("anterior_commissure")||new vi.J.Vector3;_.set(0,0,0);let v=i.get("tkRAS_MNI305")||new vi.J.Matrix4;if(v.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),Array.isArray(g)&&4==g.length&&4==g[3].length){v.set(g[0][0],g[0][1],g[0][2],g[0][3],g[1][0],g[1][1],g[1][2],g[1][3],g[2][0],g[2][1],g[2][2],g[2][3],g[3][0],g[3][1],g[3][2],g[3][3]);const t=(new vi.J.Matrix4).copy(v).invert();_.setFromMatrixPosition(t)}this.switch_volume(t,l),this.switch_ct(t,c,h),this.switch_atlas(t,s),this.switch_surface(t,r,[f,m],[a,o]),u?this.map_electrodes(t,d,p):this.map_electrodes(t,"reset","reset"),this.set_side_visibility(),i.set("surface_type",r),i.set("atlas_type",s),i.set("material_type_left",a),i.set("material_type_right",o),i.set("volume_type",l),i.set("ct_type",c),i.set("ct_threshold",h),i.set("map_template",u),i.set("map_type_surface",d),i.set("map_type_volume",p),i.set("surface_opacity_left",f),i.set("surface_opacity_right",m),i.set("anterior_commissure",_),i.set("tkRAS_MNI305",v),this.dispatch_event("switch_subject",{target_subject:t}),this.start_animation(0)}calculate_mni305(t,e=!0){if(!t.isVector3)throw"vec must be a THREE.Vector3 instance";const i=this.state_data.get("tkRAS_MNI305");return i&&i.isMatrix4?t.applyMatrix4(i):e&&t.set(NaN,NaN,NaN),t}switch_surface(t,e="pial",i=[1,1],n=["normal","normal"]){this.surfaces.forEach((r,s)=>{for(let a in r){const o=r[a];if(o.visible=!1,s===t)if(a===`Standard 141 Left Hemisphere - ${e} (${t})`||a===`FreeSurfer Left Hemisphere - ${e} (${t})`)"hidden"===n[0]?o.visible=!1:(o.material.wireframe="wireframe"===n[0],o.visible=!0,o.material.opacity=i[0],o.material.transparent=i[0]<.99);else if(a===`Standard 141 Right Hemisphere - ${e} (${t})`||a===`FreeSurfer Right Hemisphere - ${e} (${t})`){"hidden"===n[1]?o.visible=!1:(o.material.wireframe="wireframe"===n[1],o.visible=!0,o.material.opacity=i[1],o.material.transparent=i[1]<.99),this.bounding_box.setFromObject(o.parent),this.bounding_box.geometry.computeBoundingBox();const t=this.bounding_box.geometry.boundingBox;this.controls.target.copy(t.min.clone()).add(t.max).multiplyScalar(.5),this.control_center=this.controls.target.toArray(),this.controls.update()}}}),this.start_animation(0)}switch_volume(t,e="T1"){this.volumes.forEach((i,n)=>{for(let r in i){const s=i[r];n===t&&r===`${e} (${n})`?(s[0].parent.visible=!0,this._register_datacube(s)):s[0].parent.visible=!1}}),this.start_animation(0)}switch_atlas(t,e){console.debug(`Setting volume data cube: ${e} (${t})`),this.atlases.forEach((i,n)=>{for(let r in i){const s=i[r];s.visible=n===t&&r===`Atlas - ${e} (${n})`}})}switch_ct(t,e="ct.aligned.t1",i=.8){this.ct_scan.forEach((n,r)=>{for(let s in n){const a=n[s];r===t&&s===`${e} (${r})`?(a.parent.visible=this._show_ct,a.material.uniforms.u_renderthreshold.value=i):a.parent.visible=!1}}),this.start_animation(0)}map_electrodes(t,e="std.141",i="mni305"){const r=new vi.J.Vector3,s=new vi.J.Vector3,a=new vi.J.Matrix4,o=new vi.J.Matrix4;this.electrodes.forEach((l,c)=>{for(let h in l){const u=l[h],d=u.userData.construct_params,p=d.is_surface_electrode,f=d.vertex_number,m=d.surface_type,g=d.MNI305_position,_=d.position,v=this.group.get(`Surface - ${m} (${t})`),y=0===_[0]&&0===_[1]&&0===_[2];if(void 0===u.userData.MNI305_position)if(u.userData.MNI305_position=(new vi.J.Vector3).set(0,0,0),!Array.isArray(g)||3!==g.length||0===g[0]&&0===g[1]&&0===g[2]){let t=(0,n.jM)(this.shared_data,c,{}).vox2vox_MNI305;t&&(a.set(t[0][0],t[0][1],t[0][2],t[0][3],t[1][0],t[1][1],t[1][2],t[1][3],t[2][0],t[2][1],t[2][2],t[2][3],t[3][0],t[3][1],t[3][2],t[3][3]),r.fromArray(_).applyMatrix4(a),u.userData.MNI305_position.fromArray(r.toArray()))}else u.userData.MNI305_position.fromArray(g);const b=u.userData.MNI305_position;s.fromArray(_);let x=!1,w="string"==typeof d.hemisphere&&d.hemisphere.length>0?d.hemisphere.charAt(0).toUpperCase()+d.hemisphere.slice(1):"";if(!y&&"mni305"===i){const e=(0,n.jM)(this.shared_data,t,{}).vox2vox_MNI305;e&&(o.set(e[0][0],e[0][1],e[0][2],e[0][3],e[1][0],e[1][1],e[1][2],e[1][3],e[2][0],e[2][1],e[2][2],e[2][3],e[3][0],e[3][1],e[3][2],e[3][3]),o.invert(),0===b.x&&0===b.y&&0===b.z||(r.set(b.x,b.y,b.z).applyMatrix4(o),x=!0),x?(u.position.copy(r),u.userData._template_mni305=r.clone(),u.userData._template_mapped=!0,u.userData._template_space="mni305",u.userData._template_shift=0,u.userData._template_surface=d.surface_type,u.userData._template_hemisphere=d.hemisphere):u.userData._template_mni305=void 0)}if(!y&&"std.141"===e&&p&&f>=0&&v&&v.isObject3D&&2===v.children.length){let e=v.children.filter(e=>e.name===`mesh_free_Standard 141 ${w} Hemisphere - ${m} (${t})`);if(1===e.length){const t=e[0].geometry.getAttribute("position"),i=e[0].getWorldPosition(u.parent.position.clone());r.set(t.getX(f),t.getY(f),t.getZ(f)).add(i),u.position.copy(r),u.userData._template_mapped=!0,u.userData._template_space="std.141",u.userData._template_surface=d.surface_type,u.userData._template_hemisphere=d.hemisphere,u.userData._template_mni305&&(u.userData._template_shift=r.distanceTo(u.userData._template_mni305)),x=!0}}x||(u.position.fromArray(_),u.userData._template_mapped=!1,u.userData._template_space="original",u.userData._template_mni305=void 0,u.userData._template_shift=0,u.userData._template_surface=d.surface_type,u.userData._template_hemisphere=d.hemisphere),y&&(u.visible=!1)}}),this.start_animation(0)}electrodes_info(){const t={};return this.electrodes.forEach((e,i)=>{const r=new RegExp(`^${i}, ([0-9]+) \\- (.*)$`),s=(0,n.jM)(this.shared_data,i,{}).vox2vox_MNI305,a=[],o=new vi.J.Matrix4,l=new vi.J.Vector3;let c,h,u,d={};s&&o.set(s[0][0],s[0][1],s[0][2],s[0][3],s[1][0],s[1][1],s[1][2],s[1][3],s[2][0],s[2][1],s[2][2],s[2][3],s[3][0],s[3][1],s[3][2],s[3][3]);for(let t in e)c=r.exec(t),c&&3===c.length&&(d={},h=e[t],u=h.userData.construct_params,l.fromArray(u.position),d.Electrode=parseInt(c[1]),d.Coord_x=l.x,d.Coord_y=l.y,d.Coord_z=l.z,d.Label=c[2],l.applyMatrix4(o),d.MNI305_x=l.x,d.MNI305_y=l.y,d.MNI305_z=l.z,d.SurfaceElectrode=u.is_surface_electrode?"TRUE":"FALSE",d.SurfaceType=u.surface_type,d.Radius=u.radius,d.VertexNumber=u.vertex_number,d.Hemisphere=u.hemisphere,d.Notes=u.custom_info||""),a[d.Electrode-1]=d;d={},d.Coord_x=0,d.Coord_y=0,d.Coord_z=0,d.Label="NA",d.MNI305_x=0,d.MNI305_y=0,d.MNI305_z=0,d.SurfaceElectrode="TRUE",d.SurfaceType="NA",d.Radius=1,d.VertexNumber=-1,d.Hemisphere="NA",d.Notes="";for(let t=0;t<a.length;t++)void 0===a[t]&&(d.Electrode=t+1,a[t]={...d});t[i]=a}),t}download_electrodes(t="json"){const e=this.electrodes_info();for(let i in e){let n=e[i];if("__localization__"===i){const t=this.state_data.get("target_subject");n=n.map(e=>({Electrode:e.Electrode,TemplateCoord_x:e.Coord_x,TemplateCoord_y:e.Coord_y,TemplateCoord_z:e.Coord_z,Label:e.Notes,TemplateSubject:t}))}n.length>0&&("json"===t?Fi()(JSON.stringify(n),i+"_electrodes.json","application/json"):"csv"===t&&(0,Oi.json2csv)(n,(t,e)=>{Fi()(e,i+"_electrodes.csv","plan/csv")}))}}trim_electrodes(t){"number"!=typeof t?t=(0,n.jM)(this.state_data,"threshold_electrode_plane",1/0):this.state_data.set("threshold_electrode_plane",t);const e=(0,n.jM)(this.state_data,"sagittal_posx",0),i=(0,n.jM)(this.state_data,"coronal_posy",0),r=(0,n.jM)(this.state_data,"axial_posz",0),s=(new vi.J.Vector3).set(e,i,r),a=new vi.J.Vector3;this.electrodes.forEach((e,i)=>{for(let i in e){const n=e[i];n.layers.set(wi.t.LAYER_SYS_MAIN_CAMERA_8),n.layers.enable(wi.t.LAYER_SYS_RAYCASTER_14),n.getWorldPosition(a).sub(s),Math.abs(a.x)<=t&&n.layers.enable(wi.t.LAYER_SYS_SAGITTAL_11),Math.abs(a.y)<=t&&n.layers.enable(wi.t.LAYER_SYS_CORONAL_9),Math.abs(a.z)<=t&&n.layers.enable(wi.t.LAYER_SYS_AXIAL_10)}})}}},178:(t,e,i)=>{"use strict";i.d(e,{J:()=>s});var n=i(7e3);const r=t=>t.split("\n").map(t=>t.replaceAll(/\/\/.*/g,"")).join("\n");let s=function(t){return void 0===t&&console.error("THREE is not defined"),t.Lut||(t.Lut=function(e,i){this.lut=[],this.map=t.ColorMapKeywords[e],this.n=i,this.mapname=e;for(var n=1/this.n,r=0;r<=1;r+=n)for(var s=0;s<this.map.length-1;s++)if(r>=this.map[s][0]&&r<this.map[s+1][0]){var a=this.map[s][0],o=this.map[s+1][0],l=new t.Color(16777215).setHex(this.map[s][1]),c=new t.Color(16777215).setHex(this.map[s+1][1]),h=l.lerp(c,(r-a)/(o-a));this.lut.push(h)}return this.set(this)},t.Lut.prototype={constructor:t.Lut,lut:[],map:[],mapname:"rainbow",n:256,minV:0,maxV:1,legend:null,set:function(e){return e instanceof t.Lut&&this.copy(e),this},setMin:function(t){return this.minV=t,this},setMax:function(t){return this.maxV=t,this},changeNumberOfColors:function(e){return this.n=e,new t.Lut(this.mapname,this.n)},changeColorMap:function(e){return this.mapname=e,new t.Lut(this.mapname,this.n)},copy:function(t){return this.lut=t.lut,this.mapname=t.mapname,this.map=t.map,this.n=t.n,this.minV=t.minV,this.maxV=t.maxV,this},getColor:function(t){t<=this.minV?t=this.minV:t>=this.maxV&&(t=this.maxV),t=(t-this.minV)/(this.maxV-this.minV);var e=Math.round(t*this.n);return e==this.n&&(e-=1),this.lut[e]},addColorMap:function(e,i){t.ColorMapKeywords[e]=i},setLegendOn:function(e){void 0===e&&(e={}),this.legend={},this.legend.layout=e.hasOwnProperty("layout")?e.layout:"vertical",this.legend.position=e.hasOwnProperty("position")?e.position:{x:4,y:0,z:0},this.legend.dimensions=e.hasOwnProperty("dimensions")?e.dimensions:{width:.5,height:3},this.legend.canvas=document.createElement("canvas"),this.legend.canvas.setAttribute("id","legend"),this.legend.canvas.setAttribute("hidden",!0),document.body.appendChild(this.legend.canvas),this.legend.ctx=this.legend.canvas.getContext("2d"),this.legend.canvas.setAttribute("width",1),this.legend.canvas.setAttribute("height",this.n),this.legend.texture=new t.Texture(this.legend.canvas);var i=this.legend.ctx.getImageData(0,0,1,this.n),n=i.data;this.map=t.ColorMapKeywords[this.mapname];for(var r=0,s=1/this.n,a=1;a>=0;a-=s)for(var o=this.map.length-1;o>=0;o--)if(a<this.map[o][0]&&a>=this.map[o-1][0]){var l=this.map[o-1][0],c=this.map[o][0],h=new t.Color(16777215).setHex(this.map[o-1][1]),u=new t.Color(16777215).setHex(this.map[o][1]),d=h.lerp(u,(a-l)/(c-l));n[4*r]=Math.round(255*d.r),n[4*r+1]=Math.round(255*d.g),n[4*r+2]=Math.round(255*d.b),n[4*r+3]=255,r+=1}return this.legend.ctx.putImageData(i,0,0),this.legend.texture.needsUpdate=!0,this.legend.legendGeometry=new t.PlaneBufferGeometry(this.legend.dimensions.width,this.legend.dimensions.height),this.legend.legendMaterial=new t.MeshBasicMaterial({map:this.legend.texture,side:t.DoubleSide}),this.legend.mesh=new t.Mesh(this.legend.legendGeometry,this.legend.legendMaterial),"horizontal"==this.legend.layout&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh.position.copy(this.legend.position),this.legend.mesh},setLegendOff:function(){return this.legend=null,this.legend},setLegendLayout:function(t){return!!this.legend&&(this.legend.layout!=t&&(("horizontal"==t||"vertical"==t)&&(this.layout=t,"horizontal"==t&&(this.legend.mesh.rotation.z=Math.PI/180*90),"vertical"==t&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh)))},setLegendPosition:function(e){return this.legend.position=new t.Vector3(e.x,e.y,e.z),this.legend},setLegendLabels:function(e,i){if(!this.legend)return!1;"function"==typeof e&&(i=e),void 0===e&&(e={}),this.legend.labels={},this.legend.labels.fontsize=e.hasOwnProperty("fontsize")?e.fontsize:24,this.legend.labels.fontface=e.hasOwnProperty("fontface")?e.fontface:"Arial",this.legend.labels.title=e.hasOwnProperty("title")?e.title:"",this.legend.labels.um=e.hasOwnProperty("um")?" [ "+e.um+" ]":"",this.legend.labels.ticks=e.hasOwnProperty("ticks")?e.ticks:0,this.legend.labels.decimal=e.hasOwnProperty("decimal")?e.decimal:2,this.legend.labels.notation=e.hasOwnProperty("notation")?e.notation:"standard";var n=255,r=100,s=100,a=.8,o=255,l=0,c=0,h=1,u=document.createElement("canvas"),d=u.getContext("2d");d.font="Normal "+1.2*this.legend.labels.fontsize+"px "+this.legend.labels.fontface,d.fillStyle="rgba("+n+","+r+","+s+","+a+")",d.strokeStyle="rgba("+o+","+l+","+c+","+h+")",d.lineWidth=4,d.fillStyle="rgba( 0, 0, 0, 1.0 )",d.fillText(this.legend.labels.title.toString()+this.legend.labels.um.toString(),4,this.legend.labels.fontsize+4);var p=new t.CanvasTexture(u);p.minFilter=t.LinearFilter;var f=new t.SpriteMaterial({map:p}),m=new t.Sprite(f);if(m.scale.set(2,1,1),"vertical"==this.legend.layout&&m.position.set(this.legend.position.x+this.legend.dimensions.width,this.legend.position.y+.45*this.legend.dimensions.height,this.legend.position.z),"horizontal"==this.legend.layout&&m.position.set(1.015*this.legend.position.x,this.legend.position.y+.03*this.legend.dimensions.height,this.legend.position.z),this.legend.labels.ticks>0){var g={},_={};if("vertical"==this.legend.layout)var v=this.legend.position.y+.36*this.legend.dimensions.height,y=this.legend.position.y-.61*this.legend.dimensions.height;if("horizontal"==this.legend.layout)var b=this.legend.position.x+.75*this.legend.dimensions.height,x=this.legend.position.x-1.2*this.legend.dimensions.width;for(var w=0;w<this.legend.labels.ticks;w++){var S=(this.maxV-this.minV)/(this.legend.labels.ticks-1)*w+this.minV;S=i?i(S):"scientific"==this.legend.labels.notation?S.toExponential(this.legend.labels.decimal):S.toFixed(this.legend.labels.decimal);var M=document.createElement("canvas"),A=M.getContext("2d");A.font="Normal "+this.legend.labels.fontsize+"px "+this.legend.labels.fontface,A.fillStyle="rgba("+n+","+r+","+s+","+a+")",A.strokeStyle="rgba("+o+","+l+","+c+","+h+")",A.lineWidth=4,A.fillStyle="rgba( 0, 0, 0, 1.0 )",A.fillText(S.toString(),4,this.legend.labels.fontsize+4);var E=new t.CanvasTexture(M);E.minFilter=t.LinearFilter;var L=new t.SpriteMaterial({map:E}),T=new t.Sprite(L);if(T.scale.set(2,1,1),"vertical"==this.legend.layout){var C=y+(v-y)*((S-this.minV)/(this.maxV-this.minV));T.position.set(this.legend.position.x+2.7*this.legend.dimensions.width,C,this.legend.position.z)}if("horizontal"==this.legend.layout){C=x+(b-x)*((S-this.minV)/(this.maxV-this.minV));if(this.legend.labels.ticks>5)if(w%2==0)var P=1.7;else P=2.1;else P=1.7;T.position.set(C,this.legend.position.y-this.legend.dimensions.width*P,this.legend.position.z)}var N=new t.LineBasicMaterial({color:0,linewidth:2}),R=[];if("vertical"==this.legend.layout){var D=this.legend.position.y-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((S-this.minV)/(this.maxV-this.minV)*.99);R.push(new t.Vector3(this.legend.position.x+.55*this.legend.dimensions.width,D,this.legend.position.z)),R.push(new t.Vector3(this.legend.position.x+.7*this.legend.dimensions.width,D,this.legend.position.z))}if("horizontal"==this.legend.layout){D=this.legend.position.x-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((S-this.minV)/(this.maxV-this.minV)*.99);R.push(new t.Vector3(D,this.legend.position.y-.55*this.legend.dimensions.width,this.legend.position.z)),R.push(new t.Vector3(D,this.legend.position.y-.7*this.legend.dimensions.width,this.legend.position.z))}var I=(new t.BufferGeometry).setFromPoints(R),O=new t.Line(I,N);_[w]=O,g[w]=T}}return{title:m,ticks:g,lines:_}}},t.ColorMapKeywords={rainbow:[[0,"0x0000FF"],[.2,"0x00FFFF"],[.5,"0x00FF00"],[.8,"0xFFFF00"],[1,"0xFF0000"]],cooltowarm:[[0,"0x3C4EC2"],[.2,"0x9BBCFF"],[.5,"0xDCDCDC"],[.8,"0xF6A385"],[1,"0xB40426"]],blackbody:[[0,"0x000000"],[.2,"0x780000"],[.5,"0xE63200"],[.8,"0xFFFF00"],[1,"0xFFFFFF"]],grayscale:[[0,"0x000000"],[.2,"0x404040"],[.5,"0x7F7F80"],[.8,"0xBFBFBF"],[1,"0xFFFFFF"]]}),t}(n);s=function(t){return void 0===t&&console.error("THREE is not defined"),t.OrthographicTrackballControls||(t.OrthographicTrackballControls=function(e,i){var n=this,r=-1,s=0,a=1,o=2,l=3,c=4;this.object=e,this.domElement=void 0!==i?i:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.radius=0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new t.Vector3;var h=!0,u=r,d=r,p=new t.Vector3,f=new t.Vector3,m=new t.Vector3,g=new t.Vector2,_=new t.Vector2,v=0,y=0,b=new t.Vector2,x=new t.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom;var w={type:"change"},S={type:"start"},M={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom};var A,E,L,T,C=(A=new t.Vector2,function(t,e){return A.set((t-n.screen.left)/n.screen.width,(e-n.screen.top)/n.screen.height),A}),P=function(){var e=new t.Vector3,i=new t.Vector3,r=new t.Vector3;return function(t,s,a=0){r.set((t-.5*n.screen.width-n.screen.left)/n.radius,(.5*n.screen.height+n.screen.top-s)/n.radius,0);var o=r.length();return 1===a?(r.x=0,o=Math.abs(r.y)):2===a?(r.y=0,o=Math.abs(r.x)):3===a&&(r.normalize(),o=1),n.noRoll?o<Math.SQRT1_2?r.z=Math.sqrt(1-o*o):r.z=.5/o:o>1?r.normalize():r.z=Math.sqrt(1-o*o),p.copy(n.object.position).sub(n.target),e.copy(n.object.up).setLength(r.y),e.add(i.copy(n.object.up).cross(p).setLength(r.x)),e.add(p.setLength(r.z)),e}}();function N(t){!1!==n.enabled&&(window.removeEventListener("keydown",N),d=u,u===r&&(t.keyCode!==n.keys[s]||n.noRotate?t.keyCode!==n.keys[a]||n.noZoom?t.keyCode!==n.keys[o]||n.noPan||(u=o):u=a:u=s))}function R(t){!1!==n.enabled&&(u=d,window.addEventListener("keydown",N,!1))}function D(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),u===r&&(u=t.button),u!==s||n.noRotate?u!==a||n.noZoom?u!==o||n.noPan||(b.copy(C(t.pageX,t.pageY)),x.copy(b)):(g.copy(C(t.pageX,t.pageY)),_.copy(g)):(f.copy(P(t.pageX,t.pageY,3*t.altKey+2*t.ctrlKey+t.shiftKey)),m.copy(f)),document.addEventListener("mousemove",I,!1),document.addEventListener("mouseup",O,!1),n.dispatchEvent(S))}function I(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),u!==s||n.noRotate?u!==a||n.noZoom?u!==o||n.noPan||x.copy(C(t.pageX,t.pageY)):_.copy(C(t.pageX,t.pageY)):m.copy(P(t.pageX,t.pageY,3*t.altKey+2*t.ctrlKey+t.shiftKey)))}function O(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),u=r,document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",O),n.dispatchEvent(M))}function k(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),g.y+=.01*t.deltaY,n.dispatchEvent(S),n.dispatchEvent(M))}function F(t){if(!1!==n.enabled){switch(t.touches.length){case 1:u=l,f.copy(P(t.touches[0].pageX,t.touches[0].pageY)),m.copy(f);break;case 2:u=c;var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;y=v=Math.sqrt(e*e+i*i);var s=(t.touches[0].pageX+t.touches[1].pageX)/2,a=(t.touches[0].pageY+t.touches[1].pageY)/2;b.copy(C(s,a)),x.copy(b);break;default:u=r}n.dispatchEvent(S)}}function B(t){if(!1!==n.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:m.copy(P(t.touches[0].pageX,t.touches[0].pageY));break;case 2:var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;y=Math.sqrt(e*e+i*i);var s=(t.touches[0].pageX+t.touches[1].pageX)/2,a=(t.touches[0].pageY+t.touches[1].pageY)/2;x.copy(C(s,a));break;default:u=r}}function z(t){if(!1!==n.enabled){switch(t.touches.length){case 1:m.copy(P(t.touches[0].pageX,t.touches[0].pageY)),f.copy(m);break;case 2:v=y=0;var e=(t.touches[0].pageX+t.touches[1].pageX)/2,i=(t.touches[0].pageY+t.touches[1].pageY)/2;x.copy(C(e,i)),b.copy(x)}u=r,n.dispatchEvent(M)}}function j(t){t.preventDefault()}this.rotateCamera=(E=new t.Vector3,L=new t.Quaternion,T=!1,function(){var t=Math.acos(f.dot(m)/f.length()/m.length());t?(T=!0,n.dispatchEvent(S),E.crossVectors(f,m).normalize(),t*=n.rotateSpeed,L.setFromAxisAngle(E,-t),p.applyQuaternion(L),n.object.up.applyQuaternion(L),m.applyQuaternion(L),n.staticMoving?f.copy(m):(L.setFromAxisAngle(E,t*(n.dynamicDampingFactor-1)),f.applyQuaternion(L)),h=!0):T&&(T=!1,n.dispatchEvent(M))}),this.zoomCamera=function(){var t=!1;return function(){if(u===c){var e=y/v;v=y,Math.abs(e-1)>1e-6&&e>0?(t=!0,n.dispatchEvent(S),n.object.zoom*=e,h=!0):t&&(t=!1,n.dispatchEvent(M))}else{e=1+(_.y-g.y)*n.zoomSpeed;Math.abs(e-1)>1e-6&&e>0?(t=!0,n.dispatchEvent(S),n.object.zoom/=e,n.staticMoving?g.copy(_):g.y+=(_.y-g.y)*this.dynamicDampingFactor,h=!0):t&&(t=!1,n.dispatchEvent(M))}}}(),this.panCamera=function(){var e=new t.Vector2,i=new t.Vector3,r=new t.Vector3,s=!1;return function(){if(e.copy(x).sub(b),e.lengthSq()>1e-5){s=!0,n.dispatchEvent(S);var t=(n.object.right-n.object.left)/n.object.zoom,a=(n.object.top-n.object.bottom)/n.object.zoom;e.x*=t,e.y*=a,r.copy(p).cross(n.object.up).setLength(e.x),r.add(i.copy(n.object.up).setLength(e.y)),n.object.right=n.object.right-e.x/2,n.object.left=n.object.left-e.x/2,n.object.top=n.object.top+e.y/2,n.object.bottom=n.object.bottom+e.y/2,n.left0=n.object.left,n.right0=n.object.right,n.top0=n.object.top,n.bottom0=n.object.bottom,n.staticMoving?b.copy(x):b.add(e.subVectors(x,b).multiplyScalar(n.dynamicDampingFactor)),h=!0}else s&&(s=!1,n.dispatchEvent(M))}}(),this.update=function(){p.subVectors(n.object.position,n.target),n.noRotate||n.rotateCamera(),n.noZoom||(n.zoomCamera(),h&&n.object.updateProjectionMatrix()),n.noPan||(n.panCamera(),h&&n.object.updateProjectionMatrix()),n.object.position.addVectors(n.target,p),n.object.lookAt(n.target),h&&(n.dispatchEvent(w),h=!1)},this.reset=function(){u=r,d=r,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),p.subVectors(n.object.position,n.target),n.object.left=n.left0,n.object.right=n.right0,n.object.top=n.top0,n.object.bottom=n.bottom0,n.object.lookAt(n.target),n.dispatchEvent(w),h=!1},this.dispose=function(){this.domElement.removeEventListener("contextmenu",j,!1),this.domElement.removeEventListener("mousedown",D,!1),this.domElement.removeEventListener("wheel",k,!1),this.domElement.removeEventListener("touchstart",F,!1),this.domElement.removeEventListener("touchend",z,!1),this.domElement.removeEventListener("touchmove",B,!1),document.removeEventListener("mousemove",I,!1),document.removeEventListener("mouseup",O,!1),window.removeEventListener("keydown",N,!1),window.removeEventListener("keyup",R,!1)},this.domElement.addEventListener("contextmenu",j,!1),this.domElement.addEventListener("mousedown",D,!1),this.domElement.addEventListener("wheel",k,!1),this.domElement.addEventListener("touchstart",F,!1),this.domElement.addEventListener("touchend",z,!1),this.domElement.addEventListener("touchmove",B,!1),window.addEventListener("keydown",N,!1),window.addEventListener("keyup",R,!1),this.handleResize(),this.update()},t.OrthographicTrackballControls.prototype=Object.create(t.EventDispatcher.prototype),t.OrthographicTrackballControls.prototype.constructor=t.OrthographicTrackballControls),t}(s),s=function(t){return t.VolumeRenderShader1={uniforms:{cmap:{value:null},nmap:{value:null},mask:{value:null},cameraPos:{value:new t.Vector3},alpha:{value:-1},steps:{value:300},scale_inv:{value:new t.Vector3},bounding:{value:.5}},vertexShader:r("#version 300 es\nprecision highp float;\nin vec3 position;\n// uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 cameraPos;\nuniform vec3 scale_inv;\n\nout mat4 pmv;\nout vec3 vOrigin;\nout vec3 vDirection;\nvoid main() {\n  pmv = projectionMatrix * modelViewMatrix;\n\n  // For perspective camera, vorigin is camera\n  // 'vOrigin = vec3( inverse( modelMatrix ) * vec4( cameraPos, 1.0 ) ).xyz / scale;',\n  // 'vDirection = position / scale - vOrigin;',\n\n  // Orthopgraphic camera, camera position in theory is at infinite\n  // instead of using camera's position, we can directly inverse (projectionMatrix * modelViewMatrix)\n  // Because projectionMatrix * modelViewMatrix * anything is centered at 0,0,0,1, hence inverse this procedure\n  // obtains Orthopgraphic direction, which can be directly used as ray direction\n\n  // 'vDirection = vec3( inverse( pmv ) * vec4( 0.0,0.0,0.0,1.0 ) ) / scale;',\n  vDirection = inverse( pmv )[3].xyz * scale_inv;\n\n  // Previous test code, seems to be poor because camera position is not well-calculated?\n  // 'vDirection = - normalize( vec3( inverse( modelMatrix ) * vec4( cameraPos , 1.0 ) ).xyz ) * 1000.0;',\n  vOrigin = (position - vec3(0.6,-0.6,0.6)) * scale_inv - vDirection;\n  gl_Position = pmv * vec4( position, 1.0 );\n}"),fragmentShader:r("#version 300 es\nprecision highp float;\nprecision mediump sampler3D;\nin vec3 vOrigin;\nin vec3 vDirection;\nin mat4 pmv;\nout vec4 color;\nuniform sampler3D cmap;\nuniform sampler3D nmap;\nuniform float alpha;\nuniform float steps;\nuniform vec3 scale_inv;\nuniform float bounding;\nvec4 fcolor;\nvec2 hitBox( vec3 orig, vec3 dir ) {\n  vec3 box_min = vec3( - bounding );\n  vec3 box_max = vec3( bounding );\n  vec3 inv_dir = 1.0 / dir;\n  vec3 tmin_tmp = ( box_min - orig ) * inv_dir;\n  vec3 tmax_tmp = ( box_max - orig ) * inv_dir;\n  vec3 tmin = min( tmin_tmp, tmax_tmp );\n  vec3 tmax = max( tmin_tmp, tmax_tmp );\n  float t0 = max( tmin.x, max( tmin.y, tmin.z ) );\n  float t1 = min( tmax.x, min( tmax.y, tmax.z ) );\n  return vec2( t0, t1 );\n}\nfloat getDepth( vec3 p ){\n  vec4 frag2 = pmv * vec4( p, scale_inv );\n  return (frag2.z / frag2.w / 2.0 + 0.5);\n}\nvec4 sample2( vec3 p ) {\n  return texture( cmap, p + 0.5 );\n}\nvec3 getNormal( vec3 p ) {\n  vec3 re = vec3( texture( nmap, p + 0.5 ).rgb *  255.0 - 127.0 );\n  return normalize( re );\n}\n\nvoid main(){\n  vec3 rayDir = normalize( vDirection );\n  vec2 bounds = hitBox( vOrigin, rayDir );\n  if ( bounds.x > bounds.y ) discard;\n  bounds.x = max( bounds.x, 0.0 );\n  // 0-255 need to be 0.5-255.5\n  vec3 p = vOrigin + bounds.x * rayDir;\n  vec3 inc = 1.0 / abs( rayDir );\n  float delta = min( inc.x, min( inc.y, inc.z ) );\n  delta /= steps;\n\n  int nn = 0;\n  int valid_voxel = 0;\n  float mix_factor = 1.0;\n  vec4 last_color = vec4( 0.0, 0.0, 0.0, 0.0 );\n  vec3 zero_rgb = vec3( 0.0, 0.0, 0.0 );\n\n  for ( float t = bounds.x; t < bounds.y; t += delta ) {\n    fcolor = sample2( p );\n\n    // Hit voxel\n    if( fcolor.a > 0.0 && fcolor.rgb != zero_rgb ){\n\n      if( alpha >= 0.0 ){\n        fcolor.a = alpha;\n      }\n\n\n      if( fcolor.rgb != last_color.rgb ){\n        // We are right on the surface\n\n        last_color = fcolor;\n\n        // reflect light\n        fcolor.rgb *= max( dot(-rayDir, getNormal( p )) , 0.5 );\n\n        if( nn == 0 ){\n          gl_FragDepth = getDepth( p );\n          color = fcolor;\n          color.a = max( color.a, 0.2 );\n        } else {\n          // blend\n          color.rgb = vec3( color.a ) * color.rgb + vec3( 1.0 - color.a ) * fcolor.rgb;\n          color.a = color.a + ( 1.0 - color.a ) * fcolor.a;\n          // color = vec4( color.a ) * color + vec4( 1.0 - color.a ) * fcolor;\n        }\n\n        nn++;\n\n      }\n\n      valid_voxel = 1;\n\n      if( nn >= 10 || color.a > 0.95 ){\n        break;\n      }\n\n    } else if ( valid_voxel > 0 ) {\n\n      // Leaving the structure reset states\n      last_color.rgb = zero_rgb;\n      valid_voxel = 0;\n    }\n    p += rayDir * delta;\n  }\n  if ( nn == 0 || color.a == 0.0 ) discard;\n\n  // calculate alpha at depth\n}")},t}(s),s=function(t){return t.Volume2dArrayShader_xy={uniforms:{diffuse:{value:null},depth:{value:0},size:{value:new t.Vector3(256,256,256)},threshold:{value:0},renderDepth:{value:1}},vertexShader:["uniform vec3 size;","out vec2 vUv;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vUv.xy = position.xy / size.xy + 0.5;","}"].join("\n"),fragmentShader:["precision highp float;","precision highp int;","precision highp sampler2DArray;","uniform sampler2DArray diffuse;","in vec2 vUv;","uniform int depth;","uniform float threshold;","uniform float renderDepth;","void main() {","vec4 color = texture( diffuse, vec3( vUv, depth ) );","float is_opaque = float( color.r > threshold );","gl_FragDepth = (1.0 - is_opaque * renderDepth) * (1.0 - gl_FragCoord.z) + gl_FragCoord.z;","gl_FragColor = vec4( color.rrr, is_opaque );","}"].join("\n")},t.Volume2dArrayShader_xz={uniforms:{diffuse:{value:null},depth:{value:0},size:{value:new t.Vector3(256,256,256)},threshold:{value:0},renderDepth:{value:1}},vertexShader:["uniform vec3 size;","out vec2 vUv;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vUv.xy = position.xy / size.xz + 0.5;","}"].join("\n"),fragmentShader:["precision highp float;","precision highp int;","precision highp sampler2DArray;","uniform sampler2DArray diffuse;","uniform vec3 size;","in vec2 vUv;","uniform float depth;","uniform float threshold;","uniform float renderDepth;","void main() {","vec4 color = texture( diffuse, vec3( vUv.x, depth / size.y, floor( vUv.y * size.z ) ) );","float is_opaque = float( color.r > threshold );","gl_FragDepth = (1.0 - is_opaque * renderDepth) * (1.0 - gl_FragCoord.z) + gl_FragCoord.z;","gl_FragColor = vec4( color.rrr, is_opaque );","}"].join("\n")},t.Volume2dArrayShader_yz={uniforms:{diffuse:{value:null},depth:{value:0},size:{value:new t.Vector3(256,256,256)},threshold:{value:0},renderDepth:{value:1}},vertexShader:["uniform vec3 size;","out vec2 vUv;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vUv.xy = position.xy / size.yz + 0.5;","}"].join("\n"),fragmentShader:["precision highp float;","precision highp int;","precision highp sampler2DArray;","uniform sampler2DArray diffuse;","uniform vec3 size;","in vec2 vUv;","uniform float depth;","uniform float threshold;","uniform float renderDepth;","void main() {","vec4 color = texture( diffuse, vec3( depth / size.x, vUv.x, floor( vUv.y * size.z ) ) );","float is_opaque = float( color.r > threshold );","gl_FragDepth = (1.0 - is_opaque * renderDepth) * (1.0 - gl_FragCoord.z) + gl_FragCoord.z;","gl_FragColor = vec4( color.rrr, is_opaque );","}"].join("\n")},t}(s),s=function(t){class e extends t.Sprite{constructor(e="",i=10,n="rgba(255, 255, 255, 1)",r="Arial"){super(new t.SpriteMaterial({map:new t.Texture,transparent:!0,opacity:.5})),this._text=e,this._textHeight=i,this._color=n,this._fontFace=r,this._fontSize=90,this._fontWeight="normal",this._canvas=document.createElement("canvas"),this._texture=this.material.map,this._texture.minFilter=t.LinearFilter,this._genCanvas()}get text(){return this._text}set text(t){this._text=t,this._genCanvas()}get textHeight(){return this._textHeight}set textHeight(t){this._textHeight=t,this._genCanvas()}get color(){return this._color}set color(t){this._color=t,this._genCanvas()}get fontFace(){return this._fontFace}set fontFace(t){this._fontFace=t,this._genCanvas()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t,this._genCanvas()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this._genCanvas()}_genCanvas(){const t=this._canvas,e=t.getContext("2d"),i=`${this.fontWeight} ${this.fontSize}px ${this.fontFace}`;e.font=i;const n=e.measureText(this.text).width;t.width=n,t.height=this.fontSize,e.font=i,e.fillStyle=this.color,e.textBaseline="bottom",e.fillText(this.text,0,t.height),this._texture.image=t,this._texture.needsUpdate=!0,this.scale.set(this.textHeight*t.width/t.height,this.textHeight)}clone(){return new this.constructor(this.text,this.textHeight,this.color,this._fontFace).copy(this)}copy(e){return t.Sprite.prototype.copy.call(this,e),this.color=e.color,this.fontFace=e.fontFace,this.fontSize=e.fontSize,this.fontWeight=e.fontWeight,this}}return t.TextSprite=e,t}(s)},3658:(t,e,i)=>{"use strict";i.d(e,{qd:()=>n,Bd:()=>r,nr:()=>s,AA:()=>a,nq:()=>c,jM:()=>h,Ds:()=>u,ht:()=>o,Q0:()=>l});const n=function(t){if(0===t.indexOf("#")&&(t=t.slice(1)),3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),6!==t.length)throw new Error("Invalid HEX color.");var e=(255-parseInt(t.slice(0,2),16)).toString(16),i=(255-parseInt(t.slice(2,4),16)).toString(16),n=(255-parseInt(t.slice(4,6),16)).toString(16);return"#"+r(e)+r(i)+r(n)},r=function(t,e){return e=e||2,(new Array(e).join("0")+t).slice(-e)},s=function(t,e){if("object"!=typeof t&&(t=[t]),null===t)return{};if(t={...t},void 0!==e){old_keys=Object.keys(t);let i={};[...old_keys.keys()].forEach(n=>{i[e[n]]=t[old_keys[n]]}),t=i}return t},a=function(t){return null==t?[]:Array.isArray(t)?t:"object"!=typeof t?[t]:t instanceof Map?[...t.values()]:"[object Map Iterator]"===Object.prototype.toString.call(t)?[...t]:Object.values(t)},o=function(t,e=-1/0){if(0===t.length)return e;let i=1/0;for(let e in t){let n=t[e];Array.isArray(n)&&(n=o(n,i,!0)),n<i&&(i=n)}return i},l=function(t,e){for(let i in t){let n=t[i];Array.isArray(n)?l(n,e):t[i]=n-e}return t};function c(t){return[parseFloat(getComputedStyle(t,null).getPropertyValue("width").replace("px","")),parseFloat(getComputedStyle(t,null).getPropertyValue("height").replace("px",""))]}function h(t,e,i){return t.has(e)?t.get(e):(t.set(e,i),i)}function u(t,e,i){var n;return function(){var r=this,s=arguments,a=function(){n=null,i||t.apply(r,s)},o=i&&!n;clearTimeout(n),n=setTimeout(a,e),o&&t.apply(r,s)}}d=new Float32Array(1),p=new Int32Array(d.buffer);var d,p}},__webpack_module_cache__={},leafPrototypes,getProto,inProgress;function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},getProto=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,__webpack_require__.t=function(t,e){if(1&e&&(t=this(t)),8&e)return t;if("object"==typeof t&&t){if(4&e&&t.__esModule)return t;if(16&e&&"function"==typeof t.then)return t}var i=Object.create(null);__webpack_require__.r(i);var n={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var r=2&e&&t;"object"==typeof r&&!~leafPrototypes.indexOf(r);r=getProto(r))Object.getOwnPropertyNames(r).forEach(e=>n[e]=()=>t[e]);return n.default=()=>t,__webpack_require__.d(i,n),i},__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.f={},__webpack_require__.e=t=>Promise.all(Object.keys(__webpack_require__.f).reduce((e,i)=>(__webpack_require__.f[i](t,e),e),[])),__webpack_require__.u=t=>t+".main.js",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),inProgress={},__webpack_require__.l=(t,e,i,n)=>{if(inProgress[t])inProgress[t].push(e);else{var r,s;if(void 0!==i)for(var a=document.getElementsByTagName("script"),o=0;o<a.length;o++){var l=a[o];if(l.getAttribute("src")==t||l.getAttribute("data-webpack")=="three_brain:"+i){r=l;break}}r||(s=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,__webpack_require__.nc&&r.setAttribute("nonce",__webpack_require__.nc),r.setAttribute("data-webpack","three_brain:"+i),r.src=t),inProgress[t]=[e];var c=(e,i)=>{r.onerror=r.onload=null,clearTimeout(h);var n=inProgress[t];if(delete inProgress[t],r.parentNode&&r.parentNode.removeChild(r),n&&n.forEach(t=>t(i)),e)return e(i)},h=setTimeout(c.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=c.bind(null,r.onerror),r.onload=c.bind(null,r.onload),s&&document.head.appendChild(r)}},__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;__webpack_require__.g.importScripts&&(t=__webpack_require__.g.location+"");var e=__webpack_require__.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=t})(),(()=>{var t={179:0};__webpack_require__.f.j=(e,i)=>{var n=__webpack_require__.o(t,e)?t[e]:void 0;if(0!==n)if(n)i.push(n[2]);else{var r=new Promise((i,r)=>n=t[e]=[i,r]);i.push(n[2]=r);var s=__webpack_require__.p+__webpack_require__.u(e),a=new Error;__webpack_require__.l(s,i=>{if(__webpack_require__.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var r=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;a.message="Loading chunk "+e+" failed.\n("+r+": "+s+")",a.name="ChunkLoadError",a.type=r,a.request=s,n[1](a)}},"chunk-"+e,e)}};var e=(e,i)=>{var n,r,[s,a,o]=i,l=0;for(n in a)__webpack_require__.o(a,n)&&(__webpack_require__.m[n]=a[n]);if(o)o(__webpack_require__);for(e&&e(i);l<s.length;l++)r=s[l],__webpack_require__.o(t,r)&&t[r]&&t[r][0](),t[s[l]]=0},i=self.webpackChunkthree_brain=self.webpackChunkthree_brain||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var __webpack_exports__={};(()=>{"use strict";var _js_download_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(3121),_js_WebGL_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5278),_js_threeplugins_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(178),_js_data_controls_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1658),_js_shiny_tools_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(8173),_js_threejs_scene_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(1619),_js_threebrain_cache_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(5664),_js_constants_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(975),_js_utils_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(3658),json_2_csv__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(7542),json_2_csv__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(json_2_csv__WEBPACK_IMPORTED_MODULE_7__);const utils_toolbox={padZero:_js_utils_js__WEBPACK_IMPORTED_MODULE_6__.Bd,to_array:_js_utils_js__WEBPACK_IMPORTED_MODULE_6__.AA,get_element_size:_js_utils_js__WEBPACK_IMPORTED_MODULE_6__.nq,get_or_default:_js_utils_js__WEBPACK_IMPORTED_MODULE_6__.jM,json2csv:json_2_csv__WEBPACK_IMPORTED_MODULE_7__.json2csv,download:_js_download_js__WEBPACK_IMPORTED_MODULE_8__.L,CONSTANTS:_js_constants_js__WEBPACK_IMPORTED_MODULE_5__.t};class BrainCanvas{constructor(t,e,i,n=!1,r=!1,s=!1,a=!0){this.el=t,r&&(this.el.style.height="100vh",this.el.style.width="100vw"),this.shiny_mode=n,this.DEBUG=a,this.outputId=this.el.getAttribute("data-target"),this.has_webgl=!1,this.check_webgl(),this.el_side=document.createElement("div"),this.el_side.style.maxHeight=i+"px",this.el_side.setAttribute("class","threejs-control"),this.el.appendChild(this.el_side),this.el_control=document.createElement("div"),this.gui_placeholder=document.createElement("div"),this.el_control.style.width="100%",this.el_control.appendChild(this.gui_placeholder),this.el_side.appendChild(this.el_control),this.el_text=document.createElement("div"),this.el_text.style.width="100%",this.el_text.style.padding="10px",this.el_side.appendChild(this.el_text),this.canvas=new _js_threejs_scene_js__WEBPACK_IMPORTED_MODULE_4__.S(this.el,e,i,250,this.shiny_mode,s,this.DEBUG,this.has_webgl2),this.shiny=new _js_shiny_tools_js__WEBPACK_IMPORTED_MODULE_3__.P(this.outputId,this.canvas,this.shiny_mode),this.canvas.animate()}check_webgl(){this.has_webgl=!1,this.has_webgl2=!1,!1===_js_WebGL_js__WEBPACK_IMPORTED_MODULE_0__.$.isWebGLAvailable()?this.el.appendChild(_js_WebGL_js__WEBPACK_IMPORTED_MODULE_0__.$.getWebGLErrorMessage()):(this.has_webgl=!0,!1===_js_WebGL_js__WEBPACK_IMPORTED_MODULE_0__.$.isWebGL2Available()?console.warn("WebGL2 is disabled in this browser, some features might be affected. Force using WebGL instead."):this.has_webgl2=!0)}resize_widget(t,e){if(t<=0||e<=0)return null;this.el_side.style.maxHeight=e+"px",this.hide_controls||!this.control_display?this.canvas.handle_resize(t,e):this.canvas.handle_resize(t-300,e),this._reset_flag&&(this._reset_flag=!1,this.canvas.reset_side_canvas()),this.canvas.start_animation(0)}_register_gui_control(){if(this.gui)try{this.gui.dispose()}catch(t){}const t=new _js_data_controls_js__WEBPACK_IMPORTED_MODULE_2__.E({autoPlace:!1},this.DEBUG);if(this.DEBUG&&(window.gui=t),this.gui=t,this.gui.set_closeHandler(t=>{this.control_display=!this.gui.closed,this.resize_widget(this.el.clientWidth,this.el.clientHeight)}),this.settings.hide_controls)this.hide_controls=!0,this.gui.close();else{const t=this.el_control.firstChild;this.el_control.replaceChild(this.gui.domElement,t),this.hide_controls=!1}const e=this.settings.control_presets,i=new _js_data_controls_js__WEBPACK_IMPORTED_MODULE_2__.B(this.canvas,this.gui,this.settings,this.shiny);this.presets=i,this.DEBUG?window.presets=i:window.__presets=i,i.c_background(),i.c_recorder(),i.c_reset_camera(),i.c_main_camera_position(),i.c_toggle_anchor(),this.settings.side_camera&&(i.c_toggle_side_panel(),i.c_reset_side_panel(),i.c_side_depth(),i.c_side_electrode_dist());let n=!1;return(0,_js_utils_js__WEBPACK_IMPORTED_MODULE_6__.AA)(e).forEach(t=>{try{i["c_"+t](),"animation"===t&&(n=!0)}catch(t){this.DEBUG&&console.warn(t)}}),n||i.c_animation(),t}_set_loader_callbacks(t){this.canvas.loader_manager.onLoad=()=>{this.finalize_render(t)},this.el_text.style.display="block",this.canvas.loader_manager.onProgress=(t,e,i)=>{let n="<p><small>Loaded file: "+e+" of "+i+" files.<br>"+/\/([^/]*)$/.exec(t)[1]+"</small></p>";this.DEBUG&&console.debug(n),this.el_text.innerHTML=n}}render_value(t,e=!1,i){this.geoms=t.geoms,this.settings=t.settings,this.default_controllers=t.settings.default_controllers||{},this.groups=t.groups,this.has_animation=t.settings.has_animation,this.DEBUG=t.settings.debug||!1,this.canvas.DEBUG=this.DEBUG,this.canvas.__reset_flag=!0===e,this.shiny.set_token(this.settings.token),this.DEBUG?(window.__ctrller=this,window.groups=this.groups,window.geoms=this.geoms,window.settings=this.settings,window.canvas=this.canvas,window.scene=this.canvas.scene,this.canvas._add_stats()):(window.__ctrller=this,window.__groups=this.groups,window.__geoms=this.geoms,window.__settings=this.settings,window.__canvas=this.canvas);this.canvas.pause_animation(9999),this.canvas.clear_all(),(0,_js_utils_js__WEBPACK_IMPORTED_MODULE_6__.AA)(this.settings.color_maps).forEach(t=>{this.canvas.add_colormap(t.name,t.alias,t.value_type,t.value_names,t.value_range,t.time_range,t.color_keys,t.color_vals,t.color_levels,t.hard_range)}),this.canvas.loader_triggered=!1,this._set_loader_callbacks(i);let n=this.groups.map(t=>new Promise(e=>{this.canvas.add_group(t,this.settings.cache_folder),e(!0)}));Promise.all(n).then(t=>{this.canvas.loader_triggered||this.finalize_render(i)})}finalize_render(callback){console.debug(this.outputId+" - Finished loading. Adding object"),this.el_text.style.display="none",this.geoms.sort((t,e)=>t.render_order-e.render_order),this.geoms.forEach(t=>{if(this.DEBUG)this.canvas.add_object(t);else try{this.canvas.add_object(t)}catch(t){console.warn(t)}}),this.canvas.finish_init();let display_controllers=this.control_display;this._register_gui_control(),this.shiny.register_gui(this.gui,this.presets),this.canvas.reset_main_camera(void 0,this.settings.start_zoom),this.canvas.set_font_size(this.settings.font_magnification||1);let coords=(0,_js_utils_js__WEBPACK_IMPORTED_MODULE_6__.AA)(this.settings.coords);if(3===coords.length?this.canvas.draw_axis(coords[0],coords[1],coords[2]):this.canvas.draw_axis(0,0,0),this.canvas.main_renderer.compile(this.canvas.scene,this.canvas.main_camera),this.settings.side_camera?(this.canvas.side_canvas.coronal.set_zoom_level(this.settings.side_canvas_zoom||1),this.canvas.side_canvas.axial.set_zoom_level(this.settings.side_canvas_zoom||1),this.canvas.side_canvas.sagittal.set_zoom_level(this.settings.side_canvas_zoom||1),this.canvas.side_renderer.compile(this.canvas.scene,this.canvas.side_canvas.coronal.camera),this.canvas.side_renderer.compile(this.canvas.scene,this.canvas.side_canvas.axial.camera),this.canvas.side_renderer.compile(this.canvas.scene,this.canvas.side_canvas.sagittal.camera),this.settings.side_display?(this.canvas.enable_side_cameras(),this._reset_flag=!0):this.canvas.disable_side_cameras()):this.canvas.disable_side_cameras(),this.shiny_mode&&void 0!==display_controllers||(display_controllers=this.settings.control_display),this.hide_controls||(display_controllers?this.gui.open():this.gui.close()),this.resize_widget(this.el.clientWidth,this.el.clientHeight),this.gui&&(this.presets.update_self(),this.gui.remember(this.default_controllers)),this.canvas.render(),this.canvas.start_animation(0),"function"==typeof callback)try{callback()}catch(t){console.warn(t)}if(this.settings.custom_javascript&&""!==this.settings.custom_javascript){this.canvas.DEBUG&&console.log("[threeBrain]: Executing customized js code:\n"+this.settings.custom_javascript);const _f=(groups,geoms,settings,scene,canvas,gui,presets,shiny,tools)=>{try{eval(this.settings.custom_javascript)}catch(t){console.warn(t)}};_f(this.groups,this.geoms,this.settings,this.scene,this.canvas,this.gui,this.presets,this.shiny,utils_toolbox)}}}window.BrainCanvas=BrainCanvas,window.THREE=_js_threeplugins_js__WEBPACK_IMPORTED_MODULE_1__.J,window.download=_js_download_js__WEBPACK_IMPORTED_MODULE_8__.L,window.THREEBRAIN_STORAGE=_js_threebrain_cache_js__WEBPACK_IMPORTED_MODULE_9__.E})()})();
//# sourceMappingURL=main.js.map